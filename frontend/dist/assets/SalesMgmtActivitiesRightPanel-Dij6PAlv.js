import{r as h,j as t,R as ut}from"./index-BDCdW1US.js";import{a as ht,g as Z}from"./week-BjFFxGNs.js";function pt(){const[a,M]=h.useState(null),[x,T]=h.useState([]),[L,$]=h.useState(!1),[z,B]=h.useState(null),[A,P]=h.useState([]),[_,O]=h.useState(!1),[C,H]=h.useState(null),[k,tt]=h.useState([]),[et,Y]=h.useState(!0),[F,U]=h.useState(null),[I,D]=h.useState(null),[nt,E]=h.useState(!1),[y,st]=h.useState(null);h.useEffect(()=>{if(!I)return;const e=()=>D(null),n=i=>{i.key==="Escape"&&D(null)};return window.addEventListener("click",e),window.addEventListener("keydown",n),()=>{window.removeEventListener("click",e),window.removeEventListener("keydown",n)}},[I]);const it=(e,n)=>{e.preventDefault(),e.stopPropagation(),D({x:e.clientX,y:e.clientY,activity:n})},at=e=>{st(e),E(!0),D(null)};h.useEffect(()=>{let e=!1;async function n(){Y(!0),U(null);try{const i=Z(0),s=new URLSearchParams;s.set("mineOnly","false"),s.set("onlyRoot","true"),s.set("start",i.start.toISOString()),s.set("end",i.end.toISOString());const l=await fetch(`/api/v1/sales-activities?${s.toString()}`);if(!l.ok)throw new Error(`HTTP ${l.status}`);const g=await l.json();if(e)return;const r=new Map;for(const d of Array.isArray(g)?g:[]){const p=d.sfOwnerId||d.assigneeId;if(!p)continue;const f=String(p);r.has(f)||r.set(f,[]),r.get(f).push({id:Number(d.id),subject:d.subject,activityType:d.activityType,activityStatus:d.activityStatus,plannedStartAt:d.plannedStartAt,plannedEndAt:d.plannedEndAt,customerName:d.customerName,sfAccountId:d.sfAccountId})}const u=await fetch("/api/v1/employees"),c=u.ok?await u.json():[],j=new Map;for(const d of Array.isArray(c)?c:[]){const p=String(d.assignee_id??d.emp_id);j.set(p,String(d.emp_name??p))}const o=[];for(const[d,p]of r.entries()){const f=p.length,m=p.filter(w=>w.activityStatus==="완료"||w.activityStatus==="completed").length,b=p.filter(w=>w.activityStatus==="계획"||w.activityStatus==="scheduled").length,R=f>0?Math.round(m/f*100):0;o.push({empName:j.get(d)||d,assigneeId:d,totalActivities:f,completed:m,scheduled:b,completionRate:R})}o.sort((d,p)=>p.totalActivities-d.totalActivities),tt(o)}catch{if(e)return;U("전체 활동 요약을 불러오지 못했습니다")}finally{e||Y(!1)}}return n(),()=>{e=!0}},[]),h.useEffect(()=>{const e=i=>{const s=(i==null?void 0:i.detail)||{};!s.assigneeId||!s.startIso||!s.endIso||M({assigneeId:String(s.assigneeId),empName:String(s.empName||""),startIso:String(s.startIso),endIso:String(s.endIso),status:s.status==="completed"?"completed":s.status==="scheduled"?"scheduled":void 0,label:s.label,isRegion:s.isRegion||!1})},n=i=>{const s=(i==null?void 0:i.detail)||{};!s.assigneeId||!s.startIso||!s.endIso||M({assigneeId:String(s.assigneeId),empName:String(s.empName||""),startIso:String(s.startIso),endIso:String(s.endIso),label:s.label,isRegion:!0})};return window.addEventListener("tnt.sales.activities.select",e),window.addEventListener("tnt.sales.region-plans.select",n),()=>{window.removeEventListener("tnt.sales.activities.select",e),window.removeEventListener("tnt.sales.region-plans.select",n)}},[]),h.useEffect(()=>{if(!a||a.isRegion)return;let e=!1;async function n(){$(!0),B(null);try{const i=new URLSearchParams;i.set("mineOnly","true"),i.set("assigneeId",a.assigneeId),i.set("onlyRoot","true"),i.set("start",a.startIso),i.set("end",a.endIso);const s=await fetch(`/api/v1/sales-activities?${i.toString()}`);if(!s.ok)throw new Error(`HTTP ${s.status}`);const l=await s.json();if(e)return;const g=(Array.isArray(l)?l:[]).map(r=>({id:Number(r.id),subject:r.subject,activityType:r.activityType,activityStatus:r.activityStatus,plannedStartAt:r.plannedStartAt,plannedEndAt:r.plannedEndAt,actualStartAt:r.actualStartAt,customerName:r.customerName,sfAccountId:r.sfAccountId,sfLeadId:r.sfLeadId,companyType:r.companyType,description:r.description,channel:r.channel}));T(g)}catch{if(e)return;B("활동 내역을 불러오지 못했습니다"),T([])}finally{e||$(!1)}}return n(),()=>{e=!0}},[a==null?void 0:a.assigneeId,a==null?void 0:a.startIso,a==null?void 0:a.endIso,a==null?void 0:a.isRegion]),h.useEffect(()=>{if(!a||!a.isRegion)return;let e=!1;async function n(){O(!0),H(null);try{const i=new URLSearchParams;i.set("assigneeId",a.assigneeId),i.set("start",a.startIso),i.set("end",a.endIso);const s=await fetch(`/api/v1/region-activity-plans?${i.toString()}`);if(!s.ok)throw new Error(`HTTP ${s.status}`);const l=await s.json();if(e)return;const g=(Array.isArray(l)?l:[]).map(r=>({id:Number(r.id),subject:r.subject,plannedStartAt:r.planned_start_at||r.plannedStartAt,plannedEndAt:r.planned_end_at||r.plannedEndAt,actualStartAt:r.actual_start_at||r.actualStartAt,actualEndAt:r.actual_end_at||r.actualEndAt,addrProvinceName:r.addr_province_name||r.addrProvinceName,addrDistrictName:r.addr_district_name||r.addrDistrictName,targetCount:typeof r.target_count=="number"?r.target_count:typeof r.targetCount=="number"?r.targetCount:0,targetLabels:r.target_labels||r.targetLabels||null}));P(g)}catch{if(e)return;H("지역 활동 계획을 불러오지 못했습니다"),P([])}finally{e||O(!1)}}return n(),()=>{e=!0}},[a==null?void 0:a.assigneeId,a==null?void 0:a.startIso,a==null?void 0:a.endIso,a==null?void 0:a.isRegion]),h.useMemo(()=>a?`${a.empName||a.assigneeId} — ${a.label||""}`.trim():"활동 상세",[a]);function W(e){if(!e)return"";const n=new Date(e);if(isNaN(n.getTime()))return"";const i=String(n.getMonth()+1).padStart(2,"0"),s=String(n.getDate()).padStart(2,"0"),l=String(n.getHours()).padStart(2,"0"),g=String(n.getMinutes()).padStart(2,"0");return`${i}-${s} ${l}:${g}`}const[S,V]=h.useState(null),[rt,K]=h.useState(!1),[X,q]=h.useState(null),G=h.useRef(null),[lt,ot]=h.useState(0);h.useEffect(()=>{const e=G.current;if(!e)return;const n=new ResizeObserver(i=>{for(const s of i)ot(s.contentRect.width)});return n.observe(e),()=>n.disconnect()},[]);function J(e){const n=new Date(e.getFullYear(),e.getMonth(),e.getDate()),s=(n.getDay()+6)%7,l=new Date(n);return l.setDate(n.getDate()-s),l.setHours(0,0,0,0),l}function Q(e){const n=J(e),i=String(n.getMonth()+1).padStart(2,"0"),s=String(n.getDate()).padStart(2,"0");return`${i}-${s}`}function dt(e){const n=new Date(e.valueOf()),i=(e.getDay()+6)%7;n.setDate(n.getDate()-i+3);const s=new Date(n.getFullYear(),0,4),l=(n.valueOf()-s.valueOf())/864e5;return 1+Math.floor(l/7)}async function ct(e){V(null),K(!0),q(null);try{const n=Z(-1),i=new Date(n.end);i.setHours(23,59,59,999);const s=new Date(n.start);s.setDate(s.getDate()-7*3),s.setHours(0,0,0,0);const l=new URLSearchParams;l.set("mineOnly","false"),l.append("status","completed"),l.set("start",s.toISOString()),l.set("end",i.toISOString()),e.sfAccountId?l.set("sfAccountId",String(e.sfAccountId)):e.customerName&&l.set("customerName",String(e.customerName)),console.log("[Chart Debug] API params:",{customerName:e.customerName,sfAccountId:e.sfAccountId,start:s.toISOString(),end:i.toISOString(),url:`/api/v1/sales-activities?${l.toString()}`});const g=await fetch(`/api/v1/sales-activities?${l.toString()}`);if(!g.ok)throw new Error(`HTTP ${g.status}`);const r=await g.json();console.log("[Chart Debug] API response:",r);const u=new Map,c=[],j=[],o=new Date(s);for(let f=0;f<4;f++){const m=J(o),b=Q(m);c.push(b),j.push(m.toISOString()),u.set(b,0),o.setDate(o.getDate()+7)}console.log("[Chart Debug] Week buckets initialized:",Array.from(u.keys()));for(const f of Array.isArray(r)?r:[]){const m=f.plannedStartAt?new Date(f.plannedStartAt):null;if(!m||isNaN(m.getTime()))continue;const b=Q(m);console.log("[Chart Debug] Activity date:",f.plannedStartAt,"-> label:",b,"has bucket:",u.has(b)),u.has(b)&&u.set(b,(u.get(b)||0)+1)}const d=c.map(f=>u.get(f)||0),p=20;console.log("[Chart Debug] Final counts:",d,"max:",p),V({weeks:c,weekDates:j,counts:d,max:p,customerName:e.customerName})}catch{q("최근 4주 완료 활동 집계를 불러오지 못했습니다")}finally{K(!1)}}const v=h.useMemo(()=>{const e=x.length,n=x.filter(c=>c.activityStatus==="완료"||c.activityStatus==="completed").length,i=x.filter(c=>c.activityStatus==="계획"||c.activityStatus==="scheduled").length,s=x.filter(c=>c.activityStatus==="취소"||c.activityStatus==="cancelled").length,l=x.filter(c=>c.activityStatus==="연기"||c.activityStatus==="postponed").length,g=x.filter(c=>c.activityStatus==="미방문"||c.activityStatus==="no_visit").length,r=e>0?Math.round(n/e*100):0,u=new Map;for(const c of x){const j=c.activityType||"기타";u.set(j,(u.get(j)||0)+1)}return{total:e,completed:n,scheduled:i,cancelled:s,postponed:l,noVisit:g,completionRate:r,typeDistribution:u}},[x]),N=h.useMemo(()=>{const e=A.length,n=A.filter(l=>l.actualStartAt!=null||l.actualEndAt!=null).length,i=A.filter(l=>l.actualStartAt==null&&l.actualEndAt==null).length,s=e>0?Math.round(n/e*100):0;return{total:e,completed:n,scheduled:i,completionRate:s}},[A]);return a?a!=null&&a.isRegion?t.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",gap:12},children:[t.jsx("div",{style:{padding:"6px 10px",fontWeight:600,fontSize:13,borderBottom:"1px solid var(--border)"},children:a.empName||a.assigneeId}),_?t.jsx("div",{className:"muted",style:{fontSize:12,padding:8},children:"불러오는 중…"}):null,C?t.jsx("div",{className:"error",style:{fontSize:12,padding:8},children:C}):null,!_&&!C&&A.length>0&&t.jsx("div",{className:"card",style:{padding:12,border:"1px solid var(--border)",borderRadius:8,background:"var(--panel)"},children:t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:8},children:[t.jsxs("div",{style:{textAlign:"center",padding:"8px 0"},children:[t.jsx("div",{className:"muted",style:{fontSize:10,marginBottom:4},children:"전체"}),t.jsx("div",{style:{fontSize:18,fontWeight:700,color:"#3b82f6"},children:N.total})]}),t.jsxs("div",{style:{textAlign:"center",padding:"8px 0"},children:[t.jsx("div",{className:"muted",style:{fontSize:10,marginBottom:4},children:"완료"}),t.jsx("div",{style:{fontSize:18,fontWeight:700,color:"#10b981"},children:N.completed})]}),t.jsxs("div",{style:{textAlign:"center",padding:"8px 0"},children:[t.jsx("div",{className:"muted",style:{fontSize:10,marginBottom:4},children:"계획"}),t.jsx("div",{style:{fontSize:18,fontWeight:700,color:"#f59e0b"},children:N.scheduled})]}),t.jsxs("div",{style:{textAlign:"center",padding:"8px 0",borderLeft:"1px solid var(--border)"},children:[t.jsx("div",{className:"muted",style:{fontSize:10,marginBottom:4},children:"달성률"}),t.jsxs("div",{style:{fontSize:18,fontWeight:700,color:N.completionRate>=80?"#10b981":N.completionRate>=50?"#f59e0b":"#ef4444"},children:[N.completionRate,"%"]})]})]})}),t.jsx("div",{className:"table-container",style:{flex:1,minHeight:0},children:t.jsxs("table",{className:"table",style:{width:"100%"},children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"제목"}),t.jsx("th",{style:{width:160},children:"지역"}),t.jsx("th",{style:{width:80},children:"상태"}),t.jsx("th",{style:{width:120},children:"시작"}),t.jsx("th",{style:{width:120},children:"거래처수"}),t.jsx("th",{style:{width:140},children:"종료"})]})}),t.jsx("tbody",{children:A.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:6,className:"muted",style:{textAlign:"center"},children:"데이터가 없습니다."})}):A.map(e=>{const n=!!(e.actualStartAt||e.actualEndAt),i=[e.addrProvinceName,e.addrDistrictName].filter(Boolean).join(" "),s=e.actualEndAt?e.actualEndAt:e.actualStartAt?e.actualStartAt:null,l=(e.targetLabels||"").split(/\n+/).map(g=>g.trim()).filter(Boolean);return t.jsxs(ut.Fragment,{children:[t.jsxs("tr",{children:[t.jsx("td",{title:e.subject||"",children:e.subject||""}),t.jsx("td",{children:i||"-"}),t.jsx("td",{children:t.jsx("span",{style:{padding:"2px 6px",borderRadius:4,fontSize:11,fontWeight:600,background:n?"rgba(16,185,129,.15)":"rgba(245,158,11,.15)",color:n?"#10b981":"#f59e0b"},children:n?"완료":"계획"})}),t.jsx("td",{children:W(e.plannedStartAt)}),t.jsx("td",{style:{textAlign:"center",fontWeight:600},children:e.targetCount??0}),t.jsx("td",{children:W(s||void 0)})]}),l.length>0?t.jsx("tr",{children:t.jsx("td",{colSpan:6,style:{background:"var(--panel-2)",borderBottom:"1px solid var(--border)"},children:t.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:10,marginLeft:28},children:l.map((g,r)=>{const u=g.charAt(0),c=g.slice(1).trim(),j=u==="T"?"#3b82f6":u==="D"?"#f97316":u==="잠"?"#a855f7":"#6b7280",o=u==="잠"?"잠":u==="T"||u==="D"?u:"거";return t.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:4,fontSize:11},children:[t.jsx("span",{style:{width:14,height:14,borderRadius:"50%",background:j,color:"#fff",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:9,fontWeight:700},children:o}),t.jsx("span",{children:c})]},`${e.id}-target-${r}`)})})})}):null]},e.id)})})]})})]}):t.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",gap:12},children:[t.jsx("div",{style:{padding:"6px 10px",fontWeight:600,fontSize:13,borderBottom:"1px solid var(--border)"},children:a.empName||a.assigneeId}),L?t.jsx("div",{className:"muted",style:{fontSize:12,padding:8},children:"불러오는 중…"}):null,z?t.jsx("div",{className:"error",style:{fontSize:12,padding:8},children:z}):null,!L&&!z&&x.length>0&&t.jsxs("div",{className:"card",style:{padding:12,border:"1px solid var(--border)",borderRadius:8,background:"var(--panel)"},children:[t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:8,marginBottom:8},children:[t.jsxs("div",{style:{textAlign:"center",padding:"6px 0"},children:[t.jsx("div",{className:"muted",style:{fontSize:10,marginBottom:4},children:"전체"}),t.jsx("div",{style:{fontSize:18,fontWeight:700,color:"#3b82f6"},children:v.total})]}),t.jsxs("div",{style:{textAlign:"center",padding:"6px 0"},children:[t.jsx("div",{className:"muted",style:{fontSize:10,marginBottom:4},children:"완료"}),t.jsx("div",{style:{fontSize:18,fontWeight:700,color:"#10b981"},children:v.completed})]}),t.jsxs("div",{style:{textAlign:"center",padding:"6px 0"},children:[t.jsx("div",{className:"muted",style:{fontSize:10,marginBottom:4},children:"계획"}),t.jsx("div",{style:{fontSize:18,fontWeight:700,color:"#f59e0b"},children:v.scheduled})]})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:8,borderTop:"1px solid var(--border)",paddingTop:8},children:[t.jsxs("div",{style:{textAlign:"center",padding:"6px 0"},children:[t.jsx("div",{className:"muted",style:{fontSize:10,marginBottom:4},children:"취소"}),t.jsx("div",{style:{fontSize:16,fontWeight:600,color:"#6b7280"},children:v.cancelled})]}),t.jsxs("div",{style:{textAlign:"center",padding:"6px 0"},children:[t.jsx("div",{className:"muted",style:{fontSize:10,marginBottom:4},children:"연기"}),t.jsx("div",{style:{fontSize:16,fontWeight:600,color:"#6b7280"},children:v.postponed})]}),t.jsxs("div",{style:{textAlign:"center",padding:"6px 0"},children:[t.jsx("div",{className:"muted",style:{fontSize:10,marginBottom:4},children:"미방문"}),t.jsx("div",{style:{fontSize:16,fontWeight:600,color:"#6b7280"},children:v.noVisit})]}),t.jsxs("div",{style:{textAlign:"center",padding:"6px 0",borderLeft:"1px solid var(--border)"},children:[t.jsx("div",{className:"muted",style:{fontSize:10,marginBottom:4},children:"달성률"}),t.jsxs("div",{style:{fontSize:16,fontWeight:700,color:v.completionRate>=80?"#10b981":v.completionRate>=50?"#f59e0b":"#ef4444"},children:[v.completionRate,"%"]})]})]})]}),!L&&!z&&x.length>0&&v.typeDistribution.size>0&&t.jsxs("div",{className:"card",style:{padding:10,border:"1px solid var(--border)",borderRadius:8,background:"var(--panel)"},children:[t.jsx("div",{style:{fontSize:11,marginBottom:6,color:"var(--text-muted)",fontWeight:600},children:"활동 유형"}),t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:4},children:Array.from(v.typeDistribution.entries()).sort((e,n)=>n[1]-e[1]).slice(0,5).map(([e,n])=>{const i=Math.round(n/v.total*100);return t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[t.jsx("div",{style:{minWidth:70,fontSize:11,color:"var(--text)"},children:e}),t.jsxs("div",{style:{flex:1,position:"relative",height:18,background:"rgba(0,0,0,.06)",borderRadius:3},children:[t.jsx("div",{style:{width:`${i}%`,height:"100%",background:"linear-gradient(90deg, #3b82f6, #6366f1)",borderRadius:3,transition:"width .3s ease"}}),t.jsx("div",{style:{position:"absolute",right:4,top:0,bottom:0,display:"flex",alignItems:"center",fontSize:10,fontWeight:600,color:"var(--text)"},children:n})]})]},e)})})]}),t.jsx("div",{className:"table-container",style:{flex:"0 0 40%",minHeight:0},children:t.jsxs("table",{className:"table",style:{width:"100%"},children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"거래처"}),t.jsx("th",{children:"제목"}),t.jsx("th",{style:{width:110},children:"유형"}),t.jsx("th",{style:{width:110},children:"상태"}),t.jsx("th",{style:{width:120},children:"시작"}),t.jsx("th",{style:{width:120},children:"종료"})]})}),t.jsx("tbody",{children:x.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:6,className:"muted",style:{textAlign:"center"},children:"데이터가 없습니다."})}):x.map(e=>t.jsxs("tr",{onClick:()=>ct(e),onContextMenu:n=>it(n,e),style:{cursor:"pointer"},title:"좌클릭: 주간 완료 활동 집계 / 우클릭: 활동 상세",children:[t.jsx("td",{title:e.customerName||"",children:t.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[(()=>{const n=(e.companyType||"").toUpperCase(),i=!!e.sfLeadId;return n.includes("TNT")?t.jsx("span",{style:{width:16,height:16,borderRadius:"50%",background:"#3b82f6",color:"#fff",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:700},children:"T"}):n.includes("DYS")?t.jsx("span",{style:{width:16,height:16,borderRadius:"50%",background:"#f97316",color:"#fff",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:700},children:"D"}):i?t.jsx("span",{style:{width:16,height:16,borderRadius:"50%",background:"#a855f7",color:"#fff",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:700},children:"잠"}):null})(),t.jsx("span",{children:e.customerName||"-"})]})}),t.jsx("td",{title:e.subject||"",children:e.subject||""}),t.jsx("td",{children:e.activityType||""}),t.jsx("td",{children:e.activityStatus||""}),t.jsx("td",{children:W(e.plannedStartAt)}),t.jsx("td",{children:W(e.plannedEndAt)})]},e.id))})]})}),t.jsxs("div",{style:{marginTop:8,flex:"1 1 auto",minHeight:0,display:"flex",flexDirection:"column"},children:[rt?t.jsx("div",{className:"muted",style:{fontSize:12},children:"주간 집계를 불러오는 중…"}):null,X?t.jsx("div",{className:"error",style:{fontSize:12},children:X}):null,S&&(()=>{const e=S.weeks.length,n=6,s=Math.max(0,lt-32-8),l=e>0?Math.max(12,Math.min(36,Math.floor((s-n*(e-1))/e))):14,g=120,r=S.weekDates.map(o=>{const d=new Date(o);return`${dt(d)}주차`}),u=S.weekDates.map(o=>{const d=new Date(o),p=d.getFullYear(),f=d.getMonth()+1;return{key:`${p}-${String(f).padStart(2,"0")}`,label:`${f}월`}}),c=[];for(let o=0;o<u.length;o++)o===0?c.push({key:u[o].key,label:u[o].label,start:0,count:1}):u[o].key===u[o-1].key?c[c.length-1].count+=1:c.push({key:u[o].key,label:u[o].label,start:o,count:1});const j=o=>o*l+(o-1)*n;return t.jsx("div",{ref:G,className:"card",style:{padding:8,border:"1px solid var(--border)",borderRadius:10},children:t.jsxs("div",{style:{display:"flex",alignItems:"flex-end",gap:6},children:[t.jsxs("div",{style:{height:g,display:"flex",flexDirection:"column",justifyContent:"space-between",paddingRight:6,color:"var(--muted)",fontSize:10},children:[t.jsx("div",{children:S.max}),t.jsx("div",{children:"0"})]}),t.jsxs("div",{style:{position:"relative",flex:1},children:[t.jsx("div",{style:{position:"absolute",left:0,right:0,bottom:0,height:1,background:"var(--border)"}}),t.jsx("div",{style:{display:"flex",alignItems:"flex-end",height:g},children:c.map((o,d)=>t.jsxs("div",{style:{display:"flex",flexDirection:"column",position:"relative",marginLeft:d>0?n:0},children:[d>0?t.jsx("div",{style:{position:"absolute",left:0,bottom:0,height:g,width:1,background:"var(--border)",opacity:.5}}):null,t.jsx("div",{style:{display:"flex",alignItems:"flex-end",gap:n,height:g},children:Array.from({length:o.count}).map((p,f)=>{const m=o.start+f,b=S.weeks[m],R=S.counts[m],w=S.max>0?Math.round(R/S.max*100):0;return t.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-end",width:l,height:g},children:R>0&&t.jsx("div",{style:{height:`${w}%`,minHeight:8,width:Math.max(8,l-6),background:"#3b82f6",borderRadius:4},title:`${r[m]}: ${R}건`})},b)})})]},`g-${o.key}-${d}`))}),t.jsx("div",{style:{display:"flex",marginTop:4},children:c.map((o,d)=>t.jsx("div",{style:{display:"flex",gap:n,marginLeft:d>0?n:0},children:Array.from({length:o.count}).map((p,f)=>{const m=o.start+f;return t.jsx("div",{className:"muted",style:{minWidth:l,textAlign:"center",fontSize:10,whiteSpace:"nowrap"},children:r[m]},`w-${m}`)})},`gl-${o.key}-${d}`))}),t.jsx("div",{style:{display:"flex",marginTop:2},children:c.map((o,d)=>t.jsx("div",{style:{width:j(o.count),marginLeft:d>0?n:0,textAlign:"center",fontSize:10,color:"var(--muted)",whiteSpace:"nowrap"},children:o.label},`gm-${o.key}-${d}`))})]})]})})})()]}),I&&t.jsx("div",{style:{position:"fixed",left:I.x,top:I.y,background:"var(--panel)",border:"1px solid var(--border)",borderRadius:8,boxShadow:"0 4px 12px rgba(0,0,0,.15)",zIndex:1e4,minWidth:160,padding:"4px 0"},onClick:e=>e.stopPropagation(),children:t.jsx("button",{className:"btn",onClick:()=>at(I.activity),style:{width:"100%",textAlign:"left",padding:"8px 16px",border:"none",background:"transparent",cursor:"pointer",fontSize:13,fontWeight:500,borderRadius:0},onMouseEnter:e=>{e.currentTarget.style.background="rgba(59,130,246,.1)"},onMouseLeave:e=>{e.currentTarget.style.background="transparent"},children:"활동 상세"})}),nt&&y&&t.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,.4)"},onClick:()=>E(!1),children:t.jsxs("div",{className:"card",style:{width:"min(920px, 92vw)",maxHeight:"90vh",overflow:"auto",padding:16,background:"var(--panel)",border:"1px solid var(--border)",borderRadius:12,boxShadow:"0 8px 32px rgba(0,0,0,.2)"},onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:12},children:[t.jsx("h3",{style:{margin:0,fontSize:16,fontWeight:700},children:"영업활동 상세"}),t.jsx("button",{className:"btn",onClick:()=>E(!1),style:{padding:"4px 12px",fontSize:13,background:"var(--panel-2)",border:"1px solid var(--border)"},children:"닫기"})]}),t.jsx(ht,{bare:!0,editId:y.id,initial:{id:y.id,subject:y.subject,description:y.description,channel:y.channel,activityType:y.activityType,activityStatus:y.activityStatus,plannedStartAt:y.plannedStartAt,actualStartAt:y.actualStartAt,sfAccountId:y.sfAccountId,customerName:y.customerName},onSaved:()=>{if(E(!1),a&&!a.isRegion){const e=new URLSearchParams;e.set("mineOnly","true"),e.set("assigneeId",a.assigneeId),e.set("onlyRoot","true"),e.set("start",a.startIso),e.set("end",a.endIso),fetch(`/api/v1/sales-activities?${e.toString()}`).then(n=>n.ok?n.json():[]).then(n=>{const i=(Array.isArray(n)?n:[]).map(s=>({id:Number(s.id),subject:s.subject,activityType:s.activityType,activityStatus:s.activityStatus,plannedStartAt:s.plannedStartAt,plannedEndAt:s.plannedEndAt,actualStartAt:s.actualStartAt,customerName:s.customerName,sfAccountId:s.sfAccountId,sfLeadId:s.sfLeadId,companyType:s.companyType,description:s.description,channel:s.channel}));T(i)}).catch(()=>{})}}})]})})]}):t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12,padding:12},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[t.jsx("h2",{style:{margin:0,fontSize:14,fontWeight:600},children:"영업사원 전체 활동 현황"}),t.jsx("div",{className:"muted",style:{fontSize:11},children:"이번주"})]}),et?t.jsx("div",{className:"muted",style:{fontSize:12},children:"불러오는 중…"}):F?t.jsx("div",{className:"error",style:{fontSize:12},children:F}):k.length===0?t.jsx("div",{className:"muted",style:{fontSize:12},children:"활동 데이터가 없습니다."}):t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:8},children:[t.jsxs("div",{className:"card",style:{padding:12,border:"1px solid var(--border)",borderRadius:8,textAlign:"center"},children:[t.jsx("div",{className:"muted",style:{fontSize:10,marginBottom:4},children:"전체 활동"}),t.jsx("div",{style:{fontSize:20,fontWeight:700,color:"#3b82f6"},children:k.reduce((e,n)=>e+n.totalActivities,0)})]}),t.jsxs("div",{className:"card",style:{padding:12,border:"1px solid var(--border)",borderRadius:8,textAlign:"center"},children:[t.jsx("div",{className:"muted",style:{fontSize:10,marginBottom:4},children:"완료"}),t.jsx("div",{style:{fontSize:20,fontWeight:700,color:"#10b981"},children:k.reduce((e,n)=>e+n.completed,0)})]}),t.jsxs("div",{className:"card",style:{padding:12,border:"1px solid var(--border)",borderRadius:8,textAlign:"center"},children:[t.jsx("div",{className:"muted",style:{fontSize:10,marginBottom:4},children:"계획"}),t.jsx("div",{style:{fontSize:20,fontWeight:700,color:"#f59e0b"},children:k.reduce((e,n)=>e+n.scheduled,0)})]})]}),t.jsx("div",{className:"card",style:{border:"1px solid var(--border)",borderRadius:8,overflow:"hidden"},children:t.jsx("div",{style:{maxHeight:"60vh",overflowY:"auto"},children:t.jsxs("table",{className:"table",style:{width:"100%"},children:[t.jsx("thead",{style:{position:"sticky",top:0,background:"var(--panel)",zIndex:1},children:t.jsxs("tr",{children:[t.jsx("th",{style:{textAlign:"left"},children:"영업사원"}),t.jsx("th",{style:{textAlign:"center",width:80},children:"전체"}),t.jsx("th",{style:{textAlign:"center",width:80},children:"완료"}),t.jsx("th",{style:{textAlign:"center",width:80},children:"계획"}),t.jsx("th",{style:{textAlign:"center",width:80},children:"달성률"})]})}),t.jsx("tbody",{children:k.map(e=>{const n=e.completionRate>=80?"#10b981":e.completionRate>=50?"#f59e0b":"#ef4444";return t.jsxs("tr",{children:[t.jsx("td",{style:{fontWeight:500},children:e.empName}),t.jsx("td",{style:{textAlign:"center",color:"#3b82f6",fontWeight:600},children:e.totalActivities}),t.jsx("td",{style:{textAlign:"center",color:"#10b981",fontWeight:600},children:e.completed}),t.jsx("td",{style:{textAlign:"center",color:"#f59e0b",fontWeight:600},children:e.scheduled}),t.jsxs("td",{style:{textAlign:"center",color:n,fontWeight:700},children:[e.completionRate,"%"]})]},e.assigneeId)})})]})})}),t.jsx("div",{className:"muted",style:{fontSize:11,padding:8,textAlign:"center"},children:"좌측 그래프를 클릭하면 개별 영업사원의 상세 활동을 볼 수 있습니다."})]})]})}export{pt as SalesMgmtActivitiesRightPanel};
