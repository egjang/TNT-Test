import{r as t,j as e,_ as nn,R as ke,m as Bn,d as Un,a as Hn,g as an,b as Bs,o as Yn,i as Us,s as Kn,c as jn,e as vn,w as rn,t as Qn}from"./index-BDCdW1US.js";import{DemandList as Jn}from"./DemandList-CjKV81Oz.js";import{c as dt}from"./close-CV7tuFPj.js";import{t as st}from"./tone-B1QjB-CC.js";import{u as At}from"./useDraggableModal-BXE2A0Ge.js";import{S as yt,a as Ns,g as ln,f as Xn}from"./week-BjFFxGNs.js";const wt={demandManagement:!0,customerManagement:!0};function Gn(){const s=t.useRef(null),[u,p]=t.useState(null),[_,F]=t.useState([]),[B,q]=t.useState(null),[X,R]=t.useState([]),[se,V]=t.useState([]),[N,y]=t.useState(null),[A,O]=t.useState(!1),[b,d]=t.useState(null),[x,r]=t.useState(0),[T,S]=t.useState(""),w=()=>{var ie;return(ie=s.current)==null?void 0:ie.click()},l=async ie=>{var m;y(null);const n=(m=ie.target.files)==null?void 0:m[0];if(p(n?n.name:null),R([]),F([]),q(null),!!n)try{const P=await nn(()=>import("./xlsx-D_0l8YDs.js"),[]),h=await n.arrayBuffer(),o=P.read(h,{type:"array"}),M=o.SheetNames||[];F(M);const G=M[0];if(q(G||null),G){const H=o.Sheets[G],j=P.utils.sheet_to_json(H,{header:1});V(j),R(j)}}catch(P){y("엑셀 파일을 읽는 중 오류가 발생했습니다. 파일 형식을 확인해 주세요."),console.error(P)}},C=X&&X.length>0,Y=t.useMemo(()=>{if(!C)return null;const ie=X.reduce((n,m)=>Math.max(n,Array.isArray(m)?m.length:0),0);return e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsx("tr",{children:Array.from({length:ie}).map((n,m)=>e.jsxs("th",{children:["C",m+1]},m))})}),e.jsx("tbody",{children:X.map((n,m)=>e.jsx("tr",{children:Array.from({length:ie}).map((P,h)=>e.jsx("td",{children:Array.isArray(n)&&n[h]!=null?String(n[h]):""},h))},m))})]})})},[X,C]),ue=async ie=>{var P,h;const n=ie.target.value;q(n);const m=(h=(P=s.current)==null?void 0:P.files)==null?void 0:h[0];if(m)try{const o=await nn(()=>import("./xlsx-D_0l8YDs.js"),[]),M=await m.arrayBuffer(),H=o.read(M,{type:"array"}).Sheets[n],j=o.utils.sheet_to_json(H,{header:1});V(j),R(j)}catch(o){y("시트를 전환하는 중 오류가 발생했습니다."),console.error(o)}};return e.jsxs("section",{children:[e.jsxs("div",{className:"page-title",style:{alignItems:"center"},children:[e.jsx("h2",{style:{margin:0,fontSize:18},children:"Excel Upload"}),e.jsx("div",{className:"muted count-text"})]}),e.jsx("p",{children:"로컬 PC에서 엑셀 파일(.xlsx, .xls)만 선택할 수 있습니다."}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[e.jsx("input",{ref:s,type:"file",accept:".xlsx,.xls,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel",onChange:l,style:{display:"none"}}),e.jsx("button",{className:"btn",onClick:w,children:"엑셀 파일 선택"}),u&&e.jsxs("span",{className:"muted",children:["선택됨: ",u]})]}),_.length>1&&e.jsx("div",{style:{marginTop:10},children:e.jsxs("label",{children:["시트 선택: ",e.jsx("select",{value:B??"",onChange:ue,children:_.map(ie=>e.jsx("option",{value:ie,children:ie},ie))})]})}),N&&e.jsx("div",{className:"error",children:N}),Y,C&&e.jsxs("div",{style:{marginTop:12,display:"flex",alignItems:"center",gap:10},children:[e.jsx("button",{type:"button",className:"btn",disabled:A,onClick:async ie=>{ie.preventDefault(),ie.stopPropagation(),d(null),y(null);try{O(!0),r(0),S("데이터 준비 중...");const n=Vn(se);if(!n.length)throw new Error("업로드할 데이터가 없습니다. 엑셀 내용을 확인해 주세요.");const P=ea(n,250);let h=0,o=0,M=0;for(let G=0;G<P.length;G++){const H=P[G];S(`업로드 중... (${G+1}/${P.length})`);const j=await fetch("/api/v1/demand/upload",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:H})});if(!j.ok){const c=await j.text();try{const i=JSON.parse(c),v=(i==null?void 0:i.error)||c||`Upload failed: ${j.status}`;throw new Error(v)}catch{throw new Error(`Upload failed: ${j.status} ${c}`)}}const te=await j.json();o+=Number(te.updated||0),M+=Number(te.inserted||0),h+=H.length,r(Math.min(100,Math.round(h/n.length*100)))}S("완료"),d(`성공: 총 ${o+M}건 (업데이트 ${o}, 신규 ${M})`)}catch(n){y(n.message||"업로드 중 오류가 발생했습니다")}finally{O(!1),setTimeout(()=>{r(0),S("")},1200)}},children:"업로드"}),b&&e.jsx("span",{className:"muted",children:b})]}),A&&e.jsxs("div",{style:{marginTop:10,width:"100%"},children:[e.jsx("div",{className:"progress",children:e.jsx("div",{className:"progress-bar",style:{width:`${x}%`}})}),e.jsxs("div",{className:"muted",style:{marginTop:6},children:[T," ",x>0?`${x}%`:""]})]})]})}function Vn(s){if(!s||s.length===0)return[];const u=s[0].map(b=>String(b||"").trim()),p=s.slice(1);function _(b){return u.map((d,x)=>b.some(r=>Ds(d,r))?x:-1).filter(d=>d>=0)}const F=u.findIndex(b=>["영업담당자","영업사원","sales_owner","sales_rep","sales_rep_name"].some(d=>Ds(b,d))),B=u.findIndex(b=>["거래처","고객","customer"].some(d=>Ds(b,d))),q=u.findIndex(b=>["중분류","품목중분류","종분류","category_mid","item_subcategory"].some(d=>Ds(b,d))),X=_(["공급사(tnt)","공급사 tnt","tnt","공급사","공급자","supplier"]),R=_(["영업관리단위","관리단위","mgmt_unit","sales_mgmt_unit"]),se=_(["점유율(%)","점유율","share","share_rate"]),V=Math.max(X.length,R.length,se.length),N=[];let y=null,A=null,O=null;for(const b of p){let d=ds(b,F).trim(),x=ds(b,B).trim(),r=ds(b,q).trim();if(d||(d=y||""),x||(x=A||""),r||(r=O||""),!d||!x||!r){d&&(y=d),x&&(A=x),r&&(O=r);continue}y=d,A=x,O=r;for(let T=0;T<V;T++){const S=ds(b,X[T]).trim(),w=ds(b,R[T]).trim(),l=Zn(ds(b,se[T])),C=l!=null&&l!==0;if(!(S||w||C))continue;const Y=C?l:null;N.push({salesRepName:d,customerName:x,itemSubcategory:r,supplierName:S,salesMgmtUnit:w,shareRate:Y,priority:T+1})}}return N}function ds(s,u){return u>=0?s[u]??"":""}function on(s){return String(s||"").replace(/[\s\-_%()\[\]{}]/g,"").replace(/tnt/gi,"").toLowerCase()}function Ds(s,u){return on(s)===on(u)}function Zn(s){if(s==null)return null;const u=Number(String(s).replace(/[,\s%]/g,""));return Number.isFinite(u)?u:null}function ea(s,u){const p=[];for(let _=0;_<s.length;_+=u)p.push(s.slice(_,_+u));return p}const bn="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='20'%20height='20'%20viewBox='0%200%2024%2024'%20fill='none'%20stroke='currentColor'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'%20aria-hidden='true'%3e%3cpath%20d='M20.59%2013.41%2011%203H4v7l9.59%209.59a2%202%200%200%200%202.82%200l4.18-4.18a2%202%200%200%200%200-2.82Z'/%3e%3ccircle%20cx='7.5'%20cy='7.5'%20r='1.5'/%3e%3c/svg%3e";function ta(s){if(!s)return"";const u=s instanceof Date?s:new Date(s);if(isNaN(u.getTime()))return"";const p=String(u.getFullYear()%100).padStart(2,"0"),_=String(u.getMonth()+1).padStart(2,"0"),F=String(u.getDate()).padStart(2,"0"),B=String(u.getHours()).padStart(2,"0"),q=String(u.getMinutes()).padStart(2,"0");return`${p}-${_}-${F} ${B}:${q}`}function cn(){const[s,u]=t.useState(""),[p,_]=t.useState(""),[F,B]=t.useState(""),[q,X]=t.useState(!1),[R,se]=t.useState(null),[V,N]=t.useState([]),[y,A]=t.useState(""),[O,b]=t.useState(!1),[d,x]=t.useState({open:!1,x:0,y:0}),[r,T]=t.useState(()=>new Set),[S,w]=t.useState({open:!1,x:0,y:0}),[l,C]=t.useState(void 0),[Y,ue]=t.useState("init"),[ie,n]=t.useState({}),[m,P]=t.useState("TNT"),h=100,[o,M]=t.useState(0),[G,H]=t.useState(!0),[j,te]=t.useState(!1),c=ke.useRef(null),[i,v]=t.useState(0),g=["init","sim","apply","confirm"],z=[{key:"init",label:"초기설정"},{key:"sim",label:"Simulation"},{key:"apply",label:"목표반영"},{key:"confirm",label:"확정"}],I=g.indexOf(Y),ge=()=>{const k=Math.max(0,I-1);ue(g[k])},re=()=>{const k=Math.min(g.length-1,I+1);ue(g[k])};function Z(){const k=[];for(let ae=2030;ae>=2026;ae--)k.push(ae);return k}const[ye,L]=t.useState(""),[he,fe]=t.useState(!1),[Se,Ae]=t.useState(null),[E,ve]=t.useState({tnt:0,dys:0}),[ee,_e]=t.useState({tnt:0,dys:0}),[Pe,Te]=t.useState({tnt:0,dys:0}),me=new Intl.NumberFormat("ko-KR");function Ue(k,ae){return Number.isFinite(k)?k:0}function Je(k,ae){const je=Number.isFinite(k)&&k>0,Ie=je?Ue(k):0;return e.jsxs("div",{style:{textAlign:"right",lineHeight:1.15},children:[e.jsx("div",{children:je?k%1===0?Math.round(k).toLocaleString():k.toFixed(2):"-"}),e.jsx("div",{className:"muted",style:{fontSize:11},children:je?`${me.format(Math.round(Ie))} 원`:""})]})}async function ht(){fe(!0),Ae(null);try{const k=(localStorage.getItem("tnt.sales.empName")||"").trim();if(!k){ve({tnt:0,dys:0}),Ae("로그인이 필요합니다");return}if(!ye||isNaN(Number(ye))){ve({tnt:0,dys:0});return}const ae=new URL("/api/v1/targets/assigned",window.location.origin);ae.searchParams.set("year",String(ye)),ae.searchParams.set("empNames",k);try{const Ee=(localStorage.getItem("tnt.sales.assign.mode")||"").toLowerCase(),qe=Ee==="moderate"?"2":Ee==="best"?"1":"";qe&&ae.searchParams.set("versionNo",qe)}catch{}const je=await fetch(ae.toString());if(!je.ok)throw new Error(`HTTP ${je.status}`);const Ie=await je.json().catch(()=>[]),Le=Array.isArray(Ie)?Ie.find(Ee=>String(Ee.company_name||"").toUpperCase()==="TNT"):null,Ne=Array.isArray(Ie)?Ie.find(Ee=>String(Ee.company_name||"").toUpperCase()==="DYS"):null;ve({tnt:Math.round(Number((Le==null?void 0:Le.assigned_amount)||0)),dys:Math.round(Number((Ne==null?void 0:Ne.assigned_amount)||0)),tntStage:String((Le==null?void 0:Le.target_stage)||"").trim()||void 0,dysStage:String((Ne==null?void 0:Ne.target_stage)||"").trim()||void 0})}catch(k){Ae((k==null?void 0:k.message)||"조회 오류"),ve({tnt:0,dys:0})}finally{fe(!1)}}const[We,Ve]=t.useState(0);t.useEffect(()=>{const k=()=>Ve(ae=>ae+1);return window.addEventListener("tnt.sales.assign.mode.changed",k),()=>window.removeEventListener("tnt.sales.assign.mode.changed",k)},[]),t.useEffect(()=>{ht()},[ye,We]);const[rt,jt]=t.useState(!1),[nt,ut]=t.useState(null);new Date().getFullYear();const[Ze,Tt]=t.useState("prev1"),[gt,Zt]=t.useState(()=>new Array(12).fill(0)),[es,kt]=t.useState({loading:!1});async function St(){if(!(l!=null&&l.customerSeq)){Zt(new Array(12).fill(0));return}jt(!0),ut(null);try{const k=new Date().getFullYear(),ae=Ze==="prev1"?[k-1]:Ze==="last2"?[k-1,k-2]:[k-1,k-2,k-3],je=[];await Promise.all(ae.map(async Ee=>{try{const qe=await fetch(`/api/v1/customers/${l.customerSeq}/invoice-monthly-by-dim?year=${Ee}`);if(!qe.ok)return;const at=await qe.json().catch(()=>[]),ft=Ye=>{const it=String(Ye??"").trim();return it.toLowerCase()==="na"?"":it},bt=(Array.isArray(at)?at:[]).map(Ye=>({itemSubcategorySeq:Number(Ye.itemSubcategorySeq??Ye.item_subcategory_seq??0),salesMgmtUnitSeq:Number(Ye.salesMgmtUnitSeq??Ye.sales_mgmt_unit_seq??0),itemSubcategory:ft(Ye.itemSubcategory??Ye.item_subcategory),salesMgmtUnit:ft(Ye.salesMgmtUnit??Ye.sales_mgmt_unit),month:Number(Ye.month??0),amount:Number(Ye.amount??0)}));je.push(...bt)}catch{}}));const Ie=new Map,Le=(Ee,qe)=>`${(Ee||"").trim().toLowerCase()}||${(qe||"").trim().toLowerCase()}`;for(const Ee of je){const qe=Le(Ee.itemSubcategory,Ee.salesMgmtUnit);let at=Ie.get(qe);at||(at={sub:Ee.itemSubcategory||"",unit:Ee.salesMgmtUnit||"",months:new Array(12).fill(0)},Ie.set(qe,at));const ft=Math.min(12,Math.max(1,Number(Ee.month)||0))-1;at.months[ft]+=Number.isFinite(Ee.amount)?Number(Ee.amount):0}const Ne=Array.from(Ie.values()).sort((Ee,qe)=>(Ee.sub||"").localeCompare(qe.sub||"")||(Ee.unit||"").localeCompare(qe.unit||""));is(Ne)}catch(k){ut(k.message||"조회 중 오류가 발생했습니다"),is([])}finally{jt(!1)}}t.useEffect(()=>{Y==="init"&&St()},[Y,l==null?void 0:l.customerSeq,Ze]);async function vt(){if(!(l!=null&&l.customerSeq)){kt({loading:!1,hasRecent:void 0,error:null});return}kt({loading:!0,hasRecent:void 0,error:null});try{const k=new URL("/api/v1/customers/recent-invoice-flags",window.location.origin);k.searchParams.set("custSeq",String(l.customerSeq)),k.searchParams.set("years","2");const ae=await fetch(k.toString());if(!ae.ok){let Le=`HTTP ${ae.status}`;try{const Ne=await ae.json();Ne!=null&&Ne.error&&(Le=Ne.error)}catch{}throw new Error(Le)}const je=await ae.json(),Ie=Array.isArray(je)&&je.some(Le=>Number((Le==null?void 0:Le.customerSeq)||(Le==null?void 0:Le.customerSeqText)||0)===Number(l.customerSeq)&&!!(Le!=null&&Le.hasRecent));kt({loading:!1,hasRecent:Ie,error:null})}catch(k){kt({loading:!1,hasRecent:void 0,error:k.message||"오류"})}}t.useEffect(()=>{Y==="init"&&vt()},[Y,l==null?void 0:l.customerSeq]);const[_t,is]=t.useState([]),ls=t.useMemo(()=>e.jsx("div",{className:"table-container",style:{border:"1px solid var(--border)",borderRadius:8,marginTop:8},children:e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:220,textAlign:"left"},children:"중분류"}),e.jsx("th",{style:{width:220,textAlign:"left"},children:"영업관리단위"}),e.jsx("th",{style:{width:120,textAlign:"center"},children:"목표입력"}),Array.from({length:12},(k,ae)=>e.jsxs("th",{style:{width:90,textAlign:"right"},children:[String(ae+1).padStart(2,"0"),"월"]},ae))]})}),e.jsx("tbody",{children:_t.length===0?e.jsx("tr",{children:e.jsx("td",{className:"muted",colSpan:15,style:{padding:"12px 10px"},children:rt?"불러오는 중…":"데이터가 없습니다"})}):_t.map((k,ae)=>e.jsxs("tr",{children:[e.jsx("td",{children:k.sub}),e.jsx("td",{children:k.unit}),e.jsx("td",{style:{textAlign:"center"},children:e.jsx("button",{className:"btn btn-card btn-3d",onClick:()=>ps(k.sub,k.unit),children:"목표입력"})}),k.months.map((je,Ie)=>e.jsx("td",{style:{textAlign:"right"},children:Math.round(je).toLocaleString()},Ie))]},ae))})]})}),[_t,rt]),[lt,Rt]=t.useState({open:!1,dist:new Array(12).fill(0)});function ps(k,ae){Rt({open:!0,sub:k,unit:ae,month:"",qty:"",dist:new Array(12).fill(0)})}function qt(){Rt({open:!1,dist:new Array(12).fill(0)})}function Wt(k,ae){const je=Number(k),Ie=Number(ae),Le=new Array(12).fill(0);if(Number.isFinite(je)&&je>=1&&je<=12&&Number.isFinite(Ie)&&Ie>0){const Ne=12-je+1,Ee=Ie/Ne;for(let qe=je-1;qe<12;qe++)Le[qe]=Ee}Rt(Ne=>({...Ne,month:k,qty:ae,dist:Le}))}const[Ct,$t]=t.useState({open:!1,rows:[]});function Qe(){const k=(_t||[]).map((ae,je)=>({key:`${ae.sub}||${ae.unit}||${je}`,sub:ae.sub,unit:ae.unit,month:"",qty:"",dist:new Array(12).fill(0)}));$t({open:!0,rows:k})}function Et(){$t({open:!1,rows:[]})}function ts(k,ae,je){$t(Ie=>{const Le=Ie.rows.slice(),Ne={...Le[k]},Ee=Number(ae??Ne.month),qe=Number(je??Ne.qty),at=new Array(12).fill(0);if(Number.isFinite(Ee)&&Ee>=1&&Ee<=12&&Number.isFinite(qe)&&qe>0){const ft=12-Ee+1,bt=qe/ft;for(let Ye=Ee-1;Ye<12;Ye++)at[Ye]=bt}return Ne.month=ae??Ne.month,Ne.qty=je??Ne.qty,Ne.dist=at,Le[k]=Ne,{...Ie,rows:Le}})}function Bt(k){try{const ae=k.getBoundingClientRect(),je=(ae==null?void 0:ae.width)||k.offsetWidth||600,Ie=(ae==null?void 0:ae.height)||k.offsetHeight||400,Le=Math.max(0,Math.round((window.innerWidth-je)/2)),Ee=Math.max(0,Math.round(window.innerHeight-Ie-40));return{x:Le,y:Ee}}catch{const ae=Math.max(0,Math.round((window.innerWidth-600)/2)),Ie=Math.max(0,Math.round(window.innerHeight-400-40));return{x:ae,y:Ie}}}function gs(k){try{const ae=k.getBoundingClientRect(),je=(ae==null?void 0:ae.width)||k.offsetWidth||460,Ie=Math.max(0,Math.round(window.innerWidth-je)),Le=Math.max(0,Math.round(window.innerHeight*.17));return{x:Ie,y:Le}}catch{const je=Math.max(0,Math.round(window.innerWidth-460)),Ie=Math.max(0,Math.round(window.innerHeight*.17));return{x:je,y:Ie}}}const Ut=At("sales-plan-target-input",!!lt.open,Bt,{persist:!1,resetOnOpen:!0}),ss=At("sales-plan-bulk-input",!!Ct.open,Bt,{persist:!1,resetOnOpen:!0}),[zt,ns]=t.useState({open:!1,rows:[]}),[et,pt]=t.useState("");function Q(){const k=(_t||[]).map((ae,je)=>({key:`${ae.sub}||${ae.unit}||${je}`,sub:ae.sub,unit:ae.unit,month:"",qty:"",dist:new Array(12).fill(0)}));ns({open:!0,rows:k})}function xe(){ns({open:!1,rows:[]})}function pe(k,ae,je){ns(Ie=>{const Le=Ie.rows.slice(),Ne={...Le[k]},Ee=Number(ae??Ne.month),qe=Number(je??Ne.qty),at=new Array(12).fill(0);if(Number.isFinite(Ee)&&Ee>=1&&Ee<=12&&Number.isFinite(qe)&&qe>0){const ft=12-Ee+1,bt=qe/ft;for(let Ye=Ee-1;Ye<12;Ye++)at[Ye]=bt}return Ne.month=ae??Ne.month,Ne.qty=je??Ne.qty,Ne.dist=at,Le[k]=Ne,{...Ie,rows:Le}})}const Me=At("sales-plan-bulk-ratio",!!zt.open,Bt,{persist:!1,resetOnOpen:!0}),[le,De]=t.useState({open:!1,loading:!1,error:null,opts:[],dist:new Array(12).fill(0),rows:[]}),we=At("sales-plan-new-item",!!le.open,Bt,{persist:!1,resetOnOpen:!0});async function ze(){De(k=>({...k,open:!0,loading:!0,error:null,unit:"",sub:"",month:"",qty:"",dist:new Array(12).fill(0),rows:[]}));try{const k=await fetch("/api/v1/items/dim"),ae=k.ok?await k.json():[],je=Array.isArray(ae)?ae.map(Ne=>({itemSubcategory:String(Ne.itemSubcategory||Ne.item_subcategory||""),salesMgmtUnit:String(Ne.salesMgmtUnit||Ne.sales_mgmt_unit||"")})):[],Ie={};je.forEach(Ne=>{const Ee=Ne.salesMgmtUnit.trim();Ee&&!Ie[Ee]&&(Ie[Ee]=Ne)});const Le=Object.values(Ie).sort((Ne,Ee)=>Ne.salesMgmtUnit.localeCompare(Ee.salesMgmtUnit));De(Ne=>({...Ne,loading:!1,opts:Le}))}catch(k){De(ae=>({...ae,loading:!1,error:(k==null?void 0:k.message)||"조회 오류",opts:[]}))}}function Oe(){De({open:!1,loading:!1,error:null,opts:[],dist:new Array(12).fill(0),rows:[]})}function He(k){const ae=le.opts.find(je=>je.salesMgmtUnit===k);De(je=>({...je,unit:k,sub:(ae==null?void 0:ae.itemSubcategory)||je.sub}))}function Fe(k,ae){const je=Number(k??le.month),Ie=Number(ae??le.qty),Le=new Array(12).fill(0);if(Number.isFinite(je)&&je>=1&&je<=12&&Number.isFinite(Ie)&&Ie>0){const Ne=12-je+1,Ee=Ie/Ne;for(let qe=je-1;qe<12;qe++)Le[qe]=Ee}De(Ne=>({...Ne,month:k??Ne.month,qty:ae??Ne.qty,dist:Le}))}function ot(){const k=(le.unit||"").trim(),ae=(le.sub||"").trim(),je=le.month,Ie=le.qty;if(!k||!je||!Ie){alert("영업관리단위, 매출월, 매출 수량을 입력하세요.");return}const Le={sub:ae||"(신규)",unit:k,months:le.dist.slice()};De(Ne=>({...Ne,rows:[...Ne.rows,Le],unit:"",sub:"",month:"",qty:"",dist:new Array(12).fill(0)}))}t.useEffect(()=>{if(!lt.open&&!Ct.open&&!le.open)return;const k=ae=>{ae.key==="Escape"&&(lt.open&&qt(),Ct.open&&Et(),le.open&&Oe())};return window.addEventListener("keydown",k,!0),()=>window.removeEventListener("keydown",k,!0)},[lt.open,Ct.open,le.open]);async function tt(k=!0){se(null),k?(X(!0),M(0),H(!0)):te(!0);try{const ae=localStorage.getItem("tnt.sales.assigneeId");if(!ae){N([]),se(st.loginRequired);return}const je=new URL("/api/v1/customers",window.location.origin);je.searchParams.set("mineOnly","true"),je.searchParams.set("assigneeId",ae),je.searchParams.set("companyType",m),y.trim()&&je.searchParams.set("name",y.trim()),je.searchParams.set("limit",String(h)),je.searchParams.set("offset",String(k?0:o));const Ie=await fetch(je.toString());if(!Ie.ok){let Ee=`HTTP ${Ie.status}`;try{const qe=await Ie.json();qe!=null&&qe.error&&(Ee=qe.error)}catch{const qe=await Ie.text();qe&&(Ee=qe)}throw new Error(Ee)}const Le=await Ie.json(),Ne=Array.isArray(Le)?Le:[];N(k?Ne:Ee=>[...Ee,...Ne]),H(Ne.length>=h),M(Ee=>k?h:Ee+h);try{if(ae){const Ee=new URL("/api/v1/customers/count",window.location.origin);Ee.searchParams.set("mineOnly","true"),Ee.searchParams.set("assigneeId",ae);const qe=await fetch(Ee.toString());if(qe.ok){const at=await qe.json().catch(()=>({})),ft=Number((at==null?void 0:at.total)??0);v(Number.isFinite(ft)?ft:0)}else v(0)}else v(0)}catch{v(0)}try{const Ee=Ne.map(qe=>Number(qe.customerSeq||0)).filter(qe=>Number.isFinite(qe)&&qe>0);if(Ee.length>0){const qe=new URL("/api/v1/customers/recent-invoice-flags",window.location.origin);qe.searchParams.set("custSeq",Array.from(new Set(Ee)).join(",")),qe.searchParams.set("years","2");const at=await fetch(qe.toString());if(at.ok){const ft=await at.json(),bt={};Array.isArray(ft)&&ft.forEach(Ye=>{const it=Number((Ye==null?void 0:Ye.customerSeq)||(Ye==null?void 0:Ye.customerSeqText)||0);Number.isFinite(it)&&(bt[it]=!!(Ye!=null&&Ye.hasRecent))}),n(Ye=>k?bt:{...Ye,...bt})}else k&&n({})}else k&&n({})}catch{n({})}}catch(ae){se(ae.message||"조회 중 오류가 발생했습니다")}finally{k?X(!1):te(!1)}}t.useEffect(()=>{tt(!0)},[]),t.useEffect(()=>{tt(!0)},[m]),t.useEffect(()=>{if(!d.open)return;const k=()=>x({open:!1,x:0,y:0});return window.addEventListener("click",k),()=>window.removeEventListener("click",k)},[d.open]),t.useEffect(()=>{if(!d.open)return;const k=ae=>{ae.key==="Escape"&&x({open:!1,x:0,y:0})};return window.addEventListener("keydown",k),()=>window.removeEventListener("keydown",k)},[d.open]),t.useEffect(()=>{const k=ae=>{((ae==null?void 0:ae.key)==="Escape"||(ae==null?void 0:ae.key)==="Esc"||(ae==null?void 0:ae.keyCode)===27)&&(x({open:!1,x:0,y:0}),w({open:!1,x:0,y:0}))};return document.addEventListener("keydown",k,!0),()=>document.removeEventListener("keydown",k,!0)},[]);async function Xe(k,ae){k.preventDefault(),k.stopPropagation(),x({open:!1,x:0,y:0});const je=k.clientX,Ie=k.clientY;w({open:!0,x:je,y:Ie,row:ae,loading:!1,error:null,data:[]})}const Ht=t.useMemo(()=>{var ae,je,Ie,Le,Ne,Ee,qe,at,ft,bt,Ye,it,as,ys,As;const k=[...V].sort((Nt,Gt)=>{const Ot=Number(Nt.customerSeq||0),fs=Number(Gt.customerSeq||0),Rs=!!ie[Ot],Ke=!!ie[fs];if(Rs!==Ke)return Ke?1:-1;const It=(Nt.customerName||"").toString(),xs=(Gt.customerName||"").toString();return It.localeCompare(xs,"ko",{sensitivity:"base"})});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:8},children:[e.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:6,cursor:"pointer"},children:[e.jsx("input",{type:"radio",name:"companyType",checked:m==="TNT",onChange:()=>P("TNT")}),e.jsx("span",{children:"TNT"})]}),e.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:6,cursor:"pointer"},children:[e.jsx("input",{type:"radio",name:"companyType",checked:m==="DYS",onChange:()=>P("DYS")}),e.jsx("span",{children:"DYS"})]})]}),e.jsxs("div",{ref:c,className:"table-container",onClick:()=>x({open:!1,x:0,y:0}),style:{height:"100%",overflow:"auto"},children:[k.length===0?e.jsx("div",{className:"empty-state",children:st.empty}):e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsx("tr",{children:e.jsx("th",{style:{width:"auto"},children:"거래처명"})})}),e.jsx("tbody",{children:k.map((Nt,Gt)=>e.jsx("tr",{onClick:Ot=>{Ot.preventDefault(),Ot.stopPropagation(),C(Nt),w({open:!1,x:0,y:0})},onContextMenu:Ot=>Xe(Ot,Nt),"aria-selected":(l==null?void 0:l.customerId)===Nt.customerId?!0:void 0,style:(l==null?void 0:l.customerId)===Nt.customerId?{background:"var(--row-selected, rgba(0, 128, 255, 0.12))"}:void 0,children:e.jsx("td",{children:(()=>{const Ot=Number(Nt.customerSeq||0);return ie[Ot]?e.jsxs("span",{children:[Nt.customerName," "," ","$"]}):Nt.customerName})()})},Gt))})]}),j&&e.jsx("div",{className:"muted",style:{padding:"6px 8px"},children:st.loading}),!q&&!j&&!G&&V.length>0&&e.jsx("div",{className:"muted",style:{padding:"8px 10px",textAlign:"center"},children:"마지막 데이터입니다."}),S.open&&e.jsxs("div",{className:"context-menu",style:{left:S.x+6,top:S.y+6,maxWidth:420,padding:8},onClick:Nt=>Nt.stopPropagation(),children:[e.jsx("div",{style:{fontWeight:600,marginBottom:6},children:"거래처 상세"}),S.error?e.jsx("div",{className:"error",style:{maxWidth:380},children:S.error}):e.jsx("table",{className:"table",style:{width:"100%"},children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{style:{width:110,textAlign:"left"},children:"거래처번호"}),e.jsx("td",{children:((ae=S.row)==null?void 0:ae.customerId)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"사업자번호"}),e.jsx("td",{children:((je=S.row)==null?void 0:je.bizNo)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"대표자명"}),e.jsx("td",{children:((Ie=S.row)==null?void 0:Ie.ownerName)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"업태"}),e.jsx("td",{children:((Le=S.row)==null?void 0:Le.bizKind)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"종목"}),e.jsx("td",{children:((Ne=S.row)==null?void 0:Ne.bizType)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"전화번호"}),e.jsx("td",{children:((Ee=S.row)==null?void 0:Ee.telNo)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"담당자명"}),e.jsx("td",{children:((qe=S.row)==null?void 0:qe.empName)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"부서명"}),e.jsx("td",{children:((at=S.row)==null?void 0:at.deptName)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"시/도"}),e.jsx("td",{children:((ft=S.row)==null?void 0:ft.addrProvinceName)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"시/군/구"}),e.jsx("td",{children:((bt=S.row)==null?void 0:bt.addrCityName)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"고객유형"}),e.jsx("td",{children:((Ye=S.row)==null?void 0:Ye.customerTypeName)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"비고"}),e.jsx("td",{children:((it=S.row)==null?void 0:it.customerRemark)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"생성자"}),e.jsx("td",{children:((as=S.row)==null?void 0:as.createdBy)??""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"수정자"}),e.jsx("td",{children:((ys=S.row)==null?void 0:ys.updatedBy)??""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"생성일시"}),e.jsx("td",{children:ta((As=S.row)==null?void 0:As.createdAt)})]})]})})]})]})]})},[V,d,r,S,l,ie,q,j,G]);t.useEffect(()=>{const k=c.current;if(!k)return;function ae(){k.scrollTop+k.clientHeight>=k.scrollHeight-48&&G&&!j&&!q&&tt(!1)}return k.addEventListener("scroll",ae),()=>k.removeEventListener("scroll",ae)},[G,j,q,o]);const[xt,Jt]=t.useState({open:!1,loading:!1,error:null,rows:[]}),Xt=At("unit-amounts-by-emp",xt.open,gs,{persist:!1,resetOnOpen:!0});function ks(){Jt({open:!0,loading:!0,error:null,rows:[]});const k=(localStorage.getItem("tnt.sales.empName")||"").trim();if(!k){Jt({open:!0,loading:!1,error:"로그인이 필요합니다",rows:[]});return}const ae=new URL("/api/v1/dashboard/unit-amounts-by-emp",window.location.origin);ae.searchParams.set("empName",k),fetch(ae.toString()).then(async je=>{if(!je.ok){let Ne=`HTTP ${je.status}`;try{const Ee=await je.json();Ee!=null&&Ee.error&&(Ne=Ee.error)}catch{const Ee=await je.text();Ee&&(Ne=Ee)}throw new Error(Ne)}const Ie=await je.json(),Le=(Array.isArray(Ie)?Ie:[]).map(Ne=>({unit:String((Ne==null?void 0:Ne.sales_mgmt_unit)??(Ne==null?void 0:Ne.salesMgmtUnit)??""),amount:Number((Ne==null?void 0:Ne.amount)??0)}));Jt({open:!0,loading:!1,error:null,rows:Le})}).catch(je=>Jt({open:!0,loading:!1,error:(je==null?void 0:je.message)||"조회 오류",rows:[]}))}function Cs(){Jt(k=>({...k,open:!1}))}return t.useEffect(()=>{if(!xt.open)return;const k=ae=>{ae.key==="Escape"&&Cs()};return window.addEventListener("keydown",k,!0),()=>window.removeEventListener("keydown",k,!0)},[xt.open]),t.useEffect(()=>{if(!lt.open)return;const k=ae=>{ae.key==="Escape"&&qt()};return window.addEventListener("keydown",k,!0),()=>window.removeEventListener("keydown",k,!0)},[lt.open]),t.useEffect(()=>{if(!Ct.open)return;const k=ae=>{ae.key==="Escape"&&Et()};return window.addEventListener("keydown",k,!0),()=>window.removeEventListener("keydown",k,!0)},[Ct.open]),t.useEffect(()=>{if(!zt.open)return;const k=ae=>{ae.key==="Escape"&&xe()};return window.addEventListener("keydown",k,!0),()=>window.removeEventListener("keydown",k,!0)},[zt.open]),t.useEffect(()=>{if(!le.open)return;const k=ae=>{ae.key==="Escape"&&Oe()};return window.addEventListener("keydown",k,!0),()=>window.removeEventListener("keydown",k,!0)},[le.open]),e.jsxs("section",{children:[e.jsxs("div",{className:"page-title",style:{alignItems:"center"},children:[e.jsxs("h2",{style:{margin:0,fontSize:18,display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"},children:["목표 Simulation",e.jsxs("select",{className:"search-input",value:ye,onChange:k=>L(k.target.value),"aria-label":"목표년도",children:[e.jsx("option",{value:"",disabled:!0,children:"선택"}),Z().map(k=>e.jsxs("option",{value:String(k),children:[k,"년"]},k))]}),e.jsxs("span",{className:"badge",title:"내 목표 배정(TNT)",children:["TNT(배정): ",me.format(E.tnt)," 억"]}),e.jsxs("span",{className:"badge",title:"내 목표 배정(DYS)",children:["DYS(배정): ",me.format(E.dys)," 억"]}),e.jsx("span",{"aria-hidden":"true",style:{opacity:.4},children:"|"}),e.jsxs("span",{className:"badge",title:"내 목표 계획(TNT)",children:["TNT(계획): ",me.format(ee.tnt)," 억"]}),e.jsxs("span",{className:"badge",title:"내 목표 계획(DYS)",children:["DYS(계획): ",me.format(ee.dys)," 억"]}),e.jsx("span",{"aria-hidden":"true",style:{opacity:.4},children:"|"}),e.jsxs("span",{className:"badge",title:"내 목표 차액(TNT)",children:["TNT(차액): ",me.format(Pe.tnt)," 억"]}),e.jsxs("span",{className:"badge",title:"내 목표 차액(DYS)",children:["DYS(차액): ",me.format(Pe.dys)," 억"]})]}),e.jsxs("div",{className:"muted count-text",style:{display:"flex",alignItems:"center",gap:12},children:[e.jsx("button",{className:"btn-plain",title:"내 평균거래 단가",onClick:ks,"aria-label":"평균거래 단가 팝업 열기",children:e.jsx("img",{src:bn,className:"icon",alt:"단가"})}),i.toLocaleString(),"개 거래처"]})]}),R&&e.jsx("div",{className:"error",children:R||st.errorGeneric}),e.jsxs("div",{style:{marginTop:12,display:"flex",gap:12,alignItems:"stretch",height:"calc(100vh - 140px)"},children:[e.jsxs("div",{style:{flex:"0 0 17%",maxWidth:"17%",minWidth:240,height:"100%",overflow:"auto"},children:[e.jsx("div",{className:"card",style:{padding:8,marginBottom:8},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("input",{className:"search-input",placeholder:"거래처명",value:y,onChange:k=>A(k.target.value),onKeyDown:k=>{k.key==="Enter"&&tt(!0)},style:{flex:1}}),e.jsx("button",{className:"btn",onClick:()=>tt(!0),disabled:q,style:{flex:"0 0 auto"},children:"조회"})]})}),Ht]}),e.jsxs("aside",{className:"card",style:{flex:"1 1 83%",maxWidth:"83%",height:"100%",padding:12,overflow:"auto"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12,gap:16},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,flex:1,minWidth:0},children:z.map((k,ae)=>{const je=ae<I,Ie=ae===I;return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,minWidth:0,flex:ae===z.length-1?"0 0 auto":"1 1 0"},children:[e.jsx("div",{title:k.label,onClick:()=>ue(k.key),style:{width:22,height:22,borderRadius:999,display:"inline-flex",alignItems:"center",justifyContent:"center",background:je||Ie?"var(--accent)":"transparent",border:`2px solid ${je||Ie?"var(--accent)":"var(--border)"}`,color:je||Ie?"var(--on-accent)":"var(--muted)",cursor:"pointer",flex:"0 0 auto"},"aria-current":Ie?"step":void 0,children:je?"✓":ae+1}),e.jsx("div",{style:{fontSize:12,color:Ie||je?"var(--text)":"var(--muted)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:k.label}),ae<z.length-1&&e.jsx("div",{style:{height:2,background:ae<I?"var(--accent)":"var(--border)",flex:1,borderRadius:2}})]},k.key)})}),e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[e.jsx("button",{className:"btn btn-icon",onClick:ge,disabled:I===0,"aria-label":"이전 단계",title:"이전 단계",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",focusable:"false",children:e.jsx("path",{d:"M15 18l-6-6 6-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),e.jsx("button",{className:"btn btn-icon",onClick:re,disabled:I===z.length-1,"aria-label":"다음 단계",title:"다음 단계",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",focusable:"false",children:e.jsx("path",{d:"M9 6l6 6-6 6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]})]}),Y==="init"&&e.jsxs("section",{style:{marginTop:12},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12},children:[e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:10},children:[e.jsx("b",{children:"기준매출"}),e.jsxs("select",{value:Ze,onChange:k=>Tt(k.target.value),style:{height:28,padding:"4px 8px",borderRadius:8,border:"1px solid var(--border)",background:"transparent",color:"var(--text)",fontSize:12},"aria-label":"기준 기간 선택",children:[e.jsx("option",{value:"prev1",children:"전년"}),e.jsx("option",{value:"last2",children:"최근2년"}),e.jsx("option",{value:"last3",children:"최근3년"})]})]}),e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:8},children:[nt&&e.jsx("span",{className:"error",children:nt}),e.jsx("button",{className:"btn btn-card btn-3d",onClick:Q,children:"일괄비율"}),e.jsx("button",{className:"btn btn-card btn-3d",onClick:Qe,children:"일괄입력"}),e.jsx("button",{className:"btn btn-card btn-3d",onClick:ze,children:"신규품목"})]})]}),ls]})]})]}),lt.open&&e.jsx("div",{role:"dialog","aria-modal":"true",className:"card",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.35)",zIndex:50},children:e.jsxs("div",{ref:Ut.ref,className:"card",style:{...Ut.style,width:720,maxWidth:"92vw",background:"var(--panel)",padding:12},children:[e.jsx("div",{...Ut.bindHeader,style:{position:"absolute",top:0,left:0,right:36,height:32,cursor:"move"},"aria-hidden":"true"}),e.jsx("button",{"aria-label":"닫기",onClick:qt,className:"btn-plain",style:{position:"absolute",top:8,right:8},children:e.jsx("img",{src:dt,className:"icon",alt:"닫기"})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"120px 1fr 120px 1fr",gap:8,alignItems:"center"},children:[e.jsx("div",{className:"muted",children:"중분류"}),e.jsx("div",{children:lt.sub||""}),e.jsx("div",{className:"muted",children:"영업관리단위"}),e.jsx("div",{children:lt.unit||""}),e.jsx("div",{className:"muted",children:"매출월"}),e.jsx("div",{children:e.jsxs("select",{className:"search-input",value:lt.month||"",onChange:k=>Wt(k.target.value,lt.qty),children:[e.jsx("option",{value:"",disabled:!0,children:"선택"}),Array.from({length:12},(k,ae)=>ae+1).map(k=>e.jsxs("option",{value:String(k),children:[k,"월"]},k))]})}),e.jsx("div",{className:"muted",children:"매출 수량"}),e.jsx("div",{children:e.jsx("input",{className:"assign-input",type:"number",min:0,step:1,placeholder:"0",value:lt.qty||"",onChange:k=>Wt(lt.month,k.target.value)})})]}),e.jsx("div",{style:{marginTop:12},children:e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{children:Array.from({length:12},(k,ae)=>ae+1).map(k=>e.jsxs("th",{style:{textAlign:"right"},children:[String(k).padStart(2,"0"),"월"]},k))})}),e.jsx("tbody",{children:e.jsx("tr",{children:lt.dist.map((k,ae)=>e.jsx("td",{children:Je(k)},ae))})})]})})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:8,gap:8},children:e.jsx("button",{className:"btn btn-card btn-3d",onClick:()=>alert("목표등록(단건) — 추후 구현 예정"),children:"목표등록"})})]})}),Ct.open&&e.jsx("div",{role:"dialog","aria-modal":"true",className:"card",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.35)",zIndex:50},children:e.jsxs("div",{ref:ss.ref,className:"card",style:{...ss.style,width:"92vw",maxWidth:1100,background:"var(--panel)",padding:12},children:[e.jsx("div",{...ss.bindHeader,style:{position:"absolute",top:0,left:0,right:36,height:32,cursor:"move"},"aria-hidden":"true"}),e.jsx("button",{"aria-label":"닫기",onClick:Et,className:"btn-plain",style:{position:"absolute",top:8,right:8},children:e.jsx("img",{src:dt,className:"icon",alt:"닫기"})}),e.jsx("div",{className:"page-title",style:{marginBottom:8},children:e.jsx("h2",{style:{margin:0},children:"목표 일괄입력"})}),e.jsx("div",{className:"table-container",style:{maxHeight:"70vh",overflow:"auto"},children:e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:200,textAlign:"left"},children:"중분류"}),e.jsx("th",{style:{width:220,textAlign:"left"},children:"영업관리단위"}),e.jsx("th",{style:{width:120,textAlign:"left"},children:"매출월"}),e.jsx("th",{style:{width:120,textAlign:"left"},children:"매출 수량"}),Array.from({length:12},(k,ae)=>ae+1).map(k=>e.jsxs("th",{style:{textAlign:"right"},children:[String(k).padStart(2,"0"),"월"]},k))]})}),e.jsx("tbody",{children:Ct.rows.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:16,className:"muted",style:{padding:"12px 10px"},children:"데이터가 없습니다"})}):Ct.rows.map((k,ae)=>e.jsxs("tr",{children:[e.jsx("td",{children:k.sub}),e.jsx("td",{children:k.unit}),e.jsx("td",{children:e.jsxs("select",{className:"search-input",value:k.month||"",onChange:je=>ts(ae,je.target.value,void 0),children:[e.jsx("option",{value:"",disabled:!0,children:"선택"}),Array.from({length:12},(je,Ie)=>Ie+1).map(je=>e.jsxs("option",{value:String(je),children:[je,"월"]},je))]})}),e.jsx("td",{children:e.jsx("input",{className:"assign-input",type:"number",min:0,step:1,placeholder:"0",value:k.qty||"",onChange:je=>ts(ae,void 0,je.target.value)})}),k.dist.map((je,Ie)=>e.jsx("td",{children:Je(je)},Ie))]},k.key))})]})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:8,gap:8},children:e.jsx("button",{className:"btn btn-card btn-3d",onClick:()=>alert("목표등록(일괄) — 추후 구현 예정"),children:"목표등록"})})]})}),zt.open&&e.jsx("div",{role:"dialog","aria-modal":"true",className:"card",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.35)",zIndex:50},children:e.jsxs("div",{ref:Me.ref,className:"card",style:{...Me.style,width:"92vw",maxWidth:1100,background:"var(--panel)",padding:12},children:[e.jsx("div",{...Me.bindHeader,style:{position:"absolute",top:0,left:0,right:36,height:32,cursor:"move"},"aria-hidden":"true"}),e.jsx("button",{"aria-label":"닫기",onClick:xe,className:"btn-plain",style:{position:"absolute",top:8,right:8},children:e.jsx("img",{src:dt,className:"icon",alt:"닫기"})}),e.jsxs("div",{className:"page-title",style:{marginBottom:8,alignItems:"center"},children:[e.jsx("h2",{style:{margin:0},children:"목표 일괄비율"}),e.jsxs("div",{className:"controls",style:{gap:8},children:[e.jsx("span",{className:"muted",children:"적용 비율(%)"}),e.jsx("input",{className:"assign-input",type:"number",min:0,max:100,step:1,placeholder:"0",value:et,onChange:k=>pt(k.target.value),style:{width:100},"aria-label":"일괄 비율 입력"}),e.jsx("button",{className:"btn btn-card btn-3d",onClick:()=>alert("일괄비율 적용 — 추후 개발 예정"),children:"적용"})]})]}),e.jsx("div",{className:"table-container",style:{maxHeight:"70vh",overflow:"auto"},children:e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:200,textAlign:"left"},children:"중분류"}),e.jsx("th",{style:{width:220,textAlign:"left"},children:"영업관리단위"}),e.jsx("th",{style:{width:120,textAlign:"left"},children:"매출월"}),e.jsx("th",{style:{width:120,textAlign:"left"},children:"매출 수량"}),Array.from({length:12},(k,ae)=>ae+1).map(k=>e.jsxs("th",{style:{textAlign:"right"},children:[String(k).padStart(2,"0"),"월"]},k))]})}),e.jsx("tbody",{children:zt.rows.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:16,className:"muted",style:{padding:"12px 10px"},children:"데이터가 없습니다"})}):zt.rows.map((k,ae)=>e.jsxs("tr",{children:[e.jsx("td",{children:k.sub}),e.jsx("td",{children:k.unit}),e.jsx("td",{children:e.jsxs("select",{className:"search-input",value:k.month||"",onChange:je=>pe(ae,je.target.value,void 0),children:[e.jsx("option",{value:"",disabled:!0,children:"선택"}),Array.from({length:12},(je,Ie)=>Ie+1).map(je=>e.jsxs("option",{value:String(je),children:[je,"월"]},je))]})}),e.jsx("td",{children:e.jsx("input",{className:"assign-input",type:"number",min:0,step:1,placeholder:"0",value:k.qty||"",onChange:je=>pe(ae,void 0,je.target.value)})}),k.dist.map((je,Ie)=>e.jsx("td",{children:Je(je)},Ie))]},k.key))})]})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:8,gap:8},children:e.jsx("button",{className:"btn btn-card btn-3d",onClick:()=>alert("목표등록(일괄비율) — 추후 구현 예정"),children:"목표등록"})})]})}),le.open&&e.jsx("div",{role:"dialog","aria-modal":"true",className:"card",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.35)",zIndex:50},children:e.jsxs("div",{ref:we.ref,className:"card",style:{...we.style,width:820,maxWidth:"92vw",background:"var(--panel)",padding:12},children:[e.jsx("div",{...we.bindHeader,style:{position:"absolute",top:0,left:0,right:36,height:32,cursor:"move"},"aria-hidden":"true"}),e.jsx("button",{"aria-label":"닫기",onClick:Oe,className:"btn-plain",style:{position:"absolute",top:8,right:8},children:e.jsx("img",{src:dt,className:"icon",alt:"닫기"})}),e.jsx("div",{className:"page-title",style:{marginBottom:8},children:e.jsx("h2",{style:{margin:0},children:"신규품목"})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"120px 1fr 120px 1fr",gap:8,alignItems:"center"},children:[e.jsx("div",{className:"muted",children:"영업관리단위"}),e.jsx("div",{children:e.jsxs("select",{className:"search-input",value:le.unit||"",onChange:k=>He(k.target.value),children:[e.jsx("option",{value:"",disabled:!0,children:"선택"}),le.opts.map((k,ae)=>e.jsx("option",{value:k.salesMgmtUnit,children:k.salesMgmtUnit},ae))]})}),e.jsx("div",{className:"muted",children:"중분류"}),e.jsx("div",{children:e.jsx("input",{className:"assign-input",value:le.sub||"",readOnly:!0,placeholder:"자동"})}),e.jsx("div",{className:"muted",children:"매출월"}),e.jsx("div",{children:e.jsxs("select",{className:"search-input",value:le.month||"",onChange:k=>Fe(k.target.value,void 0),children:[e.jsx("option",{value:"",disabled:!0,children:"선택"}),Array.from({length:12},(k,ae)=>ae+1).map(k=>e.jsxs("option",{value:String(k),children:[k,"월"]},k))]})}),e.jsx("div",{className:"muted",children:"매출 수량"}),e.jsx("div",{children:e.jsx("input",{className:"assign-input",type:"number",min:0,step:1,placeholder:"0",value:le.qty||"",onChange:k=>Fe(void 0,k.target.value)})})]}),e.jsx("div",{style:{marginTop:12},children:e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{children:Array.from({length:12},(k,ae)=>ae+1).map(k=>e.jsxs("th",{style:{textAlign:"right"},children:[String(k).padStart(2,"0"),"월"]},k))})}),e.jsx("tbody",{children:e.jsx("tr",{children:le.dist.map((k,ae)=>e.jsx("td",{children:Je(k)},ae))})})]})})}),e.jsxs("div",{style:{marginTop:12},children:[e.jsx("div",{className:"pane-header",style:{margin:0},children:"추가된 항목"}),e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:200,textAlign:"left"},children:"중분류"}),e.jsx("th",{style:{width:220,textAlign:"left"},children:"영업관리단위"}),Array.from({length:12},(k,ae)=>ae+1).map(k=>e.jsxs("th",{style:{textAlign:"right"},children:[String(k).padStart(2,"0"),"월"]},k))]})}),e.jsx("tbody",{children:le.rows.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:14,className:"muted",style:{padding:"12px 10px"},children:"추가된 항목이 없습니다"})}):le.rows.map((k,ae)=>e.jsxs("tr",{children:[e.jsx("td",{children:k.sub}),e.jsx("td",{children:k.unit}),k.months.map((je,Ie)=>e.jsx("td",{children:Je(je)},Ie))]},ae))})]})})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:8,gap:8},children:[e.jsx("button",{className:"btn btn-card btn-3d",onClick:ot,children:"추가"}),e.jsx("button",{className:"btn btn-card btn-3d",onClick:()=>alert("목표등록(신규품목) — 추후 구현 예정"),children:"목표등록"})]})]})}),xt.open&&e.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:60},children:e.jsxs("div",{ref:Xt.ref,className:"card",style:{...Xt.style,height:"66vh",width:460,maxWidth:"92vw",background:"var(--panel)",padding:12,borderLeft:"1px solid var(--border)",boxShadow:"-8px 0 24px rgba(0,0,0,0.18)",overflow:"auto"},children:[e.jsx("div",{...Xt.bindHeader,style:{position:"absolute",top:0,left:0,right:36,height:32,cursor:"move"},"aria-hidden":"true"}),e.jsx("button",{"aria-label":"닫기",onClick:Cs,className:"btn-plain",style:{position:"absolute",top:8,right:8},children:e.jsx("img",{src:dt,className:"icon",alt:"닫기"})}),e.jsx("div",{className:"page-title",style:{marginBottom:8},children:e.jsx("h2",{style:{margin:0},children:"내 평균거래 단가"})}),xt.error?e.jsx("div",{className:"error",style:{maxWidth:420},children:xt.error}):e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:280,textAlign:"left"},children:"영업관리단위"}),e.jsx("th",{style:{width:180,textAlign:"right"},children:"합계(원)"})]})}),e.jsx("tbody",{children:xt.loading?e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"muted",style:{padding:"12px 10px"},children:"불러오는 중…"})}):xt.rows.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"muted",style:{padding:"12px 10px"},children:"데이터가 없습니다"})}):xt.rows.map((k,ae)=>e.jsxs("tr",{children:[e.jsx("td",{children:k.unit||"na"}),e.jsxs("td",{style:{textAlign:"right"},children:[me.format(Math.round(k.amount))," 원"]})]},ae))})]})})]})})]})}function sa(s){if(!s)return"";const u=s instanceof Date?s:new Date(s);if(isNaN(u.getTime()))return"";const p=String(u.getFullYear()%100).padStart(2,"0"),_=String(u.getMonth()+1).padStart(2,"0"),F=String(u.getDate()).padStart(2,"0"),B=String(u.getHours()).padStart(2,"0"),q=String(u.getMinutes()).padStart(2,"0");return`${p}-${_}-${F} ${B}:${q}`}function na(){const[s,u]=t.useState(""),[p,_]=t.useState(""),[F,B]=t.useState(""),[q,X]=t.useState(!1),[R,se]=t.useState(null),[V,N]=t.useState([]),[y,A]=t.useState(""),[O,b]=t.useState(!1),[d,x]=t.useState({open:!1,x:0,y:0}),[r,T]=t.useState(()=>new Set),[S,w]=t.useState({open:!1,x:0,y:0}),[l,C]=t.useState(void 0),[Y,ue]=t.useState("init"),[ie,n]=t.useState({}),[m,P]=t.useState("TNT"),[h,o]=t.useState({}),M=100,[G,H]=t.useState(0),[j,te]=t.useState(!0),[c,i]=t.useState(!1),v=ke.useRef(null),[g,z]=t.useState(0),[I,ge]=t.useState({show:!1,name:"",tnt:0,dys:0,year:0}),[re,Z]=t.useState(!1),[ye,L]=t.useState({tnt:0,dys:0}),he=["init","sim","confirm"],fe=[{key:"init",label:"초기설정"},{key:"sim",label:"계획 수립 중"},{key:"confirm",label:"확정"}],Se=he.indexOf(Y);function Ae(){const a=[];for(let f=2030;f>=2026;f--)a.push(f);return a}const[E,ve]=t.useState(""),[ee,_e]=t.useState(!1),[Pe,Te]=t.useState(null),[me,Ue]=t.useState({tnt:0,dys:0}),[Je,ht]=t.useState({tnt:0,dys:0}),[We,Ve]=t.useState({tnt:0,dys:0}),[rt,jt]=t.useState({tnt:0,dys:0}),[nt,ut]=t.useState({open:!1,company:"TNT",group:"customer",loading:!1,error:null,rows:[]}),[Ze,Tt]=t.useState({x:0,y:0}),gt=new Intl.NumberFormat("ko-KR"),Zt=new Intl.NumberFormat("ko-KR",{minimumFractionDigits:2,maximumFractionDigits:2}),[es,kt]=t.useState(null),[St,vt]=t.useState({val:"",loading:!1,saving:!1,error:null,success:null});async function _t(){try{const a=Number(E),f=Number((l==null?void 0:l.customerSeq)||0),$=(localStorage.getItem("tnt.sales.assigneeId")||"").trim();if(!$||!Number.isFinite(a)||a<=0||!f){vt(J=>({...J,val:"",loading:!1,error:null}));return}vt(J=>({...J,loading:!0,error:null}));const U=new URL("/api/v1/sales/plan/plan-remark",window.location.origin);U.searchParams.set("year",String(a)),U.searchParams.set("customerSeq",String(f));const W=await fetch(U.toString(),{headers:{"X-ASSIGNEE-ID":$}});if(!W.ok)throw new Error(`HTTP ${W.status}`);const D=await W.json().catch(()=>({})),ne=String((D==null?void 0:D.remark)??"");vt({val:ne,loading:!1,saving:!1,error:null,success:null})}catch(a){vt(f=>({...f,loading:!1,error:(a==null?void 0:a.message)||"조회 오류"}))}}async function is(){try{const a=Number(E),f=Number((l==null?void 0:l.customerSeq)||0),$=(localStorage.getItem("tnt.sales.assigneeId")||"").trim();if(!$){alert("로그인이 필요합니다.");return}if(!Number.isFinite(a)||a<=0){alert("연도를 선택하세요.");return}if(!f){alert("거래처를 선택하세요.");return}vt(ne=>({...ne,saving:!0,error:null,success:null}));const U={"Content-Type":"application/json","X-ASSIGNEE-ID":$},W=JSON.stringify({year:a,customerSeq:f,remark:St.val}),D=await fetch("/api/v1/sales/plan/plan-remark",{method:"POST",headers:U,body:W});if(!D.ok){let ne=await D.text().catch(()=>"");throw new Error(ne||"HTTP "+D.status)}vt(ne=>({...ne,saving:!1,success:"저장되었습니다."})),setTimeout(()=>vt(ne=>({...ne,success:null})),1200)}catch(a){vt(f=>({...f,saving:!1,error:(a==null?void 0:a.message)||"저장 오류"}))}}t.useEffect(()=>{l!=null&&l.customerSeq&&E&&_t()},[l==null?void 0:l.customerSeq,E]);async function ls(){try{const a=Number(E),f=(localStorage.getItem("tnt.sales.assigneeId")||"").trim(),$=Number((l==null?void 0:l.customerSeq)||0);if(!f){alert("로그인이 필요합니다.");return}if(!Number.isFinite(a)||a<=0){alert("연도를 선택하세요.");return}if(!$){alert("거래처를 선택하세요.");return}const U={year:a,companyType:m,assigneeId:f,customerSeq:$},W={"Content-Type":"application/json","X-ASSIGNEE-ID":f},D=(localStorage.getItem("tnt.sales.empId")||"").trim();D&&(W["X-EMP-ID"]=D);const ne=await fetch("/api/v1/sales/plan/confirm-customer",{method:"POST",headers:W,body:JSON.stringify(U)});if(!ne.ok){let J=await ne.text().catch(()=>"");throw new Error(J||"HTTP "+ne.status)}await ne.json().catch(()=>({})),ue("confirm"),ns(J=>J+1);try{const J=String((l==null?void 0:l.customerName)||""),K=String(E||"");kt(J&&K?`${J} ${K}년 목표 수립이 완료되었습니다.`:"목표 수립이 완료되었습니다.")}catch{kt("목표 수립이 완료되었습니다.")}}catch(a){alert((a==null?void 0:a.message)||"확정 처리 중 오류가 발생했습니다")}}const[lt,Rt]=t.useState(!1),[ps,qt]=t.useState(""),[Wt,Ct]=t.useState("TNT");function $t(a,f){return Number.isFinite(a)?a:0}function Qe(a,f,$,U,W){const D=Number.isFinite(a)&&a>0,ne=D&&Number.isFinite($),J=ne?Number($):D?$t(a):0,K=D?Zt.format(Number(a)):"-",oe=D?ne?`${Zt.format(Number(J))} 원`:"-":"";return e.jsxs("div",{style:{textAlign:"right",lineHeight:1.15,color:U||void 0},children:[e.jsx("div",{style:{fontWeight:W?700:void 0},children:K}),e.jsx("div",{className:W?void 0:"muted",style:{fontSize:11,color:U||void 0,fontWeight:W?700:void 0},children:oe})]})}async function Et(a,f){try{const $=Number(E),U=(localStorage.getItem("tnt.sales.assigneeId")||"").trim();if(!U||!Number.isFinite($)||$<=0){ut(K=>({...K,rows:[],error:null,loading:!1}));return}ut(K=>({...K,loading:!0,error:null}));const W=new URL("/api/v1/sales/plan/totals-breakdown",window.location.origin);W.searchParams.set("year",String($)),W.searchParams.set("assigneeId",U),W.searchParams.set("companyType",a),W.searchParams.set("groupBy",f);const D=await fetch(W.toString());if(!D.ok){let K=await D.text().catch(()=>"");throw new Error(K||"HTTP "+D.status)}const ne=await D.json().catch(()=>[]),J=(Array.isArray(ne)?ne:[]).map(K=>({key:String((K==null?void 0:K.key)??""),label:K!=null&&K.label?String(K.label):void 0,amount:Number((K==null?void 0:K.amount)??0)}));ut(K=>({...K,rows:J,loading:!1,error:null}))}catch($){ut(U=>({...U,loading:!1,error:($==null?void 0:$.message)||"조회 오류",rows:[]}))}}function ts(a,f){if(f)try{Tt({x:f.clientX||0,y:f.clientY||0})}catch{}ut({open:!0,company:a,group:"customer",loading:!1,error:null,rows:[]}),Et(a,"customer")}function Bt(){ut(a=>({...a,open:!1}))}async function gs(){_e(!0),Te(null);try{const a=(localStorage.getItem("tnt.sales.empName")||"").trim();if(!a){Ue({tnt:0,dys:0}),Te("로그인이 필요합니다");return}if(!E||isNaN(Number(E))){Ue({tnt:0,dys:0});return}const f=new URL("/api/v1/targets/assigned",window.location.origin);f.searchParams.set("year",String(E)),f.searchParams.set("empNames",a);try{const ne=(localStorage.getItem("tnt.sales.assign.mode")||"").toLowerCase(),J=ne==="moderate"?"2":ne==="best"?"1":"";J&&f.searchParams.set("versionNo",J)}catch{}const $=await fetch(f.toString());if(!$.ok)throw new Error(`HTTP ${$.status}`);const U=await $.json().catch(()=>[]),W=Array.isArray(U)?U.find(ne=>String(ne.company_name||"").toUpperCase()==="TNT"):null,D=Array.isArray(U)?U.find(ne=>String(ne.company_name||"").toUpperCase()==="DYS"):null;Ue({tnt:Math.round(Number((W==null?void 0:W.assigned_amount)||0)),dys:Math.round(Number((D==null?void 0:D.assigned_amount)||0)),tntStage:String((W==null?void 0:W.target_stage)||"").trim()||void 0,dysStage:String((D==null?void 0:D.target_stage)||"").trim()||void 0})}catch(a){Te((a==null?void 0:a.message)||"조회 오류"),Ue({tnt:0,dys:0})}finally{_e(!1)}}const[Ut,ss]=t.useState(0);t.useEffect(()=>{const a=()=>ss(f=>f+1);return window.addEventListener("tnt.sales.assign.mode.changed",a),()=>window.removeEventListener("tnt.sales.assign.mode.changed",a)},[]),t.useEffect(()=>{gs()},[E,Ut]),t.useEffect(()=>{(async()=>{try{const a=Number(E),f=(localStorage.getItem("tnt.sales.assigneeId")||"").trim();if(!f||!Number.isFinite(a)||a<=0){Ve({tnt:0,dys:0});return}const $=new URL("/api/v1/sales/plan/totals-by-assignee",window.location.origin);$.searchParams.set("year",String(a)),$.searchParams.set("assigneeId",f);const U=await fetch($.toString());if(!U.ok)throw new Error(`HTTP ${U.status}`);const W=await U.json().catch(()=>[]);let D=0,ne=0;Array.isArray(W)&&W.forEach(J=>{const K=String((J==null?void 0:J.company_type)||(J==null?void 0:J.companyType)||"").toUpperCase(),oe=Number((J==null?void 0:J.amount)||0);K==="TNT"?D+=oe:K==="DYS"&&(ne+=oe)}),Ve({tnt:Math.round(D),dys:Math.round(ne)})}catch{Ve({tnt:0,dys:0})}})()},[E]),t.useEffect(()=>{async function a(){try{Z(!1);const f=Number(E);if(!Number.isFinite(f)||f<=0){ge(Re=>({...Re,show:!1})),Z(!0);return}const $=localStorage.getItem("tnt.sales.assigneeId")||"",U=localStorage.getItem("tnt.sales.empId")||"",W=new URL("/api/v1/sales/plan/status",window.location.origin);W.searchParams.set("year",String(f)),$?W.searchParams.set("assigneeId",$):U&&W.searchParams.set("empId",U);const D=await fetch(W.toString());if(!D.ok){ge(Re=>({...Re,show:!1})),Z(!0);return}const ne=await D.json().catch(()=>({})),J=(localStorage.getItem("tnt.sales.empName")||"").trim()||"사용자",K=Number((ne==null?void 0:ne.tnt)||0),oe=Number((ne==null?void 0:ne.dys)||0),de=!!(ne!=null&&ne.hasP),ce=!!(ne!=null&&ne.hasC),Ce=!!(ne!=null&&ne.hasI);let be="";ce&&!de&&!Ce?be="목표수립완료":Ce&&!de&&!ce?be="초기설정완료":(de||ce&&Ce)&&(be="계획수립 중"),ge({show:!!be,name:J,tnt:K,dys:oe,year:f,label:be,hasP:de,hasC:ce,hasI:Ce}),ue(ce&&!de&&!Ce?"confirm":de?"sim":"init"),Z(!0)}catch{ge($=>({...$,show:!1})),Z(!0)}}a()},[E]);const[zt,ns]=t.useState(0),[et,pt]=t.useState({loading:!1,error:null,rows:[]});t.useEffect(()=>{const a=Number((l==null?void 0:l.customerSeq)||0),f=Number(E);if(!a||!Number.isFinite(f)||f<=0){pt({loading:!1,error:null,rows:[]});return}let $=!1;return(async()=>{try{pt(K=>({...K,loading:!0,error:null}));const U=localStorage.getItem("tnt.sales.assigneeId")||"",W=new URL("/api/v1/sales/plan/customer-monthly-rows",window.location.origin);W.searchParams.set("year",String(f)),W.searchParams.set("customerSeq",String(a)),m&&W.searchParams.set("companyType",m),U&&W.searchParams.set("assigneeId",U);const D=await fetch(W.toString());if(!D.ok){let K=`HTTP ${D.status}`;try{const oe=await D.json();oe!=null&&oe.error&&(K=oe.error)}catch{}throw new Error(K)}const ne=await D.json().catch(()=>[]),J=(Array.isArray(ne)?ne:[]).map(K=>({sub:String((K==null?void 0:K.item_subcategory)??(K==null?void 0:K.itemSubcategory)??""),unit:String((K==null?void 0:K.sales_mgmt_unit)??(K==null?void 0:K.salesMgmtUnit)??""),months:Array.from({length:12},(oe,de)=>Number((K==null?void 0:K[`qty_${String(de+1).padStart(2,"0")}`])??0)),amounts:Array.from({length:12},(oe,de)=>Number((K==null?void 0:K[`amount_${String(de+1).padStart(2,"0")}`])??0)),type:String((K==null?void 0:K.plan_type)||(K==null?void 0:K.planType)||"").toUpperCase()==="P"?"P":"B",stage:String((K==null?void 0:K.target_stage)||(K==null?void 0:K.targetStage)||"").toUpperCase()||void 0}));$||pt({loading:!1,error:null,rows:J})}catch(U){$||pt({loading:!1,error:(U==null?void 0:U.message)||"오류",rows:[]})}})(),()=>{$=!0}},[l==null?void 0:l.customerSeq,E,m,zt]),t.useEffect(()=>{try{if(!Number((l==null?void 0:l.customerSeq)||0))return;const f=Array.isArray(et.rows)?et.rows:[];if(!f.length){ue("init");return}const $=f.some(D=>String((D==null?void 0:D.type)||"").toUpperCase()==="P"),U=f.map(D=>String((D==null?void 0:D.stage)||"").toUpperCase()).filter(Boolean),W=U.length>0&&U.every(D=>D==="C");ue(W?"confirm":$?"sim":"init")}catch{}},[l==null?void 0:l.customerSeq,et.rows]);const[Q,xe]=t.useState({open:!1,dist:new Array(12).fill(0),curMonths:new Array(12).fill(0),curAmounts:new Array(12).fill(0),success:null}),[pe,Me]=t.useState({}),[le,De]=t.useState({}),[we,ze]=t.useState({});function Oe(a){return String(a||"").trim().toUpperCase()}function He(a){try{const f=Fe(),U=(pe[f]||{})[Oe(a)];if(Number.isFinite(U)&&Number(U)>0)return Number(U);const W=tt(),ne=((le==null?void 0:le[W])||{})[Oe(a)];return Number.isFinite(ne)&&Number(ne)>0?Number(ne):void 0}catch{return}}function Fe(){const a=(localStorage.getItem("tnt.sales.assigneeId")||"").trim(),f=Number(E),$=new Date().getFullYear()-1,U=Number.isFinite(f)&&f>0?f-1:$;return`${a}|${m||""}|${U}`}async function ot(){try{const a=Fe();if(!a||pe[a])return;const[f,$,U]=a.split("|"),W=Number(U);if(!f||!$||!Number.isFinite(W)||W<=0)return;const D=new URL("/api/v1/dashboard/avg-unit-price-by-emp",window.location.origin);D.searchParams.set("assigneeId",f),D.searchParams.set("companyType",$),D.searchParams.set("year",String(W));const ne=await fetch(D.toString());if(!ne.ok)return;const J=await ne.json().catch(()=>[]),K={},oe={};Array.isArray(J)&&J.forEach(de=>{const ce=Oe((de==null?void 0:de.sales_mgmt_unit)||(de==null?void 0:de.salesMgmtUnit)),Ce=Number((de==null?void 0:de.avg_unit_price)||(de==null?void 0:de.avgUnitPrice)||0);ce&&(K[ce]=Ce),ce&&(oe[ce]={itemUnit:String((de==null?void 0:de.item_unit)||(de==null?void 0:de.itemUnit)||""),itemStdUnit:String((de==null?void 0:de.item_std_unit)||(de==null?void 0:de.itemStdUnit)||"")})}),Me(de=>({...de,[a]:K})),ze(de=>({...de,[a]:oe}))}catch{}}function tt(){const a=Number(E),f=new Date().getFullYear()-1,$=Number.isFinite(a)&&a>0?a-1:f;return`${m||""}|${$}`}async function Xe(){try{const a=tt();if(!a||le[a])return;const[f,$]=a.split("|"),U=Number($);if(!f||!Number.isFinite(U)||U<=0)return;const W=new URL("/api/v1/dashboard/avg-unit-price",window.location.origin);W.searchParams.set("companyType",f),W.searchParams.set("year",String(U));const D=await fetch(W.toString());if(!D.ok)return;const ne=await D.json().catch(()=>[]),J={};Array.isArray(ne)&&ne.forEach(K=>{const oe=Oe((K==null?void 0:K.sales_mgmt_unit)||(K==null?void 0:K.salesMgmtUnit)),de=Number((K==null?void 0:K.avg_unit_price)||(K==null?void 0:K.avgUnitPrice)||0);oe&&(J[oe]=de)}),De(K=>({...K,[a]:J}))}catch{}}async function Ht(a){try{await Xe()}catch{}}async function xt(a){try{const f=Fe();if(!f)return;const[$,U,W]=f.split("|"),D=Number(W);if(!$||!U||!Number.isFinite(D)||D<=0)return;const ne=new URL("/api/v1/dashboard/avg-unit-price-by-emp",window.location.origin);ne.searchParams.set("assigneeId",$),ne.searchParams.set("companyType",U),ne.searchParams.set("year",String(D));const J=await fetch(ne.toString());if(!J.ok)return;const K=await J.json().catch(()=>[]);let oe=null;if(Array.isArray(K)){const de=Oe(a);oe=K.find(ce=>Oe((ce==null?void 0:ce.sales_mgmt_unit)||(ce==null?void 0:ce.salesMgmtUnit))===de)}if(oe){const de=Oe((oe==null?void 0:oe.sales_mgmt_unit)||(oe==null?void 0:oe.salesMgmtUnit)),ce=Number((oe==null?void 0:oe.avg_unit_price)||(oe==null?void 0:oe.avgUnitPrice)||0),Ce={itemUnit:String((oe==null?void 0:oe.item_unit)||(oe==null?void 0:oe.itemUnit)||""),itemStdUnit:String((oe==null?void 0:oe.item_std_unit)||(oe==null?void 0:oe.itemStdUnit)||"")};Me(be=>({...be,[f]:{...be[f]||{},[de]:ce}})),ze(be=>({...be,[f]:{...be[f]||{},[de]:Ce}}))}}catch{}}function Jt(a,f){const $=(et.rows||[]).find(D=>D.sub===a&&D.unit===f),U=$!=null&&$.months?$.months.slice():new Array(12).fill(0),W=$!=null&&$.amounts?$.amounts.slice():new Array(12).fill(0);xe({open:!0,sub:a,unit:f,stage:$==null?void 0:$.stage,month:"",qty:"",dist:new Array(12).fill(0),curMonths:U,curAmounts:W,success:null});try{ot()}catch{}try{Xe()}catch{}}function Xt(){xe({open:!1,dist:new Array(12).fill(0),curMonths:new Array(12).fill(0),curAmounts:new Array(12).fill(0),success:null})}function ks(a,f){const $=Number(a),U=Number(f),W=new Array(12).fill(0);if(Number.isFinite($)&&$>=1&&$<=12&&Number.isFinite(U)&&U>0){const D=12-$+1,ne=U/D;for(let J=$-1;J<12;J++)W[J]=ne}xe(D=>({...D,month:a,qty:f,dist:W}))}async function Cs(){try{const a=Number(E),f=m,$=(localStorage.getItem("tnt.sales.assigneeId")||"").trim(),U=Number((l==null?void 0:l.customerSeq)||0),W=(Q.sub||"").trim(),D=(Q.unit||"").trim();if(!Number.isFinite(a)||a<=0){alert("연도를 선택하세요.");return}if(!$){alert("로그인이 필요합니다.");return}if(!U||!W||!D){alert("거래처/중분류/영업관리단위가 필요합니다.");return}const ne=(Q.dist||[]).map(ce=>{const Ce=Number(ce);return!Number.isFinite(Ce)||Ce<=0?0:Math.round(Ce*100)/100});if(!ne.some(ce=>ce>0)&&!(Q.month&&Number(Q.month)>0)){alert("매출월을 선택하세요.");return}const J={year:a,companyType:f,assigneeId:$,customerSeq:U,itemSubcategory:W,salesMgmtUnit:D,qty:ne},K={"Content-Type":"application/json","X-ASSIGNEE-ID":$},oe=(localStorage.getItem("tnt.sales.empId")||"").trim();oe&&(K["X-EMP-ID"]=oe);const de=await fetch("/api/v1/sales/plan/upsert-row",{method:"POST",headers:K,body:JSON.stringify(J)});if(!de.ok){let ce=await de.text().catch(()=>"");throw new Error(ce||"HTTP "+de.status)}xe(ce=>({...ce,success:"목표가 변경되었습니다"}))}catch(a){alert((a==null?void 0:a.message)||"저장 중 오류가 발생했습니다")}}async function k(){try{const a=Number(E),f=(localStorage.getItem("tnt.sales.assigneeId")||"").trim(),$=Number((l==null?void 0:l.customerSeq)||0);if(Number.isFinite(a)&&a>0&&f&&$){const U=new URL("/api/v1/sales/plan/customer-monthly-rows",window.location.origin);U.searchParams.set("year",String(a)),U.searchParams.set("customerSeq",String($)),m&&U.searchParams.set("companyType",m),U.searchParams.set("assigneeId",f);const W=await fetch(U.toString());if(W.ok){const D=await W.json().catch(()=>[]),ne=(Array.isArray(D)?D:[]).map(J=>({sub:String((J==null?void 0:J.item_subcategory)??(J==null?void 0:J.itemSubcategory)??""),unit:String((J==null?void 0:J.sales_mgmt_unit)??(J==null?void 0:J.salesMgmtUnit)??""),months:Array.from({length:12},(K,oe)=>Number((J==null?void 0:J[`qty_${String(oe+1).padStart(2,"0")}`])??0)),amounts:Array.from({length:12},(K,oe)=>Number((J==null?void 0:J[`amount_${String(oe+1).padStart(2,"0")}`])??0)),type:String((J==null?void 0:J.plan_type)||(J==null?void 0:J.planType)||"").toUpperCase()==="P"?"P":"B",stage:String((J==null?void 0:J.target_stage)||(J==null?void 0:J.targetStage)||"").toUpperCase()||void 0}));pt({loading:!1,error:null,rows:ne})}}}catch{}Xt();try{Le()}catch{}try{Gt()}catch{}try{Is()}catch{}}const[ae,je]=t.useState({open:!1,rows:[],success:null});function Ie(){const a=(et.rows||[]).map((f,$)=>({key:`${f.sub}||${f.unit}||${$}`,sub:f.sub,unit:f.unit,stage:f.stage,type:f.type,month:"",qty:"",dist:new Array(12).fill(0),curMonths:f.months?f.months.slice():new Array(12).fill(0),curAmounts:f.amounts?f.amounts.slice():new Array(12).fill(0)}));je({open:!0,rows:a,success:null});try{ot()}catch{}try{Xe()}catch{}}function Le(){je({open:!1,rows:[],success:null})}function Ne(a,f,$){je(U=>{const W=U.rows.slice(),D={...W[a]},ne=Number(f??D.month),J=Number($??D.qty),K=new Array(12).fill(0);if(Number.isFinite(ne)&&ne>=1&&ne<=12&&Number.isFinite(J)&&J>0){const oe=12-ne+1,de=J/oe;for(let ce=ne-1;ce<12;ce++)K[ce]=de}return D.month=f??D.month,D.qty=$??D.qty,D.dist=K,W[a]=D,{...U,rows:W}})}async function Ee(){try{const a=Number(E),f=m,$=(localStorage.getItem("tnt.sales.assigneeId")||"").trim(),U=Number((l==null?void 0:l.customerSeq)||0);if(!Number.isFinite(a)||a<=0){alert("연도를 선택하세요.");return}if(!$){alert("로그인이 필요합니다.");return}if(!U){alert("거래처를 선택하세요.");return}const W={"Content-Type":"application/json","X-ASSIGNEE-ID":$},D=(localStorage.getItem("tnt.sales.empId")||"").trim();D&&(W["X-EMP-ID"]=D);const ne=(ae.rows||[]).filter(J=>!!J.month&&Number(J.month)>0);if(ne.length===0){alert("매출월을 선택한 행이 없습니다.");return}for(const J of ne){const K=Number(J.month),oe=Number(J.qty||0),de=new Array(12).fill(0);if(Number.isFinite(K)&&K>=1&&K<=12){const Re=12-K+1,$e=Number.isFinite(oe)&&oe>0?oe/Re:0;for(let Be=K-1;Be<12;Be++)de[Be]=$e}const ce=de.map(Re=>{const $e=Number(Re);return!Number.isFinite($e)||$e<=0?0:Math.round($e*100)/100}),Ce={year:a,companyType:f,assigneeId:$,customerSeq:U,itemSubcategory:J.sub,salesMgmtUnit:J.unit,qty:ce},be=await fetch("/api/v1/sales/plan/upsert-row",{method:"POST",headers:W,body:JSON.stringify(Ce)});if(!be.ok){let Re=await be.text().catch(()=>"");throw new Error(Re||"HTTP "+be.status)}}je(J=>({...J,success:"목표가 변경되었습니다"}))}catch(a){alert((a==null?void 0:a.message)||"저장 중 오류가 발생했습니다")}}function qe(a){try{const f=a.getBoundingClientRect(),$=(f==null?void 0:f.width)||a.offsetWidth||600,U=(f==null?void 0:f.height)||a.offsetHeight||400,W=Math.max(0,Math.round((window.innerWidth-$)/2)),ne=Math.max(0,Math.round(window.innerHeight-U-40));return{x:W,y:ne}}catch{const f=Math.max(0,Math.round((window.innerWidth-600)/2)),U=Math.max(0,Math.round(window.innerHeight-400-40));return{x:f,y:U}}}function at(a){try{const f=a.getBoundingClientRect(),$=(f==null?void 0:f.width)||a.offsetWidth||600,U=(f==null?void 0:f.height)||a.offsetHeight||400,W=Math.max(0,Math.round((window.innerWidth-$)/2)),D=Math.max(0,Math.round((window.innerHeight-U)/2));return{x:W,y:D}}catch{const U=Math.max(0,Math.round((window.innerWidth-600)/2)),W=Math.max(0,Math.round((window.innerHeight-400)/2));return{x:U,y:W}}}function ft(a){try{const f=a.getBoundingClientRect(),$=(f==null?void 0:f.width)||a.offsetWidth||460,U=Math.max(0,Math.round(window.innerWidth-$)),W=Math.max(0,Math.round(window.innerHeight*.17));return{x:U,y:W}}catch{const $=Math.max(0,Math.round(window.innerWidth-460)),U=Math.max(0,Math.round(window.innerHeight*.17));return{x:$,y:U}}}const bt=At("sales-plan-target-input",!!Q.open,qe,{persist:!1,resetOnOpen:!0}),Ye=At("sales-plan-bulk-input",!!ae.open,at,{persist:!1,resetOnOpen:!0}),[it,as]=t.useState({open:!1,rows:[],success:null}),[ys,As]=t.useState("");function Nt(){const a=(et.rows||[]).map((f,$)=>({key:`${f.sub}||${f.unit}||${$}`,sub:f.sub,unit:f.unit,stage:f.stage,type:f.type,month:"",qty:"",dist:new Array(12).fill(0),curMonths:f.months?f.months.slice():new Array(12).fill(0),curAmounts:f.amounts?f.amounts.slice():new Array(12).fill(0)}));as({open:!0,rows:a,success:null});try{ot()}catch{}try{Xe()}catch{}}function Gt(){as({open:!1,rows:[],success:null})}function Ot(){const a=Number(ys);if(!Number.isFinite(a)){alert("적용 비율(%)을 입력하세요.");return}let f=1+a/100;(!Number.isFinite(f)||f<0)&&(f=0),as($=>{const U=($.rows||[]).map(W=>{const D=W.curMonths||[],ne=Array.from({length:12},(J,K)=>{const oe=Number(D[K]||0);return Number.isFinite(oe)?oe*f:0});return{...W,dist:ne}});return{...$,rows:U}})}const fs=At("sales-plan-bulk-ratio",!!it.open,at,{persist:!1,resetOnOpen:!0});async function Rs(){try{const a=Number(E),f=m,$=(localStorage.getItem("tnt.sales.assigneeId")||"").trim(),U=Number((l==null?void 0:l.customerSeq)||0);if(!Number.isFinite(a)||a<=0){alert("연도를 선택하세요.");return}if(!$){alert("로그인이 필요합니다.");return}if(!U){alert("거래처를 선택하세요.");return}const W={"Content-Type":"application/json","X-ASSIGNEE-ID":$},D=(localStorage.getItem("tnt.sales.empId")||"").trim();D&&(W["X-EMP-ID"]=D);const ne=(it.rows||[]).filter(J=>(J.dist||[]).some(K=>Number(K)>0));if(ne.length===0){alert("적용 비율을 먼저 적용하세요.");return}for(const J of ne){const K=(J.dist||[]).map(ce=>{const Ce=Number(ce);return!Number.isFinite(Ce)||Ce<=0?0:Math.round(Ce*100)/100}),oe={year:a,companyType:f,assigneeId:$,customerSeq:U,itemSubcategory:J.sub,salesMgmtUnit:J.unit,qty:K},de=await fetch("/api/v1/sales/plan/upsert-row",{method:"POST",headers:W,body:JSON.stringify(oe)});if(!de.ok){let ce=await de.text().catch(()=>"");throw new Error(ce||"HTTP "+de.status)}}as(J=>({...J,success:"목표가 변경되었습니다"}))}catch(a){alert((a==null?void 0:a.message)||"저장 중 오류가 발생했습니다")}}const[Ke,It]=t.useState({open:!1,loading:!1,error:null,success:null,opts:[],dist:new Array(12).fill(0),rows:[]}),xs=At("sales-plan-new-item",!!Ke.open,at,{persist:!1,resetOnOpen:!0});function En(a){try{const f=a.getBoundingClientRect(),$=(f==null?void 0:f.width)||a.offsetWidth||480,U=(f==null?void 0:f.height)||a.offsetHeight||300,W=12;let D=Math.round(Ze.x-Math.min($/2,240)),ne=Math.round(Ze.y+W);return D=Math.max(8,Math.min(D,window.innerWidth-$-8)),ne=Math.max(8,Math.min(ne,window.innerHeight-U-8)),{x:D,y:ne}}catch{const f=Math.max(8,Math.min(Ze.x,window.innerWidth-500)),$=Math.max(8,Math.min(Ze.y,window.innerHeight-320));return{x:f,y:$}}}const qs=At("plan-totals-breakdown",nt.open,En,{persist:!1,resetOnOpen:!0});async function Gs(){It(a=>({...a,open:!0,loading:!0,error:null,unit:"",sub:"",month:"",qty:"",dist:new Array(12).fill(0),rows:[]}));try{const a=await fetch("/api/v1/items/dim"),f=a.ok?await a.json():[],$=Array.isArray(f)?f.map(D=>({itemSubcategory:String(D.itemSubcategory||D.item_subcategory||""),salesMgmtUnit:String(D.salesMgmtUnit||D.sales_mgmt_unit||"")})):[],U={};$.forEach(D=>{const ne=D.salesMgmtUnit.trim();ne&&!U[ne]&&(U[ne]=D)});const W=Object.values(U).sort((D,ne)=>D.salesMgmtUnit.localeCompare(ne.salesMgmtUnit));It(D=>({...D,loading:!1,opts:W}));try{ot()}catch{}}catch(a){It(f=>({...f,loading:!1,error:(a==null?void 0:a.message)||"조회 오류",opts:[]}))}}t.useEffect(()=>{if(Ke.open){try{ot()}catch{}try{Xe()}catch{}}},[Ke.open,E,m]);function Is(){It({open:!1,loading:!1,error:null,success:null,opts:[],dist:new Array(12).fill(0),rows:[]})}function Dn(a){const f=Ke.opts.find($=>$.salesMgmtUnit===a);It($=>({...$,unit:a,sub:(f==null?void 0:f.itemSubcategory)||$.sub}));try{ot()}catch{}try{xt(a)}catch{}try{Ht(a)}catch{}}function Vs(a,f){const $=Number(a??Ke.month),U=Number(f??Ke.qty),W=new Array(12).fill(0);if(Number.isFinite($)&&$>=1&&$<=12&&Number.isFinite(U)&&U>0){const D=12-$+1,ne=U/D;for(let J=$-1;J<12;J++)W[J]=ne}It(D=>({...D,month:a??D.month,qty:f??D.qty,dist:W}))}function Mn(){const a=(Ke.unit||"").trim(),f=(Ke.sub||"").trim(),$=Ke.month,U=Ke.qty;if(!a||!$||!U){alert("영업관리단위, 매출월, 매출 수량을 입력하세요.");return}const W={sub:f||"(신규)",unit:a,months:Ke.dist.slice()};It(D=>{const ne=D.rows.slice(),J=ne.findIndex(K=>(K.unit||"").trim()===a&&(K.sub||"").trim()===(W.sub||"").trim());return J>=0?ne[J]={...ne[J],sub:W.sub,unit:W.unit,months:W.months.slice()}:ne.push(W),{...D,rows:ne,unit:"",sub:"",month:"",qty:"",dist:new Array(12).fill(0)}})}async function _n(){try{const a=Number(E),f=m,$=(localStorage.getItem("tnt.sales.assigneeId")||"").trim(),U=Number((l==null?void 0:l.customerSeq)||0);if(!Number.isFinite(a)||a<=0){alert("연도를 선택하세요.");return}if(!$){alert("로그인이 필요합니다.");return}if(!U){alert("거래처를 선택하세요.");return}const W=Ke.rows||[];if(!W.length){alert("추가된 영업관리단위가 없습니다.");return}const D=new Set((et.rows||[]).map(oe=>`${String(oe.sub||"").trim()}||${String(oe.unit||"").trim()}`).filter(oe=>!!oe&&oe!=="||")),ne=W.map(oe=>({sub:String(oe.sub||"").trim(),unit:String(oe.unit||"").trim()})).filter(oe=>oe.sub&&oe.unit&&D.has(`${oe.sub}||${oe.unit}`)).map(oe=>oe.unit);if(ne.length>0){It(oe=>({...oe,error:`${ne.join(", ")} 이미 목표에 등록되어 있습니다. 목표 수정을 통해 작업 하세요.`}));return}const J={"Content-Type":"application/json","X-ASSIGNEE-ID":$},K=(localStorage.getItem("tnt.sales.empId")||"").trim();K&&(J["X-EMP-ID"]=K);for(const oe of W){const de=(oe.months||[]).map(ct=>{const Ge=Number(ct);return!Number.isFinite(Ge)||Ge<=0?0:Math.round(Ge*100)/100}),ce=String(oe.unit||"").trim(),Ce=He(ce),be=Number.isFinite(Ce)?Math.round(Number(Ce)):0,Re=de.map(ct=>Number.isFinite(ct)&&be>0?Math.round(Number(ct)*be):0),$e={year:a,companyType:f,assigneeId:$,customerSeq:U,itemSubcategory:oe.sub,salesMgmtUnit:oe.unit,qty:de,amount:Re},Be=await fetch("/api/v1/sales/plan/upsert-row",{method:"POST",headers:J,body:JSON.stringify($e)});if(!Be.ok){let ct=await Be.text().catch(()=>"");throw new Error(ct||"HTTP "+Be.status)}}It(oe=>({...oe,success:"목표가 변경되었습니다"}))}catch(a){alert((a==null?void 0:a.message)||"저장 중 오류가 발생했습니다")}}t.useEffect(()=>{if(!Q.open&&!ae.open&&!Ke.open)return;const a=f=>{f.key==="Escape"&&(Q.open&&Xt(),ae.open&&Le(),Ke.open&&Is())};return window.addEventListener("keydown",a,!0),()=>window.removeEventListener("keydown",a,!0)},[Q.open,ae.open,Ke.open]);async function rs(a=!0){se(null),a?(X(!0),H(0),te(!0)):i(!0);try{const f=Number(E);if(!Number.isFinite(f)||f<=0){a&&(N([]),te(!0),H(0),n({}),o({}));return}const $=localStorage.getItem("tnt.sales.assigneeId");if(!$){N([]),se(st.loginRequired);return}const U=new URL("/api/v1/customers",window.location.origin);U.searchParams.set("mineOnly","true"),U.searchParams.set("assigneeId",$),U.searchParams.set("companyType",m),E&&U.searchParams.set("year",String(E)),y.trim()&&U.searchParams.set("name",y.trim()),U.searchParams.set("limit",String(M)),U.searchParams.set("offset",String(a?0:G));const W=await fetch(U.toString());if(!W.ok){let J=`HTTP ${W.status}`;try{const K=await W.json();K!=null&&K.error&&(J=K.error)}catch{const K=await W.text();K&&(J=K)}throw new Error(J)}const D=await W.json(),ne=Array.isArray(D)?D:[];N(a?ne:J=>[...J,...ne]),te(ne.length>=M),H(J=>a?M:J+M);try{if($){const J=new URL("/api/v1/customers/count",window.location.origin);J.searchParams.set("mineOnly","true"),J.searchParams.set("assigneeId",$);const K=await fetch(J.toString());if(K.ok){const oe=await K.json().catch(()=>({})),de=Number((oe==null?void 0:oe.total)??0);z(Number.isFinite(de)?de:0)}else z(0)}else z(0)}catch{z(0)}try{const J=ne.map(K=>Number(K.customerSeq||0)).filter(K=>Number.isFinite(K)&&K>0);if(J.length>0){const K=new URL("/api/v1/customers/recent-invoice-flags",window.location.origin);K.searchParams.set("custSeq",Array.from(new Set(J)).join(",")),K.searchParams.set("years","2");const oe=await fetch(K.toString());if(oe.ok){const de=await oe.json(),ce={};Array.isArray(de)&&de.forEach(Ce=>{const be=Number((Ce==null?void 0:Ce.customerSeq)||(Ce==null?void 0:Ce.customerSeqText)||0);Number.isFinite(be)&&(ce[be]=!!(Ce!=null&&Ce.hasRecent))}),n(Ce=>a?ce:{...Ce,...ce})}else a&&n({})}else a&&n({})}catch{n({})}try{const J=Number(E),K=Number.isFinite(J)&&J>0?J:new Date().getFullYear(),oe=localStorage.getItem("tnt.sales.assigneeId")||"",de=ne.map(ce=>Number(ce.customerSeq||0)).filter(ce=>Number.isFinite(ce)&&ce>0);if(oe&&de.length>0){const ce=new URL("/api/v1/sales/plan/stages",window.location.origin);ce.searchParams.set("year",String(K)),m&&ce.searchParams.set("companyType",m),ce.searchParams.set("assigneeId",oe),ce.searchParams.set("customerSeqs",Array.from(new Set(de)).join(","));const Ce=await fetch(ce.toString());if(Ce.ok){const be=await Ce.json(),Re={};Array.isArray(be)&&be.forEach($e=>{const Be=Number(($e==null?void 0:$e.customer_seq)??($e==null?void 0:$e.customerSeq)??0),ct=String(($e==null?void 0:$e.target_stage)??($e==null?void 0:$e.targetStage)??"").trim();Number.isFinite(Be)&&ct&&(Re[Be]=ct)}),o($e=>a?Re:{...$e,...Re})}else a&&o({})}else a&&o({})}catch{a&&o({})}}catch(f){se(f.message||"조회 중 오류가 발생했습니다")}finally{a?X(!1):i(!1)}}t.useEffect(()=>{E&&rs(!0)},[E,m]),t.useEffect(()=>{E||(N([]),te(!0),H(0),n({}),o({}))},[E]),t.useEffect(()=>{async function a(){try{const f=localStorage.getItem("tnt.sales.assigneeId");if(!f){L({tnt:0,dys:0});return}const $=Number(E);if(!Number.isFinite($)||$<=0){L({tnt:0,dys:0});return}const U=new URL("/api/v1/customers/with-invoice-count",window.location.origin);U.searchParams.set("assigneeId",f),U.searchParams.set("year",String($));const W=await fetch(U.toString());if(!W.ok){L({tnt:0,dys:0});return}const D=await W.json().catch(()=>({})),ne=Number((D==null?void 0:D.tnt)??0),J=Number((D==null?void 0:D.dys)??0);L({tnt:Number.isFinite(ne)?ne:0,dys:Number.isFinite(J)?J:0})}catch{L({tnt:0,dys:0})}}a()},[E]);const $n=t.useMemo(()=>{const a=Number(E);return Number.isFinite(a)&&a>0?`${a-1}년`:"전년도"},[E]),Pn=t.useMemo(()=>(localStorage.getItem("tnt.sales.empName")||"").trim()||"사용자",[]),mt="#1e3a8a";t.useEffect(()=>{if(!d.open)return;const a=()=>x({open:!1,x:0,y:0});return window.addEventListener("click",a),()=>window.removeEventListener("click",a)},[d.open]),t.useEffect(()=>{if(!d.open)return;const a=f=>{f.key==="Escape"&&x({open:!1,x:0,y:0})};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[d.open]),t.useEffect(()=>{const a=f=>{((f==null?void 0:f.key)==="Escape"||(f==null?void 0:f.key)==="Esc"||(f==null?void 0:f.keyCode)===27)&&(x({open:!1,x:0,y:0}),w({open:!1,x:0,y:0}))};return document.addEventListener("keydown",a,!0),()=>document.removeEventListener("keydown",a,!0)},[]);async function Ln(a,f){a.preventDefault(),a.stopPropagation(),x({open:!1,x:0,y:0});const $=a.clientX,U=a.clientY;w({open:!0,x:$,y:U,row:f,loading:!1,error:null,data:[]})}const Zs=t.useMemo(()=>{var f,$,U,W,D,ne,J,K,oe,de,ce,Ce,be,Re,$e;const a=[...V].sort((Be,ct)=>{const Ge=Number(Be.customerSeq||0),Dt=Number(ct.customerSeq||0),Mt=!!h[Ge],Lt=!!h[Dt];if(Mt!==Lt)return Mt?-1:1;const Yt=(Be.customerName||"").toString(),Fs=(ct.customerName||"").toString();return Yt.localeCompare(Fs,"ko",{sensitivity:"base"})});return e.jsx(e.Fragment,{children:e.jsxs("div",{ref:v,className:"table-container",onClick:()=>x({open:!1,x:0,y:0}),style:{height:"100%",overflow:"auto"},children:[a.length===0?e.jsx("div",{className:"empty-state",children:st.empty}):e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsx("tr",{children:e.jsx("th",{style:{width:"auto"},children:"거래처명"})})}),e.jsx("tbody",{children:a.map((Be,ct)=>e.jsx("tr",{onClick:Ge=>{Ge.preventDefault(),Ge.stopPropagation(),C(Be),w({open:!1,x:0,y:0})},onContextMenu:Ge=>Ln(Ge,Be),"aria-selected":(l==null?void 0:l.customerId)===Be.customerId?!0:void 0,style:(l==null?void 0:l.customerId)===Be.customerId?{background:"var(--row-selected, rgba(0, 128, 255, 0.12))"}:void 0,children:e.jsx("td",{children:(()=>{const Ge=Number(Be.customerSeq||0),Dt=h[Ge],Mt={};return Dt==="P"&&(Mt.color="#dc2626"),Dt==="C"&&(Mt.fontWeight=700),e.jsxs("span",{children:[e.jsx("span",{style:Mt,children:Be.customerName}),Dt?e.jsx("span",{className:"badge stage-badge",style:{marginLeft:6},children:Dt}):null]})})()})},ct))})]}),c&&e.jsx("div",{className:"muted",style:{padding:"6px 8px"},children:st.loading}),!q&&!c&&!j&&V.length>0&&e.jsx("div",{className:"muted",style:{padding:"8px 10px",textAlign:"center"},children:"마지막 데이터입니다."}),S.open&&e.jsxs("div",{className:"context-menu",style:{left:S.x+6,top:S.y+6,maxWidth:420,padding:8},onClick:Be=>Be.stopPropagation(),children:[e.jsx("div",{style:{fontWeight:600,marginBottom:6},children:"거래처 상세"}),S.error?e.jsx("div",{className:"error",style:{maxWidth:380},children:S.error}):e.jsx("table",{className:"table",style:{width:"100%"},children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{style:{width:110,textAlign:"left"},children:"거래처번호"}),e.jsx("td",{children:((f=S.row)==null?void 0:f.customerId)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"사업자번호"}),e.jsx("td",{children:(($=S.row)==null?void 0:$.bizNo)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"대표자명"}),e.jsx("td",{children:((U=S.row)==null?void 0:U.ownerName)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"업태"}),e.jsx("td",{children:((W=S.row)==null?void 0:W.bizKind)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"종목"}),e.jsx("td",{children:((D=S.row)==null?void 0:D.bizType)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"전화번호"}),e.jsx("td",{children:((ne=S.row)==null?void 0:ne.telNo)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"담당자명"}),e.jsx("td",{children:((J=S.row)==null?void 0:J.empName)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"부서명"}),e.jsx("td",{children:((K=S.row)==null?void 0:K.deptName)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"시/도"}),e.jsx("td",{children:((oe=S.row)==null?void 0:oe.addrProvinceName)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"시/군/구"}),e.jsx("td",{children:((de=S.row)==null?void 0:de.addrCityName)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"고객유형"}),e.jsx("td",{children:((ce=S.row)==null?void 0:ce.customerTypeName)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"비고"}),e.jsx("td",{children:((Ce=S.row)==null?void 0:Ce.customerRemark)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"생성자"}),e.jsx("td",{children:((be=S.row)==null?void 0:be.createdBy)??""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"수정자"}),e.jsx("td",{children:((Re=S.row)==null?void 0:Re.updatedBy)??""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"생성일시"}),e.jsx("td",{children:sa(($e=S.row)==null?void 0:$e.createdAt)})]})]})})]})]})})},[V,d,r,S,l,h,q,c,j]);t.useEffect(()=>{const a=v.current;if(!a)return;function f(){a.scrollTop+a.clientHeight>=a.scrollHeight-48&&j&&!c&&!q&&rs(!1)}return a.addEventListener("scroll",f),()=>a.removeEventListener("scroll",f)},[j,c,q,G]);const[Pt,os]=t.useState({open:!1,loading:!1,error:null,rows:[]}),[Ws,Rn]=t.useState(10),[Vt,en]=t.useState(""),[js,zs]=t.useState("TNT"),Os=At("unit-amounts-by-emp",Pt.open,ft,{persist:!1,resetOnOpen:!0}),[cs,Ts]=t.useState({total:0,confirmed:0,inprogress:0,loading:!1,error:null}),[vs,Es]=t.useState({tnt:0,dys:0,loading:!1,error:null});t.useEffect(()=>{async function a(){const f=Number(E),$=(localStorage.getItem("tnt.sales.assigneeId")||"").trim(),U=(localStorage.getItem("tnt.sales.empId")||"").trim();if(!Number.isFinite(f)||f<=0||!$&&!U){Ts({total:0,confirmed:0,inprogress:0,loading:!1,error:null});return}Ts(W=>({...W,loading:!0,error:null}));try{const W=new URL("/api/v1/sales/plan/customer-counts-overall",window.location.origin);W.searchParams.set("year",String(f)),$?W.searchParams.set("assigneeId",$):U&&W.searchParams.set("empId",U);const D=await fetch(W.toString());if(!D.ok)throw new Error(`HTTP ${D.status}`);const ne=await D.json(),J=Number((ne==null?void 0:ne.total_customers)??0)||0,K=Number((ne==null?void 0:ne.confirmed_customers)??0)||0,oe=Number((ne==null?void 0:ne.inprogress_customers)??0)||0;Ts({total:J,confirmed:K,inprogress:oe,loading:!1,error:null})}catch(W){Ts({total:0,confirmed:0,inprogress:0,loading:!1,error:(W==null?void 0:W.message)||"요약 조회 오류"})}}a()},[E,Ut]);async function qn(){try{const a=localStorage.getItem("tnt.sales.assigneeId");if(!a||!Vt){os(ce=>({...ce,loading:!1}));return}const f=new URL("/api/v1/dashboard/avg-unit-price-by-emp",window.location.origin);f.searchParams.set("assigneeId",a),f.searchParams.set("companyType",js),f.searchParams.set("year",String(Vt));const $=await fetch(f.toString());if(!$.ok)throw new Error(`HTTP ${$.status}`);const U=await $.json(),W=new URL("/api/v1/dashboard/avg-unit-price",window.location.origin);W.searchParams.set("companyType",js),W.searchParams.set("year",String(Vt));const D=await fetch(W.toString()),ne=D.ok?await D.json():[],J={},K={};Array.isArray(U)&&U.forEach(ce=>{const be=String((ce==null?void 0:ce.sales_mgmt_unit)??(ce==null?void 0:ce.salesMgmtUnit)??"").trim().toUpperCase();be&&(J[be]={amount:Number((ce==null?void 0:ce.avg_unit_price)??(ce==null?void 0:ce.avgUnitPrice)??0),itemUnit:String((ce==null?void 0:ce.item_unit)??(ce==null?void 0:ce.itemUnit)??""),itemStdUnit:String((ce==null?void 0:ce.item_std_unit)??(ce==null?void 0:ce.itemStdUnit)??"")})}),Array.isArray(ne)&&ne.forEach(ce=>{const be=String((ce==null?void 0:ce.sales_mgmt_unit)??(ce==null?void 0:ce.salesMgmtUnit)??"").trim().toUpperCase();be&&(K[be]={amount:Number((ce==null?void 0:ce.avg_unit_price)??(ce==null?void 0:ce.avgUnitPrice)??0),itemUnit:String((ce==null?void 0:ce.item_unit)??(ce==null?void 0:ce.itemUnit)??""),itemStdUnit:String((ce==null?void 0:ce.item_std_unit)??(ce==null?void 0:ce.itemStdUnit)??"")})});const de=Array.from(new Set([...Object.keys(J),...Object.keys(K)])).sort().map(ce=>{var Ce,be,Re,$e,Be,ct;return{unit:ce,amountMy:Number(((Ce=J[ce])==null?void 0:Ce.amount)??0),amountGlobal:Number(((be=K[ce])==null?void 0:be.amount)??0),itemUnit:((Re=J[ce])==null?void 0:Re.itemUnit)||(($e=K[ce])==null?void 0:$e.itemUnit)||"",itemStdUnit:((Be=J[ce])==null?void 0:Be.itemStdUnit)||((ct=K[ce])==null?void 0:ct.itemStdUnit)||""}});os({open:!0,loading:!1,error:null,rows:de})}catch(a){os({open:!0,loading:!1,error:(a==null?void 0:a.message)||"조회 오류",rows:[]})}}function Wn(){os({open:!0,loading:!0,error:null,rows:[]});const a=Number(E),f=Number.isFinite(a)&&a>0?a-1:new Date().getFullYear()-1,$=Math.max(2025,Math.min(2030,f));en($),zs("TNT")}function zn(a){const f=a.target.value;ve(f)}function tn(){os(a=>({...a,open:!1}))}return t.useEffect(()=>{if(!Pt.open)return;const a=f=>{f.key==="Escape"&&tn()};return window.addEventListener("keydown",a,!0),()=>window.removeEventListener("keydown",a,!0)},[Pt.open]),t.useEffect(()=>{Pt.open&&Vt&&(os(a=>({...a,loading:!0})),qn())},[Pt.open,Vt,js]),t.useEffect(()=>{(async()=>{try{Es(K=>({...K,loading:!0,error:null}));const a=Number(E),f=(localStorage.getItem("tnt.sales.assigneeId")||"").trim(),$=(localStorage.getItem("tnt.sales.empId")||"").trim();if(!Number.isFinite(a)||a<=0||!f&&!$){Es({tnt:0,dys:0,loading:!1,error:null});return}const U=new URL("/api/v1/sales/plan/totals-confirmed-by-assignee",window.location.origin);U.searchParams.set("year",String(a)),f?U.searchParams.set("assigneeId",f):$&&U.searchParams.set("empId",$);const W=await fetch(U.toString());if(!W.ok)throw new Error(`HTTP ${W.status}`);const D=await W.json().catch(()=>[]);let ne=0,J=0;if(Array.isArray(D))for(const K of D){const oe=String((K==null?void 0:K.company_type)||(K==null?void 0:K.companyType)||"").toUpperCase(),de=Number((K==null?void 0:K.amount)||0);oe==="TNT"?ne+=de:oe==="DYS"&&(J+=de)}Es({tnt:Math.round(ne),dys:Math.round(J),loading:!1,error:null})}catch(a){Es({tnt:0,dys:0,loading:!1,error:(a==null?void 0:a.message)||"확정 합계 조회 오류"})}})()},[E]),t.useEffect(()=>{if(!Q.open)return;const a=f=>{f.key==="Escape"&&Xt()};return window.addEventListener("keydown",a,!0),()=>window.removeEventListener("keydown",a,!0)},[Q.open]),t.useEffect(()=>{if(!ae.open)return;const a=f=>{f.key==="Escape"&&Le()};return window.addEventListener("keydown",a,!0),()=>window.removeEventListener("keydown",a,!0)},[ae.open]),t.useEffect(()=>{if(!it.open)return;const a=f=>{f.key==="Escape"&&Gt()};return window.addEventListener("keydown",a,!0),()=>window.removeEventListener("keydown",a,!0)},[it.open]),t.useEffect(()=>{if(!Ke.open)return;const a=f=>{f.key==="Escape"&&Is()};return window.addEventListener("keydown",a,!0),()=>window.removeEventListener("keydown",a,!0)},[Ke.open]),t.useEffect(()=>{if(!nt.open)return;const a=f=>{f.key==="Escape"&&Bt()};return window.addEventListener("keydown",a,!0),()=>window.removeEventListener("keydown",a,!0)},[nt.open]),e.jsxs("section",{"aria-busy":lt||void 0,children:[e.jsxs("div",{className:"page-title",style:{alignItems:"center"},children:[e.jsx("h2",{style:{margin:0,fontSize:18},children:"목표 Simulation"}),e.jsxs("div",{className:"muted count-text",style:{display:"flex",alignItems:"center",gap:12,flexWrap:"wrap"},children:[e.jsx("span",{style:{fontWeight:700},children:"현재목표"}),e.jsxs("span",{onClick:a=>ts("TNT",a),style:{display:"inline-flex",alignItems:"baseline",gap:8,padding:"6px 10px",border:"2px solid #3b82f6",borderRadius:999,fontWeight:800,fontSize:16,background:"transparent",cursor:"pointer"},title:"TNT 계획 합계 (클릭하여 상세)",children:[e.jsx("span",{style:{fontSize:12,color:"#3b82f6",fontWeight:700},children:"TNT"}),e.jsx("span",{style:{color:"#3b82f6"},children:gt.format(We.tnt)}),e.jsx("span",{style:{fontSize:12,color:"#3b82f6"},children:"원"})]}),e.jsxs("span",{onClick:a=>ts("DYS",a),style:{display:"inline-flex",alignItems:"baseline",gap:8,padding:"6px 10px",border:"2px solid #10b981",borderRadius:999,fontWeight:800,fontSize:16,background:"transparent",cursor:"pointer"},title:"DYS 계획 합계 (클릭하여 상세)",children:[e.jsx("span",{style:{fontSize:12,color:"#10b981",fontWeight:700},children:"DYS"}),e.jsx("span",{style:{color:"#10b981"},children:gt.format(We.dys)}),e.jsx("span",{style:{fontSize:12,color:"#10b981"},children:"원"})]}),e.jsx("span",{"aria-hidden":!0,style:{width:1,height:20,background:"var(--border)",display:"inline-block"}}),e.jsx("span",{style:{fontWeight:700},children:"목표확정"}),vs.loading?e.jsx("span",{className:"muted",style:{fontSize:12},children:"불러오는 중…"}):vs.error?e.jsx("span",{className:"error",style:{fontSize:12},children:vs.error}):e.jsxs(e.Fragment,{children:[e.jsxs("span",{title:"확정된 고객 합계 (TNT)",style:{display:"inline-flex",alignItems:"baseline",gap:8,padding:"6px 10px",border:"2px solid #3b82f6",borderRadius:999,fontWeight:800,fontSize:16,background:"transparent"},children:[e.jsx("span",{style:{fontSize:12,color:"#3b82f6",fontWeight:700},children:"TNT"}),e.jsx("span",{style:{color:"#3b82f6"},children:gt.format(vs.tnt)}),e.jsx("span",{style:{fontSize:12,color:"#3b82f6"},children:"원"})]}),e.jsxs("span",{title:"확정된 고객 합계 (DYS)",style:{display:"inline-flex",alignItems:"baseline",gap:8,padding:"6px 10px",border:"2px solid #10b981",borderRadius:999,fontWeight:800,fontSize:16,background:"transparent"},children:[e.jsx("span",{style:{fontSize:12,color:"#10b981",fontWeight:700},children:"DYS"}),e.jsx("span",{style:{color:"#10b981"},children:gt.format(vs.dys)}),e.jsx("span",{style:{fontSize:12,color:"#10b981"},children:"원"})]})]}),e.jsx("button",{className:"btn-plain",title:"내 평균거래 단가",onClick:Wn,"aria-label":"평균거래 단가 팝업 열기",children:e.jsx("img",{src:bn,className:"icon",alt:"단가"})}),g.toLocaleString(),"개 거래처"]})]}),e.jsxs("div",{className:"card",style:{padding:8,marginTop:8,display:"flex",alignItems:"center",gap:12,flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:8},children:[e.jsx("div",{className:"muted",children:"목표년도"}),e.jsxs("select",{className:"search-input",value:E,onChange:zn,"aria-label":"목표년도",style:{height:28},children:[e.jsx("option",{value:"",disabled:!0,children:"선택"}),Ae().map(a=>e.jsxs("option",{value:String(a),children:[a,"년"]},a))]}),e.jsx("div",{className:"muted",style:{marginLeft:12},children:"가중치"}),e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[e.jsx("input",{className:"search-input",value:String(Ws),onChange:a=>{const f=Number((a.target.value||"").replace(/[^0-9]/g,""));Number.isFinite(f)&&Rn(Math.max(0,Math.min(999,f)))},inputMode:"numeric","aria-label":"가중치(%)",style:{width:72,height:28,textAlign:"right"}}),e.jsx("span",{className:"muted",children:"%"})]})]}),(()=>{const a=!!(I.hasC&&!I.hasP&&!I.hasI),f=!!(I.hasI&&!I.hasP&&!I.hasC),$=!!(I.hasP||I.hasC&&I.hasI),U=a?"목표수립완료":f?"초기설정완료":$?"계획수립 중":"초기설정",W=a||f||$,D=W||lt?{opacity:.6,cursor:"not-allowed",background:"var(--border)",color:"var(--muted)"}:void 0;return e.jsx("button",{className:"btn btn-card btn-3d",onClick:On,disabled:W||lt,style:D,children:U})})(),E?I.show?e.jsxs("div",{className:"muted",style:{display:"inline-flex",alignItems:"center",gap:6,flexWrap:"wrap",fontSize:12},children:[e.jsxs("span",{style:{fontSize:12},children:[I.name,"님"]}),e.jsxs("span",{style:{color:mt,fontWeight:700,fontSize:14,whiteSpace:"pre"},children:[I.year,"년"]}),e.jsx("span",{style:{fontSize:12},children:" "}),e.jsxs("span",{style:{color:mt,fontWeight:700,fontSize:14},children:["TNT ",I.tnt.toLocaleString(),"개"]}),e.jsx("span",{style:{fontSize:12},children:","}),e.jsxs("span",{style:{color:mt,fontWeight:700,fontSize:14},children:[" DYS ",I.dys.toLocaleString(),"개"]}),e.jsx("span",{style:{fontSize:12},children:I.label||""})]}):re?e.jsxs("div",{className:"muted",style:{display:"inline-flex",alignItems:"center",gap:6,flexWrap:"wrap",fontSize:12},children:[e.jsxs("span",{style:{fontSize:12},children:[Pn,"님,"]}),e.jsx("span",{style:{color:mt,fontWeight:700,fontSize:14},children:$n}),e.jsx("span",{style:{fontSize:12},children:"매출 기준으로 담당 거래처"}),e.jsx("span",{style:{color:mt,fontWeight:700,fontSize:14},children:"TNT"}),e.jsx("span",{style:{color:mt,fontWeight:700,fontSize:14},children:ye.tnt.toLocaleString()}),e.jsx("span",{style:{fontSize:12},children:"개,"}),e.jsx("span",{style:{color:mt,fontWeight:700,fontSize:14},children:"DYS"}),e.jsx("span",{style:{color:mt,fontWeight:700,fontSize:14},children:ye.dys.toLocaleString()}),e.jsx("span",{style:{fontSize:12},children:"개에 대해"}),e.jsxs("span",{style:{color:mt,fontWeight:700,fontSize:14},children:[Ws,"%"]}),e.jsx("span",{style:{fontSize:12},children:"추가하여 목표 설정합니다."})]}):null:null,e.jsx("div",{className:"muted",style:{marginLeft:"auto"},children:cs.loading?"요약 불러오는 중…":cs.error?e.jsx("span",{className:"error",children:cs.error}):e.jsxs(e.Fragment,{children:["수립대상 ",cs.total.toLocaleString(),"개, 확정 ",cs.confirmed.toLocaleString(),"개, 진행 중 ",cs.inprogress.toLocaleString(),"개"]})})]}),nt.open&&e.jsx("div",{role:"dialog","aria-modal":"true",className:"card",style:{position:"fixed",inset:0,background:"transparent",zIndex:60},children:e.jsxs("div",{ref:qs.ref,className:"card",style:{...qs.style,width:720,maxWidth:"92vw",background:"var(--panel)",padding:12,fontSize:12},children:[e.jsx("div",{...qs.bindHeader,style:{position:"absolute",top:0,left:0,right:36,height:32,cursor:"move"},"aria-hidden":"true"}),e.jsx("button",{"aria-label":"닫기",onClick:Bt,className:"btn-plain",style:{position:"absolute",top:8,right:8},children:e.jsx("img",{src:dt,className:"icon",alt:"닫기"})}),e.jsxs("div",{className:"page-title",style:{marginBottom:8,alignItems:"center"},children:[e.jsxs("h2",{style:{margin:0},children:[nt.company," 계획 합계 상세"]}),e.jsxs("div",{className:"controls",style:{gap:8},children:[e.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[e.jsx("input",{type:"radio",name:"totals-group",checked:nt.group==="customer",onChange:()=>{ut(a=>({...a,group:"customer"})),Et(nt.company,"customer")}}),"거래처별"]}),e.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[e.jsx("input",{type:"radio",name:"totals-group",checked:nt.group==="unit",onChange:()=>{ut(a=>({...a,group:"unit"})),Et(nt.company,"unit")}}),"영업관리단위별"]})]})]}),nt.error?e.jsx("div",{className:"error",children:nt.error}):null,e.jsx("div",{className:"table-container",style:{maxHeight:"66vh",overflow:"auto"},children:e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left",width:380},children:nt.group==="customer"?"거래처":"영업관리단위"}),e.jsx("th",{style:{textAlign:"right",width:200},children:"금액(원)"})]})}),e.jsx("tbody",{children:nt.loading?e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"muted",style:{padding:"12px 10px"},children:"불러오는 중…"})}):nt.rows.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"muted",style:{padding:"12px 10px"},children:"데이터가 없습니다"})}):nt.rows.map((a,f)=>{const $=nt.group==="customer"&&a.label||a.key;return e.jsxs("tr",{children:[e.jsx("td",{children:$}),e.jsx("td",{className:"sum-cell",style:{textAlign:"right"},children:gt.format(Math.round(a.amount))})]},f)})})]})})]})}),es?e.jsx("div",{role:"dialog","aria-modal":"true",className:"card",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.35)",zIndex:80,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{className:"card",style:{background:"var(--panel)",padding:12,border:"1px solid var(--border)",borderRadius:10,minWidth:280,maxWidth:"86vw"},children:[e.jsx("div",{style:{marginBottom:8,fontWeight:700,textAlign:"center"},children:es}),e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx("button",{className:"btn btn-card btn-3d",onClick:()=>kt(null),children:"확인"})})]})}):null,e.jsx("div",{className:"c360-tabs",role:"tablist","aria-label":"회사 구분 탭",style:{marginTop:8},children:["TNT","DYS"].map(a=>e.jsx("button",{role:"tab","aria-selected":Wt===a,className:`tab ${Wt===a?"active":""}`,onClick:()=>{Ct(a);try{P(a)}catch{}},children:a},a))}),Wt==="TNT"?e.jsxs(e.Fragment,{children:[R&&e.jsx("div",{className:"error",children:R||st.errorGeneric}),e.jsxs("div",{style:{marginTop:12,display:"flex",gap:12,alignItems:"stretch",height:"calc(100vh - 140px)"},children:[e.jsxs("div",{style:{flex:"0 0 17%",maxWidth:"17%",minWidth:240,height:"100%",overflow:"auto"},children:[e.jsx("div",{className:"card",style:{padding:8,marginBottom:8},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("input",{className:"search-input",placeholder:"거래처명",value:y,onChange:a=>A(a.target.value),onKeyDown:a=>{a.key==="Enter"&&rs(!0)},style:{flex:1}}),e.jsx("button",{className:"btn",onClick:()=>rs(!0),disabled:q,style:{flex:"0 0 auto"},children:"조회"})]})}),E?Zs:e.jsx("div",{className:"muted",style:{padding:"12px 10px"},children:"연도를 먼저 선택하세요."})]}),e.jsxs("aside",{className:"card",style:{flex:"1 1 83%",maxWidth:"83%",height:"100%",padding:12,overflow:"auto"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12,gap:16},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,flex:1,minWidth:0},children:fe.map((a,f)=>{const $=f<Se,U=f===Se;return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,minWidth:0,flex:f===fe.length-1?"0 0 auto":"1 1 0"},children:[e.jsx("div",{title:a.label,onClick:()=>ue(a.key),style:{width:22,height:22,borderRadius:999,display:"inline-flex",alignItems:"center",justifyContent:"center",background:$||U?"var(--accent)":"transparent",border:`2px solid ${$||U?"var(--accent)":"var(--border)"}`,color:$||U?"var(--on-accent)":"var(--muted)",cursor:"pointer",flex:"0 0 auto"},"aria-current":U?"step":void 0,children:$?"✓":f+1}),e.jsx("div",{style:{fontSize:12,color:U||$?"var(--text)":"var(--muted)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:a.label}),f<fe.length-1&&e.jsx("div",{style:{height:2,background:f<Se?"var(--accent)":"var(--border)",flex:1,borderRadius:2}})]},a.key)})}),e.jsx("div",{children:e.jsx("button",{className:"btn btn-card btn-3d",onClick:ls,disabled:!(l!=null&&l.customerSeq)||!E,title:"해당 거래처 목표 확정",children:"확정"})})]}),l!=null&&l.customerSeq&&E?e.jsxs("div",{className:"card",style:{marginBottom:12,padding:8},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-end",marginBottom:8,gap:8,flexWrap:"wrap"},children:[e.jsx("button",{className:"btn btn-card btn-3d",style:{fontSize:12,padding:"4px 8px"},onClick:Nt,children:"일괄비율"}),e.jsx("button",{className:"btn btn-card btn-3d",style:{fontSize:12,padding:"4px 8px"},onClick:Ie,children:"일괄입력"}),e.jsx("button",{className:"btn btn-card btn-3d",style:{fontSize:12,padding:"4px 8px"},onClick:Gs,children:"신규 영업관리단위"})]}),et.error?e.jsx("div",{className:"error",children:et.error}):e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left",width:220},children:"중분류"}),e.jsx("th",{style:{textAlign:"left",width:220},children:"영업관리단위"}),e.jsx("th",{style:{textAlign:"center",width:120},children:"목표입력"}),e.jsx("th",{className:"sum-head",style:{textAlign:"right",width:140},children:"합계"}),Array.from({length:12},(a,f)=>f+1).map(a=>e.jsxs("th",{style:{textAlign:"right"},children:[String(a).padStart(2,"0"),"월"]},a))]})}),e.jsx("tbody",{children:et.rows.length===0?e.jsx("tr",{children:e.jsx("td",{className:"muted",colSpan:16,style:{padding:"12px 10px"},children:et.loading?"불러오는 중…":"데이터가 없습니다"})}):et.rows.map((a,f)=>{const $=(a.months||[]).reduce((W,D)=>W+(Number.isFinite(D)?Number(D):0),0),U=(a.amounts||[]).reduce((W,D)=>W+(Number.isFinite(D)?Number(D):0),0);return e.jsxs("tr",{children:[e.jsx("td",{children:a.sub}),e.jsxs("td",{children:[e.jsx("span",{children:a.unit}),a.stage?e.jsx("span",{className:"stage-badge",style:{marginLeft:6},title:String(a.stage),children:a.stage}):null]}),e.jsx("td",{style:{textAlign:"center"},children:e.jsx("button",{type:"button",className:"btn btn-card btn-3d",style:{fontSize:12,padding:"4px 8px"},onClick:W=>{W.preventDefault(),W.stopPropagation(),Jt(a.sub,a.unit)},children:"입력"})}),e.jsx("td",{className:"sum-cell",style:{textAlign:"right"},children:Qe($,0,U)}),a.months.map((W,D)=>{var ne;return e.jsx("td",{style:{textAlign:"right"},children:Qe(W,D,(ne=a.amounts)==null?void 0:ne[D],a.stage==="P"?"#dc2626":void 0,a.stage==="C")},D)})]},f)})}),(()=>{if(!et.rows||et.rows.length===0)return null;const a=Array.from({length:12},(W,D)=>et.rows.reduce((ne,J)=>{var K;return ne+(Number((K=J.months)==null?void 0:K[D])||0)},0)),f=Array.from({length:12},(W,D)=>et.rows.reduce((ne,J)=>{var K;return ne+(Number((K=J.amounts)==null?void 0:K[D])||0)},0)),$=a.reduce((W,D)=>W+(Number(D)||0),0),U=f.reduce((W,D)=>W+(Number(D)||0),0);return e.jsx("tfoot",{children:e.jsxs("tr",{className:"sum-row",children:[e.jsx("td",{colSpan:3,style:{textAlign:"center",fontWeight:700},children:"합계"}),e.jsx("td",{className:"sum-cell",style:{textAlign:"right"},children:Qe($,0,U)}),a.map((W,D)=>e.jsx("td",{className:"sum-cell",style:{textAlign:"right"},children:Qe(W,D,f[D])},D))]})})})()]})})]}):null]})]})]}):e.jsxs(e.Fragment,{children:[R&&e.jsx("div",{className:"error",children:R||st.errorGeneric}),e.jsxs("div",{style:{marginTop:12,display:"flex",gap:12,alignItems:"stretch",height:"calc(100vh - 140px)"},children:[e.jsxs("div",{style:{flex:"0 0 17%",maxWidth:"17%",minWidth:240,height:"100%",overflow:"auto"},children:[e.jsx("div",{className:"card",style:{padding:8,marginBottom:8},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("input",{className:"search-input",placeholder:"거래처명",value:y,onChange:a=>A(a.target.value),onKeyDown:a=>{a.key==="Enter"&&rs(!0)},style:{flex:1}}),e.jsx("button",{className:"btn",onClick:()=>rs(!0),disabled:q,style:{flex:"0 0 auto"},children:"조회"})]})}),E?Zs:e.jsx("div",{className:"muted",style:{padding:"12px 10px"},children:"연도를 먼저 선택하세요."})]}),e.jsxs("aside",{className:"card",style:{flex:"1 1 83%",maxWidth:"83%",height:"100%",padding:12,overflow:"auto"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12,gap:16},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,flex:1,minWidth:0},children:fe.map((a,f)=>{const $=f<Se,U=f===Se;return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,minWidth:0,flex:f===fe.length-1?"0 0 auto":"1 1 0"},children:[e.jsx("div",{title:a.label,onClick:()=>ue(a.key),style:{width:22,height:22,borderRadius:999,display:"inline-flex",alignItems:"center",justifyContent:"center",background:$||U?"var(--accent)":"transparent",border:`2px solid ${$||U?"var(--accent)":"var(--border)"}`,color:$||U?"var(--on-accent)":"var(--muted)",cursor:"pointer",flex:"0 0 auto"},"aria-current":U?"step":void 0,children:$?"✓":f+1}),e.jsx("div",{style:{fontSize:12,color:U||$?"var(--text)":"var(--muted)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:a.label}),f<fe.length-1&&e.jsx("div",{style:{height:2,background:f<Se?"var(--accent)":"var(--border)",flex:1,borderRadius:2}})]},a.key)})}),e.jsx("div",{children:e.jsx("button",{className:"btn btn-card btn-3d",onClick:ls,disabled:!(l!=null&&l.customerSeq)||!E,title:"해당 거래처 목표 확정",children:"확정"})})]}),l!=null&&l.customerSeq&&E?e.jsxs("div",{className:"card",style:{marginBottom:12,padding:8},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-end",marginBottom:8,gap:8,flexWrap:"wrap"},children:[e.jsx("button",{className:"btn btn-card btn-3d",style:{fontSize:12,padding:"4px 8px"},onClick:Nt,children:"일괄비율"}),e.jsx("button",{className:"btn btn-card btn-3d",style:{fontSize:12,padding:"4px 8px"},onClick:Ie,children:"일괄입력"}),e.jsx("button",{className:"btn btn-card btn-3d",style:{fontSize:12,padding:"4px 8px"},onClick:Gs,children:"신규 영업관리단위"})]}),et.error?e.jsx("div",{className:"error",children:et.error}):e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left",width:220},children:"중분류"}),e.jsx("th",{style:{textAlign:"left",width:220},children:"영업관리단위"}),e.jsx("th",{style:{textAlign:"center",width:120},children:"목표입력"}),e.jsx("th",{className:"sum-head",style:{textAlign:"right",width:140},children:"합계"}),Array.from({length:12},(a,f)=>f+1).map(a=>e.jsxs("th",{style:{textAlign:"right"},children:[String(a).padStart(2,"0"),"월"]},a))]})}),e.jsx("tbody",{children:et.rows.length===0?e.jsx("tr",{children:e.jsx("td",{className:"muted",colSpan:16,style:{padding:"12px 10px"},children:et.loading?"불러오는 중…":"데이터가 없습니다"})}):et.rows.map((a,f)=>{const $=(a.months||[]).reduce((W,D)=>W+(Number.isFinite(D)?Number(D):0),0),U=(a.amounts||[]).reduce((W,D)=>W+(Number.isFinite(D)?Number(D):0),0);return e.jsxs("tr",{children:[e.jsx("td",{children:a.sub}),e.jsxs("td",{children:[e.jsx("span",{children:a.unit}),a.stage?e.jsx("span",{className:"badge stage-badge",style:{marginLeft:6},children:a.stage}):null]}),e.jsx("td",{style:{textAlign:"center"},children:e.jsx("button",{type:"button",className:"btn btn-card btn-3d",style:{fontSize:12,padding:"4px 8px"},onClick:W=>{W.preventDefault(),W.stopPropagation(),Jt(a.sub,a.unit)},children:"입력"})}),e.jsx("td",{className:"sum-cell",style:{textAlign:"right"},children:Qe($,0,U)}),a.months.map((W,D)=>{var ne;return e.jsx("td",{style:{textAlign:"right"},children:Qe(W,D,(ne=a.amounts)==null?void 0:ne[D],a.stage==="P"?"#dc2626":void 0,a.stage==="C")},D)})]},f)})}),(()=>{if(!et.rows||et.rows.length===0)return null;const a=Array.from({length:12},(W,D)=>et.rows.reduce((ne,J)=>{var K;return ne+(Number((K=J.months)==null?void 0:K[D])||0)},0)),f=Array.from({length:12},(W,D)=>et.rows.reduce((ne,J)=>{var K;return ne+(Number((K=J.amounts)==null?void 0:K[D])||0)},0)),$=a.reduce((W,D)=>W+(Number(D)||0),0),U=f.reduce((W,D)=>W+(Number(D)||0),0);return e.jsx("tfoot",{children:e.jsxs("tr",{className:"sum-row",children:[e.jsx("td",{colSpan:3,style:{textAlign:"center",fontWeight:700},children:"합계"}),e.jsx("td",{className:"sum-cell",style:{textAlign:"right"},children:Qe($,0,U)}),a.map((W,D)=>e.jsx("td",{className:"sum-cell",style:{textAlign:"right"},children:Qe(W,D,f[D])},D))]})})})()]})})]}):null,l!=null&&l.customerSeq&&E?e.jsxs("div",{className:"card",style:{marginBottom:12,padding:8},children:[e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:8},children:[e.jsx("div",{className:"muted",style:{fontWeight:700,lineHeight:"28px",fontSize:14},children:"목표수립의견"}),e.jsx("textarea",{className:"search-input",value:St.val,onChange:a=>vt(f=>({...f,val:a.target.value})),placeholder:"목표수립에 대한 의견을 입력하세요",rows:6,style:{flex:1,resize:"vertical",height:80,minHeight:80,fontSize:12}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-end",gap:8,marginTop:8},children:[St.loading?e.jsx("span",{className:"muted",style:{fontSize:12},children:"(읽는 중…)"}):null,St.error?e.jsx("span",{className:"error",style:{fontSize:12},children:St.error}):null,St.success?e.jsx("span",{style:{fontSize:12,color:"var(--accent)",fontWeight:700},children:St.success}):null,e.jsx("button",{className:"btn btn-card btn-3d",onClick:is,disabled:St.saving,children:St.saving?"저장중…":"저장"})]})]}):null]})]})]}),Q.open&&e.jsx("div",{role:"dialog","aria-modal":"true",className:"card",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.35)",zIndex:50},children:e.jsxs("div",{ref:bt.ref,className:"card compact",style:{...bt.style,position:"relative",width:900,maxWidth:"92vw",background:"var(--panel)",padding:12},children:[e.jsx("div",{...bt.bindHeader,style:{position:"absolute",top:0,left:0,right:36,height:32,cursor:"move"},"aria-hidden":"true"}),e.jsx("button",{"aria-label":"닫기",onClick:Xt,className:"btn-plain",style:{position:"absolute",top:8,right:8},children:e.jsx("img",{src:dt,className:"icon",alt:"닫기"})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"120px 1.6fr 120px 1fr",gap:8,alignItems:"center"},children:[e.jsx("div",{className:"muted form-label",children:"영업관리단위"}),e.jsx("div",{children:Q.unit||""}),e.jsx("div",{className:"muted form-label",children:"중분류"}),e.jsx("div",{children:Q.sub||""}),e.jsx("div",{className:"muted form-label",children:"매출 수량"}),e.jsx("div",{style:{gridColumn:"2 / 5"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,flexWrap:"nowrap",minWidth:0},children:[e.jsx("input",{className:"assign-input",type:"number",min:0,step:1,placeholder:"0",value:Q.qty||"",onChange:a=>ks(Q.month,a.target.value)}),(()=>{const a=Fe(),f=(Q.unit||"").trim(),$=Oe(f),U=pe[a]||{},W=Number(U[$]||0),D=tt(),ne=(le==null?void 0:le[D])||{},J=Number(ne[$]||0),K=Number.isFinite(W)&&W>0?gt.format(Math.round(W)):"-",oe=Number.isFinite(J)&&J>0?gt.format(Math.round(J)):"-",de=Number.isFinite(W)&&Number.isFinite(J)?W>=J?mt:"#dc2626":mt;return e.jsxs("span",{className:"muted",style:{fontSize:12,whiteSpace:"nowrap"},children:[e.jsxs("span",{style:{color:de,fontWeight:700},children:["내단가 ",K," 원"]})," | 전체단가 ",oe," 원/단위"]})})()]})}),e.jsx("div",{className:"muted form-label",children:"매출월"}),e.jsx("div",{children:e.jsxs("select",{className:"search-input",value:Q.month||"",onChange:a=>ks(a.target.value,Q.qty),children:[e.jsx("option",{value:"",disabled:!0,children:"선택"}),Array.from({length:12},(a,f)=>f+1).map(a=>e.jsxs("option",{value:String(a),children:[a,"월"]},a))]})})]}),e.jsxs("div",{style:{marginTop:12},children:[e.jsx("div",{className:"pane-header",style:{margin:0},children:"현재 목표"}),e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"sum-head",style:{textAlign:"right",width:120},children:"합계"}),Array.from({length:12},(a,f)=>f+1).map(a=>e.jsxs("th",{style:{textAlign:"right"},children:[String(a).padStart(2,"0"),"월"]},a))]})}),e.jsx("tbody",{children:e.jsx("tr",{children:(()=>{const a=(Q.curMonths||[]).reduce(($,U)=>$+(Number.isFinite(U)?Number(U):0),0),f=(Q.curAmounts||[]).reduce(($,U)=>$+(Number.isFinite(U)?Number(U):0),0);return e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"sum-cell",style:{textAlign:"right"},children:Qe(a,0,f)}),Q.curMonths.map(($,U)=>{var W;return e.jsx("td",{children:Qe($,U,(W=Q.curAmounts)==null?void 0:W[U],Q.stage==="P"?"#dc2626":void 0,Q.stage==="C")},U)})]})})()})})]})})]}),e.jsxs("div",{style:{marginTop:12},children:[e.jsx("div",{className:"pane-header",style:{margin:0},children:"분배 미리보기"}),e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"sum-head",style:{textAlign:"right",width:120},children:"합계"}),Array.from({length:12},(a,f)=>f+1).map(a=>e.jsxs("th",{style:{textAlign:"right"},children:[String(a).padStart(2,"0"),"월"]},a))]})}),e.jsx("tbody",{children:e.jsx("tr",{children:(()=>{const a=Fe();pe[a];const f=(Q.unit||"").trim(),$=He(f),U=Number.isFinite($)?Number($):0,W=(Q.dist||[]).reduce((J,K)=>J+(Number.isFinite(K)?Number(K):0),0),D=Number.isFinite(U)?Math.round(U):0,ne=(Q.dist||[]).reduce((J,K)=>J+(Number.isFinite(K)&&D>0?Number(K)*D:0),0);return e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"sum-cell",style:{textAlign:"right"},children:Qe(W,0,ne)}),Q.dist.map((J,K)=>{const oe=Number.isFinite(U)?Math.round(U):0,de=Number.isFinite(J)&&oe>0?Number(J)*oe:void 0;return e.jsx("td",{children:Qe(J,K,de,Q.stage==="P"?"#dc2626":void 0,Q.stage==="C")},K)})]})})()})})]})})]}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:8,gap:8},children:e.jsx("button",{className:"btn btn-card btn-3d",onClick:Cs,children:"목표등록"})}),Q.success?e.jsx("div",{role:"dialog","aria-modal":"true",className:"card",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.45)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:70},children:e.jsxs("div",{className:"card",style:{background:"var(--panel)",padding:12,border:"1px solid var(--border)",borderRadius:10,minWidth:260,maxWidth:"86vw"},children:[e.jsx("div",{style:{marginBottom:8,fontWeight:700,textAlign:"center"},children:Q.success}),e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx("button",{className:"btn btn-card btn-3d",onClick:k,children:"확인"})})]})}):null]})}),ae.open&&e.jsx("div",{role:"dialog","aria-modal":"true",className:"card",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.35)",zIndex:50},children:e.jsxs("div",{ref:Ye.ref,className:"card compact",style:{...Ye.style,width:"92vw",maxWidth:1100,background:"var(--panel)",padding:12},children:[e.jsx("div",{...Ye.bindHeader,style:{position:"absolute",top:0,left:0,right:36,height:32,cursor:"move"},"aria-hidden":"true"}),e.jsx("button",{"aria-label":"닫기",onClick:Le,className:"btn-plain",style:{position:"absolute",top:8,right:8},children:e.jsx("img",{src:dt,className:"icon",alt:"닫기"})}),e.jsx("div",{className:"page-title",style:{marginBottom:8},children:e.jsx("h2",{style:{margin:0},children:"목표 일괄입력"})}),e.jsx("div",{className:"table-container",style:{maxHeight:"70vh",overflow:"auto",position:"relative"},children:e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:200,textAlign:"left"},children:"중분류"}),e.jsx("th",{style:{width:220,textAlign:"left"},children:"영업관리단위"}),e.jsx("th",{style:{width:68,textAlign:"center"},children:"구분"}),e.jsx("th",{style:{width:160,textAlign:"left"},children:"내 평균단가"}),e.jsx("th",{className:"sum-head",style:{textAlign:"right",width:120},children:"합계"}),Array.from({length:12},(a,f)=>f+1).map(a=>e.jsxs("th",{style:{textAlign:"right"},children:[String(a).padStart(2,"0"),"월"]},a))]})}),e.jsx("tbody",{children:ae.rows.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:19,className:"muted",style:{padding:"12px 10px"},children:"데이터가 없습니다"})}):ae.rows.map((a,f)=>{const $=Fe();pe[$];const U=He((a.unit||"").trim()),W=Number.isFinite(U)?Number(U):0,D=Number(a.month||0),ne=Number(a.qty||0),J=new Array(12).fill(0);if(Number.isFinite(D)&&D>=1&&D<=12&&Number.isFinite(ne)&&ne>0){const be=12-D+1,Re=ne/be;for(let $e=D-1;$e<12;$e++)J[$e]=Re}const K=J,oe=(a.curMonths||[]).reduce((be,Re)=>be+(Number.isFinite(Re)?Number(Re):0),0),de=(a.curAmounts||[]).reduce((be,Re)=>be+(Number.isFinite(Re)?Number(Re):0),0),ce=J.reduce((be,Re)=>be+(Number.isFinite(Re)?Number(Re):0),0),Ce=J.reduce((be,Re)=>be+(Number.isFinite(Re)&&Number.isFinite(W)?Number(Re)*W:0),0);return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("span",{style:{fontSize:12},children:a.sub})}),e.jsxs("td",{children:[e.jsx("span",{style:{fontSize:12},children:a.unit}),a.stage?e.jsx("span",{className:"stage-badge",style:{marginLeft:6},title:String(a.stage),children:String(a.stage)}):null]}),e.jsx("td",{style:{textAlign:"center"},className:"muted",children:"현재"}),e.jsx("td",{className:"muted",children:"-"}),e.jsx("td",{className:"muted",children:"-"}),e.jsx("td",{className:"sum-cell",style:{textAlign:"right"},children:Qe(oe,0,de)}),a.curMonths.map((be,Re)=>{var $e;return e.jsx("td",{children:Qe(be,Re,($e=a.curAmounts)==null?void 0:$e[Re],a.stage==="P"?"#dc2626":void 0,a.stage==="C")},Re)})]},a.key+":cur"),e.jsxs("tr",{style:{background:"var(--panel-2)"},children:[e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{style:{textAlign:"center"},className:"sum-head",children:"적용"}),e.jsx("td",{children:e.jsxs("select",{className:"search-input",value:a.month||"",onChange:be=>Ne(f,be.target.value,void 0),children:[e.jsx("option",{value:"",disabled:!0,children:"선택"}),Array.from({length:12},(be,Re)=>Re+1).map(be=>e.jsxs("option",{value:String(be),children:[be,"월"]},be))]})}),e.jsx("td",{children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("input",{className:"assign-input",type:"number",min:0,step:1,placeholder:"0",value:a.qty||"",onChange:be=>Ne(f,void 0,be.target.value)}),(()=>{var sn;const be=Fe(),$e=(((sn=(we[be]||{})[(a.unit||"").trim()])==null?void 0:sn.itemStdUnit)||"").trim(),Be=Oe(a.unit||""),ct=pe[be]||{},Ge=Number(ct[Be]||0),Dt=tt(),Mt=(le==null?void 0:le[Dt])||{},Lt=Number(Mt[Be]||0),Yt=Number.isFinite(Ge)&&Ge>0?gt.format(Math.round(Ge)):"-",Fs=Number.isFinite(Lt)&&Lt>0?gt.format(Math.round(Lt)):"-",Fn=Number.isFinite(Ge)&&Number.isFinite(Lt)?Ge>=Lt?mt:"#dc2626":mt;return e.jsxs("span",{className:"muted",style:{fontSize:12},children:[e.jsxs("span",{style:{color:Fn,fontWeight:700},children:["내단가 ",Yt," 원"]})," | 전체단가 ",Fs," 원/",$e||"단위"]})})()]})}),e.jsx("td",{className:"sum-cell",style:{textAlign:"right"},children:Qe(ce,0,Ce)}),K.map((be,Re)=>{const $e=Number.isFinite(W)?Math.round(W):0,Be=Number.isFinite(be)&&$e>0?Number(be)*$e:void 0;return e.jsx("td",{children:Qe(be,Re,Be,a.stage==="P"?"#dc2626":void 0,a.stage==="C")},Re)})]},a.key+":prev")]})})}),(()=>{if(!ae.rows||ae.rows.length===0)return null;const a=Fe();pe[a];const f=Array.from({length:12},(oe,de)=>ae.rows.reduce((ce,Ce)=>{var be;return ce+(Number((be=Ce.curMonths)==null?void 0:be[de])||0)},0)),$=Array.from({length:12},(oe,de)=>ae.rows.reduce((ce,Ce)=>{var be;return ce+(Number((be=Ce.curAmounts)==null?void 0:be[de])||0)},0)),U=f.reduce((oe,de)=>oe+(Number(de)||0),0),W=$.reduce((oe,de)=>oe+(Number(de)||0),0),D=Array.from({length:12},(oe,de)=>ae.rows.reduce((ce,Ce)=>{var be;return ce+(Number((be=Ce.dist)==null?void 0:be[de])||0)},0)),ne=Array.from({length:12},(oe,de)=>ae.rows.reduce((ce,Ce)=>{var Be;const be=He((Ce.unit||"").trim()),Re=Number.isFinite(be)?Math.round(Number(be)):0,$e=Number(((Be=Ce.dist)==null?void 0:Be[de])||0);return ce+(Number.isFinite($e)&&Re>0?$e*Re:0)},0)),J=D.reduce((oe,de)=>oe+(Number(de)||0),0),K=ne.reduce((oe,de)=>oe+(Number(de)||0),0);return e.jsxs("tfoot",{children:[e.jsxs("tr",{className:"sum-row-current",children:[e.jsx("td",{colSpan:5,style:{textAlign:"center",fontWeight:700},children:"[현재] 합계"}),e.jsx("td",{className:"sum-cell",style:{textAlign:"right"},children:Qe(U,0,W)}),f.map((oe,de)=>e.jsx("td",{className:"sum-cell",style:{textAlign:"right"},children:Qe(oe,de,$[de])},de))]}),e.jsxs("tr",{className:"sum-row-apply",style:{background:"var(--panel-2)"},children:[e.jsx("td",{colSpan:5,style:{textAlign:"center",fontWeight:700},children:"[적용] 합계"}),e.jsx("td",{className:"sum-cell",style:{textAlign:"right"},children:Qe(J,0,K)}),D.map((oe,de)=>e.jsx("td",{className:"sum-cell",style:{textAlign:"right"},children:Qe(oe,de,ne[de])},de))]})]})})()]})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:8,gap:8},children:e.jsx("button",{className:"btn btn-card btn-3d",onClick:Ee,children:"목표등록"})}),ae.success?e.jsx("div",{role:"dialog","aria-modal":"true",className:"card",style:{position:"absolute",inset:0,background:"rgba(0,0,0,.45)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:80},children:e.jsxs("div",{className:"card",style:{background:"var(--panel)",padding:12,border:"1px solid var(--border)",borderRadius:10,minWidth:260,maxWidth:"86vw"},children:[e.jsx("div",{style:{marginBottom:8,fontWeight:700,textAlign:"center"},children:ae.success}),e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx("button",{className:"btn btn-card btn-3d",onClick:k,children:"확인"})})]})}):null]})}),it.open&&e.jsx("div",{role:"dialog","aria-modal":"true",className:"card",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.35)",zIndex:50},children:e.jsxs("div",{ref:fs.ref,className:"card compact",style:{...fs.style,width:"92vw",maxWidth:1100,background:"var(--panel)",padding:12},children:[e.jsx("div",{...fs.bindHeader,style:{position:"absolute",top:0,left:0,right:36,height:32,cursor:"move"},"aria-hidden":"true"}),e.jsx("button",{"aria-label":"닫기",onClick:Gt,className:"btn-plain",style:{position:"absolute",top:8,right:8},children:e.jsx("img",{src:dt,className:"icon",alt:"닫기"})}),e.jsxs("div",{className:"page-title",style:{marginBottom:8,alignItems:"center"},children:[e.jsx("h2",{style:{margin:0},children:"목표 일괄비율"}),e.jsxs("div",{className:"controls",style:{gap:8},children:[e.jsx("span",{className:"muted",children:"적용 비율(%)"}),e.jsx("input",{className:"assign-input",type:"number",min:0,max:100,step:1,placeholder:"0",value:ys,onChange:a=>As(a.target.value),style:{width:100},"aria-label":"일괄 비율 입력"}),e.jsx("button",{className:"btn btn-card btn-3d",onClick:Ot,children:"적용"})]})]}),e.jsx("div",{className:"table-container",style:{maxHeight:"70vh",overflow:"auto"},children:e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:200,textAlign:"left"},children:"중분류"}),e.jsx("th",{style:{width:220,textAlign:"left"},children:"영업관리단위"}),e.jsx("th",{style:{width:68,textAlign:"center"},children:"구분"}),e.jsx("th",{style:{width:160,textAlign:"left"},children:"내 평균단가"}),e.jsx("th",{className:"sum-head",style:{textAlign:"right",width:120},children:"합계"}),Array.from({length:12},(a,f)=>f+1).map(a=>e.jsxs("th",{style:{textAlign:"right"},children:[String(a).padStart(2,"0"),"월"]},a))]})}),e.jsx("tbody",{children:it.rows.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:19,className:"muted",style:{padding:"12px 10px"},children:"데이터가 없습니다"})}):it.rows.map((a,f)=>{const $=Fe();pe[$];const U=He((a.unit||"").trim()),W=Number.isFinite(U)?Number(U):0,D=Array.isArray(a.dist)?a.dist.slice():new Array(12).fill(0),ne=(a.curMonths||[]).reduce((de,ce)=>de+(Number.isFinite(ce)?Number(ce):0),0),J=(a.curAmounts||[]).reduce((de,ce)=>de+(Number.isFinite(ce)?Number(ce):0),0),K=D.reduce((de,ce)=>de+(Number.isFinite(ce)?Number(ce):0),0),oe=D.reduce((de,ce)=>de+(Number.isFinite(ce)&&Number.isFinite(W)?Number(ce)*W:0),0);return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("span",{style:{fontSize:12},children:a.sub})}),e.jsxs("td",{children:[e.jsx("span",{style:{fontSize:12},children:a.unit}),a.stage?e.jsx("span",{className:"stage-badge",style:{marginLeft:6},title:String(a.stage),children:String(a.stage)}):null]}),e.jsx("td",{style:{textAlign:"center"},className:"muted",children:"현재"}),e.jsx("td",{className:"muted",style:{textAlign:"left"},children:(()=>{var Yt;const de=Fe(),Ce=(((Yt=(we[de]||{})[(a.unit||"").trim()])==null?void 0:Yt.itemStdUnit)||"").trim(),be=Oe(a.unit||""),Re=pe[de]||{},$e=Number(Re[be]||0),Be=tt(),ct=(le==null?void 0:le[Be])||{},Ge=Number(ct[be]||0),Dt=Number.isFinite($e)&&$e>0?gt.format(Math.round($e)):"-",Mt=Number.isFinite(Ge)&&Ge>0?gt.format(Math.round(Ge)):"-",Lt=Number.isFinite($e)&&Number.isFinite(Ge)?$e>=Ge?mt:"#dc2626":mt;return e.jsxs("span",{children:[e.jsxs("span",{style:{color:Lt,fontWeight:700},children:["내단가 ",Dt," 원"]})," | 전체단가 ",Mt," 원/",Ce||"단위"]})})()}),e.jsx("td",{className:"sum-cell",style:{textAlign:"right"},children:Qe(ne,0,J)}),a.curMonths.map((de,ce)=>{var Ce;return e.jsx("td",{children:Qe(de,ce,(Ce=a.curAmounts)==null?void 0:Ce[ce],a.stage==="P"?"#dc2626":void 0,a.stage==="C")},ce)})]},a.key+":cur"),e.jsxs("tr",{style:{background:"var(--panel-2)"},children:[e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{style:{textAlign:"center"},className:"sum-head",children:"적용"}),e.jsx("td",{className:"muted",style:{textAlign:"left"},children:(()=>{var Yt;const de=Fe(),Ce=(((Yt=(we[de]||{})[(a.unit||"").trim()])==null?void 0:Yt.itemStdUnit)||"").trim(),be=Oe(a.unit||""),Re=pe[de]||{},$e=Number(Re[be]||0),Be=tt(),ct=(le==null?void 0:le[Be])||{},Ge=Number(ct[be]||0),Dt=Number.isFinite($e)&&$e>0?gt.format(Math.round($e)):"-",Mt=Number.isFinite(Ge)&&Ge>0?gt.format(Math.round(Ge)):"-",Lt=Number.isFinite($e)&&Number.isFinite(Ge)?$e>=Ge?mt:"#dc2626":mt;return e.jsxs("span",{children:[e.jsxs("span",{style:{color:Lt,fontWeight:700},children:["내단가 ",Dt," 원"]})," | 전체단가 ",Mt," 원/",Ce||"단위"]})})()}),e.jsx("td",{className:"sum-cell",style:{textAlign:"right"},children:Qe(K,0,oe)}),D.map((de,ce)=>{const Ce=Number.isFinite(W)?Math.round(W):0,be=Number.isFinite(de)&&Ce>0?Number(de)*Ce:void 0;return e.jsx("td",{children:Qe(de,ce,be,a.stage==="P"?"#dc2626":void 0,a.stage==="C")},ce)})]},a.key+":prev")]})})}),(()=>{if(!it.rows||it.rows.length===0)return null;const a=Fe();pe[a];const f=Array.from({length:12},(oe,de)=>it.rows.reduce((ce,Ce)=>{var be;return ce+(Number((be=Ce.curMonths)==null?void 0:be[de])||0)},0)),$=Array.from({length:12},(oe,de)=>it.rows.reduce((ce,Ce)=>{var be;return ce+(Number((be=Ce.curAmounts)==null?void 0:be[de])||0)},0)),U=f.reduce((oe,de)=>oe+(Number(de)||0),0),W=$.reduce((oe,de)=>oe+(Number(de)||0),0),D=Array.from({length:12},(oe,de)=>it.rows.reduce((ce,Ce)=>{var be;return ce+(Number((be=Ce.dist)==null?void 0:be[de])||0)},0)),ne=Array.from({length:12},(oe,de)=>it.rows.reduce((ce,Ce)=>{var Be;const be=He((Ce.unit||"").trim()),Re=Number.isFinite(be)?Math.round(Number(be)):0,$e=Number(((Be=Ce.dist)==null?void 0:Be[de])||0);return ce+(Number.isFinite($e)&&Re>0?$e*Re:0)},0)),J=D.reduce((oe,de)=>oe+(Number(de)||0),0),K=ne.reduce((oe,de)=>oe+(Number(de)||0),0);return e.jsxs("tfoot",{children:[e.jsxs("tr",{className:"sum-row-current",children:[e.jsx("td",{colSpan:4,style:{textAlign:"center",fontWeight:700},children:"[현재] 합계"}),e.jsx("td",{className:"sum-cell",style:{textAlign:"right"},children:Qe(U,0,W)}),f.map((oe,de)=>e.jsx("td",{className:"sum-cell",style:{textAlign:"right"},children:Qe(oe,de,$[de])},de))]}),e.jsxs("tr",{className:"sum-row-apply",style:{background:"var(--panel-2)"},children:[e.jsx("td",{colSpan:4,style:{textAlign:"center",fontWeight:700},children:"[적용] 합계"}),e.jsx("td",{className:"sum-cell",style:{textAlign:"right"},children:Qe(J,0,K)}),D.map((oe,de)=>e.jsx("td",{className:"sum-cell",style:{textAlign:"right"},children:Qe(oe,de,ne[de])},de))]})]})})()]})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:8,gap:8},children:e.jsx("button",{className:"btn btn-card btn-3d",onClick:Rs,children:"목표등록"})}),it.success?e.jsx("div",{role:"dialog","aria-modal":"true",className:"card",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.45)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:70},children:e.jsxs("div",{className:"card",style:{background:"var(--panel)",padding:12,border:"1px solid var(--border)",borderRadius:10,minWidth:260,maxWidth:"86vw"},children:[e.jsx("div",{style:{marginBottom:8,fontWeight:700,textAlign:"center"},children:it.success}),e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx("button",{className:"btn btn-card btn-3d",onClick:k,children:"확인"})})]})}):null]})}),Ke.open&&e.jsx("div",{role:"dialog","aria-modal":"true",className:"card",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.35)",zIndex:50},children:e.jsxs("div",{ref:xs.ref,className:"card",style:{...xs.style,width:984,maxWidth:"92vw",background:"var(--panel)",padding:12},children:[e.jsx("div",{...xs.bindHeader,style:{position:"absolute",top:0,left:0,right:36,height:32,cursor:"move"},"aria-hidden":"true"}),e.jsx("button",{"aria-label":"닫기",onClick:Is,className:"btn-plain",style:{position:"absolute",top:8,right:8},children:e.jsx("img",{src:dt,className:"icon",alt:"닫기"})}),e.jsx("div",{className:"page-title",style:{marginBottom:8},children:e.jsx("h2",{style:{margin:0},children:"신규 영업관리단위"})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"120px 1fr 120px 1fr",gap:8,alignItems:"center",fontSize:12},children:[e.jsx("div",{className:"muted",children:"영업관리단위"}),e.jsx("div",{children:e.jsxs("select",{className:"search-input",value:Ke.unit||"",onChange:a=>Dn(a.target.value),children:[e.jsx("option",{value:"",disabled:!0,children:"선택"}),Ke.opts.map((a,f)=>e.jsx("option",{value:a.salesMgmtUnit,children:a.salesMgmtUnit},f))]})}),e.jsx("div",{className:"muted",children:"중분류"}),e.jsx("div",{children:e.jsx("input",{className:"assign-input",value:Ke.sub||"",readOnly:!0,placeholder:"자동"})}),e.jsx("div",{className:"muted",children:"매출월"}),e.jsx("div",{children:e.jsxs("select",{className:"search-input",value:Ke.month||"",onChange:a=>Vs(a.target.value,void 0),children:[e.jsx("option",{value:"",disabled:!0,children:"선택"}),Array.from({length:12},(a,f)=>f+1).map(a=>e.jsxs("option",{value:String(a),children:[a,"월"]},a))]})}),e.jsx("div",{className:"muted",children:"매출 수량"}),e.jsx("div",{children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("input",{className:"assign-input",type:"number",min:0,step:1,placeholder:"0",value:Ke.qty||"",onChange:a=>Vs(void 0,a.target.value)}),(()=>{var be;const a=Fe(),f=pe[a]||{},$=we[a]||{},U=(Ke.unit||"").trim(),W=Oe(U),D=Number((f==null?void 0:f[W])||0),ne=tt(),J=(le==null?void 0:le[ne])||{},K=Number(J[W]||0),oe=(((be=$[U])==null?void 0:be.itemStdUnit)||"").trim(),de=Number.isFinite(D)&&D>0?gt.format(Math.round(D)):"-",ce=Number.isFinite(K)&&K>0?gt.format(Math.round(K)):"-",Ce=Number.isFinite(D)&&Number.isFinite(K)?D>=K?mt:"#dc2626":mt;return e.jsxs("span",{className:"muted",style:{fontSize:12,whiteSpace:"nowrap"},children:[e.jsxs("span",{style:{color:Ce,fontWeight:700},children:["내단가 ",de," 원"]})," | 전체단가 ",ce," 원/",oe||"단위"]})})()]})})]}),e.jsx("div",{style:{marginTop:12},children:e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{children:Array.from({length:12},(a,f)=>f+1).map(a=>e.jsxs("th",{style:{textAlign:"right"},children:[String(a).padStart(2,"0"),"월"]},a))})}),e.jsx("tbody",{children:e.jsx("tr",{children:Ke.dist.map((a,f)=>{const $=Fe();pe[$];const U=He((Ke.unit||"").trim()),W=Number.isFinite(U)?Number(U):0,D=Number.isFinite(W)?Math.round(W):0,ne=Number.isFinite(a)&&D>0?Number(a)*D:void 0;return e.jsx("td",{children:Qe(a,f,ne)},f)})})})]})})}),e.jsxs("div",{style:{marginTop:12},children:[e.jsx("div",{className:"pane-header",style:{margin:0},children:"추가된 영업관리단위"}),e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:200,textAlign:"left"},children:"중분류"}),e.jsx("th",{style:{width:220,textAlign:"left"},children:"영업관리단위"}),Array.from({length:12},(a,f)=>f+1).map(a=>e.jsxs("th",{style:{textAlign:"right"},children:[String(a).padStart(2,"0"),"월"]},a))]})}),e.jsx("tbody",{children:Ke.rows.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:14,className:"muted",style:{padding:"12px 10px"},children:"추가된 영업관리단위가 없습니다"})}):Ke.rows.map((a,f)=>e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("button",{className:"btn-plain","aria-label":"삭제",title:"삭제",onClick:()=>It($=>({...$,rows:$.rows.filter((U,W)=>W!==f)})),style:{marginRight:6,verticalAlign:"middle"},children:e.jsx("img",{src:dt,className:"icon",alt:"삭제"})}),a.sub]}),e.jsx("td",{children:a.unit}),a.months.map(($,U)=>{const W=Fe();pe[W];const D=He((a.unit||"").trim()),ne=Number.isFinite(D)?Number(D):0,J=Number.isFinite(ne)?Math.round(ne):0,K=Number.isFinite($)&&J>0?Number($)*J:void 0;return e.jsx("td",{children:Qe($,U,K)},U)})]},f))})]})})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:8,gap:8},children:[e.jsx("button",{className:"btn btn-card btn-3d",onClick:Mn,children:"추가"}),e.jsx("button",{className:"btn btn-card btn-3d",onClick:_n,children:"목표등록"})]}),Ke.error?e.jsx("div",{role:"dialog","aria-modal":"true",className:"card",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.45)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:70},children:e.jsxs("div",{className:"card",style:{background:"var(--panel)",padding:12,border:"1px solid var(--border)",borderRadius:10,minWidth:260,maxWidth:"86vw"},children:[e.jsx("div",{style:{marginBottom:8,fontWeight:700,textAlign:"center"},children:Ke.error}),e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx("button",{className:"btn btn-card btn-3d",onClick:()=>It(a=>({...a,error:null})),children:"확인"})})]})}):null,Ke.success?e.jsx("div",{role:"dialog","aria-modal":"true",className:"card",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.45)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:70},children:e.jsxs("div",{className:"card",style:{background:"var(--panel)",padding:12,border:"1px solid var(--border)",borderRadius:10,minWidth:260,maxWidth:"86vw"},children:[e.jsx("div",{style:{marginBottom:8,fontWeight:700,textAlign:"center"},children:Ke.success}),e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx("button",{className:"btn btn-card btn-3d",onClick:k,children:"확인"})})]})}):null]})}),Pt.open&&e.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:60},children:e.jsxs("div",{ref:Os.ref,className:"card",style:{...Os.style,height:"66vh",width:760,maxWidth:"96vw",background:"var(--panel)",padding:12,borderLeft:"1px solid var(--border)",boxShadow:"-8px 0 24px rgba(0,0,0,0.18)",overflow:"hidden"},children:[e.jsx("div",{...Os.bindHeader,style:{position:"absolute",top:0,left:0,right:36,height:32,cursor:"move"},"aria-hidden":"true"}),e.jsx("button",{"aria-label":"닫기",onClick:tn,className:"btn-plain",style:{position:"absolute",top:8,right:8},children:e.jsx("img",{src:dt,className:"icon",alt:"닫기"})}),e.jsxs("div",{className:"page-title",style:{marginBottom:8,display:"flex",alignItems:"center"},children:[e.jsx("h2",{style:{margin:0,display:"flex",alignItems:"center",gap:6,fontSize:14},children:Vt?e.jsxs(e.Fragment,{children:[e.jsxs("span",{style:{color:mt,fontWeight:700,fontSize:14},children:[Vt,"년"]}),e.jsx("span",{style:{fontSize:12},children:"내 평균거래 단가"})]}):e.jsx("span",{style:{fontSize:12},children:"내 평균거래 단가"})}),e.jsxs("div",{style:{marginLeft:"auto",display:"inline-flex",alignItems:"center",gap:8,flexWrap:"nowrap"},children:[e.jsx("select",{className:"search-input",value:Vt,onChange:a=>en(Number(a.target.value)),"aria-label":"평균단가 조회 연도",style:{height:28},children:[2025,2026,2027,2028,2029,2030].map(a=>e.jsxs("option",{value:a,children:[a,"년"]},a))}),e.jsxs("div",{role:"radiogroup","aria-label":"회사 구분",className:"segmented",style:{display:"inline-flex",alignItems:"center",gap:8,height:28,border:"1px solid var(--border)",borderRadius:6,padding:"0 6px"},children:[e.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:6,fontSize:12,height:"100%"},children:[e.jsx("input",{type:"radio",name:"unit-company",value:"TNT",checked:js==="TNT",onChange:()=>zs("TNT")}),e.jsx("span",{style:{fontSize:12},children:"TNT"})]}),e.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:6,fontSize:12,height:"100%"},children:[e.jsx("input",{type:"radio",name:"unit-company",value:"DYS",checked:js==="DYS",onChange:()=>zs("DYS")}),e.jsx("span",{style:{fontSize:12},children:"DYS"})]})]})]})]}),Pt.error?e.jsx("div",{className:"error",style:{maxWidth:420},children:Pt.error}):e.jsx("div",{className:"table-container",style:{height:"calc(66vh - 120px)",overflow:"auto"},children:e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:180,textAlign:"left"},children:"영업관리단위"}),e.jsx("th",{style:{width:120,textAlign:"left"},children:"판매단위"}),e.jsx("th",{style:{width:120,textAlign:"left"},children:"표준단위"}),e.jsx("th",{style:{width:120,textAlign:"right"},children:"내평균단가(원)"}),e.jsx("th",{style:{width:120,textAlign:"right"},children:"전체단가(원)"})]})}),e.jsx("tbody",{children:Pt.loading?e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"muted",style:{padding:"12px 10px"},children:"불러오는 중…"})}):Pt.rows.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"muted",style:{padding:"12px 10px"},children:"데이터가 없습니다"})}):Pt.rows.map((a,f)=>e.jsxs("tr",{children:[e.jsx("td",{children:a.unit||"na"}),e.jsx("td",{children:a.itemUnit||"-"}),e.jsx("td",{children:a.itemStdUnit||"-"}),(()=>{const $=Number(a.amountMy||0),U=Number(a.amountGlobal||0),W=Number.isFinite($)&&Number.isFinite(U)?$>=U?mt:"#dc2626":mt;return e.jsx("td",{style:{textAlign:"right",color:W,fontWeight:700},children:Number.isFinite($)&&$>0?`${gt.format(Math.round($))} 원`:"-"})})(),e.jsx("td",{style:{textAlign:"right"},children:Number.isFinite(Number(a.amountGlobal))&&Number(a.amountGlobal)>0?`${gt.format(Math.round(Number(a.amountGlobal)))} 원`:"-"})]},f))})]})})]})}),lt&&e.jsx("div",{role:"alert","aria-live":"assertive","aria-busy":"true",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.45)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:100},children:e.jsxs("div",{className:"card",style:{padding:16,background:"var(--panel)",minWidth:280,textAlign:"center",boxShadow:"0 4px 16px rgba(0,0,0,.3)"},children:[e.jsx("div",{style:{marginBottom:8,fontWeight:700},children:"초기설정 진행 중"}),e.jsx("div",{className:"muted",style:{marginBottom:12},children:ps||"작업을 준비 중입니다…"}),e.jsx("div",{className:"muted",style:{fontSize:12},children:"작업이 완료될 때까지 다른 동작을 할 수 없습니다."})]})})]});async function On(){try{if(Rt(!0),qt("초기설정 요청 중입니다…"),!E||isNaN(Number(E))){alert("연도를 선택하세요.");return}const a=localStorage.getItem("tnt.sales.assigneeId")||"";if(!a){alert("로그인이 필요합니다.");return}const f={year:Number(E),companyType:m,upliftPercent:Math.max(0,Math.min(999,Number(Ws)||0)),versionNo:1,assigneeId:a},$=localStorage.getItem("tnt.sales.empSeq")||"",U=localStorage.getItem("tnt.sales.empId")||"",W={"Content-Type":"application/json"};$&&(W["X-EMP-SEQ"]=$),U&&(W["X-EMP-ID"]=U),W["X-ASSIGNEE-ID"]=a;const D=await fetch("/api/v1/sales/plan/init",{method:"POST",headers:W,body:JSON.stringify(f)});if(qt("초기 목표를 저장하고 있습니다…"),!D.ok){let K=`HTTP ${D.status}`;try{const oe=await D.json();oe!=null&&oe.error&&(K=oe.error)}catch{const oe=await D.text();oe&&(K=oe)}throw new Error(K)}await D.json().catch(()=>({}));const ne=(localStorage.getItem("tnt.sales.empName")||"").trim()||"사용자",J=Number(E);ge({show:!0,name:ne,tnt:ye.tnt,dys:ye.dys,year:Number.isFinite(J)&&J>0?J:0,hasP:!1,hasC:!1,hasI:!0,label:"초기설정완료"});try{await rs(!0)}catch{}}catch(a){alert((a==null?void 0:a.message)||"초기설정 중 오류가 발생했습니다.")}finally{Rt(!1),qt("")}}}function aa(s){if(!s)return"";const u=s instanceof Date?s:new Date(s);if(isNaN(u.getTime()))return"";const p=String(u.getFullYear()%100).padStart(2,"0"),_=String(u.getMonth()+1).padStart(2,"0"),F=String(u.getDate()).padStart(2,"0"),B=String(u.getHours()).padStart(2,"0"),q=String(u.getMinutes()).padStart(2,"0");return`${p}-${_}-${F} ${B}:${q}`}function ra(){const[s,u]=t.useState(""),[p,_]=t.useState(""),[F,B]=t.useState(""),[q,X]=t.useState(!1),[R,se]=t.useState(null),[V,N]=t.useState([]),[y,A]=t.useState(!1),[O,b]=t.useState({open:!1,x:0,y:0}),[d,x]=t.useState(()=>new Set),[r,T]=t.useState({open:!1,x:0,y:0}),[S,w]=t.useState(void 0),[l,C]=t.useState("init"),[Y,ue]=t.useState({}),ie=["init","sim","apply","confirm"],n=[{key:"init",label:"초기설정"},{key:"sim",label:"Simulation"},{key:"apply",label:"목표반영"},{key:"confirm",label:"확정"}],m=ie.indexOf(l),P=()=>{const L=Math.max(0,m-1);C(ie[L])},h=()=>{const L=Math.min(ie.length-1,m+1);C(ie[L])},[o,M]=t.useState(!1),[G,H]=t.useState(null);new Date().getFullYear();const[j,te]=t.useState("prev1"),[c,i]=t.useState(()=>new Array(12).fill(0)),[v,g]=t.useState({loading:!1});async function z(){if(!(S!=null&&S.customerSeq)){i(new Array(12).fill(0));return}M(!0),H(null);try{const L=new Date().getFullYear(),he=j==="prev1"?[L-1]:j==="last2"?[L-1,L-2]:[L-1,L-2,L-3],fe=[];await Promise.all(he.map(async Ae=>{try{const E=await fetch(`/api/v1/customers/${S.customerSeq}/invoice-monthly?year=${Ae}`);if(!E.ok)return;const ve=await E.json().catch(()=>[]),ee=(Array.isArray(ve)?ve:[]).map(_e=>({month:Number(_e.month??0),amount:Number(_e.amount??0)}));fe.push(...ee)}catch{}}));const Se=new Array(12).fill(0);for(const Ae of fe){const E=Math.min(12,Math.max(1,Number(Ae.month)||0))-1;Se[E]+=Number.isFinite(Ae.amount)?Number(Ae.amount):0}i(Se)}catch(L){H(L.message||"조회 중 오류가 발생했습니다"),i(new Array(12).fill(0))}finally{M(!1)}}t.useEffect(()=>{l==="init"&&z()},[l,S==null?void 0:S.customerSeq,j]);async function I(){if(!(S!=null&&S.customerSeq)){g({loading:!1,hasRecent:void 0,error:null});return}g({loading:!0,hasRecent:void 0,error:null});try{const L=new URL("/api/v1/customers/recent-invoice-flags",window.location.origin);L.searchParams.set("custSeq",String(S.customerSeq)),L.searchParams.set("years","2");const he=await fetch(L.toString());if(!he.ok){let Ae=`HTTP ${he.status}`;try{const E=await he.json();E!=null&&E.error&&(Ae=E.error)}catch{}throw new Error(Ae)}const fe=await he.json(),Se=Array.isArray(fe)&&fe.some(Ae=>Number((Ae==null?void 0:Ae.customerSeq)||(Ae==null?void 0:Ae.customerSeqText)||0)===Number(S.customerSeq)&&!!(Ae!=null&&Ae.hasRecent));g({loading:!1,hasRecent:Se,error:null})}catch(L){g({loading:!1,hasRecent:void 0,error:L.message||"오류"})}}t.useEffect(()=>{l==="init"&&I()},[l,S==null?void 0:S.customerSeq]);const ge=t.useMemo(()=>e.jsx("div",{className:"table-container",style:{border:"1px solid var(--border)",borderRadius:8,marginTop:8},children:e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{children:Array.from({length:12},(L,he)=>e.jsxs("th",{style:{width:100,textAlign:"right"},children:[String(he+1).padStart(2,"0"),"월"]},he))})}),e.jsx("tbody",{children:e.jsx("tr",{children:c.map((L,he)=>e.jsx("td",{style:{textAlign:"right"},children:Math.round(L).toLocaleString()},he))})})]})}),[c]);async function re(){se(null),X(!0);try{const L=localStorage.getItem("tnt.sales.empId");if(!L){N([]),se(st.loginRequired);return}const he=new URL("/api/v1/customers",window.location.origin);he.searchParams.set("mineOnly","true"),he.searchParams.set("empId",L);const fe=await fetch(he.toString());if(!fe.ok){let E=`HTTP ${fe.status}`;try{const ve=await fe.json();ve!=null&&ve.error&&(E=ve.error)}catch{const ve=await fe.text();ve&&(E=ve)}throw new Error(E)}const Se=await fe.json(),Ae=Array.isArray(Se)?Se:[];N(Ae);try{const E=Ae.map(ve=>Number(ve.customerSeq||0)).filter(ve=>Number.isFinite(ve)&&ve>0);if(E.length>0){const ve=new URL("/api/v1/customers/recent-invoice-flags",window.location.origin);ve.searchParams.set("custSeq",Array.from(new Set(E)).join(",")),ve.searchParams.set("years","2");const ee=await fetch(ve.toString());if(ee.ok){const _e=await ee.json(),Pe={};Array.isArray(_e)&&_e.forEach(Te=>{const me=Number((Te==null?void 0:Te.customerSeq)||(Te==null?void 0:Te.customerSeqText)||0);Number.isFinite(me)&&(Pe[me]=!!(Te!=null&&Te.hasRecent))}),ue(Pe)}else ue({})}else ue({})}catch{ue({})}}catch(L){se(L.message||"조회 중 오류가 발생했습니다")}finally{X(!1)}}t.useEffect(()=>{re()},[]),t.useEffect(()=>{if(!O.open)return;const L=()=>b({open:!1,x:0,y:0});return window.addEventListener("click",L),()=>window.removeEventListener("click",L)},[O.open]),t.useEffect(()=>{if(!O.open)return;const L=he=>{he.key==="Escape"&&b({open:!1,x:0,y:0})};return window.addEventListener("keydown",L),()=>window.removeEventListener("keydown",L)},[O.open]),t.useEffect(()=>{const L=he=>{((he==null?void 0:he.key)==="Escape"||(he==null?void 0:he.key)==="Esc"||(he==null?void 0:he.keyCode)===27)&&(b({open:!1,x:0,y:0}),T({open:!1,x:0,y:0}))};return document.addEventListener("keydown",L,!0),()=>document.removeEventListener("keydown",L,!0)},[]);async function Z(L,he){L.preventDefault(),L.stopPropagation(),b({open:!1,x:0,y:0});const fe=L.clientX,Se=L.clientY;T({open:!0,x:fe,y:Se,row:he,loading:!1,error:null,data:[]})}const ye=t.useMemo(()=>{var L,he,fe,Se,Ae,E,ve,ee,_e,Pe,Te,me,Ue,Je,ht;return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"table-container",onClick:()=>b({open:!1,x:0,y:0}),style:{height:"100%",overflow:"auto"},children:[V.length===0?e.jsx("div",{className:"empty-state",children:st.empty}):e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsx("tr",{children:e.jsx("th",{style:{width:"auto"},children:"거래처명"})})}),e.jsx("tbody",{children:V.map((We,Ve)=>e.jsx("tr",{onClick:rt=>{rt.preventDefault(),rt.stopPropagation(),w(We),T({open:!1,x:0,y:0})},onContextMenu:rt=>Z(rt,We),"aria-selected":(S==null?void 0:S.customerId)===We.customerId?!0:void 0,style:(S==null?void 0:S.customerId)===We.customerId?{background:"var(--row-selected, rgba(0, 128, 255, 0.12))"}:void 0,children:e.jsx("td",{children:(()=>{const rt=Number(We.customerSeq||0);return Y[rt]?e.jsxs("span",{children:[We.customerName," "," ","$"]}):We.customerName})()})},Ve))})]}),r.open&&e.jsxs("div",{className:"context-menu",style:{left:r.x+6,top:r.y+6,maxWidth:420,padding:8},onClick:We=>We.stopPropagation(),children:[e.jsx("div",{style:{fontWeight:600,marginBottom:6},children:"거래처 상세"}),r.error?e.jsx("div",{className:"error",style:{maxWidth:380},children:r.error}):e.jsx("table",{className:"table",style:{width:"100%"},children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{style:{width:110,textAlign:"left"},children:"거래처번호"}),e.jsx("td",{children:((L=r.row)==null?void 0:L.customerId)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"사업자번호"}),e.jsx("td",{children:((he=r.row)==null?void 0:he.bizNo)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"대표자명"}),e.jsx("td",{children:((fe=r.row)==null?void 0:fe.ownerName)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"업태"}),e.jsx("td",{children:((Se=r.row)==null?void 0:Se.bizKind)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"종목"}),e.jsx("td",{children:((Ae=r.row)==null?void 0:Ae.bizType)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"전화번호"}),e.jsx("td",{children:((E=r.row)==null?void 0:E.telNo)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"담당자명"}),e.jsx("td",{children:((ve=r.row)==null?void 0:ve.empName)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"부서명"}),e.jsx("td",{children:((ee=r.row)==null?void 0:ee.deptName)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"시/도"}),e.jsx("td",{children:((_e=r.row)==null?void 0:_e.addrProvinceName)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"시/군/구"}),e.jsx("td",{children:((Pe=r.row)==null?void 0:Pe.addrCityName)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"고객유형"}),e.jsx("td",{children:((Te=r.row)==null?void 0:Te.customerTypeName)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"비고"}),e.jsx("td",{children:((me=r.row)==null?void 0:me.customerRemark)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"생성자"}),e.jsx("td",{children:((Ue=r.row)==null?void 0:Ue.createdBy)??""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"수정자"}),e.jsx("td",{children:((Je=r.row)==null?void 0:Je.updatedBy)??""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"생성일시"}),e.jsx("td",{children:aa((ht=r.row)==null?void 0:ht.createdAt)})]})]})})]})]})})},[V,O,d,r,S,Y]);return e.jsxs("section",{children:[e.jsxs("div",{className:"page-title",style:{alignItems:"center"},children:[e.jsx("h2",{style:{margin:0,fontSize:18},children:"목표 Simulation"}),e.jsxs("div",{className:"muted count-text",children:[V.length.toLocaleString(),"개 거래처"]})]}),R&&e.jsx("div",{className:"error",children:R||st.errorGeneric}),e.jsxs("div",{style:{marginTop:12,display:"flex",gap:12,alignItems:"stretch",height:"calc(100vh - 140px)"},children:[e.jsx("div",{style:{flex:"0 0 17%",maxWidth:"17%",minWidth:240,height:"100%",overflow:"auto"},children:ye}),e.jsxs("aside",{className:"card",style:{flex:"1 1 83%",maxWidth:"83%",height:"100%",padding:12,overflow:"auto"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12,gap:16},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,flex:1,minWidth:0},children:(()=>{const L=[];for(let he=0;he<n.length;he++){const fe=n[he],Se=he<m,Ae=he===m;L.push(e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,minWidth:0,flex:he===n.length-1?"0 0 auto":"1 1 0"},children:[e.jsx("div",{title:fe.label,onClick:()=>C(fe.key),style:{width:22,height:22,borderRadius:999,display:"inline-flex",alignItems:"center",justifyContent:"center",background:Se||Ae?"var(--accent)":"transparent",border:`2px solid ${Se||Ae?"var(--accent)":"var(--border)"}`,color:Se||Ae?"var(--on-accent)":"var(--muted)",cursor:"pointer",flex:"0 0 auto"},"aria-current":Ae?"step":void 0,children:Se?"✓":he+1}),e.jsx("div",{style:{fontSize:12,color:Ae||Se?"var(--text)":"var(--muted)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:fe.label}),he<n.length-1&&e.jsx("div",{style:{height:2,background:he<m?"var(--accent)":"var(--border)",flex:1,borderRadius:2}})]},fe.key))}return L})()}),e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[e.jsx("button",{className:"btn btn-icon",onClick:P,disabled:m===0,"aria-label":"이전 단계",title:"이전 단계",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",focusable:"false",children:e.jsx("path",{d:"M15 18l-6-6 6-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),e.jsx("button",{className:"btn btn-icon",onClick:h,disabled:m===n.length-1,"aria-label":"다음 단계",title:"다음 단계",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",focusable:"false",children:e.jsx("path",{d:"M9 6l6 6-6 6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]})]}),l==="init"&&e.jsxs("section",{style:{marginTop:12},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12},children:[e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:10},children:[e.jsx("b",{children:"기준매출"}),e.jsxs("select",{value:j,onChange:L=>te(L.target.value),style:{height:28,padding:"4px 8px",borderRadius:8,border:"1px solid var(--border)",background:"transparent",color:"var(--text)",fontSize:12},"aria-label":"기준 기간 선택",children:[e.jsx("option",{value:"prev1",children:"전년"}),e.jsx("option",{value:"last2",children:"최근2년"}),e.jsx("option",{value:"last3",children:"최근3년"})]})]}),G&&e.jsx("span",{className:"error",children:G})]}),o?e.jsx("div",{className:"empty-state",style:{marginTop:8},children:"불러오는 중…"}):ge]})]})]})]})}function Ms(s){if(!s)return"";const u=s instanceof Date?s:new Date(s);if(isNaN(u.getTime()))return"";const p=String(u.getFullYear()%100).padStart(2,"0"),_=String(u.getMonth()+1).padStart(2,"0"),F=String(u.getDate()).padStart(2,"0"),B=String(u.getHours()).padStart(2,"0"),q=String(u.getMinutes()).padStart(2,"0");return`${p}-${_}-${F} ${B}:${q}`}function wn({compact:s=!1,maxHeight:u,context:p="list"}){const[_,F]=t.useState(""),[B,q]=t.useState(""),[X,R]=t.useState(""),[se,V]=t.useState(!1),[N,y]=t.useState(null),[A,O]=t.useState([]),[b,d]=t.useState("mine"),[x,r]=t.useState({open:!1,x:0,y:0}),[T,S]=t.useState(()=>new Set),[w,l]=t.useState({open:!1,x:0,y:0}),[C,Y]=t.useState({}),[ue,ie]=t.useState({}),[n,m]=t.useState(!1),[P,h]=t.useState(0),o=100,[M,G]=t.useState(0),[H,j]=t.useState(!0),[te,c]=t.useState(!1),i=ke.useRef(null),[v,g]=t.useState(()=>{try{const E=localStorage.getItem("tnt.sales.selectedCustomer");if(E){const ve=JSON.parse(E),ee=Number(ve==null?void 0:ve.customerSeq);return Number.isFinite(ee)?ee:null}}catch{}return null}),[z,I]=t.useState(()=>{try{const E=localStorage.getItem("tnt.sales.selectedCustomer");if(E){const ve=JSON.parse(E);return String((ve==null?void 0:ve.customerId)||"")||null}}catch{}return null}),ge=t.useMemo(()=>{const E=typeof window<"u"?localStorage.getItem("tnt.sales.empName"):"",ve=typeof window<"u"?localStorage.getItem("tnt.sales.assigneeId"):"";return E||ve||""},[]);function re(E,ve){S(ee=>{const _e=new Set(ee);return ve?_e.add(E):_e.delete(E),_e})}function Z(E){if(!E){S(new Set);return}const ve=new Set;A.forEach(ee=>{ee.customerId&&ve.add(ee.customerId)}),S(ve)}async function ye(E=!0){y(null),E?(V(!0),G(0),j(!0)):c(!0);try{const ve=localStorage.getItem("tnt.sales.assigneeId");if(!ve){O([]),y(st.loginRequired);return}const ee=new URL("/api/v1/customers",window.location.origin);_.trim()&&ee.searchParams.set("name",_.trim()),B.trim()&&ee.searchParams.set("provinceName",B.trim()),X.trim()&&ee.searchParams.set("cityName",X.trim());const _e=b==="mine";ee.searchParams.set("mineOnly",_e?"true":"false"),_e&&ve&&ee.searchParams.set("assigneeId",ve),ee.searchParams.set("limit",String(o)),ee.searchParams.set("offset",String(E?0:M));const Pe=await fetch(ee.toString());if(!Pe.ok){let We=`HTTP ${Pe.status}`;try{const Ve=await Pe.json();Ve!=null&&Ve.error&&(We=Ve.error)}catch{const rt=await Pe.text();rt&&(We=rt)}throw new Error(We)}const Te=await Pe.json(),me=Array.isArray(Te)?Te:[],Ue=[...me].sort((We,Ve)=>{const rt=(We.customerName||"").toString(),jt=(Ve.customerName||"").toString();return rt.localeCompare(jt,"ko",{sensitivity:"base"})}),Je=(E?Ue:me).map(We=>Number(We.customerSeq||0)).filter(We=>Number.isFinite(We)&&We>0),ht=Array.from(new Set(Je)).join(",");try{if(Je.length>0){const We=new URL("/api/v1/customers/recent-invoice-flags",window.location.origin);We.searchParams.set("custSeq",ht),We.searchParams.set("years","2");const Ve=new URL("/api/v1/customers/demand-flags",window.location.origin);Ve.searchParams.set("custSeq",ht);const[rt,jt]=await Promise.all([fetch(We.toString()),fetch(Ve.toString())]);if(rt.ok){const nt=await rt.json(),ut={};Array.isArray(nt)&&nt.forEach(Ze=>{const Tt=Number((Ze==null?void 0:Ze.customerSeq)||0);Number.isFinite(Tt)&&(ut[Tt]=!!(Ze!=null&&Ze.hasRecent))}),Y(Ze=>E?ut:{...Ze,...ut})}else E&&Y({});if(jt.ok){const nt=await jt.json(),ut={};Array.isArray(nt)&&nt.forEach(Ze=>{const Tt=Number((Ze==null?void 0:Ze.customerSeq)||0);Number.isFinite(Tt)&&(ut[Tt]=!!(Ze!=null&&Ze.hasDemand))}),ie(Ze=>E?ut:{...Ze,...ut})}else E&&ie({})}else E&&(Y({}),ie({}))}catch{E&&(Y({}),ie({}))}O(E?Ue:We=>[...We,...Ue]),j(me.length>=o),G(E?o:We=>We+o),E&&!n&&Ue.length>0&&(L(Ue[0]),m(!0));try{if(ve&&b==="mine"){const We=new URL("/api/v1/customers/count",window.location.origin);We.searchParams.set("mineOnly","true"),We.searchParams.set("assigneeId",ve);const Ve=await fetch(We.toString());if(Ve.ok){const rt=await Ve.json().catch(()=>({})),jt=Number((rt==null?void 0:rt.total)??0);h(Number.isFinite(jt)?jt:0)}else h(0)}else h(0)}catch{h(0)}}catch(ve){y(ve.message||"조회 중 오류가 발생했습니다")}finally{E?V(!1):c(!1)}}t.useEffect(()=>{ye(!0)},[]),t.useEffect(()=>{const E=()=>{try{const ve=localStorage.getItem("tnt.sales.selectedCustomer");if(ve){const ee=JSON.parse(ve),_e=Number(ee==null?void 0:ee.customerSeq);g(Number.isFinite(_e)?_e:null),I((ee==null?void 0:ee.customerId)||null)}}catch{}};return window.addEventListener("tnt.sales.customer.selected",E),()=>window.removeEventListener("tnt.sales.customer.selected",E)},[]),t.useEffect(()=>{ye(!0)},[b]),t.useEffect(()=>{const E=i.current;if(!E)return;function ve(){E.scrollTop+E.clientHeight>=E.scrollHeight-48&&H&&!te&&!se&&ye(!1)}return E.addEventListener("scroll",ve),()=>E.removeEventListener("scroll",ve)},[H,te,se,M,_,B,X,b]),t.useEffect(()=>{if(!x.open)return;const E=()=>r({open:!1,x:0,y:0});return window.addEventListener("click",E),()=>window.removeEventListener("click",E)},[x.open]),t.useEffect(()=>{if(!x.open)return;const E=ve=>{ve.key==="Escape"&&r({open:!1,x:0,y:0})};return window.addEventListener("keydown",E),()=>window.removeEventListener("keydown",E)},[x.open]),t.useEffect(()=>{if(!w.open)return;const E=()=>l({open:!1,x:0,y:0}),ve=ee=>{ee.key==="Escape"&&l({open:!1,x:0,y:0})};return window.addEventListener("click",E),window.addEventListener("keydown",ve),()=>{window.removeEventListener("click",E),window.removeEventListener("keydown",ve)}},[w.open]),t.useEffect(()=>{const E=ve=>{((ve==null?void 0:ve.key)==="Escape"||(ve==null?void 0:ve.key)==="Esc"||(ve==null?void 0:ve.keyCode)===27)&&(r({open:!1,x:0,y:0}),l({open:!1,x:0,y:0}))};return document.addEventListener("keydown",E,!0),()=>document.removeEventListener("keydown",E,!0)},[]);function L(E){try{localStorage.setItem("tnt.sales.selectedCustomer",JSON.stringify(E||{})),window.dispatchEvent(new CustomEvent("tnt.sales.customer.selected",{detail:{source:"customer-search",customer:E}}))}catch{}g((()=>{const ve=Number(E.customerSeq);return Number.isFinite(ve)?ve:null})()),I(E.customerId||null),r({open:!1,x:0,y:0}),l({open:!1,x:0,y:0})}function he(E,ve){const ee=E.clientX,_e=E.clientY;l({open:!0,x:ee,y:_e,row:ve,loading:!1,error:null,data:[]})}function fe(E){w.open&&l(ve=>({...ve,x:E.clientX,y:E.clientY}))}function Se(){l({open:!1,x:0,y:0})}const Ae=t.useMemo(()=>e.jsx(e.Fragment,{children:e.jsxs("div",{ref:i,className:"table-container",onClick:()=>r({open:!1,x:0,y:0}),style:{maxHeight:u??(s?"32vh":void 0),overflow:"auto"},children:[A.length===0?e.jsx("div",{className:"empty-state",children:st.empty}):e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:36,textAlign:"center"},children:e.jsx("input",{type:"checkbox",checked:A.length>0&&T.size===A.length,indeterminate:void 0,onChange:E=>Z(E.target.checked)})}),e.jsx("th",{style:{width:140},children:p==="c360"?"회사구분":"거래처번호"}),e.jsx("th",{style:{width:200},children:"거래처명"}),e.jsx("th",{style:{width:80},children:"추가정보"}),e.jsx("th",{style:{width:140},children:"사업자번호"}),e.jsx("th",{style:{width:120},children:"대표자명"}),e.jsx("th",{style:{width:120},children:"업태"}),e.jsx("th",{style:{width:120},children:"종목"}),e.jsx("th",{style:{width:130},children:"전화번호"}),e.jsx("th",{style:{width:120},children:"담당자명"}),e.jsx("th",{style:{width:140},children:"부서명"}),e.jsx("th",{style:{width:120},children:"시/도"}),e.jsx("th",{style:{width:120},children:"시/군/구"}),e.jsx("th",{style:{width:120},children:"고객유형"}),e.jsx("th",{children:"비고"}),e.jsx("th",{style:{width:120},children:"생성자"}),e.jsx("th",{style:{width:120},children:"수정자"}),e.jsx("th",{style:{width:180},children:"생성일시"}),e.jsx("th",{style:{width:180},children:"수정일시"})]})}),e.jsx("tbody",{children:A.map((E,ve)=>e.jsxs("tr",{className:Number(E.customerSeq||0)===(v||-1)||z&&E.customerId===z?"selected":void 0,onClick:()=>L(E),onContextMenu:ee=>{ee.preventDefault(),ee.stopPropagation(),Se(),r({open:!0,x:ee.clientX,y:ee.clientY,row:E})},children:[e.jsx("td",{style:{textAlign:"center"},onClick:ee=>ee.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:T.has(E.customerId),onChange:ee=>re(E.customerId,ee.target.checked)})}),e.jsx("td",{onMouseEnter:ee=>he(ee,E),onMouseMove:fe,onMouseLeave:Se,children:p==="c360"?E.companyType||"":E.customerId}),e.jsx("td",{children:E.customerName}),e.jsx("td",{children:(()=>{const ee=Number(E.customerSeq||0),_e=!!C[ee],Pe=!!ue[ee];return!_e&&!Pe?"":e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[_e&&e.jsx("img",{src:Bn,className:"icon",alt:"",title:"최근2년 매출 있음",style:{width:14,height:14}}),Pe&&e.jsx("img",{src:Un,className:"icon",alt:"",title:"수요 있음",style:{width:14,height:14}})]})})()}),e.jsx("td",{children:E.bizNo||""}),e.jsx("td",{children:E.ownerName||""}),e.jsx("td",{children:E.bizKind||""}),e.jsx("td",{children:E.bizType||""}),e.jsx("td",{children:E.telNo||""}),e.jsx("td",{children:E.empName||""}),e.jsx("td",{children:E.deptName||""}),e.jsx("td",{children:E.addrProvinceName||""}),e.jsx("td",{children:E.addrCityName||""}),e.jsx("td",{children:E.customerTypeName||""}),e.jsx("td",{children:E.customerRemark||""}),e.jsx("td",{children:E.createdBy??""}),e.jsx("td",{children:E.updatedBy??""}),e.jsx("td",{children:Ms(E.createdAt)}),e.jsx("td",{children:Ms(E.updatedAt)})]},ve))})]}),te&&e.jsx("div",{className:"muted",style:{padding:"6px 8px"},children:st.loading}),!se&&!te&&!H&&A.length>0&&e.jsx("div",{className:"muted",style:{padding:"8px 10px",textAlign:"center"},children:"마지막 데이터입니다."}),x.open&&e.jsxs("div",{className:"context-menu",style:{left:x.x+4,top:x.y+4},onClick:E=>E.stopPropagation(),children:[p!=="c360"?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"context-item",onClick:()=>{try{localStorage.setItem("tnt.sales.selectedCustomer",JSON.stringify(x.row||{})),window.dispatchEvent(new CustomEvent("tnt.sales.customer.selected",{detail:{source:"customer-search",customer:x.row}}))}catch{}const E=document.querySelector('button[data-key="customer:c360"]');E&&E.click(),r({open:!1,x:0,y:0})},children:"C360"}),e.jsx("button",{className:"context-item",onClick:()=>{try{localStorage.setItem("tnt.sales.selectedCustomer",JSON.stringify(x.row||{})),window.dispatchEvent(new CustomEvent("tnt.sales.customer.selected",{detail:{source:"customer-search",customer:x.row}}))}catch{}window.dispatchEvent(new CustomEvent("tnt.sales.navigate",{detail:{key:"sales-mgmt:receivables"}})),r({open:!1,x:0,y:0})},children:"미수현황"})]}):null,e.jsx("button",{className:"context-item",onClick:()=>{try{localStorage.setItem("tnt.sales.selectedCustomer",JSON.stringify(x.row||{})),window.dispatchEvent(new CustomEvent("tnt.sales.customer.selected",{detail:{source:"customer-search",customer:x.row}}))}catch{}const E=document.querySelector('button[data-key="customer:sales-activity-new"]');E&&E.click(),r({open:!1,x:0,y:0})},children:"활동등록"})]}),w.open&&w.row&&e.jsxs("div",{className:"context-menu",style:{left:w.x+6,top:w.y+6,maxWidth:500,padding:10},onClick:E=>E.stopPropagation(),onMouseLeave:Se,children:[e.jsx("div",{style:{fontWeight:600,marginBottom:6},children:"거래처 정보"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"120px 1fr",gap:6,maxWidth:480},children:[e.jsx("div",{className:"muted",children:"거래처번호"}),e.jsx("div",{children:w.row.customerId||""}),e.jsx("div",{className:"muted",children:"거래처명"}),e.jsx("div",{children:w.row.customerName||""}),w.row.customerFullName?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"muted",children:"정식명"}),e.jsx("div",{children:w.row.customerFullName})]}):null,w.row.bizNo?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"muted",children:"사업자번호"}),e.jsx("div",{children:w.row.bizNo})]}):null,w.row.ownerName?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"muted",children:"대표자명"}),e.jsx("div",{children:w.row.ownerName})]}):null,w.row.bizKind?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"muted",children:"업태"}),e.jsx("div",{children:w.row.bizKind})]}):null,w.row.bizType?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"muted",children:"종목"}),e.jsx("div",{children:w.row.bizType})]}):null,w.row.telNo?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"muted",children:"전화번호"}),e.jsx("div",{children:w.row.telNo})]}):null,w.row.empName?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"muted",children:"담당자명"}),e.jsx("div",{children:w.row.empName})]}):null,w.row.deptName?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"muted",children:"부서명"}),e.jsx("div",{children:w.row.deptName})]}):null,w.row.addrProvinceName?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"muted",children:"시/도"}),e.jsx("div",{children:w.row.addrProvinceName})]}):null,w.row.addrCityName?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"muted",children:"시/군/구"}),e.jsx("div",{children:w.row.addrCityName})]}):null,w.row.customerTypeName?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"muted",children:"고객유형"}),e.jsx("div",{children:w.row.customerTypeName})]}):null,w.row.customerRemark?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"muted",children:"비고"}),e.jsx("div",{children:w.row.customerRemark})]}):null,w.row.createdAt?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"muted",children:"생성일시"}),e.jsx("div",{children:Ms(w.row.createdAt)})]}):null,w.row.updatedAt?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"muted",children:"수정일시"}),e.jsx("div",{children:Ms(w.row.updatedAt)})]}):null]})]})]})}),[A,x,T,w]);return e.jsxs("section",{children:[e.jsxs("div",{className:"page-title",style:{alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:8,alignItems:"center",flex:"1 1 auto",minWidth:0},children:[e.jsxs("select",{value:b,onChange:E=>d(E.target.value),style:{height:30,padding:"2px 8px",fontSize:11,background:b==="mine"?"rgba(59,130,246,.15)":"#fff",borderRadius:8,border:b==="mine"?"1px solid var(--accent)":"1px solid var(--border)"},children:[e.jsx("option",{value:"mine",children:"내 거래처"}),e.jsx("option",{value:"hq",children:"본부 거래처"}),e.jsx("option",{value:"all",children:"전체"})]}),e.jsx("input",{className:"search-input",value:_,onChange:E=>F(E.target.value),onKeyDown:E=>{E.key==="Enter"&&ye()},placeholder:"거래처명",style:{background:"#fff",borderRadius:8,border:"1px solid var(--border)"}}),e.jsx("input",{className:"search-input",value:B,onChange:E=>q(E.target.value),onKeyDown:E=>{E.key==="Enter"&&ye()},placeholder:"시/도",style:{background:"#fff",borderRadius:8,border:"1px solid var(--border)",minWidth:100}}),e.jsx("input",{className:"search-input",value:X,onChange:E=>R(E.target.value),onKeyDown:E=>{E.key==="Enter"&&ye()},placeholder:"시/군/구",style:{background:"#fff",borderRadius:8,border:"1px solid var(--border)",minWidth:120}}),e.jsx("button",{className:"btn",onClick:ye,disabled:se,style:{height:30,padding:"0 12px"},children:"조회"}),se&&e.jsx("span",{className:"muted",style:{lineHeight:"30px"},children:st.loading})]}),e.jsx("div",{className:"meta",style:{gap:0},children:e.jsxs("span",{className:"muted count-text",children:[b==="mine"&&ge?`${ge} · `:"",(b==="mine"?P:A.length).toLocaleString(),"개 거래처",T.size?` · 선택 ${T.size}건`:""]})})]}),N&&e.jsx("div",{className:"error",children:N||st.errorGeneric}),e.jsx("div",{style:{marginTop:12},children:Ae})]})}function Kt(s){if(!s)return"";const u=s instanceof Date?s:new Date(s);if(isNaN(u.getTime()))return"";const p=String(u.getFullYear()%100).padStart(2,"0"),_=String(u.getMonth()+1).padStart(2,"0"),F=String(u.getDate()).padStart(2,"0"),B=String(u.getHours()).padStart(2,"0"),q=String(u.getMinutes()).padStart(2,"0");return`${p}-${_}-${F} ${B}:${q}`}function Xs({customerSeq:s,customerId:u,hideHeader:p=!1,hideRefresh:_=!1,enableContextMenu:F=!1}){const[B,q]=t.useState([]),[X,R]=t.useState(!1),[se,V]=t.useState(null),[N,y]=t.useState({open:!1,x:0,y:0}),A=t.useRef(null),[O,b]=t.useState(null);async function d(){V(null),R(!0);try{const w=new URL("/api/v1/sales-activities",window.location.origin);w.searchParams.set("mineOnly","false");const l=u&&u.trim()||(()=>{try{const ue=localStorage.getItem("tnt.sales.selectedCustomer");if(ue){const ie=JSON.parse(ue);return(ie==null?void 0:ie.customerId)||""}}catch{}return""})();w.searchParams.set("sfAccountId",l||"");const C=await fetch(w.toString());if(!C.ok){let ue=`HTTP ${C.status}`;try{const ie=await C.json();ie!=null&&ie.error&&(ue=ie.error)}catch{}throw new Error(ue)}const Y=await C.json();q(Array.isArray(Y)?Y:[])}catch(w){V(w.message||"조회 중 오류가 발생했습니다")}finally{R(!1)}}t.useEffect(()=>{s&&d()},[s,u]);async function x(w){try{const l=new URL("/api/v1/sales-activities",window.location.origin);l.searchParams.set("mineOnly","false");const C=u&&u.trim()||(()=>{try{const n=localStorage.getItem("tnt.sales.selectedCustomer");if(n){const m=JSON.parse(n);return(m==null?void 0:m.customerId)||""}}catch{}return""})();l.searchParams.set("sfAccountId",C||""),l.searchParams.set("parentSeq",String(w)),l.searchParams.set("includeParent","true");const Y=await fetch(l.toString());if(!Y.ok)return;const ue=await Y.json(),ie=Array.isArray(ue)?ue:[];ie.sort((n,m)=>{const P=!n.parentSeq,h=!m.parentSeq;if(P&&!h)return-1;if(!P&&h)return 1;const o=n.createdAt?new Date(n.createdAt).getTime():0;return(m.createdAt?new Date(m.createdAt).getTime():0)-o}),b(ie)}catch{b([])}}t.useEffect(()=>{if(!N.open)return;const w=l=>{if(l.button!==0)return;const C=l.target;A.current&&C&&A.current.contains(C)||y({open:!1,x:0,y:0})};return window.addEventListener("mousedown",w,!0),()=>window.removeEventListener("mousedown",w,!0)},[N.open]),t.useEffect(()=>{if(!N.open)return;const w=l=>{((l==null?void 0:l.key)==="Escape"||(l==null?void 0:l.key)==="Esc"||(l==null?void 0:l.keyCode)===27)&&y({open:!1,x:0,y:0})};return document.addEventListener("keydown",w,!0),()=>document.removeEventListener("keydown",w,!0)},[N.open]),t.useEffect(()=>{if(!O)return;const w=l=>{l.key==="Escape"&&(l.preventDefault(),l.stopPropagation(),b(null))};return window.addEventListener("keydown",w,!0),()=>window.removeEventListener("keydown",w,!0)},[O]);const r=(w,l)=>w?l==="type"?{site_visit:"정기방문",opportunity:"영업기회",AR_mgmt:"채권관리",meeting:"미팅",call:"전화",email:"이메일",demo:"데모",task:"업무",other:"기타"}[w]||w:l==="status"?{scheduled:"계획",completed:"완료",canceled:"취소",postponed:"연기",no_show:"미방문"}[w]||w:l==="channel"&&{in_person:"방문",phone:"전화",email:"문자/메일/팩스",other:"기타",video:"영상",chat:"채팅",sms:"문자"}[w]||w:"",T=w=>[`제목: ${w.subject||""}`,`활동설명: ${w.description||""}`,`활동유형: ${r(w.activityType,"type")}`,`활동방법: ${r(w.channel,"channel")}`,`상태: ${r(w.activityStatus,"status")}`,`상위활동: ${w.parentSubject||""}`,`계획 일시: ${Kt(w.plannedStartAt)}`,`종료 일시: ${Kt(w.plannedEndAt)}`,`생성일시: ${Kt(w.createdAt)}`,w.customerName?`거래처명: ${w.customerName}`:""].filter(Boolean).join(`
`),S=t.useMemo(()=>e.jsxs(e.Fragment,{children:[!p&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:6},children:[e.jsx("div",{className:"muted"}),e.jsxs("div",{className:"muted count-text",children:["총 ",B.length,"건"]})]}),e.jsx("div",{className:"table-container",children:B.length===0?e.jsx("div",{className:"empty-state",children:"활동이 없습니다."}):e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:240},children:"제목"}),e.jsx("th",{style:{width:280},children:"활동설명"}),e.jsx("th",{style:{width:120},children:"활동유형"}),e.jsx("th",{style:{width:120},children:"활동방법"}),e.jsx("th",{style:{width:120},children:"상태"}),e.jsx("th",{style:{width:220},children:"상위활동"}),e.jsx("th",{style:{width:180},children:"계획 일시"}),e.jsx("th",{style:{width:180},children:"종료 일시"}),e.jsx("th",{style:{width:180},children:"생성일시"})]})}),e.jsx("tbody",{children:B.map((w,l)=>e.jsxs("tr",{title:T(w),onContextMenu:C=>{F&&w.parentSeq&&(C.preventDefault(),C.stopPropagation(),y({open:!0,x:C.clientX,y:C.clientY,row:w}))},children:[e.jsx("td",{children:w.subject||""}),e.jsx("td",{title:w.description||"",style:{maxWidth:600,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:w.description||""}),e.jsx("td",{children:r(w.activityType,"type")}),e.jsx("td",{children:r(w.channel,"channel")}),e.jsx("td",{children:r(w.activityStatus,"status")}),e.jsx("td",{children:w.parentSubject||""}),e.jsx("td",{children:Kt(w.plannedStartAt)}),e.jsx("td",{children:Kt(w.plannedEndAt)}),e.jsx("td",{children:Kt(w.createdAt)})]},l))})]})})]}),[B]);return e.jsxs("section",{children:[!_&&e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("button",{className:"btn",onClick:d,disabled:X,children:X?"새로고침…":"새로고침"}),se&&e.jsx("span",{className:"error",children:se})]}),_&&se&&e.jsx("div",{className:"error",children:se}),e.jsx("div",{style:{marginTop:12},children:S}),N.open&&e.jsx("div",{ref:A,className:"context-menu",style:{left:N.x+4,top:N.y+4},onClick:w=>w.stopPropagation(),children:e.jsx("button",{className:"context-item",onClick:()=>{var w,l;(w=N.row)!=null&&w.parentSeq?x(N.row.parentSeq):(l=N.row)!=null&&l.id&&x(N.row.id),y({open:!1,x:0,y:0})},children:"관련활동"})}),O&&e.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,.4)"},onClick:()=>b(null),children:e.jsxs("div",{className:"card",style:{width:"min(1200px, 92vw)",maxHeight:"90vh",overflow:"auto",padding:16,background:"var(--panel)",border:"1px solid var(--border)",borderRadius:12,boxShadow:"0 8px 32px rgba(0,0,0,.2)"},onClick:w=>w.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[e.jsxs("div",{className:"list-title",style:{display:"flex",alignItems:"center",gap:6},children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",focusable:"false",style:{color:"#555"},children:[e.jsx("circle",{cx:"6",cy:"6",r:"3",stroke:"currentColor",strokeWidth:"1.8"}),e.jsx("circle",{cx:"18",cy:"6",r:"3",stroke:"currentColor",strokeWidth:"1.8"}),e.jsx("circle",{cx:"12",cy:"18",r:"3",stroke:"currentColor",strokeWidth:"1.8"}),e.jsx("line",{x1:"8.5",y1:"7.4",x2:"15.5",y2:"7.4",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round"}),e.jsx("line",{x1:"7.2",y1:"8.9",x2:"10.8",y2:"15.1",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round"}),e.jsx("line",{x1:"16.8",y1:"8.9",x2:"13.2",y2:"15.1",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round"})]}),e.jsx("span",{style:{fontWeight:600,fontSize:14},children:"관련활동"}),e.jsxs("span",{className:"muted count-text",style:{marginLeft:8},children:["총 ",O.length,"건"]})]}),e.jsx("button",{onClick:()=>b(null),style:{width:32,height:32,display:"flex",alignItems:"center",justifyContent:"center",background:"transparent",border:"none",borderRadius:4,cursor:"pointer",color:"var(--muted)",fontSize:20,transition:"all 0.2s"},onMouseEnter:w=>{w.currentTarget.style.background="var(--panel-2)",w.currentTarget.style.color="var(--text)"},onMouseLeave:w=>{w.currentTarget.style.background="transparent",w.currentTarget.style.color="var(--muted)"},title:"닫기 (ESC)",children:"×"})]}),e.jsx("div",{className:"table-container",children:O.length===0?e.jsx("div",{className:"empty-state",children:"관련활동이 없습니다."}):e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:200},children:"상위활동"}),e.jsx("th",{style:{width:240},children:"제목"}),e.jsx("th",{style:{width:280},children:"활동설명"}),e.jsx("th",{style:{width:120},children:"활동유형"}),e.jsx("th",{style:{width:120},children:"활동방법"}),e.jsx("th",{style:{width:120},children:"상태"}),e.jsx("th",{style:{width:180},children:"계획 일시"}),e.jsx("th",{style:{width:180},children:"종료 일시"}),e.jsx("th",{style:{width:180},children:"생성일시"})]})}),e.jsx("tbody",{children:O.map((w,l)=>e.jsxs("tr",{title:T(w),className:w.parentSeq?void 0:"row-parent",children:[e.jsx("td",{children:w.parentSubject||""}),e.jsx("td",{children:w.subject||""}),e.jsx("td",{style:{maxWidth:600,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:w.description||""}),e.jsx("td",{children:r(w.activityType,"type")}),e.jsx("td",{children:r(w.channel,"channel")}),e.jsx("td",{children:r(w.activityStatus,"status")}),e.jsx("td",{children:Kt(w.plannedStartAt)}),e.jsx("td",{children:Kt(w.plannedEndAt)}),e.jsx("td",{children:Kt(w.createdAt)})]},`rel-${l}`))})]})})]})})]})}function ia(){const[s,u]=t.useState(null),[p,_]=t.useState("form");t.useEffect(()=>{try{const B=localStorage.getItem("tnt.sales.selectedCustomer");u(B?JSON.parse(B):null)}catch{u(null)}},[]);const F=t.useMemo(()=>s?e.jsx("section",{className:"card compact-form",children:e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"거래처번호"}),e.jsx(yt,{value:s.customerId||"",readOnly:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"거래처명"}),e.jsx(yt,{value:s.customerName||"",readOnly:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"정식명"}),e.jsx(yt,{value:s.customerFullName||"",readOnly:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"사업자번호"}),e.jsx(yt,{value:s.bizNo||"",readOnly:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"대표자명"}),e.jsx(yt,{value:s.ownerName||"",readOnly:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"고객유형"}),e.jsx(yt,{value:s.customerTypeName||"",readOnly:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"시/도"}),e.jsx(yt,{value:s.addrProvinceName||"",readOnly:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"시/군/구"}),e.jsx(yt,{value:s.addrCityName||"",readOnly:!0})]}),e.jsxs("div",{className:"field row-2",children:[e.jsx("label",{children:"비고"}),e.jsx(yt,{value:s.customerRemark||"",readOnly:!0})]})]})}):null,[s]);return e.jsxs("section",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[e.jsxs("div",{className:"page-title",style:{alignItems:"center"},children:[e.jsx("h2",{style:{margin:0,fontSize:18},children:"영업활동"}),e.jsx("div",{className:"muted count-text"})]}),F,e.jsxs("section",{className:"card sales-activity-panel",style:{marginTop:12},children:[e.jsxs("div",{className:"tabs c360-tabs",children:[e.jsx("button",{className:p==="form"?"tab active":"tab",onClick:()=>_("form"),children:"영업활동 등록"}),e.jsx("button",{className:p==="list"?"tab active":"tab",onClick:()=>_("list"),children:"영업활동"})]}),e.jsx("div",{className:"sales-activity-content",children:p==="form"?e.jsx(Ns,{bare:!0}):e.jsx(Xs,{customerSeq:(()=>{try{const B=localStorage.getItem("tnt.sales.selectedCustomer");if(B){const q=JSON.parse(B);return Number(q==null?void 0:q.customerSeq)||0}}catch{}return 0})(),customerId:(()=>{try{const B=localStorage.getItem("tnt.sales.selectedCustomer");if(B){const q=JSON.parse(B);return String((q==null?void 0:q.customerId)||"")}}catch{}return""})(),hideRefresh:!0,enableContextMenu:!0})})]})]})}function Sn({customerSeq:s}){const[u,p]=t.useState([]),[_,F]=t.useState(!1),[B,q]=t.useState(null),[X,R]=t.useState([]);async function se(){q(null),F(!0);try{const O=s??(()=>{try{const l=localStorage.getItem("tnt.sales.selectedCustomer");if(l){const C=JSON.parse(l);return Number(C==null?void 0:C.customerSeq)}}catch{}})();if(!O||Number.isNaN(O)){p([]),R([]),F(!1);return}const b=new URL(`/api/v1/customers/${O}/transactions`,window.location.origin),d=await fetch(b.toString());if(!d.ok){let l=`HTTP ${d.status}`;try{const C=await d.json();C!=null&&C.error&&(l=C.error)}catch{}throw new Error(l)}const x=await d.json(),r=Array.isArray(x)?x:[];p(r);let T=[];if(r.length>0){const l=new Map;r.forEach(C=>{const Y=C.minorName||"na",ue=l.get(Y)||{qty:0,amt:0};ue.qty+=Number(C.qty??C.qty??0)||0,ue.amt+=Number(C.curAmt||0)||0,l.set(Y,ue)}),T=Array.from(l.entries()).map(([C,Y])=>({name:C,qty:Y.qty,amt:Y.amt})),T.sort((C,Y)=>Y.qty-C.qty||Y.amt-C.amt),R(T)}else R([]);const S=await fetch(`/api/v1/customers/${O}/transactions/summary`);let w=[];if(S.ok)try{const l=await S.json();w=(Array.isArray(l)?l:[]).map(C=>({name:C.minorName||"na",qty:Number(C.qty||0),amt:Number(C.amt||0)}))}catch{w=[]}w.sort((l,C)=>C.qty-l.qty||C.amt-l.amt),w.length>0&&R(w)}catch(O){q(O.message||"조회 중 오류가 발생했습니다")}finally{F(!1)}}t.useEffect(()=>{se()},[s]);const V=t.useMemo(()=>{const O=[...X];return O.sort((b,d)=>d.qty-b.qty||d.amt-b.amt),O},[X]),N=t.useMemo(()=>{const O=[...X];return O.sort((b,d)=>d.amt-b.amt||d.qty-b.qty),O},[X]);function y({data:O,type:b}){const x={top:10,right:10,bottom:60,left:10},r=Math.max(360,O.length*80),T=r-x.left-x.right,S=180-x.top-x.bottom,w=Math.max(1,...O.map(C=>C.value)),l=T/Math.max(1,O.length);return e.jsx("div",{style:{overflowX:"auto"},children:e.jsx("svg",{width:r,height:180,children:e.jsx("g",{transform:`translate(${x.left},${x.top})`,children:O.map((C,Y)=>{const ue=Y*l+l*.15,ie=l*.7,n=Math.max(0,C.value/w*S),m=S-n;return e.jsxs("g",{transform:`translate(${ue},0)`,children:[e.jsx("rect",{x:0,y:m,width:ie,height:n,fill:b==="amt"?"#4e79a7":"#f28e2b"}),e.jsx("text",{x:ie/2,y:S+14,fontSize:11,textAnchor:"middle",fill:"var(--muted)",transform:`rotate(25 ${ie/2},${S+14})`,children:C.name}),e.jsx("text",{x:ie/2,y:m-4,fontSize:11,textAnchor:"middle",fill:"var(--text)",children:C.value.toLocaleString()})]},Y)})})})})}const A=t.useMemo(()=>e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:6},children:e.jsxs("div",{className:"muted count-text",children:["총 ",u.length,"건"]})}),u.length>0&&e.jsxs("div",{className:"card",style:{padding:12,marginBottom:8},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"baseline"},children:[e.jsx("b",{children:"중분류별 금액/수량"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"가로축: 중분류"})]}),e.jsxs("div",{style:{marginTop:8},children:[e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{className:"muted",style:{marginBottom:4},children:"금액"}),e.jsx(y,{type:"amt",data:N.map(O=>({name:O.name,value:O.amt}))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",style:{marginBottom:4},children:"수량"}),e.jsx(y,{type:"qty",data:V.map(O=>({name:O.name,value:O.qty}))})]})]})]}),e.jsx("div",{className:"table-container",children:u.length===0?e.jsx("div",{className:"empty-state",children:"거래 내역이 없습니다."}):e.jsxs("table",{className:"table transactions",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:160},children:"전표번호"}),e.jsx("th",{style:{width:160},children:"중분류"}),e.jsx("th",{children:"품목명"}),e.jsx("th",{style:{width:100,textAlign:"right"},children:"수량"}),e.jsx("th",{style:{width:160,textAlign:"right"},children:"금액"}),e.jsx("th",{style:{width:140},children:"전표일자"})]})}),e.jsx("tbody",{children:(()=>{let O="",b="",d="";const x=[];return u.forEach((r,T)=>{const S=r.invoiceNo!==O;let w="",l="",C="",Y;S?(T>0&&x.push(e.jsx("tr",{className:"sep-row",children:e.jsx("td",{colSpan:6})},`sep-${T}`)),w=r.invoiceNo,l=r.invoiceDate,C=r.minorName||"na",Y=void 0,O=r.invoiceNo,b=r.invoiceDate,d=r.minorName):(r.invoiceDate!==b&&(l=r.invoiceDate,b=r.invoiceDate),r.minorName!==d&&(C=r.minorName||"na",d=r.minorName),Y="same-invoice"),x.push(e.jsxs("tr",{className:Y,children:[e.jsx("td",{className:"col-invno",children:w}),e.jsx("td",{children:C}),e.jsx("td",{children:r.itemName}),e.jsx("td",{style:{textAlign:"right"},children:Number(r.qty??r.qty??0).toLocaleString()}),e.jsx("td",{style:{textAlign:"right"},children:Number(r.curAmt||0).toLocaleString()}),e.jsx("td",{className:"col-invdate",children:l?(()=>{const ue=new Date(l);if(isNaN(ue.getTime()))return l;const ie=String(ue.getFullYear()%100).padStart(2,"0"),n=String(ue.getMonth()+1).padStart(2,"0"),m=String(ue.getDate()).padStart(2,"0"),P=String(ue.getHours()).padStart(2,"0"),h=String(ue.getMinutes()).padStart(2,"0");return`${ie}-${n}-${m} ${P}:${h}`})():""})]},`row-${T}`))}),x})()})]})})]}),[u]);return e.jsxs("div",{children:[e.jsx("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:8},children:B&&e.jsx("span",{className:"error",children:B})}),A]})}function la(s){if(s==null)return"";const u=Number(s);return isFinite(u)?`${(u<=1?u*100:u).toLocaleString(void 0,{maximumFractionDigits:2})}%`:""}function Nn({customerName:s,refreshTick:u=0}){const[p,_]=t.useState([]),[F,B]=t.useState(!1),[q,X]=t.useState(null);async function R(){if(s!=null&&s.trim()){B(!0),X(null);try{const V=new URLSearchParams({customer:s,limit:"1000"}),N=await fetch(`/api/v1/demand?${V.toString()}`);if(!N.ok){const O=await N.json().catch(()=>({}));throw new Error((O==null?void 0:O.error)||`HTTP ${N.status}`)}const A=(await N.json()||[]).map(O=>({itemSubcategory:O.itemSubcategory??null,supplierName:O.supplierName??null,salesMgmtUnit:O.salesMgmtUnit??null,shareRate:O.shareRate??null}));_(A)}catch(V){X(V.message||"로드 중 오류가 발생했습니다")}finally{B(!1)}}}t.useEffect(()=>{R()},[s,u]);const se=t.useMemo(()=>{const V=new Set,N=new Set,y=new Map;for(const b of p){const d=b.itemSubcategory||"-",x=`${b.supplierName||"-"}|${b.salesMgmtUnit||"-"}`;V.add(d),N.add(x);const r=`${d}::${x}`;y.set(r,b.shareRate)}const A=Array.from(V).sort((b,d)=>b.localeCompare(d)),O=Array.from(N).sort((b,d)=>b.localeCompare(d));return{rows:A,cols:O,cell:y}},[p]);return e.jsxs("section",{children:[F&&e.jsx("div",{className:"muted",style:{marginBottom:8},children:"불러오는 중…"}),q&&e.jsx("div",{className:"error",style:{marginTop:8},children:q}),e.jsx("div",{className:"table-container",style:{marginTop:8,border:"1px solid var(--border)",borderRadius:8},children:e.jsxs("table",{className:"table",style:{width:"100%",borderCollapse:"separate",borderSpacing:0},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{position:"sticky",left:0,background:"var(--bg)",textAlign:"left",padding:"8px 10px",zIndex:1},children:"중분류"}),se.cols.map(V=>{const[N,y]=V.split("|");return e.jsxs("th",{style:{textAlign:"center",padding:"8px 10px",whiteSpace:"nowrap"},children:[e.jsx("div",{children:N}),e.jsx("div",{className:"muted",style:{fontSize:12},children:y})]},V)})]})}),e.jsx("tbody",{children:se.rows.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:Math.max(1,se.cols.length+1),className:"muted",style:{padding:"12px 10px"},children:F?"불러오는 중…":"데이터가 없습니다"})}):se.rows.map(V=>e.jsxs("tr",{children:[e.jsx("td",{style:{position:"sticky",left:0,background:"var(--bg)",padding:"8px 10px"},children:V}),se.cols.map(N=>{const y=`${V}::${N}`,A=se.cell.get(y)??null;return e.jsx("td",{style:{textAlign:"right",padding:"8px 10px"},children:la(A)},N)})]},V))})]})})]})}function oa(s){if(s==null)return 0;const u=Number(s);return isFinite(u)?u<=1?u*100:u:0}const ws=["#4e79a7","#f28e2b","#e15759","#76b7b2","#59a14f","#edc949","#af7aa1","#ff9da7","#9c755f","#bab0ab","#1f77b4","#ff7f0e"];function ca({data:s,size:u=140}){const p=u/2,_=p,F=p,B=s.filter(se=>(se.value||0)>0),q=B.reduce((se,V)=>se+Math.max(0,V.value),0)||1;if(B.length===1)return e.jsx("svg",{width:u,height:u,viewBox:`0 0 ${u} ${u}`,children:e.jsx("circle",{cx:_,cy:F,r:p,fill:ws[0],stroke:"#0b1324",strokeWidth:1})});let X=-Math.PI/2;const R=B.map((se,V)=>{const A=Math.max(0,se.value)/q*Math.PI*2,O=_+p*Math.cos(X),b=F+p*Math.sin(X),d=_+p*Math.cos(X+A),x=F+p*Math.sin(X+A),r=A>Math.PI?1:0,T=`M ${_} ${F} L ${O} ${b} A ${p} ${p} 0 ${r} 1 ${d} ${x} Z`;return X+=A,{path:T,color:ws[V%ws.length],label:se.label,value:se.value}});return e.jsx("svg",{width:u,height:u,viewBox:`0 0 ${u} ${u}`,children:R.map((se,V)=>e.jsx("path",{d:se.path,fill:se.color,stroke:"#0b1324",strokeWidth:1},V))})}function kn({customerName:s,refreshTick:u=0}){const[p,_]=t.useState([]),[F,B]=t.useState(!1),[q,X]=t.useState(null);async function R(){B(!0),X(null);try{const V=new URLSearchParams({customer:s,limit:"1000"}),N=await fetch(`/api/v1/demand?${V.toString()}`);if(!N.ok){const O=await N.json().catch(()=>({}));throw new Error((O==null?void 0:O.error)||`HTTP ${N.status}`)}const A=(await N.json()||[]).map(O=>({itemSubcategory:O.itemSubcategory??null,supplierName:O.supplierName??null,salesMgmtUnit:O.salesMgmtUnit??null,shareRate:O.shareRate??null}));_(A)}catch(V){X(V.message||"로드 중 오류가 발생했습니다")}finally{B(!1)}}t.useEffect(()=>{s&&R()},[s,u]);const se=t.useMemo(()=>{const V=new Map;for(const N of p){const y=N.itemSubcategory||"-",A=`${N.supplierName||"-"} / ${N.salesMgmtUnit||"-"}`,O=oa(N.shareRate);V.has(y)||V.set(y,[]);const b=V.get(y),d=b.find(x=>x.label===A);d?d.value+=O:b.push({label:A,value:O})}for(const[N,y]of V)y.sort((A,O)=>O.value-A.value);return V},[p]);return s?e.jsxs("section",{className:"card",style:{marginTop:12},children:[F&&e.jsx("div",{className:"muted",children:st.loading}),q&&e.jsx("div",{className:"error",children:q||st.errorGeneric}),!F&&!q&&e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:16},children:[Array.from(se.entries()).map(([V,N])=>e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",border:"1px solid var(--border)",borderRadius:12,padding:12,width:"calc((100% - 16px) / 2)"},children:[e.jsx("div",{style:{flex:"0 0 auto"},children:e.jsx(ca,{data:N})}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontWeight:600,marginBottom:6,fontSize:13},children:V}),e.jsxs("div",{style:{fontSize:12},children:[N.slice(0,8).map((y,A)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[e.jsx("span",{style:{width:10,height:10,borderRadius:2,background:ws[A%ws.length],display:"inline-block"}}),e.jsx("span",{style:{minWidth:160},children:y.label}),e.jsxs("span",{style:{color:"var(--muted)"},children:[y.value.toLocaleString(void 0,{maximumFractionDigits:2}),"%"]})]},A)),N.length>8&&e.jsxs("div",{className:"muted",children:["외 ",N.length-8,"개…"]})]})]})]},V)),se.size===0&&e.jsx("div",{className:"empty-state",children:"데이터가 없습니다"})]})]}):null}function Cn({customerName:s,customerSeq:u,empSeq:p,empName:_,onSuccess:F}){const[B,q]=t.useState([]),[X,R]=t.useState([]),[se,V]=t.useState([]),[N,y]=t.useState(""),[A,O]=t.useState(""),[b,d]=t.useState(""),[x,r]=t.useState(""),[T,S]=t.useState({subcats:!1,suppliers:!1,units:!1,submit:!1}),[w,l]=t.useState(null),[C,Y]=t.useState(null);t.useEffect(()=>{async function n(){S(m=>({...m,subcats:!0})),l(null);try{const m=await fetch("/api/v1/supplier/subcategories");if(!m.ok)throw new Error(`HTTP ${m.status}`);const P=await m.json();q(P||[])}catch(m){l(m.message||"중분류 목록을 불러오지 못했습니다")}finally{S(m=>({...m,subcats:!1}))}}n()},[]),t.useEffect(()=>{if(O(""),R([]),d(""),V([]),!N)return;async function n(){S(m=>({...m,suppliers:!0})),l(null);try{const m=new URLSearchParams({subcategory:N}),P=await fetch(`/api/v1/supplier/names?${m.toString()}`);if(!P.ok)throw new Error(`HTTP ${P.status}`);const h=await P.json();R(h||[])}catch(m){l(m.message||"공급사 목록을 불러오지 못했습니다")}finally{S(m=>({...m,suppliers:!1}))}}n()},[N]),t.useEffect(()=>{if(d(""),V([]),!N||!A)return;async function n(){S(m=>({...m,units:!0})),l(null);try{const m=new URLSearchParams({subcategory:N,supplier:A}),P=await fetch(`/api/v1/supplier/units?${m.toString()}`);if(!P.ok)throw new Error(`HTTP ${P.status}`);const h=await P.json();V(h||[])}catch(m){l(m.message||"영업관리단위를 불러오지 못했습니다")}finally{S(m=>({...m,units:!1}))}}n()},[N,A]);const ue=t.useMemo(()=>{if(!x)return"";const n=Number(x);if(!isFinite(n))return"숫자를 입력하세요";const m=n<=1?n*100:n;return st.hint.sharePreview(m)},[x]);async function ie(){if(Y(null),l(null),!N||!A||!b){l("중분류/공급사/영업관리단위를 선택하세요");return}const n=Number(x);if(!isFinite(n)||n<=0){l("점유율을 올바르게 입력하세요");return}S(m=>({...m,submit:!0}));try{const m={customerSeq:u,customerName:s||void 0,empSeq:p&&p>0?p:void 0,empName:_||void 0,itemSubcategory:N,supplierName:A,salesMgmtUnit:b,share:n},P=await fetch("/api/v1/demand/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)}),h=await P.json().catch(()=>({}));if(!P.ok)throw new Error((h==null?void 0:h.error)||`HTTP ${P.status}`);Y("등록되었습니다"),F&&F()}catch(m){l(m.message||"등록 중 오류가 발생했습니다")}finally{S(m=>({...m,submit:!1}))}}return e.jsxs("section",{style:{marginTop:16},children:[e.jsx("h3",{style:{marginTop:0},children:"수요등록"}),e.jsxs("div",{className:"card",style:{padding:12},children:[e.jsxs("div",{className:"form-grid",style:{gridTemplateColumns:"1fr 1fr 1fr 1fr"},children:[e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"중분류"}),e.jsxs("select",{value:N,onChange:n=>y(n.target.value),children:[e.jsx("option",{value:"",children:"선택하세요"}),B.map(n=>e.jsx("option",{value:n,children:n},n))]}),T.subcats&&e.jsx("div",{className:"muted",style:{marginTop:4},children:"불러오는 중…"})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"공급사"}),e.jsxs("select",{value:A,onChange:n=>O(n.target.value),disabled:!N||T.suppliers,children:[e.jsx("option",{value:"",children:"선택하세요"}),X.map(n=>e.jsx("option",{value:n,children:n},n))]})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"영업관리단위"}),e.jsxs("select",{value:b,onChange:n=>d(n.target.value),disabled:!N||!A||T.units,children:[e.jsx("option",{value:"",children:"선택하세요"}),se.map(n=>e.jsx("option",{value:n,children:n},n))]})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"점유율(%)"}),e.jsx(yt,{value:x,onChange:n=>r(n),placeholder:"예: 0.25 또는 25"}),ue&&e.jsx("div",{className:"muted",style:{marginTop:4},children:ue})]})]}),w&&e.jsx("div",{className:"error",style:{marginTop:8},children:w||st.errorGeneric}),C&&e.jsx("div",{className:"muted",style:{marginTop:8},children:C}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:12},children:e.jsx("button",{className:"btn",onClick:ie,disabled:T.submit,children:T.submit?st.fetching:s?`${s}에 ${st.action.register}`:st.action.register})})]})]})}const An=[{value:"Credit / Receivable",label:"신용·채권"},{value:"Pricing / Terms",label:"가격·조건"},{value:"Quality / Claim",label:"품질·클레임"},{value:"Logistics / Delivery",label:"물류·납기"},{value:"Contract / Legal",label:"계약·법무"},{value:"Relationship / Strategic",label:"관계·전략"},{value:"Operational",label:"운영 이슈"},{value:"기타",label:"기타"}],da=s=>{if(!s)return"미정";const u=An.find(p=>p.value===s);return(u==null?void 0:u.label)??s},dn={noteTitle:"",noteContent:"",noteType:"",importanceLevel:1},ua=s=>{try{const u=new Date(s),p=String(u.getFullYear()).slice(-2),_=String(u.getMonth()+1).padStart(2,"0"),F=String(u.getDate()).padStart(2,"0"),B=String(u.getHours()).padStart(2,"0"),q=String(u.getMinutes()).padStart(2,"0");return`${p}-${_}-${F} ${B}:${q}`}catch{return s}},un=s=>s==null?"중요도 미정":["하","중","상"][Math.min(Math.max(s,0),2)];function ma({customerSeq:s,customerId:u,empName:p}){const[_,F]=t.useState([]),[B,q]=t.useState(!1),[X,R]=t.useState(null),[se,V]=t.useState(0),[N,y]=t.useState(!1),[A,O]=t.useState(!1),[b,d]=t.useState(null),[x,r]=t.useState(()=>({...dn})),[T,S]=t.useState(null),w=t.useMemo(()=>typeof window>"u"?"":localStorage.getItem("tnt.sales.assigneeId")??"",[]),[l,C]=t.useState(null),[Y,ue]=t.useState(null),[ie,n]=t.useState(!1);t.useEffect(()=>{if(!u){R("고객 ID가 없어 특이사항을 불러올 수 없습니다."),F([]);return}let j=!1;async function te(){q(!0),R(null);try{const c=await fetch(`/api/v1/customers/${u}/special-notes`);if(!c.ok)throw new Error(`HTTP ${c.status}`);const i=await c.json();if(j)return;const v=Array.isArray(i)?i:[];v.sort((g,z)=>new Date(z.updatedAt??z.createdAt).getTime()-new Date(g.updatedAt??g.createdAt).getTime()),F(v)}catch(c){if(j)return;R(c.message||"특이사항을 불러오지 못했습니다."),F([])}finally{j||q(!1)}}return te(),()=>{j=!0}},[u,se]);const m=async j=>{if(j.preventDefault(),!u)return;O(!0),d(null);const te=T!=null,c=w||"system";try{const i={customerId:u,customerSeq:s,noteTitle:x.noteTitle.trim()||"특이사항",noteContent:x.noteContent.trim(),noteType:x.noteType||void 0,importanceLevel:x.importanceLevel},v=te?`/api/v1/customers/${u}/special-notes/${T.id}`:`/api/v1/customers/${u}/special-notes`,g=te?"PUT":"POST";te||(i.createdBy=c),i.updatedBy=c;const z=await fetch(v,{method:g,headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!z.ok){const I=await z.json().catch(()=>null);throw new Error((I==null?void 0:I.error)||`HTTP ${z.status}`)}h(),V(I=>I+1)}catch(i){d(i.message||(te?"수정 중 오류가 발생했습니다.":"등록 중 오류가 발생했습니다."))}finally{O(!1)}};t.useEffect(()=>{if(!N)return;const j=te=>{te.key==="Escape"&&h()};return window.addEventListener("keydown",j),()=>window.removeEventListener("keydown",j)},[N]);const P=()=>r({...dn}),h=()=>{y(!1),S(null),P(),d(null)},o=j=>{S(j??null),r({noteTitle:(j==null?void 0:j.noteTitle)??"",noteContent:(j==null?void 0:j.noteContent)??"",noteType:(j==null?void 0:j.noteType)??"",importanceLevel:(j==null?void 0:j.importanceLevel)??1}),d(null),y(!0)},M=j=>{C(j)},G=async()=>{if(!u||!l)return;const j=l;d(null),n(!0);try{const te=w||"system",c=await fetch(`/api/v1/customers/${u}/special-notes/${j.id}`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({updatedBy:te})});if(!c.ok){const i=await c.json().catch(()=>null);throw new Error((i==null?void 0:i.error)||`HTTP ${c.status}`)}ue("특이사항을 삭제했습니다."),F(i=>i.filter(v=>v.id!==j.id)),V(i=>i+1)}catch(te){d(te.message||"삭제 중 오류가 발생했습니다.")}finally{n(!1),C(null)}};t.useEffect(()=>{if(!Y)return;const j=window.setTimeout(()=>ue(null),4e3);return()=>window.clearTimeout(j)},[Y]);const H=j=>j==null?"unknown":j>=2?"high":j===1?"medium":"low";return e.jsxs("div",{className:"special-notes",children:[e.jsx("header",{className:"special-notes-header",children:e.jsx("button",{className:"btn btn-card btn-3d",type:"button",onClick:()=>o(),children:"신규"})}),X?e.jsx("div",{className:"empty-state",children:X}):B?e.jsx("div",{className:"empty-state",children:"특이사항을 불러오는 중입니다…"}):_.length===0?e.jsx("div",{className:"empty-state",children:"등록된 특이사항이 없습니다."}):e.jsx("div",{className:"special-notes-list",children:_.map(j=>e.jsxs("article",{className:"special-note-card",children:[e.jsxs("div",{className:"note-actions",children:[e.jsx("button",{type:"button",className:"note-edit-button","aria-label":"특이사항 수정",onClick:()=>o(j),children:"✎"}),e.jsx("button",{type:"button",className:"note-delete-button","aria-label":"특이사항 삭제",onClick:()=>M(j),children:"🗑"})]}),e.jsxs("div",{className:"note-top",children:[e.jsx("span",{className:`importance-dot level-${H(j.importanceLevel)}`,"aria-label":`중요도 ${un(j.importanceLevel)}`,children:un(j.importanceLevel)}),e.jsxs("div",{className:"note-meta-info",children:[e.jsx("span",{className:"note-type",children:da(j.noteType)}),e.jsx("strong",{className:"note-date",children:ua(j.updatedAt??j.createdAt)})]})]}),e.jsx("strong",{className:"note-title",children:j.noteTitle||"특이사항"}),e.jsx("p",{className:"note-content",children:j.noteContent}),e.jsxs("div",{className:"special-note-meta",children:[e.jsxs("span",{className:"meta-pill",children:[e.jsx("span",{className:"meta-icon edit-icon","aria-hidden":"true",children:"✎"}),e.jsx("span",{children:"수정자"}),e.jsx("strong",{children:j.updatedByName||j.updatedBy||"-"})]}),e.jsxs("span",{className:"meta-pill",children:[e.jsx("span",{className:"meta-icon user-icon","aria-hidden":"true",children:"👤"}),e.jsx("span",{children:"등록자"}),e.jsx("strong",{children:j.createdByName||j.createdBy})]})]})]},j.id))}),N&&e.jsx("div",{className:"overlay-modal",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"overlay-card",children:[e.jsx("button",{type:"button",className:"modal-close","aria-label":"닫기",onClick:h,children:"×"}),e.jsx("h4",{children:"특이사항 등록"}),e.jsxs("form",{className:"special-note-form",onSubmit:m,children:[e.jsxs("label",{children:[e.jsx("span",{children:"제목"}),e.jsx("input",{type:"text",value:x.noteTitle,onChange:j=>r(te=>({...te,noteTitle:j.target.value})),placeholder:"예: 신용이슈",required:!0})]}),e.jsxs("label",{children:[e.jsx("span",{children:"유형"}),e.jsxs("select",{value:x.noteType,onChange:j=>r(te=>({...te,noteType:j.target.value})),children:[e.jsx("option",{value:"",children:"선택 안 함"}),An.map(j=>e.jsx("option",{value:j.value,children:j.label},j.value))]})]}),e.jsxs("label",{children:[e.jsx("span",{children:"중요도"}),e.jsxs("select",{value:x.importanceLevel,onChange:j=>r(te=>({...te,importanceLevel:Number(j.target.value)})),children:[e.jsx("option",{value:2,children:"상"}),e.jsx("option",{value:1,children:"중"}),e.jsx("option",{value:0,children:"하"})]})]}),e.jsxs("label",{children:[e.jsx("span",{children:"내용"}),e.jsx("textarea",{value:x.noteContent,onChange:j=>r(te=>({...te,noteContent:j.target.value})),rows:4,required:!0})]}),b?e.jsx("div",{className:"empty-state",children:b}):null,e.jsxs("footer",{children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:()=>y(!1),disabled:A,children:"취소"}),e.jsx("button",{type:"submit",className:"btn btn-card btn-3d",disabled:A,children:A?"등록 중…":"등록"})]})]})]})}),Y&&e.jsxs("div",{className:"toast-message",children:[e.jsx("span",{children:Y}),e.jsx("button",{type:"button",onClick:()=>ue(null),children:"×"})]}),l&&e.jsx("div",{className:"confirm-overlay",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"confirm-card",children:[e.jsxs("p",{children:[e.jsx("strong",{children:l.noteTitle||"특이사항"}),"을(를) 삭제하시겠습니까?",e.jsx("br",{}),"삭제하면 되돌릴 수 없습니다."]}),e.jsxs("div",{className:"confirm-actions",children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:()=>C(null),disabled:ie,children:"취소"}),e.jsx("button",{type:"button",className:"btn btn-card btn-3d",onClick:G,disabled:ie,children:ie?"삭제 중…":"삭제"})]})]})})]})}function ha(){const[s,u]=t.useState(()=>{try{const R=localStorage.getItem("tnt.sales.selectedCustomer");return R?JSON.parse(R):null}catch{return null}}),[p,_]=t.useState("transactions"),[F,B]=t.useState(0);t.useEffect(()=>{try{const R=localStorage.getItem("tnt.sales.selectedCustomer");u(R?JSON.parse(R):null)}catch{u(null)}},[]),t.useEffect(()=>{const R=()=>{try{const se=localStorage.getItem("tnt.sales.selectedCustomer");u(se?JSON.parse(se):null)}catch{u(null)}};return window.addEventListener("tnt.sales.customer.selected",R),()=>window.removeEventListener("tnt.sales.customer.selected",R)},[]);const q=t.useMemo(()=>e.jsx(wn,{compact:!0,maxHeight:"32vh",context:"c360"}),[]),X=()=>!s||s.customerSeq==null?e.jsx("div",{className:"empty-state",children:"거래처를 선택하세요."}):p==="transactions"?e.jsx(Sn,{customerSeq:s.customerSeq}):p==="activities"?e.jsx(Xs,{customerSeq:s.customerSeq,customerId:s.customerId||"",hideRefresh:!0,enableContextMenu:!0}):p==="demand"?s.customerName?e.jsxs("div",{className:"c360-demand-stack",children:[e.jsx(Nn,{customerName:s.customerName,refreshTick:F}),e.jsx(kn,{customerName:s.customerName,refreshTick:F}),e.jsx(Cn,{customerName:s.customerName,customerSeq:s.customerSeq,empSeq:s.empSeq,empName:s.empName||void 0,onSuccess:()=>B(R=>R+1)})]}):e.jsx("div",{className:"empty-state",children:"수요정보를 보려면 거래처명을 확인하세요."}):p==="special-notes"?e.jsx(ma,{customerSeq:s.customerSeq,customerId:s.customerId,empName:s.empName}):p==="complaint"?e.jsx("div",{className:"card",style:{padding:12},children:e.jsx("div",{className:"muted",children:"Complaint 기능은 추후 제공될 예정입니다."})}):null;return e.jsxs("section",{className:"c360",children:[q,e.jsxs("section",{className:"card c360-panel",style:{marginTop:12,minHeight:240},children:[e.jsxs("div",{className:"tabs c360-tabs",children:[e.jsx("button",{className:p==="transactions"?"tab active":"tab",onClick:()=>_("transactions"),children:"거래 내역"}),e.jsx("button",{className:p==="activities"?"tab active":"tab",onClick:()=>_("activities"),children:"영업활동"}),e.jsx("button",{className:p==="demand"?"tab active":"tab",onClick:()=>_("demand"),children:"수요정보"}),e.jsx("button",{className:p==="special-notes"?"tab active":"tab",onClick:()=>_("special-notes"),children:"특이사항"}),e.jsx("button",{className:p==="complaint"?"tab active":"tab",onClick:()=>_("complaint"),children:"Complaint"})]}),e.jsx("div",{className:`c360-tab-panel-wrapper ${p==="demand"?"c360-demand-scroll":""}`,children:e.jsx("div",{className:"c360-tab-panel",children:X()})})]})]})}function In({open:s,onClose:u,leadId:p,leadName:_,targetKind:F,targetCompanyType:B,editId:q,initial:X,onSaved:R}){const{ref:se,style:V,bindHeader:N,bindContainer:y}=At("lead.activity",s,w=>{const l=document.querySelector(".pane.center"),C=l?l.getBoundingClientRect():null,Y=w.getBoundingClientRect(),ue=Y.width,ie=Y.height,n=C?C.left+(C.width-ue)/2:(window.innerWidth-ue)/2,m=C?C.top+Math.max(24,(C.height-ie)*.2):Math.max(24,(window.innerHeight-ie)*.2);return{x:n,y:m}},{persist:!1,resetOnOpen:!0});t.useEffect(()=>{if(!s)return;const w=l=>{l.key==="Escape"&&u()};return window.addEventListener("keydown",w,!0),()=>window.removeEventListener("keydown",w,!0)},[s,u]);const A=t.useCallback(()=>{q||u()},[q,u]),O=F||(p?"lead":void 0),b=(()=>{const w=(_??"").toString().trim();return w||((X==null?void 0:X.customerName)??"").toString().trim()})(),d=(B??"").toString().trim().toUpperCase(),x=O==="lead"?"잠":d.includes("TNT")?"T":d.includes("DYS")?"D":d?d.slice(0,1):"거",r=O==="lead"?"잠재고객":d||"거래처",T=O?e.jsx("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:22,height:22,borderRadius:"50%",fontSize:12,fontWeight:700,background:O==="lead"?"rgba(236,72,153,.2)":"rgba(59,130,246,.2)",color:O==="lead"?"#be185d":"#1d4ed8"},title:r,children:x}):null,S=q?"영업활동":"영업활동 등록";return s?e.jsxs("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:11e3,pointerEvents:"none"},children:[e.jsx("div",{style:{position:"absolute",inset:0,background:"rgba(0,0,0,.25)",pointerEvents:"none"}}),e.jsxs("div",{ref:se,className:"card",style:{...V,width:"min(880px, 96vw)",maxHeight:"86vh",overflow:"auto",padding:16,pointerEvents:"auto"},...y,children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:6,cursor:"move"},...N,children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[e.jsx("h3",{style:{margin:0},children:S}),b||T?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,fontSize:13,fontWeight:600,color:"var(--text)"},children:[b?e.jsx("span",{children:b}):null,T]}):null]}),e.jsx("span",{role:"button",tabIndex:0,className:"icon-button","aria-label":"닫기",title:"닫기",onClick:u,children:e.jsx("img",{src:dt,className:"icon",alt:"닫기"})})]}),e.jsx(Ns,{bare:!0,editId:q??void 0,leadId:p??void 0,initial:X,onNoticeClose:A,onSaved:w=>{R?R():u()}})]})]}):null}function bs(s){if(!s)return"";const u=new Date(s);if(isNaN(u.getTime()))return"";const p=u.getFullYear(),_=String(u.getMonth()+1).padStart(2,"0"),F=String(u.getDate()).padStart(2,"0");return`${p}-${_}-${F}`}function _s(s,u=0){if(!s)return;const p=s.trim();if(!p)return;const[_,F,B]=p.split("-").map(X=>Number(X));if(!_||!F||!B)return;const q=new Date(_,F-1,B,u,0,0,0);if(!isNaN(q.getTime()))return q.toISOString()}function mn(s){if(s.type==="customer"){const u=(s.companyType??"").toString().trim(),p=u||"거래처",_=u.toUpperCase(),F=_.includes("TNT")?"T":_.includes("DYS")?"D":(_||"거")[0];return{label:p,bg:"rgba(59,130,246,.12)",color:"#1d4ed8",icon:F,iconBg:"#1d4ed8"}}return{label:"잠재",bg:"rgba(236,72,153,.12)",color:"#be185d",icon:"잠",iconBg:"#be185d"}}function pa({onClose:s,prefillAt:u}){const[p,_]=ke.useState(""),[F,B]=ke.useState([]),[q,X]=ke.useState(!1),[R,se]=ke.useState(null),[V,N]=ke.useState([]),[y,A]=ke.useState(null);async function O(){X(!0),se(null);try{const r=new URL("/api/v1/customers",window.location.origin);r.searchParams.set("mineOnly","false"),p.trim()&&r.searchParams.set("name",p.trim()),r.searchParams.set("limit","100");try{console.debug("[customer search]",r.toString())}catch{}const T=await fetch(r.toString());if(!T.ok)throw new Error(`HTTP ${T.status}`);const S=await T.json(),w=Array.isArray(S)?S.map(l=>({customerSeq:(l==null?void 0:l.customerSeq)??(l==null?void 0:l.customer_seq)??null,customerId:(l==null?void 0:l.customerId)??(l==null?void 0:l.customer_id)??null,customerName:(l==null?void 0:l.customerName)??(l==null?void 0:l.customer_name)??null,ownerName:(l==null?void 0:l.ownerName)??(l==null?void 0:l.owner_name)??null,companyType:(l==null?void 0:l.companyType)??(l==null?void 0:l.company_type)??null})).sort((l,C)=>String(l.customerName||"").localeCompare(String(C.customerName||""),"ko-KR")):[];B(w)}catch(r){se((r==null?void 0:r.message)||"조회 실패"),B([])}finally{X(!1)}}function b(r){N(T=>{const w=T.some(l=>(l.customerId||"")===(r.customerId||""))?T:[r,...T];return!y&&w.length>0&&x(w[0]),w})}function d(r){if(N(T=>T.filter(S=>(S.customerId||"")!==(r.customerId||""))),y&&(y.customerId||"")===(r.customerId||"")){const T=V.filter(S=>(S.customerId||"")!==(r.customerId||""));x(T[0]||null)}}function x(r){A(r||null);try{r&&localStorage.setItem("tnt.sales.selectedCustomer",JSON.stringify({customerId:r.customerId||"",customerName:r.customerName||""}))}catch{}}return ke.useEffect(()=>{const r=T=>{T.key==="Escape"&&s()};return window.addEventListener("keydown",r,!0),()=>window.removeEventListener("keydown",r,!0)},[s]),e.jsxs("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:12e3},children:[e.jsx("div",{style:{position:"absolute",inset:0,background:"rgba(0,0,0,.35)"}}),e.jsxs("div",{className:"card",style:{position:"absolute",top:"6%",left:"50%",transform:"translateX(-50%)",width:"min(1200px,96vw)",maxHeight:"88vh",overflow:"auto",padding:12},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[e.jsx("h3",{style:{margin:0},children:"거래처 활동계획수립"}),e.jsx("button",{className:"btn-plain","aria-label":"닫기",title:"닫기",onClick:s,style:{width:32,height:32,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr",gap:12,minHeight:520,alignItems:"start"},children:[e.jsxs("div",{className:"card",style:{padding:12,overflow:"auto"},children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:8},children:[e.jsx("input",{className:"subject-input",placeholder:"거래처명",value:p,onChange:r=>_(r.target.value),onKeyDown:r=>{r.key==="Enter"&&O()},style:{flex:"0 0 220px",height:28,fontSize:12}}),e.jsx("span",{role:"button",tabIndex:0,className:"icon-button",title:"조회","aria-label":"조회",onClick:O,children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"icon",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("path",{d:"m21 21-4.35-4.35"})]})})]}),e.jsx("div",{className:"table-container",style:{maxHeight:240,overflowY:"auto",overflowX:"hidden",fontSize:12},children:F.length===0?e.jsx("div",{className:"empty-state",children:q?"불러오는 중…":R||"검색 결과가 없습니다"}):e.jsxs("table",{className:"table",style:{tableLayout:"fixed",width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:100},children:"회사구분"}),e.jsx("th",{style:{width:180},children:"거래처명"}),e.jsx("th",{style:{width:120},children:"대표자명"}),e.jsx("th",{style:{width:48}})]})}),e.jsx("tbody",{children:F.map((r,T)=>e.jsxs("tr",{children:[e.jsx("td",{title:r.companyType||"",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:r.companyType||""}),e.jsx("td",{title:r.customerName||"",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:r.customerName||""}),e.jsx("td",{title:r.ownerName||"",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:r.ownerName||""}),e.jsx("td",{style:{textAlign:"center"},children:e.jsx("span",{role:"button",tabIndex:0,className:"icon-button",title:"계획수립대상 담기","aria-label":"계획수립대상 담기",onClick:()=>b(r),children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"icon",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})})})]},T))})]})}),e.jsxs("div",{style:{marginTop:12,fontWeight:700},children:["계획수립대상(",V.length,")"]}),e.jsx("div",{className:"table-container",style:{maxHeight:220,overflowY:"auto",overflowX:"hidden",fontSize:12},children:V.length===0?e.jsx("div",{className:"empty-state",children:"담긴 거래처가 없습니다."}):e.jsxs("table",{className:"table",style:{tableLayout:"fixed",width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:100},children:"회사구분"}),e.jsx("th",{style:{width:180},children:"거래처명"}),e.jsx("th",{style:{width:120},children:"대표자명"}),e.jsx("th",{style:{width:60},children:"작업"})]})}),e.jsx("tbody",{children:V.map((r,T)=>e.jsxs("tr",{className:y&&(y.customerId||"")===(r.customerId||"")?"selected":"",onClick:()=>x(r),children:[e.jsx("td",{title:r.companyType||"",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:r.companyType||""}),e.jsx("td",{title:r.customerName||"",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:r.customerName||""}),e.jsx("td",{title:r.ownerName||"",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:r.ownerName||""}),e.jsx("td",{style:{textAlign:"center"},children:e.jsx("span",{role:"button",tabIndex:0,className:"icon-button",title:"삭제","aria-label":"삭제",onClick:S=>{S.stopPropagation(),d(r)},children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"icon",children:e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})})})})]},T))})]})})]}),e.jsxs("div",{className:"card plan-compact-card",style:{overflow:"auto"},children:[!y&&e.jsx("div",{className:"empty-state",children:"좌측에서 거래처를 선택해 주세요."}),e.jsx(Ns,{bare:!0,initial:{plannedStartAt:u||void 0,...y?{sfAccountId:y.customerId||"",customerName:y.customerName||"",subject:y!=null&&y.customerName?`${y.customerName} (활동계획) 으로 저장됩니다.`:""}:{}},lockSubject:!0,planMode:!0,multiTargets:V})]})]})]})]})}function ga(s){const u=new Date(s.getFullYear(),s.getMonth(),s.getDate()),p=u.getDay()||7;return p!==1&&u.setDate(u.getDate()-(p-1)),u.setHours(0,0,0,0),u}function ya(s){const u=new Date(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate())),p=u.getUTCDay()||7;u.setUTCDate(u.getUTCDate()+4-p);const _=new Date(Date.UTC(u.getUTCFullYear(),0,1)),F=Math.ceil(((u.getTime()-_.getTime())/864e5+1)/7);return{year:u.getUTCFullYear(),week:F}}function fa(s){const u=s.getFullYear(),p=s.getMonth()+1;return`${u}년 ${p}월`}function xa(s){return String(s.getDate())}const ja=Array.from({length:24},(s,u)=>u),us=60,hn=18,Hs=18;function va(){const[s,u]=ke.useState(()=>new Date),p=ke.useMemo(()=>ya(s),[s]),_=ke.useMemo(()=>ga(s),[s]),F=ke.useMemo(()=>{const Q=new Date(_);return Q.setDate(_.getDate()+6),Q.setHours(23,59,59,999),Q},[_]),B=ke.useMemo(()=>Array.from({length:7}).map((Q,xe)=>{const pe=new Date(_);return pe.setDate(_.getDate()+xe),pe}),[_]),q=ke.useRef(null),[X,R]=ke.useState(()=>({open:!1,x:0,y:0})),se=ke.useRef(null),[V,N]=ke.useState(!1),[y,A]=ke.useState(!1),[O,b]=ke.useState([]),[d,x]=ke.useState(""),[r,T]=ke.useState([]),[S,w]=ke.useState(""),[l,C]=ke.useState(""),[Y,ue]=ke.useState(""),[ie,n]=ke.useState(""),[m,P]=ke.useState(""),[h,o]=ke.useState(""),[M,G]=ke.useState(""),[H,j]=ke.useState(!1),[te,c]=ke.useState(null),[i,v]=ke.useState(null),[g,z]=ke.useState(null),[I,ge]=ke.useState(""),[re,Z]=ke.useState([]),[ye,L]=ke.useState(!1),[he,fe]=ke.useState(null),[Se,Ae]=ke.useState([]),[E,ve]=ke.useState(null),[ee,_e]=ke.useState([]),[Pe,Te]=ke.useState([]),[me,Ue]=ke.useState(null),[Je,ht]=ke.useState(null),[We,Ve]=ke.useState(""),[rt,jt]=ke.useState(null),[nt,ut]=ke.useState(""),[Ze,Tt]=ke.useState(void 0),[gt,Zt]=ke.useState(!1),es=ke.useRef(null),kt=ke.useMemo(()=>{const Q=new Array(24).fill(0).map(()=>us);if(!ee||ee.length===0)return Q;const xe=new Array(24).fill(0),pe=new Date(_.getFullYear(),_.getMonth(),_.getDate());for(let Me=0;Me<24;Me++){let le=0;for(let De=0;De<7;De++){const we=new Date(pe);we.setDate(we.getDate()+De);const ze=we.getFullYear(),Oe=we.getMonth(),He=we.getDate(),Fe=ee.reduce((ot,tt)=>{if(!tt.plannedStartAt)return ot;const Xe=new Date(tt.plannedStartAt);return Xe.getFullYear()===ze&&Xe.getMonth()===Oe&&Xe.getDate()===He&&Xe.getHours()===Me?ot+1:ot},0);Fe>le&&(le=Fe)}xe[Me]=le}for(let Me=0;Me<24;Me++){const le=Math.max(0,xe[Me]-1);Q[Me]=Math.min(us+le*Hs,us+64)}return Q},[ee,_]),St=ke.useMemo(()=>{const Q=[0];for(let xe=0;xe<24;xe++)Q[xe+1]=Q[xe]+(kt[xe]||us);return Q},[kt]),vt=ke.useCallback(async()=>{try{const Q=localStorage.getItem("tnt.sales.assigneeId")||"",xe=localStorage.getItem("tnt.sales.empId")||"",pe=new URL("/api/v1/sales-activities",window.location.origin);Q?pe.searchParams.set("assigneeId",Q):xe&&pe.searchParams.set("empId",xe),pe.searchParams.set("mineOnly","true"),pe.searchParams.set("start",_.toISOString()),pe.searchParams.set("end",F.toISOString()),pe.searchParams.set("onlyRoot","true"),pe.searchParams.set("_t",Date.now().toString());const Me=await fetch(pe.toString(),{cache:"no-cache"});if(!Me.ok)throw new Error(`HTTP ${Me.status}`);const le=await Me.json(),De=Array.isArray(le)?le:[];_e(De.map(we=>{const ze=we.plannedStartAt||we.planned_start_at,Oe=(we.activityStatus||we.activity_status||"").toString().toLowerCase(),He=Oe==="completed"||Oe==="완료";return{id:Number(we.id),subject:we.subject,description:we.description,activityType:we.activityType||we.activity_type,activityStatus:we.activityStatus||we.activity_status,channel:we.channel,plannedStartAt:ze?new Date(ze).toISOString():void 0,plannedEndAt:we.plannedEndAt||we.planned_end_at||null,actualStartAt:we.actualStartAt||we.actual_start_at||void 0,sfAccountId:we.sfAccountId||we.sf_account_id||void 0,customerName:we.customerName||we.customer_name||"",leadId:we.sfLeadId||we.sf_lead_id||null,companyType:we.companyType||we.company_type||we.companyTypeName||we.company_type_name||null,isCompleted:He}}))}catch{_e([])}},[_,F]),_t=ke.useCallback(async()=>{try{const Q=localStorage.getItem("tnt.sales.assigneeId")||localStorage.getItem("tnt.sales.empId")||"";if(!Q){Te([]);return}const xe=new URL("/api/v1/region-activity-plans",window.location.origin);xe.searchParams.set("assigneeId",Q),xe.searchParams.set("start",_.toISOString()),xe.searchParams.set("end",F.toISOString());const pe=await fetch(xe.toString());if(!pe.ok)throw new Error(`HTTP ${pe.status}`);const Me=await pe.json(),le=Array.isArray(Me)?Me:[];Te(le.map(De=>({id:Number(De.id),subject:De.subject,plannedStartAt:De.planned_start_at||De.plannedStartAt||null,plannedEndAt:De.planned_end_at||De.plannedEndAt||null,actualStartAt:De.actual_start_at||De.actualStartAt||null,actualEndAt:De.actual_end_at||De.actualEndAt||null,isCompleted:!!(De.actual_start_at||De.actualStartAt||De.actual_end_at||De.actualEndAt)})))}catch{Te([])}},[_,F]);ke.useEffect(()=>{vt()},[vt]),ke.useEffect(()=>{_t()},[_t]),ke.useEffect(()=>{const Q=()=>{try{vt()}catch{}};return window.addEventListener("tnt.sales.activity.updated",Q),()=>window.removeEventListener("tnt.sales.activity.updated",Q)},[vt]);const is=`${p.week}주차`,ls=fa(s),lt=ke.useCallback(()=>{u(Q=>{const xe=new Date(Q);return xe.setDate(xe.getDate()-7),xe})},[]),Rt=ke.useCallback(()=>{u(Q=>{const xe=new Date(Q);return xe.setDate(xe.getDate()+7),xe})},[]),ps=ke.useCallback(()=>{u(new Date)},[]);ke.useEffect(()=>{function Q(pe){let Me=pe;for(;Me;){const le=(Me.tagName||"").toLowerCase();if(["input","textarea","select","button","label","a"].includes(le)||Me!=null&&Me.isContentEditable)return!0;Me=Me.parentElement}return!1}function xe(pe){const Me=pe.target;Q(Me)||Q(document.activeElement)||(pe.key==="ArrowLeft"?(pe.preventDefault(),lt()):pe.key==="ArrowRight"&&(pe.preventDefault(),Rt()))}return window.addEventListener("keydown",xe,!0),()=>window.removeEventListener("keydown",xe,!0)},[lt,Rt]);const qt=ke.useRef(!1);ke.useEffect(()=>{if(qt.current)return;const Q=q.current;if(!Q)return;const xe=St[7]||7*us;let pe=0;const Me=30,le=()=>{if(Q){if(Q.scrollTop=xe,pe+=1,Math.abs(Q.scrollTop-xe)<2||pe>=Me){qt.current=!0;return}setTimeout(()=>requestAnimationFrame(le),50)}};requestAnimationFrame(le)},[St]),ke.useEffect(()=>{if(!X.open)return;const Q=pe=>{const Me=(pe==null?void 0:pe.target)||null;se.current&&Me&&se.current.contains(Me)||R({open:!1,x:0,y:0})},xe=pe=>{pe.key==="Escape"&&Q()};return window.addEventListener("click",Q,!0),window.addEventListener("contextmenu",Q,!0),window.addEventListener("keydown",xe,!0),()=>{window.removeEventListener("click",Q,!0),window.removeEventListener("contextmenu",Q,!0),window.removeEventListener("keydown",xe,!0)}},[X.open]);const Wt=ke.useCallback(async()=>{try{const Q=await fetch("/api/v1/address/provinces"),xe=Q.ok?await Q.json():[],pe=Array.isArray(xe)?xe.filter(Boolean):[];b(pe)}catch{b([])}},[]),Ct=ke.useCallback(async Q=>{try{if(!Q){T([]);return}const xe=new URL("/api/v1/address/districts",window.location.origin);xe.searchParams.set("province",Q);const pe=await fetch(xe.toString()),Me=pe.ok?await pe.json():[],le=Array.isArray(Me)?Me.filter(Boolean):[];T(le)}catch{T([])}},[]),$t=ke.useCallback(()=>{C(""),ue(""),n(""),P(""),o(""),G(""),c(null),Ae([]),z(null)},[]),Qe=ke.useCallback(()=>{$t();const Q=E?bs(E):"";n(Q),x(""),w(""),T([]),A(!0),Wt()},[E,Wt,$t]),Et=ke.useCallback(()=>{$t(),v(null),A(!1)},[$t]);ke.useEffect(()=>{if(!y)return;const Q=xe=>{xe.key==="Escape"&&(xe.preventDefault(),Et())};return window.addEventListener("keydown",Q,!0),()=>window.removeEventListener("keydown",Q,!0)},[y,Et]);const ts=ke.useCallback(()=>{try{return localStorage.getItem("tnt.sales.assigneeId")||localStorage.getItem("tnt.sales.empId")||""}catch{return""}},[]);ke.useEffect(()=>{if(!y||l&&l.trim().length>0||!d)return;const Q=S?`${d} ${S}`:d;C(`${Q} 지역활동`)},[y,l,d,S]);async function Bt(Q){try{const xe=await fetch(`/api/v1/region-activity-plans/${Q}`);if(!xe.ok)throw new Error(`HTTP ${xe.status}`);const pe=await xe.json();$t(),z(Q),C((pe==null?void 0:pe.subject)||""),ue((pe==null?void 0:pe.description)||"");const Me=(pe==null?void 0:pe.addrProvinceName)||(pe==null?void 0:pe.addr_province_name)||"",le=(pe==null?void 0:pe.addrDistrictName)||(pe==null?void 0:pe.addr_district_name)||"";await Wt(),x(Me),Me?await Ct(Me):T([]),w(le),n(pe!=null&&pe.planned_start_at?bs(pe.planned_start_at):""),P(pe!=null&&pe.planned_end_at?bs(pe.planned_end_at):""),o(pe!=null&&pe.actual_start_at?bs(pe.actual_start_at):""),G(pe!=null&&pe.actual_end_at?bs(pe.actual_end_at):"");const De=Array.isArray(pe==null?void 0:pe.targets)?pe.targets:[];Ae(De.map((we,ze)=>{const Oe=(we==null?void 0:we.customerId)||(we==null?void 0:we.customer_id)||"",He=(we==null?void 0:we.leadId)||(we==null?void 0:we.lead_id)||"",Fe=Oe?"customer":"lead";return{key:Oe?`customer-${Oe}`:He?`lead-${He}`:`target-${ze}-${Q}`,type:Fe,name:(we==null?void 0:we.displayName)||(we==null?void 0:we.display_name)||Oe||He||"(대상)",companyType:(we==null?void 0:we.companyType)||(we==null?void 0:we.company_type)||null,customerId:Oe||void 0,leadId:He||void 0}})),A(!0)}catch(xe){window.alert((xe==null?void 0:xe.message)||"지역활동 계획을 불러오지 못했습니다.")}}async function gs(){const Q=l.trim();if(!Q){c("제목을 입력해 주세요."),v(null);return}if(!d){c("방문 도(Province)를 선택해 주세요."),v(null);return}if(!S){c("방문 시/군/구(District)를 선택해 주세요."),v(null);return}const xe=ts().trim();if(!xe){c("담당자 정보를 확인할 수 없습니다. 다시 로그인해 주세요."),v(null);return}const pe={subject:Q,addrProvinceName:d,addrDistrictName:S,assigneeId:xe},Me=Y==null?void 0:Y.trim();Me&&(pe.description=Me);const le=_s(ie,8),De=_s(m);le&&(pe.plannedStartAt=le),De&&(pe.plannedEndAt=De);const we=_s(h),ze=_s(M);we&&(pe.actualStartAt=we),ze&&(pe.actualEndAt=ze);const Oe=Se.map(Fe=>Fe.type==="customer"&&Fe.customerId?{customerId:Fe.customerId}:Fe.type==="lead"&&Fe.leadId?{leadId:Fe.leadId}:null).filter(Boolean);Oe.length>0&&(pe.targets=Oe);const He=Number(xe);Number.isNaN(He)||(g||(pe.createdBy=He),pe.updatedBy=He),j(!0),c(null),v(null);try{const Fe=g?`/api/v1/region-activity-plans/${g}`:"/api/v1/region-activity-plans",tt=await fetch(Fe,{method:g?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(pe)});let Xe=null;try{Xe=await tt.json()}catch{Xe=null}if(!tt.ok){const xt=(Xe==null?void 0:Xe.message)||(Xe==null?void 0:Xe.error)||`HTTP ${tt.status}`;throw new Error(xt)}v(g?"지역활동 계획이 수정되었습니다.":"지역활동 계획이 등록되었습니다."),c(null),await _t()}catch(Fe){c((Fe==null?void 0:Fe.message)||"등록에 실패했습니다."),v(null)}finally{j(!1)}}async function Ut(){const Q=I.trim();if(!Q){fe("검색어를 입력해 주세요."),Z([]);return}L(!0),fe(null);try{const[xe,pe]=await Promise.all([(async()=>{const le=new URL("/api/v1/customers",window.location.origin);le.searchParams.set("mineOnly","false"),le.searchParams.set("limit","50"),le.searchParams.set("name",Q);const De=await fetch(le.toString());if(!De.ok)throw new Error(`거래처 조회 실패 (HTTP ${De.status})`);const we=await De.json();return Array.isArray(we)?we:[]})(),(async()=>{const le=new URL("/api/v1/leads",window.location.origin);le.searchParams.set("limit","50"),le.searchParams.set("company_name",Q);const De=await fetch(le.toString());if(!De.ok)throw new Error(`잠재고객 조회 실패 (HTTP ${De.status})`);const we=await De.json();return Array.isArray(we)?we:[]})()]),Me=[...xe.map((le,De)=>{const we=(le==null?void 0:le.customerId)??(le==null?void 0:le.customer_id)??(le==null?void 0:le.customerSeq)??(le==null?void 0:le.customer_seq)??"",ze=we!=null?String(we).trim():"",Oe=ze?`customer-${ze}`:`customer-${De}-${Math.random().toString(36).slice(2)}`,He=(le==null?void 0:le.companyType)??(le==null?void 0:le.company_type)??(le==null?void 0:le.companyTypeName)??(le==null?void 0:le.company_type_name)??(le==null?void 0:le.companyClass)??(le==null?void 0:le.company_class)??(le==null?void 0:le.companyGroup)??(le==null?void 0:le.company_group)??null;return{key:Oe,type:"customer",name:(le==null?void 0:le.customerName)??(le==null?void 0:le.customer_name)??"(이름 없음)",companyType:He!=null?String(He):null,customerId:ze||void 0}}),...pe.map((le,De)=>{const we=(le==null?void 0:le.id)??(le==null?void 0:le.lead_id)??"",ze=we!=null?String(we).trim():"";return{key:ze?`lead-${ze}`:`lead-${De}-${Math.random().toString(36).slice(2)}`,type:"lead",name:(le==null?void 0:le.company_name)??(le==null?void 0:le.companyName)??(le==null?void 0:le.contact_name)??"(이름 없음)",leadId:ze||void 0}})];Z(Me),Me.length===0&&fe("조회 결과가 없습니다.")}catch(xe){fe((xe==null?void 0:xe.message)||"조회에 실패했습니다."),Z([])}finally{L(!1)}}function ss(Q){Ae(xe=>xe.some(pe=>pe.key===Q.key)?xe:[...xe,Q])}function zt(Q){Ae(xe=>xe.filter(pe=>pe.key!==Q))}const ns=ke.useCallback(Q=>{Ue(Q.id);const xe=Q.leadId?"lead":"customer";es.current!==Q.id?(ht(Q.leadId??null),Ve(Q.customerName||""),jt(xe),ut(xe==="customer"&&Q.companyType||""),Tt({id:Q.id,subject:Q.subject,description:Q.description,activityType:Q.activityType,activityStatus:Q.activityStatus,channel:Q.channel,plannedStartAt:Q.plannedStartAt,actualStartAt:Q.actualStartAt,sfAccountId:Q.sfAccountId,customerName:Q.customerName}),es.current=Q.id):jt(xe),Zt(!0)},[]),et=ke.useCallback(()=>{Zt(!1),Ue(null),ht(null),Ve(""),jt(null),ut(""),Tt(void 0),es.current=null},[]),pt=ke.useMemo(()=>{const Q=ee.length,xe=ee.filter(ze=>ze.isCompleted).length,pe=Pe.length,Me=Pe.filter(ze=>ze.isCompleted).length,le=Q+pe,De=xe+Me,we=le>0?Math.round(De/le*100):0;return{customerTotal:Q,customerCompleted:xe,regionTotal:pe,regionCompleted:Me,totalPlanned:le,totalCompleted:De,achievementRate:we}},[ee,Pe]);return e.jsxs("section",{className:"activity-plan-page",children:[e.jsx("div",{className:"card",style:{padding:"12px 16px",marginBottom:12,flexShrink:0},children:e.jsxs("div",{style:{display:"flex",gap:4,alignItems:"center"},children:[e.jsx("button",{onClick:lt,title:"이전 주",style:{width:32,height:32,padding:0,display:"flex",alignItems:"center",justifyContent:"center",background:"transparent",border:"none",borderRadius:"4px",cursor:"pointer",color:"var(--text)",transition:"background-color 0.2s"},onMouseEnter:Q=>Q.currentTarget.style.backgroundColor="var(--hover)",onMouseLeave:Q=>Q.currentTarget.style.backgroundColor="transparent",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"15 18 9 12 15 6"})})}),e.jsx("button",{onClick:Rt,title:"다음 주",style:{width:32,height:32,padding:0,display:"flex",alignItems:"center",justifyContent:"center",background:"transparent",border:"none",borderRadius:"4px",cursor:"pointer",color:"var(--text)",transition:"background-color 0.2s"},onMouseEnter:Q=>Q.currentTarget.style.backgroundColor="var(--hover)",onMouseLeave:Q=>Q.currentTarget.style.backgroundColor="transparent",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"9 18 15 12 9 6"})})}),e.jsx("button",{className:"btn",onClick:ps,style:{marginLeft:4},children:"오늘"}),e.jsxs("span",{className:"badge",style:{marginLeft:"auto"},children:[ls," ",is]})]})}),e.jsxs("div",{className:"activity-kpi-grid",children:[e.jsxs("div",{className:"card kpi-card",style:{background:"linear-gradient(135deg, rgba(59,130,246,0.1) 0%, rgba(147,51,234,0.1) 100%)"},children:[e.jsx("div",{className:"kpi-label",children:"주간 달성률"}),e.jsxs("div",{className:"kpi-value",children:[e.jsx("span",{className:"kpi-number",children:pt.achievementRate}),e.jsx("span",{className:"kpi-unit",children:"%"})]}),e.jsxs("div",{className:"kpi-desc",children:["목표 ",pt.totalPlanned,"건 / 완료 ",pt.totalCompleted,"건"]})]}),e.jsxs("div",{className:"card kpi-card",children:[e.jsx("div",{className:"kpi-label",children:"거래처 활동"}),e.jsxs("div",{className:"kpi-stats",children:[e.jsxs("div",{children:[e.jsx("div",{className:"kpi-stat-label",style:{color:"#dc2626"},children:"목표"}),e.jsx("div",{className:"kpi-stat-value",style:{color:"#dc2626"},children:pt.customerTotal})]}),e.jsx("div",{className:"kpi-arrow",children:"→"}),e.jsxs("div",{children:[e.jsx("div",{className:"kpi-stat-label",style:{color:"#2563eb"},children:"완료"}),e.jsx("div",{className:"kpi-stat-value",style:{color:"#2563eb"},children:pt.customerCompleted})]})]}),e.jsx("div",{className:"kpi-progress",children:e.jsx("div",{style:{width:`${pt.customerTotal>0?pt.customerCompleted/pt.customerTotal*100:0}%`,background:"linear-gradient(90deg, #dc2626 0%, #2563eb 100%)"}})})]}),e.jsxs("div",{className:"card kpi-card",children:[e.jsx("div",{className:"kpi-label",children:"지역 활동"}),e.jsxs("div",{className:"kpi-stats",children:[e.jsxs("div",{children:[e.jsx("div",{className:"kpi-stat-label",style:{color:"#dc2626"},children:"목표"}),e.jsx("div",{className:"kpi-stat-value",style:{color:"#dc2626"},children:pt.regionTotal})]}),e.jsx("div",{className:"kpi-arrow",children:"→"}),e.jsxs("div",{children:[e.jsx("div",{className:"kpi-stat-label",style:{color:"#10b981"},children:"완료"}),e.jsx("div",{className:"kpi-stat-value",style:{color:"#10b981"},children:pt.regionCompleted})]})]}),e.jsx("div",{className:"kpi-progress",children:e.jsx("div",{style:{width:`${pt.regionTotal>0?pt.regionCompleted/pt.regionTotal*100:0}%`,background:"linear-gradient(90deg, #dc2626 0%, #10b981 100%)"}})})]})]}),e.jsxs("div",{className:"card",style:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column",minHeight:0},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"60px repeat(7, 1fr)",background:"var(--panel)",borderBottom:"1px solid var(--border)",flex:"0 0 auto"},children:[e.jsx("div",{style:{padding:8,fontSize:12,color:"var(--text-muted)"},children:"시간"}),B.map((Q,xe)=>e.jsx("div",{style:{padding:8,textAlign:"center",borderLeft:xe>0?"1px solid var(--border)":"none"},children:e.jsxs("div",{style:{fontSize:12,color:"var(--text-muted)"},children:[["월","화","수","목","금","토","일"][xe]," ",xa(Q)]})},xe))]}),e.jsx("div",{ref:q,className:"calendar-scroll",onContextMenu:Q=>{Q.preventDefault();const xe=Q.target;let pe=null,Me=null;const le=ze=>{var tt,Xe;if(!ze)return!1;const Oe=ze.getAttribute("data-day")||((tt=ze.dataset)==null?void 0:tt.day),He=ze.getAttribute("data-hour")||((Xe=ze.dataset)==null?void 0:Xe.hour),Fe=Oe?parseInt(Oe,10):NaN,ot=He?parseInt(He,10):NaN;return!Number.isNaN(Fe)&&!Number.isNaN(ot)?(pe=Fe,Me=ot,!0):!1},De=xe?xe.closest(".week-event"):null,we=xe?xe.closest(".week-cell"):null;if(!(le(De)||le(we))){const ze=q.current;if(ze){const Oe=ze.getBoundingClientRect(),He=Q.clientX-Oe.left,Fe=Q.clientY-Oe.top+ze.scrollTop,ot=He-60,tt=Math.max(1,(Oe.width-60)/7),Xe=Math.floor(ot/tt);let Ht=0;for(let xt=0;xt<24&&Fe>=St[xt];xt++)Ht=xt;Xe>=0&&Xe<=6&&Ht>=0&&Ht<=23&&(pe=Xe,Me=Ht)}}if(pe!=null&&Me!=null){const ze=new Date(_);ze.setDate(ze.getDate()+pe),ze.setHours(Me,0,0,0),ve(new Date(ze).toISOString())}R({open:!0,x:Q.clientX,y:Q.clientY})},style:{flex:1,overflowY:"scroll",overflowX:"hidden",minHeight:0},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"60px repeat(7, 1fr)",gridTemplateRows:kt.map(Q=>`${Q}px`).join(" "),position:"relative"},children:[ja.map(Q=>e.jsxs(ke.Fragment,{children:[e.jsxs("div",{style:{gridColumn:"1",gridRow:`${Q+1}`,height:kt[Q]||us,padding:"4px 8px",fontSize:11,color:"var(--text-muted)",borderTop:"1px solid var(--border)"},children:[String(Q).padStart(2,"0"),":00"]}),B.map((xe,pe)=>e.jsx("div",{className:"week-cell","data-day":pe,"data-hour":Q,style:{gridColumn:`${pe+2}`,gridRow:`${Q+1}`,borderTop:"1px solid var(--border)",borderLeft:"1px solid var(--border)"}},`${Q}-${pe}`))]},Q)),(()=>{const Q=new Map,xe=ee.map(le=>{if(!le.plannedStartAt)return null;const De=new Date(le.plannedStartAt),we=Math.floor((new Date(De.getFullYear(),De.getMonth(),De.getDate()).getTime()-new Date(_.getFullYear(),_.getMonth(),_.getDate()).getTime())/864e5);if(we<0||we>6)return null;const ze=De.getHours(),Oe=`${we}-${ze}`,He=Q.get(Oe)||0;Q.set(Oe,He+1);const Fe=le.isCompleted?"(완)":"(계)",ot=le.isCompleted?"#2563eb":"#dc2626";return e.jsxs("div",{className:"week-event","data-day":we,"data-hour":ze,onDoubleClick:tt=>{tt.stopPropagation(),ns(le)},style:{gridColumn:`${we+2}`,gridRow:`${ze+1}`,height:hn,padding:"0 6px",fontSize:10,background:"rgba(59,130,246,.12)",border:"1px solid var(--accent)",borderRadius:6,margin:1,marginTop:He*Hs,display:"flex",alignItems:"center",justifyContent:"flex-start",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",textAlign:"left"},title:le.subject||"",children:[e.jsx("span",{style:{color:ot,fontWeight:700,marginRight:4},children:Fe}),e.jsx("span",{children:le.subject||"(제목 없음)"})]},`ev-${le.id}-${He}`)}),pe=new Date(_.getFullYear(),_.getMonth(),_.getDate()),Me=Pe.map(le=>{if(!le.plannedStartAt)return null;const De=new Date(le.plannedStartAt);if(isNaN(De.getTime()))return null;const we=Math.floor((new Date(De.getFullYear(),De.getMonth(),De.getDate()).getTime()-pe.getTime())/864e5);if(we<0||we>6)return null;const ze=De.getHours(),Oe=`${we}-${ze}`,He=Q.get(Oe)||0;Q.set(Oe,He+1);const Fe=le.isCompleted||!!le.actualEndAt,ot=Fe?"(완)":"(계)",tt=Fe?"#2563eb":"#dc2626";return e.jsxs("div",{className:"week-event","data-day":we,"data-hour":ze,onDoubleClick:Xe=>{Xe.stopPropagation(),Bt(le.id)},style:{gridColumn:`${we+2}`,gridRow:`${ze+1}`,height:hn,padding:"0 6px",fontSize:10,background:"rgba(16,185,129,.18)",border:"1px solid rgba(16,185,129,.6)",borderRadius:6,margin:1,marginTop:He*Hs,display:"flex",alignItems:"center",justifyContent:"flex-start",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",textAlign:"left"},title:le.subject||"",children:[e.jsx("span",{style:{color:tt,fontWeight:700,marginRight:4},children:ot}),e.jsx("span",{children:le.subject||"(지역활동)"})]},`region-${le.id}-${we}-${ze}-${He}`)}).filter(Boolean);return[...xe,...Me]})()]})})]}),X.open&&e.jsxs("div",{className:"context-menu",role:"menu",ref:se,style:{position:"fixed",left:X.x+6,top:X.y+6,zIndex:20050},children:[e.jsx("button",{className:"context-item",role:"menuitem",onClick:()=>{R({open:!1,x:0,y:0}),N(!0)},children:"거래처활동"}),e.jsx("button",{className:"context-item",role:"menuitem",onClick:()=>{R({open:!1,x:0,y:0}),Qe()},children:"지역활동"})]}),V&&e.jsx(pa,{onClose:()=>N(!1),prefillAt:E}),y&&e.jsxs("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:13e3},children:[e.jsx("div",{style:{position:"absolute",inset:0,background:"rgba(0,0,0,.35)"}}),e.jsx("div",{style:{position:"absolute",top:"8%",left:"50%",transform:"translateX(-50%)",width:"min(920px,96vw)",maxHeight:"84vh"},children:e.jsxs("div",{className:"card plan-compact-card",style:{height:"100%",overflow:"auto",padding:12,position:"relative"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[e.jsx("h3",{style:{margin:0},children:"지역활동 계획"}),e.jsx("span",{role:"button",tabIndex:0,className:"icon-button","aria-label":"닫기",title:"닫기",onClick:Et,children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"icon",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"minmax(0,1fr) minmax(0,380px)",gap:12},children:[e.jsxs("div",{className:"plan-compact",style:{display:"flex",flexDirection:"column",gap:8},children:[e.jsxs("div",{className:"field",style:{display:"grid",gridTemplateColumns:"90px 1fr",gap:6,alignItems:"center"},children:[e.jsx("label",{children:"제목"}),e.jsx("input",{className:"subject-input",value:l,onChange:Q=>C(Q.target.value),placeholder:"예: 서울 강남구 지역활동"})]}),e.jsxs("div",{className:"field",style:{display:"grid",gridTemplateColumns:"90px 1fr",gap:6,alignItems:"center"},children:[e.jsx("label",{children:"도 선택"}),e.jsxs("select",{value:d,onChange:Q=>{const xe=Q.target.value;x(xe),w(""),Ct(xe)},style:{height:32},children:[e.jsx("option",{value:"",children:"— 선택 —"}),O.map((Q,xe)=>e.jsx("option",{value:Q,children:Q},`${Q}-${xe}`))]})]}),e.jsxs("div",{className:"field",style:{display:"grid",gridTemplateColumns:"90px 1fr",gap:6,alignItems:"center"},children:[e.jsx("label",{children:"시군 선택"}),e.jsxs("select",{value:S,onChange:Q=>w(Q.target.value),disabled:!d,style:{height:32},children:[e.jsx("option",{value:"",children:"— 선택 —"}),r.map((Q,xe)=>e.jsx("option",{value:Q,children:Q},`${Q}-${xe}`))]})]}),e.jsxs("div",{className:"field",style:{display:"grid",gridTemplateColumns:"90px 1fr",gap:6,alignItems:"center"},children:[e.jsx("label",{children:"계획 일정"}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:6},children:e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",flexWrap:"wrap"},children:[e.jsx("div",{style:{flex:1,minWidth:160,display:"flex",gap:4},children:e.jsx("input",{className:"subject-input",type:"date",value:ie,onChange:Q=>n(Q.target.value),style:{flex:1}})}),e.jsx("span",{style:{fontSize:12,color:"var(--text-muted)"},children:"~"}),e.jsx("div",{style:{flex:1,minWidth:160,display:"flex",gap:4},children:e.jsx("input",{className:"subject-input",type:"date",value:m,onChange:Q=>P(Q.target.value),style:{flex:1}})})]})})]}),e.jsxs("div",{className:"field",style:{display:"grid",gridTemplateColumns:"90px 1fr",gap:6,alignItems:"center"},children:[e.jsx("label",{children:"완료일"}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:6},children:e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",flexWrap:"wrap"},children:[e.jsx("div",{style:{flex:1,minWidth:160,display:"flex",gap:4},children:e.jsx("input",{className:"subject-input",type:"date",value:h,onChange:Q=>o(Q.target.value),style:{flex:1}})}),e.jsx("span",{style:{fontSize:12,color:"var(--text-muted)"},children:"~"}),e.jsx("div",{style:{flex:1,minWidth:160,display:"flex",gap:4},children:e.jsx("input",{className:"subject-input",type:"date",value:M,onChange:Q=>G(Q.target.value),style:{flex:1}})})]})})]}),e.jsxs("div",{className:"field",style:{display:"flex",flexDirection:"column",gap:4},children:[e.jsx("label",{children:"활동계획/설명"}),e.jsx("textarea",{value:Y,onChange:Q=>ue(Q.target.value),placeholder:"방문 목적, 세부 활동계획, 비고 등을 입력해 주세요.",rows:4,style:{resize:"vertical",padding:8}})]})]}),e.jsxs("div",{className:"card",style:{padding:10,background:"var(--panel-2)",borderRadius:12,display:"flex",flexDirection:"column",gap:8,minHeight:0},children:[e.jsx("div",{style:{fontWeight:600,fontSize:13},children:"영업대상 조회/등록"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[e.jsx("input",{className:"subject-input",placeholder:"거래처 또는 잠재고객명으로 검색",value:I,onChange:Q=>ge(Q.target.value),onKeyDown:Q=>{Q.key==="Enter"&&(Q.preventDefault(),Ut())}}),e.jsx("button",{className:"btn",type:"button",onClick:Ut,disabled:ye,children:"조회"})]}),e.jsx("div",{className:"table-container",style:{maxHeight:220,overflowY:"auto",overflowX:"hidden",background:"var(--panel)",borderRadius:8,padding:6},children:ye?e.jsx("div",{className:"empty-state",children:"조회 중…"}):re.length===0?e.jsx("div",{className:"empty-state",children:he||"조회 결과가 없습니다."}):re.map(Q=>{const xe=mn(Q);return e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"6px 4px",borderBottom:"1px solid var(--border)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,minWidth:0},children:[e.jsx("span",{title:Q.name,style:{fontSize:13,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",flex:1},children:Q.name}),e.jsx("span",{title:xe.label,style:{width:22,height:22,borderRadius:"50%",background:xe.bg,color:xe.color,fontWeight:700,display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:12},children:e.jsx("span",{style:{width:18,height:18,borderRadius:"50%",background:xe.iconBg,color:"#fff",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:11},children:xe.icon})})]}),e.jsx("button",{className:"btn-ghost",type:"button",onClick:()=>ss(Q),style:{width:28,height:28,display:"inline-flex",alignItems:"center",justifyContent:"center",border:"none"},"aria-label":"등록",children:e.jsx("span",{style:{fontSize:18,lineHeight:1},children:"+"})})]},Q.key)})}),e.jsxs("div",{style:{fontWeight:600,fontSize:12},children:["등록된 대상 (",Se.length,")"]}),e.jsx("div",{className:"table-container",style:{maxHeight:140,overflowY:"auto",background:"var(--panel)",borderRadius:8,padding:6},children:Se.length===0?e.jsx("div",{className:"empty-state",children:"등록된 대상이 없습니다."}):Se.map(Q=>{const xe=mn(Q);return e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"4px 2px",borderBottom:"1px dashed var(--border)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,minWidth:0},children:[e.jsx("span",{title:Q.name,style:{fontSize:13,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",flex:1},children:Q.name}),e.jsx("span",{title:xe.label,style:{width:22,height:22,borderRadius:"50%",background:xe.bg,color:xe.color,fontWeight:700,display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:12},children:e.jsx("span",{style:{width:18,height:18,borderRadius:"50%",background:xe.iconBg,color:"#fff",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:11},children:xe.icon})})]}),e.jsx("button",{className:"btn-ghost",type:"button",onClick:()=>zt(Q.key),style:{width:28,height:28,display:"inline-flex",alignItems:"center",justifyContent:"center",border:"none"},"aria-label":"삭제",children:e.jsx("span",{style:{fontSize:22,lineHeight:1},children:"−"})})]},`selected-${Q.key}`)})})]})]}),te&&e.jsx("div",{style:{color:"#dc2626",fontSize:12,marginTop:8},children:te}),i&&e.jsxs("div",{style:{marginTop:8,display:"flex",alignItems:"center",gap:8,border:"1px solid #10b981",background:"#ecfdf5",padding:"6px 10px",borderRadius:6},children:[e.jsx("span",{style:{color:"#047857",fontWeight:600},children:i}),e.jsx("button",{className:"btn btn-plain",type:"button",onClick:()=>v(null),style:{padding:"2px 8px",fontSize:12},children:"확인"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:12},children:[e.jsx("button",{className:"btn",type:"button",onClick:Et,children:"취소"}),e.jsx("button",{className:"btn btn-accent",type:"button",onClick:gs,disabled:H,children:H?"저장 중…":"저장"})]})]})})]}),e.jsx(In,{open:gt&&me!=null,onClose:et,editId:me??void 0,leadId:Je&&/^\d+$/.test(Je)?Number(Je):void 0,leadName:We,targetKind:rt??void 0,targetCompanyType:nt||void 0,initial:Ze,onSaved:()=>{setTimeout(()=>vt(),50)}})]})}function ba(){const[s,u]=t.useState(()=>{try{const X=localStorage.getItem("tnt.sales.selectedCustomer");return X?JSON.parse(X):null}catch{return null}}),[p,_]=t.useState("transactions"),[F,B]=t.useState(0);t.useEffect(()=>{try{const X=localStorage.getItem("tnt.sales.selectedCustomer");u(X?JSON.parse(X):null)}catch{u(null)}},[]);const q=t.useMemo(()=>s?e.jsx("section",{className:"card compact-form",children:e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"거래처번호"}),e.jsx(yt,{value:s.customerId||"",readOnly:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"거래처명"}),e.jsx(yt,{value:s.customerName||"",readOnly:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"정식명"}),e.jsx(yt,{value:s.customerFullName||"",readOnly:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"사업자번호"}),e.jsx(yt,{value:s.bizNo||"",readOnly:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"대표자명"}),e.jsx(yt,{value:s.ownerName||"",readOnly:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"전화번호"}),e.jsx(yt,{value:s.telNo||"",readOnly:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"고객유형"}),e.jsx(yt,{value:s.customerTypeName||"",readOnly:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"시/도"}),e.jsx(yt,{value:s.addrProvinceName||"",readOnly:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"시/군/구"}),e.jsx(yt,{value:s.addrCityName||"",readOnly:!0})]}),e.jsxs("div",{className:"field row-2",children:[e.jsx("label",{children:"비고"}),e.jsx(yt,{value:s.customerRemark||"",readOnly:!0})]})]})}):e.jsx("div",{className:"empty-state",children:"선택된 거래처가 없습니다."}),[s]);return e.jsxs("section",{className:"c360",children:[e.jsx("div",{className:"page-title"}),q,e.jsxs("section",{className:"card",style:{marginTop:12,minHeight:240},children:[e.jsxs("div",{className:"tabs c360-tabs",children:[e.jsx("button",{className:p==="transactions"?"tab active":"tab",onClick:()=>_("transactions"),children:"거래 내역"}),e.jsx("button",{className:p==="activities"?"tab active":"tab",onClick:()=>_("activities"),children:"영업활동"}),e.jsx("button",{className:p==="demand"?"tab active":"tab",onClick:()=>_("demand"),children:"수요정보"})]}),e.jsxs("div",{style:{marginTop:12},children:[p==="transactions"&&(s==null?void 0:s.customerSeq)!=null&&e.jsx(Sn,{customerSeq:s.customerSeq}),p==="activities"&&(s==null?void 0:s.customerSeq)!=null&&e.jsx(Xs,{customerSeq:s.customerSeq,customerId:s.customerId||"",hideRefresh:!0,enableContextMenu:!0}),p==="demand"&&(s==null?void 0:s.customerName)&&e.jsxs(e.Fragment,{children:[e.jsx(Nn,{customerName:s.customerName,refreshTick:F}),e.jsx(kn,{customerName:s.customerName,refreshTick:F}),e.jsx(Cn,{customerName:s.customerName,customerSeq:s.customerSeq,empSeq:s.empSeq,empName:s.empName||void 0,onSuccess:()=>B(X=>X+1)})]}),(!s||s.customerSeq==null)&&e.jsx("div",{className:"empty-state",children:"탭을 선택하세요"})]})]})]})}function $s(s){const u=new Date(s);return u.setDate(1),u.setHours(0,0,0,0),u}function pn(s,u){const p=new Date(s);return p.setMonth(p.getMonth()+u),p}function ms(s,u){const p=new Date(s);return p.setDate(p.getDate()+u),p}function Ys(s,u){return s.getFullYear()===u.getFullYear()&&s.getMonth()===u.getMonth()&&s.getDate()===u.getDate()}function wa(){const[s,u]=t.useState(()=>$s(new Date)),p=new Date,[_,F]=t.useState([]),[B,q]=t.useState(!1),[X,R]=t.useState(null),[se,V]=t.useState("month"),[N,y]=t.useState({open:!1,x:0,y:0}),[A,O]=t.useState(0),[b,d]=t.useState(null),[x,r]=t.useState({open:!1}),T=t.useMemo(()=>{const o=[];if(se==="month"){const M=$s(s),G=M.getDay(),H=new Date(M);H.setDate(M.getDate()-G);for(let j=0;j<42;j++){const te=new Date(H);te.setDate(H.getDate()+j),o.push({date:te,inMonth:te.getMonth()===s.getMonth(),isToday:Ys(te,p)})}}else if(se==="week"){const M=new Date(s),G=M.getDay(),H=new Date(M);H.setDate(M.getDate()-G);for(let j=0;j<7;j++){const te=new Date(H);te.setDate(H.getDate()+j),o.push({date:te,inMonth:!0,isToday:Ys(te,p)})}}else{const M=new Date(s);o.push({date:M,inMonth:!0,isToday:Ys(M,p)})}return o},[s,se]),S=t.useMemo(()=>{const o=s.getFullYear(),M=String(s.getMonth()+1).padStart(2,"0"),G=String(s.getDate()).padStart(2,"0");if(se==="month")return`${o}.${M}`;if(se==="week"){const H=s.getDay(),j=ms(new Date(s),-H),te=ms(new Date(j),6),c=String(j.getMonth()+1).padStart(2,"0"),i=String(j.getDate()).padStart(2,"0"),v=String(te.getMonth()+1).padStart(2,"0"),g=String(te.getDate()).padStart(2,"0");return`${o}.${c}.${i} ~ ${te.getFullYear()}.${v}.${g}`}return`${o}.${M}.${G}`},[s,se]);t.useEffect(()=>{const o=localStorage.getItem("tnt.sales.assigneeId");if(!o){R("로그인이 필요합니다"),F([]);return}R(null),q(!0),(async()=>{try{const M=new URL("/api/v1/sales-activities",window.location.origin);M.searchParams.set("mineOnly","true"),M.searchParams.set("assigneeId",String(o));const G=new Date(T[0].date);G.setHours(0,0,0,0);const H=new Date(T[T.length-1].date);H.setHours(23,59,59,999),M.searchParams.set("start",G.toISOString()),M.searchParams.set("end",H.toISOString());const j=await fetch(M.toString());if(!j.ok){let i=`HTTP ${j.status}`;try{const v=await j.json();v!=null&&v.error&&(i=v.error)}catch{}throw new Error(i)}const te=await j.json(),c=Array.isArray(te)?te.map(i=>({id:Number(i==null?void 0:i.id),subject:(i==null?void 0:i.subject)??void 0,plannedStartAt:(i==null?void 0:i.plannedStartAt)??(i==null?void 0:i.planned_start_at)??void 0,plannedEndAt:(i==null?void 0:i.plannedEndAt)??(i==null?void 0:i.planned_end_at)??null,activityStatus:(i==null?void 0:i.activityStatus)??(i==null?void 0:i.activity_status)??void 0,leadId:(i==null?void 0:i.sfLeadId)??(i==null?void 0:i.sf_lead_id)??(i==null?void 0:i.leadId)??(i==null?void 0:i.lead_id)??null})):[];F(c)}catch(M){R(M.message||"활동 조회 중 오류가 발생했습니다")}finally{q(!1)}})()},[s,se,T,A]);const w=t.useMemo(()=>{const o=new Map;if(!_||_.length===0)return o;const M=new Date(T[0].date),G=new Date(T[T.length-1].date);G.setHours(23,59,59,999);for(const H of _){if(!H.plannedStartAt&&!H.plannedEndAt)continue;const j=H.plannedStartAt?new Date(H.plannedStartAt):null,te=H.plannedEndAt?new Date(H.plannedEndAt):j;if(!j)continue;const c=j,i=te||j;if(i<M||c>G)continue;const v=`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}-${String(c.getDate()).padStart(2,"0")}`,g=c.toTimeString().slice(0,5),z=i.toTimeString().slice(0,5),I=o.get(v)||[];I.push({id:H.id,subject:H.subject,time:g,endTime:z,status:H.activityStatus,start:c,end:i,leadId:H.leadId??null}),o.set(v,I)}return o},[_,T]);function l(o){return o.getHours()*60+o.getMinutes()}function C(o){const M=Math.floor(o/60).toString().padStart(2,"0"),G=(o%60).toString().padStart(2,"0");return`${M}:${G}`}const Y=ke.useCallback(o=>{const M=new Date(o);M.setHours(0,0,0,0);const G=new Date(o);G.setHours(23,59,59,999);const H=[];for(const j of _){const te=j.plannedStartAt?new Date(j.plannedStartAt):null,c=j.plannedEndAt?new Date(j.plannedEndAt):te;if(!te)continue;const i=c||te;if(i<M||te>G)continue;const v=te<M?M:te,g=i>G?G:i;H.push({id:j.id,subject:j.subject,status:j.activityStatus,start:v,end:g,leadId:j.leadId??null})}return H.sort((j,te)=>j.start.getTime()-te.start.getTime()),H},[_]),ue=t.useCallback(()=>{y({open:!1,x:0,y:0,event:void 0})},[]);t.useEffect(()=>{if(!N.open)return;const o=G=>{G.target.closest(".context-menu")||ue()},M=G=>{G.key==="Escape"&&ue()};return window.addEventListener("click",o,!0),window.addEventListener("contextmenu",o,!1),window.addEventListener("keydown",M,!0),()=>{window.removeEventListener("click",o,!0),window.removeEventListener("contextmenu",o,!0),window.removeEventListener("keydown",M,!0)}},[N.open,ue]);function ie(o,M){o.preventDefault(),o.stopPropagation(),y({open:!0,x:o.clientX,y:o.clientY,event:M})}async function n(o){const M=o==null?void 0:o.id;if(M)try{const G=await fetch(`/api/v1/sales-activities/${M}`);if(!G.ok)throw new Error(`HTTP ${G.status}`);const H=await G.json(),j=(H==null?void 0:H.customerName)||(H==null?void 0:H.customer_name)||"";r({open:!0,event:o,customerName:j})}catch(G){console.error("활동 상세 조회 실패:",G),r({open:!0,event:o,customerName:""})}}async function m(){var M;const o=(M=x.event)==null?void 0:M.id;if(!o){r({open:!1});return}try{const G=await fetch(`/api/v1/sales-activities/${o}`,{method:"DELETE"});if(!G.ok)throw new Error(`HTTP ${G.status}`);F(H=>H.filter(j=>j.id!==o));try{window.dispatchEvent(new CustomEvent("tnt.sales.activity.updated",{detail:{id:o}}))}catch{}r({open:!1}),ue()}catch(G){window.alert((G==null?void 0:G.message)||"삭제 중 오류가 발생했습니다"),r({open:!1})}}function P(){r({open:!1})}t.useEffect(()=>{(se==="week"||se==="day")&&setTimeout(()=>{document.querySelectorAll(".day-timeline").forEach(o=>{o.scrollTop=7*40})},0)},[se,T]);async function h(o){o!=null&&o.id&&d(o.id)}return t.useEffect(()=>{if(se!=="week")return;const o=Array.from(document.querySelectorAll(".day-timeline"));if(o.length===0)return;const M=G=>{const H=G.target,j=H.scrollTop;o.forEach(te=>{te!==H&&(te.scrollTop=j)})};return o.forEach(G=>G.addEventListener("scroll",M)),()=>o.forEach(G=>G.removeEventListener("scroll",M))},[se,T]),t.useEffect(()=>{if(!b)return;const o=M=>{M.key==="Escape"&&(M.preventDefault(),M.stopPropagation(),d(null))};return window.addEventListener("keydown",o,!0),()=>window.removeEventListener("keydown",o,!0)},[b]),e.jsxs(e.Fragment,{children:[e.jsxs("section",{children:[e.jsxs("div",{className:"page-title",children:[e.jsx("h2",{children:"일정"}),e.jsx("div",{className:"meta",children:e.jsx("button",{className:"btn",onClick:()=>u($s(new Date)),children:"오늘"})})]}),e.jsxs("div",{className:"card",style:{padding:12},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("button",{className:"btn",onClick:()=>u(o=>se==="month"?pn(o,-1):se==="week"?ms(o,-7):ms(o,-1)),children:"〈"}),e.jsx("div",{style:{fontWeight:700},children:S}),e.jsx("button",{className:"btn",onClick:()=>u(o=>se==="month"?pn(o,1):se==="week"?ms(o,7):ms(o,1)),children:"〉"})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("button",{className:"btn",onClick:()=>{V("month"),u($s(new Date))},disabled:se==="month",children:"월"}),e.jsx("button",{className:"btn",onClick:()=>{V("week"),u(new Date)},disabled:se==="week",children:"주"}),e.jsx("button",{className:"btn",onClick:()=>{V("day"),u(new Date)},disabled:se==="day",children:"일"})]})]}),X&&e.jsx("div",{className:"error",style:{marginBottom:8},children:X}),B&&e.jsx("div",{className:"muted",style:{marginBottom:8},children:"활동 불러오는 중…"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:`repeat(${se==="day"?1:7}, 1fr)`,gap:4},children:[(se==="day"?[""]:["일","월","화","수","목","금","토"]).map((o,M)=>e.jsx("div",{style:{textAlign:"center",color:"var(--muted)",padding:"6px 0"},children:o},M)),se==="month"&&T.map((o,M)=>e.jsxs("div",{style:{border:"1px solid var(--border)",borderRadius:8,padding:8,height:120,overflow:"hidden",display:"flex",flexDirection:"column",background:o.inMonth?"transparent":"var(--panel-2)",outline:o.isToday?"2px solid var(--accent)":"none"},children:[e.jsx("div",{style:{fontWeight:600,marginBottom:6,opacity:o.inMonth?1:.6},children:o.date.getDate()}),(()=>{const G=`${o.date.getFullYear()}-${String(o.date.getMonth()+1).padStart(2,"0")}-${String(o.date.getDate()).padStart(2,"0")}`,H=w.get(G)||[];return H.length?e.jsxs("div",{className:"cal-events",style:{overflow:"hidden"},children:[H.slice(0,3).map((j,te)=>e.jsxs("div",{className:`cal-pill status-${(j.status||"scheduled").replaceAll(" ","_")}`,title:j.subject||"",onClick:()=>{h(j)},onContextMenu:c=>ie(c,j),children:[e.jsx("span",{className:"time",children:j.time}),e.jsx("span",{className:"subj",children:j.subject||"활동"})]},te)),H.length>3&&e.jsxs("div",{className:"muted",style:{fontSize:12,marginTop:4},children:["+",H.length-3," 더보기"]})]}):null})()]},M)),(se==="week"||se==="day")&&(()=>{const M=.6666666666666666;return T.map((G,H)=>{const j=`${G.date.getFullYear()}-${String(G.date.getMonth()+1).padStart(2,"0")}-${String(G.date.getDate()).padStart(2,"0")}`,te=(w.get(j)||[]).sort((i,v)=>i.start.getTime()-v.start.getTime()),c=se==="day"?Y(G.date):te;return e.jsxs("div",{style:{border:"1px solid var(--border)",borderRadius:8,padding:8},children:[e.jsx("div",{style:{fontWeight:600,marginBottom:6},children:G.date.getDate()}),e.jsxs("div",{className:"day-timeline",style:{position:"relative",height:960,borderTop:"1px solid var(--border)",overflowY:"auto",maxHeight:480},children:[[...Array(24)].map((i,v)=>e.jsx("div",{style:{position:"absolute",top:v*40,left:0,right:0,borderTop:"1px dashed var(--border)",fontSize:10,color:"var(--muted)"},children:e.jsxs("span",{style:{position:"absolute",left:0,transform:"translateY(-50%)",paddingLeft:4},children:[v,":00"]})},v)),c.map((i,v)=>{const g=l(i.start),z=l(i.end),I=g*M,ge=Math.max(20,(z-g)*M);return e.jsxs("div",{className:`cal-pill status-${(i.status||"scheduled").replaceAll(" ","_")}`,style:{position:"absolute",top:I,left:60,right:4,height:ge},title:`${C(g)}~${C(z)} ${i.subject||""}`,onClick:()=>{h(i)},onContextMenu:re=>ie(re,i),children:[e.jsx("span",{className:"time",children:C(g)}),e.jsx("span",{className:"subj",children:i.subject||"활동"})]},v)})]})]},H)})})()]}),N.open&&N.event&&e.jsxs("div",{className:"context-menu",style:{left:N.x+4,top:N.y+4},onClick:o=>o.stopPropagation(),children:[e.jsx("button",{className:"context-item",onClick:()=>{d(N.event.id),ue()},children:"활동 수정"}),e.jsx("button",{className:"context-item",onClick:()=>{ue(),n(N.event)},children:"활동 삭제"})]})]})]}),b&&e.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,.4)"},onClick:()=>d(null),children:e.jsxs("div",{className:"card",style:{width:"min(920px, 92vw)",maxHeight:"90vh",overflow:"auto",padding:16,background:"var(--panel)",border:"1px solid var(--border)",borderRadius:12,boxShadow:"0 8px 32px rgba(0,0,0,.2)"},onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:12},children:[e.jsx("h3",{style:{margin:0,fontSize:16,fontWeight:700},children:"영업활동 수정"}),e.jsx("button",{onClick:()=>d(null),style:{width:32,height:32,display:"flex",alignItems:"center",justifyContent:"center",background:"transparent",border:"none",borderRadius:4,cursor:"pointer",color:"var(--muted)",fontSize:20,transition:"all 0.2s"},onMouseEnter:o=>{o.currentTarget.style.background="var(--panel-2)",o.currentTarget.style.color="var(--text)"},onMouseLeave:o=>{o.currentTarget.style.background="transparent",o.currentTarget.style.color="var(--muted)"},title:"닫기 (ESC)",children:"×"})]}),e.jsx(Ns,{bare:!0,editId:b,onSaved:()=>{d(null),O(o=>o+1)},onNoticeClose:()=>d(null)})]})}),x.open&&e.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:1e4,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,.5)"},onClick:P,children:e.jsxs("div",{className:"card",style:{background:"var(--panel)",padding:20,border:"1px solid var(--border)",borderRadius:12,minWidth:320,maxWidth:"86vw",boxShadow:"0 8px 32px rgba(0,0,0,.3)"},onClick:o=>o.stopPropagation(),children:[e.jsx("div",{style:{marginBottom:16,fontSize:16,fontWeight:700,color:"var(--text)",textAlign:"center"},children:"활동 삭제"}),e.jsxs("div",{style:{marginBottom:20,fontSize:14,color:"var(--text)",textAlign:"center",lineHeight:1.6},children:[x.customerName&&e.jsx("div",{style:{marginBottom:8,fontWeight:600,color:"var(--primary)"},children:x.customerName}),e.jsx("div",{children:"정말로 삭제하시겠습니까?"})]}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"center"},children:[e.jsx("button",{className:"btn",onClick:P,style:{minWidth:80,background:"var(--panel-2)",border:"1px solid var(--border)",color:"var(--text)",display:"flex",alignItems:"center",justifyContent:"center"},children:"취소"}),e.jsx("button",{className:"btn",onClick:m,style:{minWidth:80,background:"#dc2626",border:"1px solid #b91c1c",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center"},children:"삭제"})]})]})})]})}function Sa(){const[s,u]=t.useState(()=>{const m=new Date;return m.setMinutes(m.getMinutes()-m.getTimezoneOffset()),m.toISOString().slice(0,10)}),[p,_]=t.useState(null),[F,B]=t.useState(new Array(12).fill(0)),[q,X]=t.useState(new Array(12).fill(0)),[R,se]=t.useState([]),[V,N]=t.useState([]),[y,A]=t.useState(!1),[O,b]=t.useState(null),[d,x]=t.useState("compare");async function r(m){A(!0),b(null);try{const P=await fetch(`/api/v1/dashboard/sales-summary?date=${encodeURIComponent(m)}`),h=await P.json().catch(()=>({}));if(!P.ok||h&&h.error)throw new Error(h.error||`HTTP ${P.status}`);_(h);const o=new Date(m),M=o.getFullYear(),G=M-1,H=m,[j,te]=await Promise.all([fetch(`/api/v1/dashboard/monthly?year=${G}`),fetch(`/api/v1/dashboard/monthly?year=${M}&until=${encodeURIComponent(H)}`)]),c=await j.json().catch(()=>[]),i=await te.json().catch(()=>[]),v=ye=>{const L=new Array(12).fill(0);return Array.isArray(ye)&&ye.forEach(he=>{const fe=Number(he==null?void 0:he.month),Se=Number((he==null?void 0:he.amount)||0);fe>=1&&fe<=12&&(L[fe-1]=Se)}),L};B(v(c)),X(v(i));const g=o.getMonth()+1,[z,I]=await Promise.all([fetch(`/api/v1/dashboard/daily?year=${G}&month=${g}`),fetch(`/api/v1/dashboard/daily?year=${M}&month=${g}&until=${encodeURIComponent(H)}`)]),ge=await z.json().catch(()=>[]),re=await I.json().catch(()=>[]),Z=(ye,L,he)=>{let fe=31;try{fe=new Date(L,he,0).getDate()}catch{}const Se=new Array(fe).fill(0);return Array.isArray(ye)&&ye.forEach(Ae=>{const E=Number(Ae==null?void 0:Ae.day),ve=Number((Ae==null?void 0:Ae.amount)||0);E>=1&&E<=fe&&(Se[E-1]=ve)}),Se};se(Z(ge,G,g)),N(Z(re,M,g))}catch(P){b((P==null?void 0:P.message)||"조회 중 오류가 발생했습니다"),_(null)}finally{A(!1)}}t.useEffect(()=>{r(s)},[]);const T=m=>{if(m==null)return"-";try{return new Intl.NumberFormat("ko-KR").format(m)}catch{return String(m)}},S=new Date(s),w=S.getFullYear(),l=S.getMonth()+1,C=S.getDate(),Y=m=>String(m).padStart(2,"0"),ue=w-1,ie=new Date(ue,l,0).getDate(),n=Math.min(C,ie);return e.jsxs("section",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[e.jsxs("div",{className:"tabs",style:{display:"flex",gap:8,padding:"6px 8px",marginBottom:8},children:[e.jsx("button",{className:d==="compare"?"tab active":"tab",onClick:()=>x("compare"),children:"전년동기 매출비교"}),e.jsx("button",{className:d==="arrears"?"tab active":"tab",onClick:()=>x("arrears"),children:"미수 분석"})]}),d==="compare"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"page-title",children:[e.jsx("h2",{children:"전년동기 매출비교"}),e.jsx("div",{className:"controls",style:{gap:8},children:e.jsx("input",{type:"date",className:"subject-input",value:s,onChange:m=>{u(m.target.value),r(m.target.value)}})})]}),O&&e.jsx("div",{className:"error",style:{marginBottom:8},children:O}),e.jsx("div",{className:"card",style:{padding:12},children:y?e.jsx("div",{className:"empty-state",children:"불러오는 중…"}):p?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(6, 1fr)",gap:12},children:[e.jsx(hs,{label:`${ue} 전체`,value:T(p.prevYearTotal)}),e.jsx(hs,{label:`${ue}-01-01 ~ ${ue}-${Y(l)}-${Y(C)}`,value:T(p.prevYearToDate)}),e.jsx(hs,{label:`${w}-01-01 ~ ${w}-${Y(l)}-${Y(C)}`,value:T(p.currentYearToDate)}),e.jsx(hs,{label:`${ue}-${Y(l)} 전체`,value:T(p.prevYearMonthTotal)}),e.jsx(hs,{label:`${ue}-${Y(l)}-01 ~ ${ue}-${Y(l)}-${Y(n)}`,value:T(p.prevYearMonthToDate)}),e.jsx(hs,{label:`${w}-${Y(l)}-01 ~ ${w}-${Y(l)}-${Y(C)}`,value:T(p.currentYearMonthToDate)})]}):e.jsx("div",{className:"empty-state",children:"데이터가 없습니다"})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginTop:12},children:[e.jsxs("div",{className:"card",style:{padding:12},children:[e.jsx("div",{className:"muted",style:{marginBottom:8},children:"월별 매출 (올해 vs 전년)"}),e.jsx(Na,{prev:F,cur:q,upToMonth:new Date(s).getMonth()+1})]}),e.jsxs("div",{className:"card",style:{padding:12},children:[e.jsx("div",{className:"muted",style:{marginBottom:8},children:"일별 매출 (해당 월: 올해 vs 전년)"}),e.jsx(ka,{prev:R,cur:V,upToDay:new Date(s).getDate()})]})]}),e.jsxs("div",{className:"controls",style:{justifyContent:"flex-start",marginTop:12},children:[e.jsx("button",{className:"btn btn-card btn-3d",style:{fontSize:12,padding:"8px 12px",borderRadius:10},onClick:async()=>{try{const m=await fetch(`/api/v1/dashboard/churn?date=${encodeURIComponent(s)}`),P=await m.json().catch(()=>[]);if(!m.ok||P&&P.error)throw new Error(P.error||`HTTP ${m.status}`);try{window.dispatchEvent(new CustomEvent("tnt.sales.dashboard.churn",{detail:{items:P}}))}catch{}}catch{alert("이탈거래처 조회 실패")}},children:"이탈거래처"}),e.jsx("button",{className:"btn btn-card btn-3d",style:{fontSize:12,padding:"8px 12px",borderRadius:10,marginLeft:12},onClick:async()=>{try{const m=await fetch(`/api/v1/dashboard/newcustomers?date=${encodeURIComponent(s)}`),P=await m.json().catch(()=>[]);if(!m.ok||P&&P.error)throw new Error(P.error||`HTTP ${m.status}`);try{window.dispatchEvent(new CustomEvent("tnt.sales.dashboard.newcustomers",{detail:{items:P}}))}catch{}}catch{alert("신규 거래처 조회 실패")}},children:"신규 거래처"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"page-title",children:e.jsx("h2",{children:"미수 분석"})}),e.jsx("div",{className:"card",style:{padding:12},children:e.jsx("div",{className:"empty-state",children:"미수 분석 콘텐츠가 준비 중입니다."})})]})]})}function hs({label:s,value:u}){return e.jsxs("div",{className:"card",style:{padding:12},children:[e.jsx("div",{className:"muted",style:{fontSize:10,marginBottom:8},children:s}),e.jsx("div",{style:{fontSize:16,fontWeight:700},children:u})]})}function Na({prev:s,cur:u,upToMonth:p}){const q=Array.from({length:12},(d,x)=>x+1),X=Math.max(1,...s,...u),R=d=>36+d*(320-2*36)/11,se=d=>204-d/X*(240-2*36),V=(d,x)=>q.filter(T=>!x||T<=x).map((T,S)=>`${S===0?"M":"L"} ${R(T-1)} ${se(d[T-1]||0)}`).join(" "),N=4,y=Array.from({length:N},(d,x)=>Math.round((x+1)*X/N)),A=d=>`${Math.round((d||0)/1e6)}`,O=d=>new Intl.NumberFormat("ko-KR",{maximumFractionDigits:0}).format((d||0)/1e6),b={prev:"#64748b",cur:"#2563eb"};return e.jsxs("svg",{width:"100%",viewBox:"0 0 320 240",children:[e.jsx("rect",{x:0,y:0,width:320,height:240,fill:"transparent"}),y.map((d,x)=>{const r=se(d);return e.jsxs("g",{children:[e.jsx("line",{x1:36,y1:r,x2:284,y2:r,stroke:"var(--border)"}),e.jsx("text",{x:30,y:r+2,textAnchor:"end",fontSize:4,fill:"var(--muted)",children:A(d)})]},x)}),e.jsx("text",{x:4,y:10,fontSize:4,fill:"var(--muted)",children:"단위: 백만원"}),e.jsx("path",{d:V(s),fill:"none",stroke:b.prev,strokeWidth:2}),e.jsx("path",{d:V(u,p),fill:"none",stroke:b.cur,strokeWidth:2}),q.map(d=>{const x=s[d-1]||0,r=se(x)-4;return e.jsx("text",{x:R(d-1),y:r,textAnchor:"middle",fontSize:4,fill:b.prev,children:O(x)},`p-${d}`)}),q.filter(d=>d<=p).map(d=>{const x=u[d-1]||0,r=se(x)-4;return e.jsx("text",{x:R(d-1),y:r-6,textAnchor:"middle",fontSize:4,fill:b.cur,children:O(x)},`c-${d}`)}),q.map(d=>e.jsxs("text",{x:R(d-1),y:234,textAnchor:"middle",fontSize:4,fill:"var(--muted)",children:[d,"월"]},d)),e.jsxs("g",{children:[e.jsx("circle",{cx:196,cy:14,r:4,fill:b.prev}),e.jsx("text",{x:206,y:18,fontSize:4,fill:"var(--muted)",children:"전년"}),e.jsx("circle",{cx:250,cy:14,r:4,fill:b.cur}),e.jsx("text",{x:260,y:18,fontSize:4,fill:"var(--muted)",children:"올해"})]})]})}function ka({prev:s,cur:u,upToDay:p}){const X=Math.max(1,...s,...u),R=(320-2*36)/31,se=Math.max(1,Math.floor(R*.35)),V=T=>36+T*R,N=T=>204-T/X*(240-2*36),y=T=>`${Math.round((T||0)/1e6)}`,A=Array.from({length:31},(T,S)=>S+1),O=Array.from({length:4},(T,S)=>Math.round((S+1)*X/4)),[b,d]=ke.useState(null),x=T=>{const w=T.currentTarget.getBoundingClientRect(),l=T.clientX-w.left,C=Math.max(0,Math.min(320-2*36,l-36)),Y=Math.max(0,Math.min(30,Math.floor(C/R)));d(Y)},r={prev:"#94a3b8",cur:"#3b82f6"};return e.jsxs("svg",{width:"100%",viewBox:"0 0 320 240",onMouseMove:x,onMouseLeave:()=>d(null),children:[e.jsx("rect",{x:0,y:0,width:320,height:240,fill:"transparent"}),O.map((T,S)=>{const w=N(T);return e.jsxs("g",{children:[e.jsx("line",{x1:36,y1:w,x2:284,y2:w,stroke:"var(--border)"}),e.jsx("text",{x:30,y:w+2,textAnchor:"end",fontSize:4,fill:"var(--muted)",children:y(T)})]},S)}),e.jsx("text",{x:4,y:10,fontSize:4,fill:"var(--muted)",children:"단위: 백만원"}),Array.from({length:31},(T,S)=>S).map(T=>{const S=V(T),w=204-N(s[T]||0),l=204-N(u[T]||0);return e.jsxs("g",{children:[e.jsx("rect",{x:S-se-1,y:N(s[T]||0),width:se,height:w,fill:r.prev}),e.jsx("rect",{x:S+1,y:N(u[T]||0),width:se,height:l,fill:r.cur})]},T)}),A.map(T=>e.jsx("text",{x:V(T-1),y:232,textAnchor:"middle",fontSize:3,fill:"var(--muted)",children:T},T)),e.jsxs("g",{children:[e.jsx("rect",{x:194,y:8,width:8,height:8,fill:r.prev}),e.jsx("text",{x:208,y:16,fontSize:4,fill:"var(--muted)",children:"전년"}),e.jsx("rect",{x:244,y:8,width:8,height:8,fill:r.cur}),e.jsx("text",{x:258,y:16,fontSize:4,fill:"var(--muted)",children:"올해"})]}),b!=null&&b<31&&e.jsxs("g",{children:[e.jsx("line",{x1:V(b),y1:32,x2:V(b),y2:208,stroke:"var(--border)"}),e.jsxs("g",{transform:`translate(${Math.min(174,Math.max(36,V(b)-55))}, 36)`,children:[e.jsx("rect",{x:0,y:0,width:110,height:38,rx:6,fill:"var(--panel)",stroke:"var(--border)"}),e.jsxs("text",{x:6,y:12,fontSize:4,fill:"var(--muted)",children:[b+1,"일"]}),e.jsxs("text",{x:6,y:22,fontSize:4,fill:r.prev,children:["전년 ",y(s[b]||0)]}),e.jsxs("text",{x:6,y:32,fontSize:4,fill:r.cur,children:["올해 ",b+1<=p?y(u[b]||0):"-"]})]})]})]})}function Ca({activity:s}){return e.jsxs("section",{className:"card activity-edit-panel",style:{marginTop:12,minHeight:240},children:[e.jsx("div",{className:"tabs c360-tabs",children:e.jsx("button",{className:"tab active",children:"영업활동 변경"})}),e.jsx("div",{className:"activity-form-wrapper",children:e.jsx(Ns,{bare:!0,editId:s==null?void 0:s.id,initial:{id:s==null?void 0:s.id,subject:(s==null?void 0:s.subject)||"",description:(s==null?void 0:s.description)||"",channel:(s==null?void 0:s.channel)||"in_person",activityType:(s==null?void 0:s.activityType)||"site_visit",activityStatus:(s==null?void 0:s.activityStatus)||"scheduled",plannedStartAt:(s==null?void 0:s.plannedStartAt)||"",plannedEndAt:(s==null?void 0:s.plannedEndAt)||"",sfAccountId:(s==null?void 0:s.sfAccountId)||"",customerName:(s==null?void 0:s.customerName)||"",parentActivitySeq:s==null?void 0:s.parentSeq,parentSubject:s==null?void 0:s.parentSubject}},`edit-${(s==null?void 0:s.id)??"new"}`)})]})}function Ft(s){if(!s)return"";const u=s instanceof Date?s:new Date(s);if(isNaN(u.getTime()))return"";const p=String(u.getFullYear()%100).padStart(2,"0"),_=String(u.getMonth()+1).padStart(2,"0"),F=String(u.getDate()).padStart(2,"0"),B=String(u.getHours()).padStart(2,"0"),q=String(u.getMinutes()).padStart(2,"0");return`${p}-${_}-${F} ${B}:${q}`}function Aa(){const[s,u]=t.useState([]),[p,_]=t.useState(!1),[F,B]=t.useState(null),[q,X]=t.useState(()=>new Set),[R,se]=t.useState(null),[V,N]=t.useState(""),[y,A]=t.useState([]),[O,b]=t.useState(""),[d,x]=t.useState(void 0),[r,T]=t.useState({open:!1,x:0,y:0});function S(){try{const ie=localStorage.getItem("tnt.sales.visitPlanActivities"),n=ie?JSON.parse(ie):[],m=new Set;return Array.isArray(n)&&n.forEach(P=>{(P==null?void 0:P.id)!=null&&m.add(Number(P.id))}),m}catch{return new Set}}async function w(){B(null),_(!0);try{const ie=localStorage.getItem("tnt.sales.assigneeId");if(!ie)throw new Error(st.loginRequired);const n=new URL("/api/v1/sales-activities",window.location.origin);n.searchParams.set("mineOnly","true"),n.searchParams.set("assigneeId",String(ie)),V&&V.trim()&&n.searchParams.set("customerName",V.trim()),O&&O.trim()&&n.searchParams.append("status",O.trim());const m=await fetch(n.toString());if(!m.ok){let G=`HTTP ${m.status}`;try{const H=await m.json();H!=null&&H.error&&(G=H.error)}catch{}throw new Error(G)}const P=await m.json(),h=Array.isArray(P)?P:[],o=S(),M=h.filter(G=>!o.has(G.id));u(M),x(G=>{if(!(!M||M.length===0))return G&&M.some(H=>H.id===G.id)?G:M[0]})}catch(ie){B(ie.message||"조회 중 오류가 발생했습니다")}finally{_(!1)}}t.useEffect(()=>{w(),(async()=>{try{const m=await fetch("/api/v1/sales-activities/statuses");if(m.ok){const P=await m.json(),h=["scheduled","completed","canceled","postponed"];Array.isArray(P)&&P.length>0?A(P):A(h)}else A(["scheduled","completed","canceled","postponed"])}catch{}})();const ie=()=>{try{const m=localStorage.getItem("tnt.sales.availableActivities");if(m){const P=JSON.parse(m);if(Array.isArray(P)){const h=P;u(h),x(o=>{if(!(!h||h.length===0))return o&&h.some(M=>M.id===o.id)?o:h[0]})}}}catch{}};window.addEventListener("tnt.sales.availableActivitiesUpdated",ie);const n=()=>{w()};return window.addEventListener("tnt.sales.activity.updated",n),()=>window.removeEventListener("tnt.sales.availableActivitiesUpdated",ie)},[]),t.useEffect(()=>{if(!r.open)return;const ie=()=>T({open:!1,x:0,y:0}),n=m=>{m.key==="Escape"&&T({open:!1,x:0,y:0})};return window.addEventListener("click",ie),window.addEventListener("keydown",n),()=>{window.removeEventListener("click",ie),window.removeEventListener("keydown",n)}},[r.open]);function l(ie,n){ie.preventDefault(),ie.stopPropagation();const m=(n.parentSubject||"").trim();if(!m){T({open:!1,x:0,y:0});return}const P=s.find(o=>(o.subject||"").trim()===m)||null,h=s.filter(o=>(o.parentSubject||"").trim()===m);T({open:!0,x:ie.clientX,y:ie.clientY,parent:P,siblings:h})}function C(){if(se(null),q.size===0){se("선택된 활동이 없습니다");return}const ie=s.filter(m=>q.has(m.id)),n=s.filter(m=>!q.has(m.id));try{let m=[];try{const H=localStorage.getItem("tnt.sales.visitPlanActivities");if(H){const j=JSON.parse(H);Array.isArray(j)&&(m=j)}}catch{}const P=new Map;m.forEach(H=>P.set(H.id,H)),ie.forEach(H=>P.set(H.id,H));const h=Array.from(P.values());localStorage.setItem("tnt.sales.visitPlanActivities",JSON.stringify(h));let o=[];try{const H=localStorage.getItem("tnt.sales.availableActivities");if(H){const j=JSON.parse(H);Array.isArray(j)&&(o=j)}}catch{}const M=new Map;o.forEach(H=>M.set(H.id,H)),n.forEach(H=>M.set(H.id,H)),ie.forEach(H=>M.delete(H.id));const G=Array.from(M.values());localStorage.setItem("tnt.sales.availableActivities",JSON.stringify(G)),window.dispatchEvent(new CustomEvent("tnt.sales.visitPlanUpdated")),window.dispatchEvent(new CustomEvent("tnt.sales.availableActivitiesUpdated")),se(`방문 일정 대상 ${ie.length}건을 우측 패널에 추가했습니다`),u(G),X(new Set)}catch{se("저장 중 오류가 발생했습니다")}}const Y=(ie,n)=>ie?n==="type"?{site_visit:"정기방문",opportunity:"영업기회",AR_mgmt:"채권관리",meeting:"미팅",call:"전화",email:"이메일",demo:"데모",task:"업무",other:"기타"}[ie]||ie:n==="status"?{scheduled:"계획",completed:"완료",canceled:"취소",postponed:"연기",no_show:"미방문"}[ie]||ie:n==="channel"&&{in_person:"방문",phone:"전화",email:"문자/메일/팩스",other:"기타",video:"영상",chat:"채팅",sms:"문자"}[ie]||ie:"",ue=t.useMemo(()=>{const ie=n=>[`제목: ${n.subject||""}`,`활동설명: ${n.description||""}`,`활동유형: ${Y(n.activityType,"type")}`,`활동방법: ${Y(n.channel,"channel")}`,`상태: ${Y(n.activityStatus,"status")}`,`상위활동: ${n.parentSubject||""}`,`계획 일시: ${Ft(n.plannedStartAt)}`,`종료 일시: ${Ft(n.plannedEndAt)}`,`거래처명: ${n.customerName||""}`,`생성일시: ${Ft(n.createdAt)}`].join(`
`);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-container",style:{maxHeight:"32vh"},children:s.length===0?e.jsx("div",{className:"empty-state",children:st.empty}):e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:36,textAlign:"center"},children:e.jsx("input",{type:"checkbox",checked:s.length>0&&q.size===s.length,onChange:n=>{if(n.target.checked){const m=new Set;s.forEach(P=>m.add(P.id)),X(m)}else X(new Set)}})}),e.jsx("th",{style:{width:240},children:"제목"}),e.jsx("th",{style:{width:120},children:"활동방법"}),e.jsx("th",{style:{width:200},children:"거래처명"}),e.jsx("th",{style:{width:280},children:"활동설명"}),e.jsx("th",{style:{width:220},children:"상위활동"}),e.jsx("th",{style:{width:120},children:"활동유형"}),e.jsx("th",{style:{width:120},children:"상태"}),e.jsx("th",{style:{width:180},children:"계획 일시"}),e.jsx("th",{style:{width:180},children:"종료 일시"}),e.jsx("th",{style:{width:180},children:"생성일시"})]})}),e.jsx("tbody",{children:s.map((n,m)=>e.jsxs("tr",{title:ie(n),onClick:()=>x(n),onContextMenu:P=>l(P,n),"aria-selected":(d==null?void 0:d.id)===n.id?!0:void 0,style:(d==null?void 0:d.id)===n.id?{background:"var(--row-selected, rgba(0, 128, 255, 0.12))"}:void 0,children:[e.jsx("td",{style:{textAlign:"center"},children:e.jsx("input",{type:"checkbox",checked:q.has(n.id),onChange:P=>{X(h=>{const o=new Set(h);return P.target.checked?o.add(n.id):o.delete(n.id),o})}})}),e.jsx("td",{children:n.subject||""}),e.jsx("td",{children:Y(n.channel,"channel")}),e.jsx("td",{children:n.customerName||""}),e.jsx("td",{title:n.description||"",style:{maxWidth:600,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:n.description||""}),e.jsx("td",{children:n.parentSubject||""}),e.jsx("td",{children:Y(n.activityType,"type")}),e.jsx("td",{children:Y(n.activityStatus,"status")}),e.jsx("td",{children:Ft(n.plannedStartAt)}),e.jsx("td",{children:Ft(n.plannedEndAt)}),e.jsx("td",{children:Ft(n.createdAt)})]},m))})]})}),r.open&&e.jsxs("div",{className:"context-menu",style:{left:r.x+6,top:r.y+6,maxWidth:720,padding:10,fontSize:10},onClick:n=>n.stopPropagation(),children:[e.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"상위활동"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:8},children:[r.parent&&e.jsx("div",{className:"card",style:{padding:8},children:e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{className:"table",style:{width:"100%",fontSize:10},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"제목"}),e.jsx("th",{children:"활동설명"}),e.jsx("th",{children:"활동유형"}),e.jsx("th",{children:"활동방법"}),e.jsx("th",{children:"상태"}),e.jsx("th",{children:"거래처명"}),e.jsx("th",{children:"계획 일시"}),e.jsx("th",{children:"종료 일시"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:r.parent.subject||""}),e.jsx("td",{style:{whiteSpace:"pre-wrap",maxWidth:360},children:r.parent.description||""}),e.jsx("td",{children:Y(r.parent.activityType,"type")}),e.jsx("td",{children:Y(r.parent.channel,"channel")}),e.jsx("td",{children:Y(r.parent.activityStatus,"status")}),e.jsx("td",{children:r.parent.customerName||""}),e.jsx("td",{children:Ft(r.parent.plannedStartAt)}),e.jsx("td",{children:Ft(r.parent.plannedEndAt)})]})})]})})}),e.jsxs("div",{className:"card",style:{padding:8},children:[e.jsx("div",{style:{fontWeight:600,marginBottom:6},children:"관련활동"}),r.siblings&&r.siblings.length>0?e.jsxs("table",{className:"table",style:{width:"100%",fontSize:10},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:240},children:"제목"}),e.jsx("th",{style:{width:120},children:"활동유형"}),e.jsx("th",{style:{width:120},children:"활동방법"}),e.jsx("th",{style:{width:120},children:"상태"}),e.jsx("th",{style:{width:180},children:"계획 일시"}),e.jsx("th",{style:{width:180},children:"종료 일시"})]})}),e.jsx("tbody",{children:r.siblings.map((n,m)=>e.jsxs("tr",{onClick:()=>{x(n),T({open:!1,x:0,y:0})},children:[e.jsx("td",{children:n.subject||""}),e.jsx("td",{children:Y(n.activityType,"type")}),e.jsx("td",{children:Y(n.channel,"channel")}),e.jsx("td",{children:Y(n.activityStatus,"status")}),e.jsx("td",{children:Ft(n.plannedStartAt)}),e.jsx("td",{children:Ft(n.plannedEndAt)})]},m))})]}):e.jsx("div",{className:"muted",children:"하위 활동이 없습니다"})]})]})]})]})},[s,q,d,r]);return e.jsxs("section",{children:[e.jsxs("div",{className:"page-title",style:{alignItems:"center"},children:[e.jsx("input",{value:V,onChange:ie=>N(ie.target.value),onKeyDown:ie=>{ie.key==="Enter"&&!p&&w()},placeholder:"거래처명 입력",style:{width:220,height:28,padding:"6px 8px",borderRadius:6,border:"1px solid var(--border)",background:"transparent",color:"var(--text)",fontSize:12}}),e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:8,marginLeft:8},children:[e.jsx("label",{className:"muted",style:{fontSize:12},children:"상태"}),e.jsxs("select",{value:O,onChange:ie=>b(ie.target.value),style:{minWidth:140,height:28,padding:"4px 8px",borderRadius:8,border:"1px solid var(--border)",background:"transparent",color:"var(--text)",fontSize:12},children:[e.jsx("option",{value:"",children:"전체"}),y.map(ie=>e.jsx("option",{value:ie,children:Y(ie,"status")},ie))]})]}),e.jsx("button",{className:"btn",onClick:w,disabled:p,children:p?"조회중…":"조회"}),e.jsx("button",{className:"btn",onClick:C,disabled:!0,title:"준비중 기능",style:{marginLeft:8,opacity:.6,cursor:"not-allowed"},children:st.action.addToPlan}),F&&e.jsx("span",{className:"error",children:F||st.errorGeneric}),R&&e.jsx("span",{className:"muted",children:R}),e.jsx("div",{style:{flex:1}}),e.jsxs("div",{className:"muted count-text",children:["총 ",s.length,"건",q.size?` · 선택 ${q.size}건`:""]})]}),e.jsx("div",{style:{marginTop:12},children:ue}),e.jsx(Ca,{activity:d})]})}function Ia(){return e.jsxs("section",{children:[e.jsxs("div",{className:"page-title",children:[e.jsx("h2",{children:"Complaint"}),e.jsx("div",{className:"meta",children:"준비 중"})]}),e.jsx("div",{className:"empty-state",children:"Complaint 기능은 추후 제공될 예정입니다."})]})}function Ta({compact:s=!1,maxHeight:u}){const[p,_]=t.useState([]),[F,B]=t.useState(!1),[q,X]=t.useState(null),[R,se]=t.useState({open:!1,x:0,y:0}),[V,N]=t.useState(()=>{try{const b=localStorage.getItem("tnt.sales.selectedInquiry");if(b){const d=JSON.parse(b),x=Number(d==null?void 0:d.id);return Number.isFinite(x)?x:null}}catch{}return null});async function y(b){X(null),B(!0);try{let d=null;try{const r=await fetch("/api/v1/inquiries");r.ok&&(d=await r.json())}catch{}let x=[];if(Array.isArray(d)?x=d.map((r,T)=>({id:Number((r==null?void 0:r.id)??T+1),title:(r==null?void 0:r.title)!=null?String(r.title):"",customerSeq:(r==null?void 0:r.customerSeq)!=null?Number(r.customerSeq):(r==null?void 0:r.customer_seq)!=null?Number(r.customer_seq):null,customerName:(r==null?void 0:r.customerName)??(r==null?void 0:r.customer_name)??null,inquiryStatus:(r==null?void 0:r.inquiryStatus)??(r==null?void 0:r.inquiry_status)??(r==null?void 0:r.status)??"",assigneeSeq:(r==null?void 0:r.assigneeSeq)!=null?Number(r.assigneeSeq):(r==null?void 0:r.assignee_seq)!=null?Number(r.assignee_seq):null,assigneeName:(r==null?void 0:r.assigneeName)??(r==null?void 0:r.assignee_name)??null,assigneeId:(r==null?void 0:r.assigneeId)??(r==null?void 0:r.assignee_id)??null,openedAt:(r==null?void 0:r.openedAt)??(r==null?void 0:r.opened_at)??"",updatedAt:(r==null?void 0:r.updatedAt)??(r==null?void 0:r.updated_at)??"",inquiryCategory:(r==null?void 0:r.inquiryCategory)??(r==null?void 0:r.inquiry_category)??"",ownerSeq:(r==null?void 0:r.ownerSeq)!=null?Number(r.ownerSeq):(r==null?void 0:r.owner_seq)!=null?Number(r.owner_seq):null,ownerName:(r==null?void 0:r.ownerName)??(r==null?void 0:r.owner_name)??null,channel:(r==null?void 0:r.channel)??"",contactSeq:(r==null?void 0:r.contactSeq)!=null?Number(r.contactSeq):(r==null?void 0:r.contact_seq)!=null?Number(r.contact_seq):null,contactName:(r==null?void 0:r.contactName)??(r==null?void 0:r.contact_name)??null,leadId:(r==null?void 0:r.leadId)??"",severity:(r==null?void 0:r.severity)??"",closedAt:(r==null?void 0:r.closedAt)??(r==null?void 0:r.closed_at)??"",inquiryContent:(r==null?void 0:r.inquiryContent)??(r==null?void 0:r.inquiry_content)??"",answerContent:(r==null?void 0:r.answerContent)??(r==null?void 0:r.answer_content)??""})):x=[],x.sort((r,T)=>{const S=r.updatedAt?Date.parse(r.updatedAt):0,w=T.updatedAt?Date.parse(T.updatedAt):0;return w!==S?w-S:(r.title||"").localeCompare(T.title||"","ko",{sensitivity:"base"})}),_(x),b!=null){const r=x.find(T=>T.id===b);if(r){A(r);return}}x.length>0&&V==null&&A(x[0])}catch(d){X((d==null?void 0:d.message)||"조회 중 오류가 발생했습니다")}finally{B(!1)}}t.useEffect(()=>{y()},[]),t.useEffect(()=>{const b=d=>{var r;const x=((r=d==null?void 0:d.detail)==null?void 0:r.focusId)!=null?Number(d.detail.focusId):null;y(x)};return window.addEventListener("tnt.sales.inquiry.reload",b),()=>window.removeEventListener("tnt.sales.inquiry.reload",b)},[]);function A(b){N(b.id);try{localStorage.setItem("tnt.sales.selectedInquiry",JSON.stringify(b)),window.dispatchEvent(new CustomEvent("tnt.sales.inquiry.selected",{detail:{inquiry:b}}))}catch{}}return t.useMemo(()=>e.jsxs("div",{className:"table-container",style:{height:u??(s?"32vh":void 0),maxHeight:u??(s?"32vh":void 0)},children:[p.length===0?e.jsx("div",{className:"empty-state",children:F?"불러오는 중…":q||"데이터가 없습니다"}):e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"제목"}),e.jsx("th",{style:{width:200},children:"거래처명"}),e.jsx("th",{style:{width:120},children:"문의유형"}),e.jsx("th",{style:{width:120},children:"접수자"}),e.jsx("th",{style:{width:120},children:"당사담당자"}),e.jsx("th",{style:{width:160},children:"접수시간"})]})}),e.jsx("tbody",{children:p.map((b,d)=>{const x=(()=>{if(String(b.inquiryStatus||"").trim()==="완료")return!1;const T=b.openedAt?Date.parse(b.openedAt):NaN;return Number.isFinite(T)?T<=Date.now()-864e5:!1})();return e.jsxs("tr",{className:V===b.id?"selected":void 0,onClick:()=>A(b),onMouseEnter:r=>se({open:!0,x:r.clientX+8,y:r.clientY+8,row:b}),onMouseMove:r=>se(T=>({...T,x:r.clientX+8,y:r.clientY+8})),onMouseLeave:()=>se({open:!1,x:0,y:0}),style:x?{color:"#ef4444"}:void 0,children:[e.jsx("td",{children:b.title||""}),e.jsx("td",{children:b.customerName||(b.customerSeq!=null?String(b.customerSeq):"")}),e.jsx("td",{children:b.inquiryCategory||""}),e.jsx("td",{children:b.ownerName||(b.ownerSeq!=null?String(b.ownerSeq):"")}),e.jsx("td",{children:b.assigneeName||(b.assigneeSeq!=null?String(b.assigneeSeq):"")}),e.jsx("td",{children:b.openedAt?(()=>{const r=new Date(b.openedAt);if(isNaN(r.getTime()))return b.openedAt;const T=String(r.getFullYear()%100).padStart(2,"0"),S=String(r.getMonth()+1).padStart(2,"0"),w=String(r.getDate()).padStart(2,"0"),l=String(r.getHours()).padStart(2,"0"),C=String(r.getMinutes()).padStart(2,"0");return`${T}-${S}-${w} ${l}:${C}`})():""})]},d)})})]}),R.open&&R.row&&e.jsxs("div",{role:"dialog","aria-label":"문의 상세",style:{position:"fixed",left:Math.min(R.x,(typeof window<"u"?window.innerWidth:1200)-420),top:Math.min(R.y,(typeof window<"u"?window.innerHeight:800)-320),zIndex:9999,maxWidth:400,background:"var(--panel)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:10,boxShadow:"0 12px 28px rgba(0,0,0,.25)",padding:10,fontSize:12,lineHeight:1.4,pointerEvents:"none"},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:6},children:R.row.title||"(문의)"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"120px 1fr",columnGap:8,rowGap:4},children:[e.jsx("span",{className:"muted",children:"거래처"}),e.jsx("span",{children:R.row.customerName||(R.row.customerSeq!=null?String(R.row.customerSeq):"")}),e.jsx("span",{className:"muted",children:"문의유형"}),e.jsx("span",{children:R.row.inquiryCategory||""}),e.jsx("span",{className:"muted",children:"상태"}),e.jsx("span",{children:R.row.inquiryStatus||""}),e.jsx("span",{className:"muted",children:"난이도"}),e.jsx("span",{children:R.row.severity||""}),e.jsx("span",{className:"muted",children:"접수자"}),e.jsx("span",{children:R.row.ownerName||(R.row.ownerSeq!=null?String(R.row.ownerSeq):"")}),e.jsx("span",{className:"muted",children:"당사담당자"}),e.jsx("span",{children:R.row.assigneeName||(R.row.assigneeSeq!=null?String(R.row.assigneeSeq):"")}),e.jsx("span",{className:"muted",children:"리드ID"}),e.jsx("span",{children:R.row.leadId||""}),e.jsx("span",{className:"muted",children:"채널"}),e.jsx("span",{children:R.row.channel||""}),e.jsx("span",{className:"muted",children:"접수시각"}),e.jsx("span",{children:R.row.openedAt?(()=>{const b=new Date(R.row.openedAt);if(isNaN(b.getTime()))return String(R.row.openedAt);const d=String(b.getFullYear()%100).padStart(2,"0"),x=String(b.getMonth()+1).padStart(2,"0"),r=String(b.getDate()).padStart(2,"0"),T=String(b.getHours()).padStart(2,"0"),S=String(b.getMinutes()).padStart(2,"0");return`${d}-${x}-${r} ${T}:${S}`})():""}),e.jsx("span",{className:"muted",children:"종료시각"}),e.jsx("span",{children:R.row.closedAt?(()=>{const b=new Date(R.row.closedAt);if(isNaN(b.getTime()))return String(R.row.closedAt);const d=String(b.getFullYear()%100).padStart(2,"0"),x=String(b.getMonth()+1).padStart(2,"0"),r=String(b.getDate()).padStart(2,"0"),T=String(b.getHours()).padStart(2,"0"),S=String(b.getMinutes()).padStart(2,"0");return`${d}-${x}-${r} ${T}:${S}`})():""}),e.jsx("span",{className:"muted",children:"문의내용"}),e.jsx("span",{style:{whiteSpace:"pre-wrap"},children:R.row.inquiryContent||""}),e.jsx("span",{className:"muted",children:"답변내용"}),e.jsx("span",{style:{whiteSpace:"pre-wrap"},children:R.row.answerContent||""}),e.jsx("span",{className:"muted",children:"수정시각"}),e.jsx("span",{children:R.row.updatedAt?(()=>{const b=new Date(R.row.updatedAt);if(isNaN(b.getTime()))return String(R.row.updatedAt);const d=String(b.getFullYear()%100).padStart(2,"0"),x=String(b.getMonth()+1).padStart(2,"0"),r=String(b.getDate()).padStart(2,"0"),T=String(b.getHours()).padStart(2,"0"),S=String(b.getMinutes()).padStart(2,"0");return`${d}-${x}-${r} ${T}:${S}`})():""}),e.jsx("span",{className:"muted",children:"ID"}),e.jsx("span",{children:R.row.id})]})]})]}),[p,V,F,q,s,u,R])}const Ss="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%20width='16'%20height='16'%20fill='none'%20stroke='currentColor'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'%20aria-hidden='true'%3e%3ccircle%20cx='11'%20cy='11'%20r='7'%20/%3e%3cline%20x1='21'%20y1='21'%20x2='16.65'%20y2='16.65'%20/%3e%3c/svg%3e";function Tn({open:s,onClose:u,title:p,children:_,footer:F,width:B=380}){return t.useEffect(()=>{if(!s)return;const q=X=>{X.key==="Escape"&&u()};return window.addEventListener("keydown",q,!0),()=>window.removeEventListener("keydown",q,!0)},[s,u]),s?Hn.createPortal(e.jsxs("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:2e3},children:[e.jsx("div",{onClick:u,style:{position:"absolute",inset:0,background:"rgba(0,0,0,.35)"}}),e.jsxs("div",{className:"card",style:{position:"absolute",top:"22%",left:"50%",transform:"translateX(-50%)",width:B,maxWidth:"92vw",padding:12},children:[p?e.jsx("div",{className:"page-title",style:{marginBottom:8},children:e.jsx("h3",{style:{margin:0,fontSize:14},children:p})}):null,e.jsx("div",{style:{padding:"4px 2px",fontSize:13},children:_}),e.jsx("div",{className:"controls",style:{justifyContent:"flex-end",gap:8,marginTop:8},children:F})]})]}),document.body):null}function Ea({open:s,onClose:u,onSubmit:p}){const[_,F]=t.useState(""),[B,q]=t.useState(""),[X,R]=t.useState(""),[se,V]=t.useState(""),[N,y]=t.useState(""),[A,O]=t.useState(""),[b,d]=t.useState(""),[x,r]=t.useState(!1),[T,S]=t.useState(""),[w,l]=t.useState(""),[C,Y]=t.useState(""),[ue,ie]=t.useState(""),[n,m]=t.useState(""),[P,h]=t.useState(!1),[o,M]=t.useState(""),[G,H]=t.useState(""),[j,te]=t.useState(!1),[c,i]=t.useState(""),[v,g]=t.useState(""),[z,I]=t.useState(""),[ge,re]=t.useState(""),[Z,ye]=t.useState(null),L=t.useRef(null),[he,fe]=t.useState(!1),[Se,Ae]=t.useState({left:0,top:0});t.useEffect(()=>{if(s){const ee=new Date;ee.setMinutes(ee.getMinutes()-ee.getTimezoneOffset()),i(ee.toISOString().slice(0,16)),g(""),F(""),q(""),R(""),V(""),y(""),O(""),d(""),S("");try{const _e=localStorage.getItem("tnt.sales.empName")||"",Pe=localStorage.getItem("tnt.sales.assigneeId")||"";l(_e),Y(Pe)}catch{l(""),Y("")}ie(""),m(""),M(""),H(""),I(""),re(""),fe(!1)}},[s]),t.useEffect(()=>{if(!s)return;const ee=_e=>{if(_e.key==="Escape"){if(x||j||P)return;u()}};return window.addEventListener("keydown",ee,!0),()=>window.removeEventListener("keydown",ee,!0)},[s,u,x,j,P]),t.useEffect(()=>{if(!Z)return;const ee=_e=>{_e.key==="Escape"&&ye(null)};return window.addEventListener("keydown",ee,!0),()=>window.removeEventListener("keydown",ee,!0)},[Z]);function E(ee){var We;ee.preventDefault();const _e=(We=L.current)==null?void 0:We.getBoundingClientRect(),Pe=ee.clientX,Te=ee.clientY,me=_e?_e.left:Se.left,Ue=_e?_e.top:Se.top,Je=Ve=>{const rt=Ve.clientX-Pe,jt=Ve.clientY-Te;Ae({left:me+rt,top:Ue+jt}),fe(!0)},ht=()=>{window.removeEventListener("mousemove",Je),window.removeEventListener("mouseup",ht)};window.addEventListener("mousemove",Je),window.addEventListener("mouseup",ht)}if(!s)return null;function ve(){const ee=(_||"").trim().length>0,_e=(B||"").trim().length>0,Pe=!!(A&&Number(A)),Te=!!(o&&String(o).trim());if(!ee){ye("제목을 입력해 주세요.");return}if(!_e){ye("상태를 선택해 주세요.");return}if(!(Pe||Te)){ye("거래처 또는 잠재고객 중 하나를 선택해 주세요.");return}const me={title:_,inquiryStatus:B,severity:X,inquiryCategory:se,channel:N,customerSeq:A?Number(A):null,contactName:T||null,ownerId:C||null,assigneeId:n||null,createdBy:C||null,updatedBy:C||null,leadId:o,openedAt:c||null,closedAt:v||null,inquiryContent:z,answerContent:ge};p==null||p(me)}return e.jsxs("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:1e3},children:[e.jsx("div",{onClick:u,style:{position:"absolute",inset:0,background:"rgba(0,0,0,.35)"}}),e.jsxs("div",{ref:L,className:"card",style:{position:"absolute",zIndex:1001,width:"90%",maxWidth:900,maxHeight:"90%",overflow:"auto",padding:12,left:he?Se.left:"50%",top:he?Se.top:"50%",transform:he?"none":"translate(-50%, -50%)"},children:[e.jsx("button",{"aria-label":"닫기",onClick:u,className:"btn-plain",style:{position:"absolute",top:8,right:8},children:e.jsx("img",{src:dt,className:"icon",alt:"닫기"})}),e.jsxs("div",{onMouseDown:E,style:{display:"flex",alignItems:"center",gap:8,marginBottom:12,cursor:"move"},children:[e.jsx("span",{className:"muted",style:{fontWeight:700},children:"새 문의"}),e.jsx("div",{style:{flex:1,height:1,background:"var(--border)"}})]}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"inline-field",children:[e.jsxs("label",{children:["제목",e.jsx("span",{className:"req-dot","aria-hidden":"true"})]}),e.jsx("input",{className:"subject-input",value:_,onChange:ee=>F(ee.target.value),placeholder:"제목"})]}),e.jsxs("div",{className:"inline-field",children:[e.jsx("label",{children:"문의유형"}),e.jsxs("select",{className:"subject-input",value:se,onChange:ee=>V(ee.target.value),children:[e.jsx("option",{value:"",children:"선택"}),e.jsx("option",{value:"제품문의",children:"제품문의"}),e.jsx("option",{value:"재고/배송문의",children:"재고/배송문의"}),e.jsx("option",{value:"가격문의",children:"가격문의"}),e.jsx("option",{value:"기타문의",children:"기타문의"})]})]}),e.jsxs("div",{className:"inline-field",style:{gridColumn:"1 / -1"},children:[e.jsx("label",{children:"문의내용"}),e.jsx("textarea",{className:"subject-input",value:z,onChange:ee=>I(ee.target.value),placeholder:"상세 설명",style:{minHeight:120}})]}),e.jsxs("div",{className:"inline-field",style:{gridColumn:"1 / -1"},children:[e.jsx("label",{children:"답변내용"}),e.jsx("textarea",{className:"subject-input",value:ge,onChange:ee=>re(ee.target.value),placeholder:"답변/조치",style:{minHeight:120}})]}),e.jsxs("div",{className:"inline-field",children:[e.jsxs("label",{children:["상태",e.jsx("span",{className:"req-dot","aria-hidden":"true"})]}),e.jsxs("select",{className:"subject-input",value:B,onChange:ee=>q(ee.target.value),children:[e.jsx("option",{value:"",children:"선택"}),e.jsx("option",{value:"신규접수",children:"신규접수"}),e.jsx("option",{value:"확인 중",children:"확인 중"}),e.jsx("option",{value:"완료",children:"완료"}),e.jsx("option",{value:"보류",children:"보류"})]})]}),e.jsxs("div",{className:"inline-field",children:[e.jsx("label",{children:"난이도"}),e.jsxs("select",{className:"subject-input",value:X,onChange:ee=>R(ee.target.value),children:[e.jsx("option",{value:"",children:"선택"}),e.jsx("option",{value:"상",children:"상"}),e.jsx("option",{value:"중",children:"중"}),e.jsx("option",{value:"하",children:"하"})]})]}),e.jsxs("div",{className:"inline-field",children:[e.jsx("label",{children:"접수경로"}),e.jsxs("select",{className:"subject-input",value:N,onChange:ee=>y(ee.target.value),children:[e.jsx("option",{value:"",children:"선택"}),e.jsx("option",{value:"전화",children:"전화"}),e.jsx("option",{value:"이메일",children:"이메일"}),e.jsx("option",{value:"고객채널",children:"고객채널"}),e.jsx("option",{value:"직접입력",children:"직접입력"})]})]}),e.jsxs("div",{className:"inline-field",children:[e.jsx("label",{children:"잠재고객"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{className:"subject-input",type:"text",value:G,onChange:ee=>{H(ee.target.value),M("")},placeholder:"잠재고객명",style:{paddingRight:28}}),e.jsx("button",{type:"button","aria-label":"잠재고객 검색",title:"잠재고객 검색",onClick:()=>te(!0),className:"btn-plain no-focus-ring",style:{position:"absolute",right:4,top:"50%",transform:"translateY(-50%)",padding:4,cursor:"pointer"},children:e.jsx("img",{src:Ss,className:"icon",alt:"검색"})})]}),o&&e.jsxs("div",{className:"muted",style:{fontSize:11,marginTop:4},children:["선택됨: id ",o]})]}),e.jsxs("div",{className:"inline-field",children:[e.jsx("label",{children:"거래처"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{className:"subject-input",type:"text",value:b,onChange:ee=>{d(ee.target.value),O("")},placeholder:"거래처명",style:{paddingRight:28}}),e.jsx("button",{type:"button","aria-label":"거래처 검색",title:"거래처 검색",onClick:()=>r(!0),className:"btn-plain no-focus-ring",style:{position:"absolute",right:4,top:"50%",transform:"translateY(-50%)",padding:4,cursor:"pointer"},children:e.jsx("img",{src:Ss,className:"icon",alt:"검색"})})]}),A&&e.jsxs("div",{className:"muted",style:{fontSize:11,marginTop:4},children:["선택됨: seq ",A]})]}),e.jsxs("div",{className:"inline-field",children:[e.jsx("label",{children:"거래처 담당자"}),e.jsx("input",{className:"subject-input",type:"text",value:T,onChange:ee=>S(ee.target.value),placeholder:"이름"})]}),e.jsxs("div",{className:"inline-field",children:[e.jsx("label",{children:"접수자"}),e.jsx("input",{className:"subject-input",value:w,readOnly:!0,title:"로그인 사용자"})]}),e.jsxs("div",{className:"inline-field",children:[e.jsx("label",{children:"당사 담당자"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{className:"subject-input",type:"text",value:ue,onChange:ee=>{ie(ee.target.value),m("")},placeholder:"이름",style:{paddingRight:28}}),e.jsx("button",{type:"button","aria-label":"직원 검색",title:"직원 검색",onClick:()=>h(!0),className:"btn-plain no-focus-ring",style:{position:"absolute",right:4,top:"50%",transform:"translateY(-50%)",padding:4,cursor:"pointer"},children:e.jsx("img",{src:Ss,className:"icon",alt:"검색"})})]})]}),e.jsxs("div",{className:"inline-field",children:[e.jsx("label",{children:"접수시각"}),e.jsx("input",{className:"subject-input",type:"datetime-local",value:c,onChange:ee=>i(ee.target.value)})]}),e.jsxs("div",{className:"inline-field",children:[e.jsx("label",{children:"종료시각"}),e.jsx("input",{className:"subject-input",type:"datetime-local",value:v,onChange:ee=>g(ee.target.value)})]})]}),e.jsxs("div",{className:"controls",style:{gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{className:"btn",onClick:ve,children:"저장"}),e.jsx("button",{className:"btn",onClick:u,children:"취소"})]})]}),x&&e.jsx(Da,{defaultQuery:b,onClose:()=>r(!1),onSelect:ee=>{O(ee.customerSeq?String(ee.customerSeq):""),d(ee.customerName||""),r(!1)}}),P&&e.jsx(_a,{defaultQuery:ue,onClose:()=>h(!1),onSelect:ee=>{m(ee.assigneeId||""),ie(ee.empName||""),h(!1)}}),j&&e.jsx(Ma,{defaultQuery:G,onClose:()=>te(!1),onSelect:ee=>{M(ee.id!=null?String(ee.id):""),H(ee.companyName||""),te(!1)}}),e.jsx(Tn,{open:!!Z,onClose:()=>ye(null),width:360,footer:e.jsx("button",{className:"btn",onClick:()=>ye(null),children:"확인"}),children:Z})]})}function Da({defaultQuery:s,onClose:u,onSelect:p}){const[_,F]=t.useState(s||""),[B,q]=t.useState([]),[X,R]=t.useState(!1),[se,V]=t.useState(null);async function N(y=!0){R(!0),V(null);try{const A=new URL("/api/v1/customers",window.location.origin);_.trim()&&A.searchParams.set("name",_.trim()),A.searchParams.set("mineOnly","false"),A.searchParams.set("limit","100");const O=await fetch(A.toString());if(!O.ok)throw new Error(`HTTP ${O.status}`);const b=await O.json();if(Array.isArray(b)){const d=b.map(x=>({customerSeq:(x==null?void 0:x.customerSeq)??(x==null?void 0:x.customer_seq)??null,customerId:(x==null?void 0:x.customerId)??(x==null?void 0:x.customer_id)??null,customerName:(x==null?void 0:x.customerName)??(x==null?void 0:x.customer_name)??null,telNo:(x==null?void 0:x.telNo)??(x==null?void 0:x.tel_no)??null,addrProvinceName:(x==null?void 0:x.addrProvinceName)??(x==null?void 0:x.addr_province_name)??null,addrCityName:(x==null?void 0:x.addrCityName)??(x==null?void 0:x.addr_city_name)??null,companyType:(x==null?void 0:x.companyType)??(x==null?void 0:x.company_type)??null,ownerName:(x==null?void 0:x.ownerName)??(x==null?void 0:x.owner_name)??null}));q(d)}else q([])}catch(A){V((A==null?void 0:A.message)||"조회 중 오류가 발생했습니다"),q([])}finally{R(!1)}}return t.useEffect(()=>{N(!0)},[]),t.useEffect(()=>{const y=A=>{A.key==="Escape"&&(A.preventDefault(),u())};return window.addEventListener("keydown",y,!0),()=>window.removeEventListener("keydown",y,!0)},[u]),e.jsxs("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:1100},children:[e.jsx("div",{onClick:u,style:{position:"absolute",inset:0,background:"rgba(0,0,0,.4)"}}),e.jsxs("div",{className:"card",style:{position:"absolute",top:"10%",left:"50%",transform:"translateX(-50%)",width:"90%",maxWidth:800,maxHeight:"80%",overflow:"auto",padding:12},children:[e.jsx("button",{"aria-label":"닫기",onClick:u,className:"btn-plain",style:{position:"absolute",top:8,right:8},children:e.jsx("img",{src:dt,className:"icon",alt:"닫기"})}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:8},children:[e.jsx("input",{className:"subject-input",placeholder:"거래처명",value:_,onChange:y=>F(y.target.value),onKeyDown:y=>{y.key==="Enter"&&N(!0)},style:{flex:1}}),e.jsx("button",{className:"btn",onClick:()=>N(!0),children:"조회"})]}),e.jsx("div",{className:"table-container",style:{height:360},children:B.length===0?e.jsx("div",{className:"empty-state",children:X?"불러오는 중…":se||"결과가 없습니다"}):e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:220},children:"거래처명"}),e.jsx("th",{style:{width:140},children:"회사구분"}),e.jsx("th",{style:{width:140},children:"대표자명"}),e.jsx("th",{style:{width:180},children:"지역"})]})}),e.jsx("tbody",{children:B.map((y,A)=>e.jsxs("tr",{onDoubleClick:()=>p(y),onClick:()=>p(y),children:[e.jsx("td",{children:y.customerName||""}),e.jsx("td",{children:y.companyType||""}),e.jsx("td",{children:y.ownerName||""}),e.jsx("td",{children:[y.addrProvinceName,y.addrCityName].filter(Boolean).join(" ")})]},A))})]})})]})]})}function Ma({defaultQuery:s,onClose:u,onSelect:p}){const[_,F]=t.useState(s||""),[B,q]=t.useState([]),[X,R]=t.useState(!1),[se,V]=t.useState(null);async function N(y=!0){R(!0),V(null);try{const A=new URL("/api/v1/leads",window.location.origin);_.trim()&&A.searchParams.set("company_name",_.trim()),A.searchParams.set("limit","100");const O=await fetch(A.toString());if(!O.ok)throw new Error(`HTTP ${O.status}`);const b=await O.json();if(Array.isArray(b)){const d=b.map(x=>({id:(x==null?void 0:x.id)!=null?Number(x.id):null,companyName:(x==null?void 0:x.company_name)??null,leadStatus:(x==null?void 0:x.lead_status)??null,ownerName:(x==null?void 0:x.owner_name)??null,addrProvinceName:(x==null?void 0:x.addr_province_name)??null}));q(d)}else q([])}catch(A){V((A==null?void 0:A.message)||"조회 중 오류가 발생했습니다"),q([])}finally{R(!1)}}return t.useEffect(()=>{N(!0)},[]),t.useEffect(()=>{const y=A=>{A.key==="Escape"&&(A.preventDefault(),u())};return window.addEventListener("keydown",y,!0),()=>window.removeEventListener("keydown",y,!0)},[u]),e.jsxs("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:1100},children:[e.jsx("div",{onClick:u,style:{position:"absolute",inset:0,background:"rgba(0,0,0,.4)"}}),e.jsxs("div",{className:"card",style:{position:"absolute",top:"10%",left:"50%",transform:"translateX(-50%)",width:"90%",maxWidth:800,maxHeight:"80%",overflow:"auto",padding:12},children:[e.jsx("button",{"aria-label":"닫기",onClick:u,className:"btn-plain",style:{position:"absolute",top:8,right:8},children:e.jsx("img",{src:dt,className:"icon",alt:"닫기"})}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:8},children:[e.jsx("input",{className:"subject-input",placeholder:"잠재고객명",value:_,onChange:y=>F(y.target.value),onKeyDown:y=>{y.key==="Enter"&&N(!0)},style:{flex:1}}),e.jsx("button",{className:"btn",onClick:()=>N(!0),children:"조회"})]}),e.jsx("div",{className:"table-container",style:{height:360},children:B.length===0?e.jsx("div",{className:"empty-state",children:X?"불러오는 중…":se||"결과가 없습니다"}):e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:220},children:"잠재고객명"}),e.jsx("th",{style:{width:120},children:"상태"}),e.jsx("th",{style:{width:140},children:"소유자"}),e.jsx("th",{style:{width:160},children:"지역"})]})}),e.jsx("tbody",{children:B.map((y,A)=>e.jsxs("tr",{onDoubleClick:()=>p(y),onClick:()=>p(y),children:[e.jsx("td",{children:y.companyName||""}),e.jsx("td",{children:y.leadStatus||""}),e.jsx("td",{children:y.ownerName||""}),e.jsx("td",{children:y.addrProvinceName||""})]},A))})]})})]})]})}function _a({defaultQuery:s,onClose:u,onSelect:p}){const[_,F]=t.useState(s||""),[B,q]=t.useState([]),[X,R]=t.useState(!1),[se,V]=t.useState(null);async function N(){R(!0),V(null);try{const y=new URL("/api/v1/employees",window.location.origin);y.searchParams.set("depts","all");const A=await fetch(y.toString());if(!A.ok)throw new Error(`HTTP ${A.status}`);const O=await A.json(),b=Array.isArray(O)?O.map(r=>({empId:(r==null?void 0:r.emp_id)??null,empName:(r==null?void 0:r.emp_name)??null,deptName:(r==null?void 0:r.dept_name)??null,assigneeId:(r==null?void 0:r.assignee_id)??null})):[],d=_.trim().toLowerCase(),x=(d?b.filter(r=>(r.empName||"").toLowerCase().includes(d)||(r.empId||"").toLowerCase().includes(d)||(r.deptName||"").toLowerCase().includes(d)):b).sort((r,T)=>(r.empName||"").localeCompare(T.empName||"","ko",{sensitivity:"base"}));q(x)}catch(y){V((y==null?void 0:y.message)||"조회 실패"),q([])}finally{R(!1)}}return t.useEffect(()=>{N()},[]),t.useEffect(()=>{const y=A=>{A.key==="Escape"&&(A.preventDefault(),u())};return window.addEventListener("keydown",y,!0),()=>window.removeEventListener("keydown",y,!0)},[u]),e.jsxs("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:1100},children:[e.jsx("div",{onClick:u,style:{position:"absolute",inset:0,background:"rgba(0,0,0,.4)"}}),e.jsxs("div",{className:"card",style:{position:"absolute",top:"10%",left:"50%",transform:"translateX(-50%)",width:"90%",maxWidth:700,maxHeight:"80%",overflow:"auto",padding:12},children:[e.jsx("button",{"aria-label":"닫기",onClick:u,className:"btn-plain",style:{position:"absolute",top:8,right:8},children:e.jsx("img",{src:dt,className:"icon",alt:"닫기"})}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:8},children:[e.jsx("input",{className:"subject-input",placeholder:"이름/사번/부서",value:_,onChange:y=>F(y.target.value),onKeyDown:y=>{y.key==="Enter"&&N()},style:{flex:1}}),e.jsx("button",{className:"btn",onClick:N,children:"조회"})]}),e.jsx("div",{className:"table-container",style:{height:320},children:B.length===0?e.jsx("div",{className:"empty-state",children:X?"불러오는 중…":se||"결과가 없습니다"}):e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:160},children:"이름"}),e.jsx("th",{style:{width:160},children:"부서"}),e.jsx("th",{style:{width:140},children:"사번"}),e.jsx("th",{style:{width:140},children:"assignee_id"})]})}),e.jsx("tbody",{children:B.map((y,A)=>e.jsxs("tr",{onDoubleClick:()=>p(y),onClick:()=>p(y),children:[e.jsx("td",{children:y.empName||""}),e.jsx("td",{children:y.deptName||""}),e.jsx("td",{children:y.empId||""}),e.jsx("td",{children:y.assigneeId||""})]},A))})]})})]})]})}function $a(){const[s,u]=t.useState(()=>{try{const n=localStorage.getItem("tnt.sales.selectedInquiry");return n?JSON.parse(n):null}catch{return null}});t.useEffect(()=>{const n=()=>{try{const m=localStorage.getItem("tnt.sales.selectedInquiry");u(m?JSON.parse(m):null)}catch{u(null)}};return window.addEventListener("tnt.sales.inquiry.selected",n),()=>window.removeEventListener("tnt.sales.inquiry.selected",n)},[]);const[p,_]=t.useState(null),[F,B]=t.useState(null),[q,X]=t.useState(!1),[R,se]=t.useState(null);t.useEffect(()=>{if(!F)return;const n=m=>{m.key==="Escape"&&B(null)};return window.addEventListener("keydown",n,!0),()=>window.removeEventListener("keydown",n,!0)},[F]),t.useEffect(()=>{if(!q)return;const n=m=>{m.key==="Escape"&&X(!1)};return window.addEventListener("keydown",n,!0),()=>window.removeEventListener("keydown",n,!0)},[q]),t.useEffect(()=>{if(!R)return;const n=m=>{m.key==="Escape"&&se(null)};return window.addEventListener("keydown",n,!0),()=>window.removeEventListener("keydown",n,!0)},[R]);const V=n=>{if(!n)return"";try{const m=new Date(n);if(isNaN(m.getTime()))return"";const P=String(m.getFullYear()),h=String(m.getMonth()+1).padStart(2,"0"),o=String(m.getDate()).padStart(2,"0"),M=String(m.getHours()).padStart(2,"0"),G=String(m.getMinutes()).padStart(2,"0");return`${P}-${h}-${o}T${M}:${G}`}catch{return""}},[N,y]=t.useState({}),[A,O]=t.useState(!1),[b,d]=t.useState(!1),[x,r]=t.useState(!1);t.useEffect(()=>{if(!s){y({});return}const n=typeof window<"u"&&localStorage.getItem("tnt.sales.empName")||"",m=typeof window<"u"&&localStorage.getItem("tnt.sales.assigneeId")||"";y({title:s.title||"",inquiryCategory:s.inquiryCategory||"",inquiryContent:s.inquiryContent||"",answerContent:s.answerContent||"",inquiryStatus:s.inquiryStatus||"",severity:s.severity||"",channel:s.channel||"",leadId:s.leadId||"",leadName:"",customerSeq:s.customerSeq!=null?String(s.customerSeq):"",customerName:s.customerName||"",contactName:s.contactName||"",ownerName:n,ownerId:m,assigneeName:s.assigneeName||"",assigneeId:s.assigneeId||"",openedAt:V(s.openedAt),closedAt:V(s.closedAt)})},[s]),t.useEffect(()=>{const n=N.leadId;if(!n||N.leadName)return;let m=!1;return(async()=>{try{const P=await fetch(`/api/v1/leads/${encodeURIComponent(String(n))}`);if(!P.ok)return;const h=await P.json().catch(()=>null);!m&&h&&y(o=>({...o,leadName:h.company_name||o.leadName||""}))}catch{}})(),()=>{m=!0}},[N.leadId,N.leadName]);function T(n,m){y(P=>({...P,[n]:m}))}async function S(){if(!(s!=null&&s.id))return;const n=(()=>{try{return localStorage.getItem("tnt.sales.assigneeId")||""}catch{return""}})(),m=String(N.title||"").trim().length>0,P=String(N.inquiryStatus||"").trim().length>0,h=!!(N.customerSeq&&Number(N.customerSeq)),o=!!(N.leadId&&String(N.leadId).trim());if(!m){B("제목을 입력해 주세요.");return}if(!P){B("상태를 선택해 주세요.");return}if(!(h||o)){B("거래처 또는 잠재고객 중 하나를 선택해 주세요.");return}const M={title:N.title,inquiryCategory:N.inquiryCategory,inquiryContent:N.inquiryContent,answerContent:N.answerContent,inquiryStatus:N.inquiryStatus,severity:N.severity,channel:N.channel,leadId:N.leadId,customerSeq:N.customerSeq?Number(N.customerSeq):null,contactName:N.contactName||null,ownerId:N.ownerId||null,assigneeId:N.assigneeId||null,updatedBy:n||N.ownerId||null,openedAt:N.openedAt||null,closedAt:N.closedAt||null};try{const G=await fetch(`/api/v1/inquiries/${s.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(M)});if(!G.ok){const H=await G.text().catch(()=>"");B("수정 실패: "+(H||G.status));return}try{_("수정 되었습니다."),window.setTimeout(()=>_(null),3e3)}catch{}try{window.dispatchEvent(new CustomEvent("tnt.sales.inquiry.reload",{detail:{focusId:s.id}}))}catch{}}catch{alert("수정 중 오류가 발생했습니다")}}const w=t.useMemo(()=>e.jsx("div",{className:"card",style:{padding:12},children:s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"inline-field",children:[e.jsxs("label",{children:["제목",e.jsx("span",{className:"req-dot","aria-hidden":"true"})]}),e.jsx("input",{className:"subject-input",value:N.title||"",onChange:n=>T("title",n.target.value)})]}),e.jsxs("div",{className:"inline-field",children:[e.jsx("label",{children:"문의유형"}),e.jsxs("select",{className:"subject-input",value:N.inquiryCategory||"",onChange:n=>T("inquiryCategory",n.target.value),children:[e.jsx("option",{value:"",children:"선택"}),e.jsx("option",{value:"제품문의",children:"제품문의"}),e.jsx("option",{value:"재고/배송문의",children:"재고/배송문의"}),e.jsx("option",{value:"가격문의",children:"가격문의"}),e.jsx("option",{value:"기타문의",children:"기타문의"})]})]}),e.jsxs("div",{className:"inline-field",style:{gridColumn:"1 / -1"},children:[e.jsx("label",{children:"문의내용"}),e.jsx("textarea",{className:"subject-input",value:N.inquiryContent||"",onChange:n=>T("inquiryContent",n.target.value),style:{minHeight:80}})]}),e.jsxs("div",{className:"inline-field",style:{gridColumn:"1 / -1"},children:[e.jsx("label",{children:"답변내용"}),e.jsx("textarea",{className:"subject-input",value:N.answerContent||"",onChange:n=>T("answerContent",n.target.value),style:{minHeight:80}})]}),e.jsxs("div",{className:"inline-field",children:[e.jsxs("label",{children:["상태",e.jsx("span",{className:"req-dot","aria-hidden":"true"})]}),e.jsxs("select",{className:"subject-input",value:N.inquiryStatus||"",onChange:n=>T("inquiryStatus",n.target.value),children:[e.jsx("option",{value:"",children:"선택"}),e.jsx("option",{value:"신규접수",children:"신규접수"}),e.jsx("option",{value:"확인 중",children:"확인 중"}),e.jsx("option",{value:"완료",children:"완료"}),e.jsx("option",{value:"보류",children:"보류"})]})]}),e.jsxs("div",{className:"inline-field",children:[e.jsx("label",{children:"난이도"}),e.jsxs("select",{className:"subject-input",value:N.severity||"",onChange:n=>T("severity",n.target.value),children:[e.jsx("option",{value:"",children:"선택"}),e.jsx("option",{value:"상",children:"상"}),e.jsx("option",{value:"중",children:"중"}),e.jsx("option",{value:"하",children:"하"})]})]}),e.jsxs("div",{className:"inline-field",children:[e.jsx("label",{children:"접수경로"}),e.jsxs("select",{className:"subject-input",value:N.channel||"",onChange:n=>T("channel",n.target.value),children:[e.jsx("option",{value:"",children:"선택"}),e.jsx("option",{value:"전화",children:"전화"}),e.jsx("option",{value:"이메일",children:"이메일"}),e.jsx("option",{value:"고객채널",children:"고객채널"}),e.jsx("option",{value:"직접입력",children:"직접입력"})]})]}),e.jsxs("div",{className:"inline-field",children:[e.jsx("label",{children:"잠재고객"}),e.jsx("input",{className:"subject-input",value:N.leadName||"",readOnly:!0,placeholder:"-"})]}),e.jsxs("div",{className:"inline-field",children:[e.jsx("label",{children:"거래처"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{className:"subject-input",value:N.customerName||"",onChange:n=>{T("customerName",n.target.value),T("customerSeq","")},placeholder:"거래처명",style:{paddingRight:28}}),e.jsx("button",{type:"button","aria-label":"거래처 검색",title:"거래처 검색",onClick:()=>O(!0),className:"btn-plain no-focus-ring",style:{position:"absolute",right:4,top:"50%",transform:"translateY(-50%)",padding:4,cursor:"pointer"},children:e.jsx("img",{src:Ss,className:"icon",alt:"검색"})})]})]}),e.jsxs("div",{className:"inline-field",children:[e.jsx("label",{children:"거래처 담당자"}),e.jsx("input",{className:"subject-input",value:N.contactName||"",onChange:n=>T("contactName",n.target.value),placeholder:"이름"})]}),e.jsxs("div",{className:"inline-field",children:[e.jsx("label",{children:"접수자"}),e.jsx("input",{className:"subject-input",value:N.ownerName||"",readOnly:!0,title:"로그인 사용자"})]}),e.jsxs("div",{className:"inline-field",children:[e.jsx("label",{children:"당사 담당자"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{className:"subject-input",value:N.assigneeName||"",onChange:n=>{T("assigneeName",n.target.value),T("assigneeId","")},placeholder:"이름",style:{paddingRight:28}}),e.jsx("button",{type:"button","aria-label":"직원 검색",title:"직원 검색",onClick:()=>r(!0),className:"btn-plain no-focus-ring",style:{position:"absolute",right:4,top:"50%",transform:"translateY(-50%)",padding:4,cursor:"pointer"},children:e.jsx("img",{src:Ss,className:"icon",alt:"검색"})})]})]}),e.jsxs("div",{className:"inline-field",children:[e.jsx("label",{children:"접수시각"}),e.jsx("input",{className:"subject-input",type:"datetime-local",value:N.openedAt||"",onChange:n=>T("openedAt",n.target.value)})]}),e.jsxs("div",{className:"inline-field",children:[e.jsx("label",{children:"종료시각"}),e.jsx("input",{className:"subject-input",type:"datetime-local",value:N.closedAt||"",onChange:n=>T("closedAt",n.target.value)})]})]}),e.jsxs("div",{className:"controls",style:{gap:8,justifyContent:"flex-end",alignItems:"center"},children:[p&&e.jsx("span",{className:"success",children:p}),e.jsx("button",{className:"btn",onClick:S,children:"저장"}),e.jsx("button",{className:"btn",onClick:ie,children:"삭제"})]})]}):e.jsx("div",{className:"empty-state",children:"선택된 케이스가 없습니다."})}),[s,N,p]),[l,C]=t.useState(!1);async function Y(n){try{const m=await fetch("/api/v1/inquiries",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!m.ok){const o=await m.text().catch(()=>"");alert("저장 실패: "+(o||m.status));return}const P=await m.json().catch(()=>null),h=P&&P.id!=null?Number(P.id):null;C(!1);try{window.dispatchEvent(new CustomEvent("tnt.sales.inquiry.reload",{detail:{focusId:h}}))}catch{}}catch{alert("저장 중 오류가 발생했습니다")}}async function ue(){try{const n=await fetch(`/api/v1/inquiries/${s.id}`,{method:"DELETE"});if(!n.ok){const m=await n.text().catch(()=>"");B("삭제 실패: "+(m||n.status));return}try{localStorage.removeItem("tnt.sales.selectedInquiry")}catch{}u(null),se("삭제 되었습니다.");try{window.dispatchEvent(new CustomEvent("tnt.sales.inquiry.reload",{detail:{}}))}catch{}}catch{B("삭제 중 오류가 발생했습니다")}}async function ie(){s!=null&&s.id&&X(!0)}return e.jsxs(e.Fragment,{children:[e.jsxs("section",{children:[e.jsxs("div",{className:"page-title",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,minWidth:0,flex:"1 1 auto"},children:[e.jsx("h2",{style:{margin:0},children:"문의"}),(()=>{const n=["신규접수","확인 중","완료"],m=String(N.inquiryStatus||"").trim(),P=m==="보류";let h=n.indexOf(m);P&&(h=1),h<0&&(h=0);const o=Math.max(0,Math.min(100,Math.round(h/Math.max(1,n.length-1)*100)));return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4,flex:"0 1 520px"},children:[e.jsx("div",{className:"progress",style:{width:"min(520px, 48vw)"},children:e.jsx("div",{className:"progress-bar",style:{width:`${o}%`,background:P?"#ef4444":"var(--accent)"}})}),e.jsx("div",{style:{display:"flex",justifyContent:"space-between",width:"min(520px, 48vw)",fontSize:11,color:"var(--muted)"},children:n.map(M=>e.jsx("span",{style:{fontWeight:m===M?700:400},children:M},M))})]})})()]}),e.jsx("div",{className:"controls",style:{gap:8},children:e.jsx("button",{className:"btn",onClick:()=>C(!0),children:"신규 등록"})})]}),A&&e.jsx(Pa,{defaultQuery:N.customerName,onClose:()=>O(!1),onSelect:n=>{T("customerSeq",n.customerSeq?String(n.customerSeq):""),T("customerName",n.customerName||""),O(!1)}}),b&&e.jsx(La,{defaultQuery:N.leadName,onClose:()=>d(!1),onSelect:n=>{T("leadId",n.id!=null?String(n.id):""),T("leadName",n.companyName||""),d(!1)}}),x&&e.jsx(Ra,{defaultQuery:N.assigneeName,onClose:()=>r(!1),onSelect:n=>{T("assigneeId",n.assigneeId||""),T("assigneeName",n.empName||""),r(!1)}}),e.jsx(Ta,{compact:!0,maxHeight:"21vh"}),e.jsx("section",{className:"card",style:{marginTop:12,minHeight:240},children:w})]}),e.jsx(Ea,{open:l,onClose:()=>C(!1),onSubmit:Y}),e.jsx(Tn,{open:!!F,onClose:()=>B(null),width:380,footer:e.jsx("button",{className:"btn",onClick:()=>B(null),children:"확인"}),children:F}),q&&e.jsxs("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:90},children:[e.jsx("div",{onClick:()=>X(!1),style:{position:"absolute",inset:0,background:"rgba(0,0,0,.35)"}}),e.jsxs("div",{className:"card",style:{position:"absolute",top:"24%",left:"50%",transform:"translateX(-50%)",width:380,maxWidth:"92vw",padding:12},children:[e.jsx("div",{style:{padding:"4px 2px",fontSize:13},children:"선택한 문의를 삭제하시겠습니까?"}),e.jsxs("div",{className:"controls",style:{justifyContent:"flex-end",gap:8,marginTop:8},children:[e.jsx("button",{className:"btn",onClick:()=>X(!1),children:"취소"}),e.jsx("button",{className:"btn",onClick:()=>{X(!1),ue()},children:"삭제"})]})]})]}),R&&e.jsxs("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:90},children:[e.jsx("div",{onClick:()=>se(null),style:{position:"absolute",inset:0,background:"rgba(0,0,0,.35)"}}),e.jsxs("div",{className:"card",style:{position:"absolute",top:"20%",left:"50%",transform:"translateX(-50%)",width:360,maxWidth:"92vw",padding:12},children:[e.jsx("div",{className:"page-title",style:{marginBottom:8},children:e.jsx("h3",{style:{margin:0,fontSize:14},children:"알림"})}),e.jsx("div",{style:{padding:"4px 2px",fontSize:13},children:R}),e.jsx("div",{className:"controls",style:{justifyContent:"flex-end",gap:8,marginTop:8},children:e.jsx("button",{className:"btn",onClick:()=>se(null),children:"확인"})})]})]})]})}function Pa({defaultQuery:s,onClose:u,onSelect:p}){const[_,F]=t.useState(s||""),[B,q]=t.useState([]),[X,R]=t.useState(!1),[se,V]=t.useState(null);async function N(){R(!0),V(null);try{const y=new URL("/api/v1/customers",window.location.origin);_.trim()&&y.searchParams.set("name",_.trim()),y.searchParams.set("mineOnly","false"),y.searchParams.set("limit","100");const A=await fetch(y.toString());if(!A.ok)throw new Error(`HTTP ${A.status}`);const O=await A.json(),b=Array.isArray(O)?O.map(d=>({customerSeq:(d==null?void 0:d.customerSeq)??(d==null?void 0:d.customer_seq)??null,customerId:(d==null?void 0:d.customerId)??(d==null?void 0:d.customer_id)??null,customerName:(d==null?void 0:d.customerName)??(d==null?void 0:d.customer_name)??null,telNo:(d==null?void 0:d.telNo)??(d==null?void 0:d.tel_no)??null,addrProvinceName:(d==null?void 0:d.addrProvinceName)??(d==null?void 0:d.addr_province_name)??null,addrCityName:(d==null?void 0:d.addrCityName)??(d==null?void 0:d.addr_city_name)??null,companyType:(d==null?void 0:d.companyType)??(d==null?void 0:d.company_type)??null,ownerName:(d==null?void 0:d.ownerName)??(d==null?void 0:d.owner_name)??null})):[];q(b)}catch(y){V((y==null?void 0:y.message)||"조회 실패"),q([])}finally{R(!1)}}return t.useEffect(()=>{N()},[]),t.useEffect(()=>{const y=A=>{A.key==="Escape"&&(A.preventDefault(),u())};return window.addEventListener("keydown",y,!0),()=>window.removeEventListener("keydown",y,!0)},[u]),e.jsxs("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:1100},children:[e.jsx("div",{onClick:u,style:{position:"absolute",inset:0,background:"rgba(0,0,0,.4)"}}),e.jsxs("div",{className:"card",style:{position:"absolute",top:"10%",left:"50%",transform:"translateX(-50%)",width:"90%",maxWidth:800,maxHeight:"80%",overflow:"auto",padding:12},children:[e.jsx("button",{"aria-label":"닫기",onClick:u,className:"btn-plain",style:{position:"absolute",top:8,right:8},children:e.jsx("img",{src:dt,className:"icon",alt:"닫기"})}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:8},children:[e.jsx("input",{className:"subject-input",placeholder:"거래처명",value:_,onChange:y=>F(y.target.value),onKeyDown:y=>{y.key==="Enter"&&N()},style:{flex:1}}),e.jsx("button",{className:"btn",onClick:N,children:"조회"})]}),e.jsx("div",{className:"table-container",style:{height:360},children:B.length===0?e.jsx("div",{className:"empty-state",children:X?"불러오는 중…":se||"결과가 없습니다"}):e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:220},children:"거래처명"}),e.jsx("th",{style:{width:140},children:"회사구분"}),e.jsx("th",{style:{width:140},children:"대표자명"}),e.jsx("th",{style:{width:180},children:"지역"})]})}),e.jsx("tbody",{children:B.map((y,A)=>e.jsxs("tr",{onDoubleClick:()=>p(y),onClick:()=>p(y),children:[e.jsx("td",{children:y.customerName||""}),e.jsx("td",{children:y.companyType||""}),e.jsx("td",{children:y.ownerName||""}),e.jsx("td",{children:[y.addrProvinceName,y.addrCityName].filter(Boolean).join(" ")})]},A))})]})})]})]})}function La({defaultQuery:s,onClose:u,onSelect:p}){const[_,F]=t.useState(s||""),[B,q]=t.useState([]),[X,R]=t.useState(!1),[se,V]=t.useState(null);async function N(){R(!0),V(null);try{const y=new URL("/api/v1/leads",window.location.origin);_.trim()&&y.searchParams.set("company_name",_.trim()),y.searchParams.set("limit","100");const A=await fetch(y.toString());if(!A.ok)throw new Error(`HTTP ${A.status}`);const O=await A.json(),b=Array.isArray(O)?O.map(d=>({id:(d==null?void 0:d.id)!=null?Number(d.id):null,companyName:(d==null?void 0:d.company_name)??null,leadStatus:(d==null?void 0:d.lead_status)??null,ownerName:(d==null?void 0:d.owner_name)??null,addrProvinceName:(d==null?void 0:d.addr_province_name)??null})):[];q(b)}catch(y){V((y==null?void 0:y.message)||"조회 실패"),q([])}finally{R(!1)}}return t.useEffect(()=>{N()},[]),t.useEffect(()=>{const y=A=>{A.key==="Escape"&&(A.preventDefault(),u())};return window.addEventListener("keydown",y,!0),()=>window.removeEventListener("keydown",y,!0)},[u]),e.jsxs("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:1100},children:[e.jsx("div",{onClick:u,style:{position:"absolute",inset:0,background:"rgba(0,0,0,.4)"}}),e.jsxs("div",{className:"card",style:{position:"absolute",top:"10%",left:"50%",transform:"translateX(-50%)",width:"90%",maxWidth:800,maxHeight:"80%",overflow:"auto",padding:12},children:[e.jsx("button",{"aria-label":"닫기",onClick:u,className:"btn-plain",style:{position:"absolute",top:8,right:8},children:e.jsx("img",{src:dt,className:"icon",alt:"닫기"})}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:8},children:[e.jsx("input",{className:"subject-input",placeholder:"잠재고객명",value:_,onChange:y=>F(y.target.value),onKeyDown:y=>{y.key==="Enter"&&N()},style:{flex:1}}),e.jsx("button",{className:"btn",onClick:N,children:"조회"})]}),e.jsx("div",{className:"table-container",style:{height:360},children:B.length===0?e.jsx("div",{className:"empty-state",children:X?"불러오는 중…":se||"결과가 없습니다"}):e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:220},children:"잠재고객명"}),e.jsx("th",{style:{width:120},children:"상태"}),e.jsx("th",{style:{width:140},children:"소유자"}),e.jsx("th",{style:{width:160},children:"지역"})]})}),e.jsx("tbody",{children:B.map((y,A)=>e.jsxs("tr",{onDoubleClick:()=>p(y),onClick:()=>p(y),children:[e.jsx("td",{children:y.companyName||""}),e.jsx("td",{children:y.leadStatus||""}),e.jsx("td",{children:y.ownerName||""}),e.jsx("td",{children:y.addrProvinceName||""})]},A))})]})})]})]})}function Ra({defaultQuery:s,onClose:u,onSelect:p}){const[_,F]=t.useState(s||""),[B,q]=t.useState([]),[X,R]=t.useState(!1),[se,V]=t.useState(null);async function N(){R(!0),V(null);try{const y=new URL("/api/v1/employees",window.location.origin);y.searchParams.set("depts","all");const A=await fetch(y.toString());if(!A.ok)throw new Error(`HTTP ${A.status}`);const O=await A.json(),b=Array.isArray(O)?O.map(r=>({empId:(r==null?void 0:r.emp_id)??null,empName:(r==null?void 0:r.emp_name)??null,deptName:(r==null?void 0:r.dept_name)??null,assigneeId:(r==null?void 0:r.assignee_id)??null})):[],d=_.trim().toLowerCase(),x=(d?b.filter(r=>(r.empName||"").toLowerCase().includes(d)||(r.empId||"").toLowerCase().includes(d)||(r.deptName||"").toLowerCase().includes(d)):b).sort((r,T)=>(r.empName||"").localeCompare(T.empName||"","ko",{sensitivity:"base"}));q(x)}catch(y){V((y==null?void 0:y.message)||"조회 실패"),q([])}finally{R(!1)}}return t.useEffect(()=>{N()},[]),t.useEffect(()=>{const y=A=>{A.key==="Escape"&&(A.preventDefault(),u())};return window.addEventListener("keydown",y,!0),()=>window.removeEventListener("keydown",y,!0)},[u]),e.jsxs("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:1100},children:[e.jsx("div",{onClick:u,style:{position:"absolute",inset:0,background:"rgba(0,0,0,.4)"}}),e.jsxs("div",{className:"card",style:{position:"absolute",top:"10%",left:"50%",transform:"translateX(-50%)",width:"90%",maxWidth:700,maxHeight:"80%",overflow:"auto",padding:12},children:[e.jsx("button",{"aria-label":"닫기",onClick:u,className:"btn-plain",style:{position:"absolute",top:8,right:8},children:e.jsx("img",{src:dt,className:"icon",alt:"닫기"})}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:8},children:[e.jsx("input",{className:"subject-input",placeholder:"이름/사번/부서",value:_,onChange:y=>F(y.target.value),onKeyDown:y=>{y.key==="Enter"&&N()},style:{flex:1}}),e.jsx("button",{className:"btn",onClick:N,children:"조회"})]}),e.jsx("div",{className:"table-container",style:{height:320},children:B.length===0?e.jsx("div",{className:"empty-state",children:X?"불러오는 중…":se||"결과가 없습니다"}):e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:160},children:"이름"}),e.jsx("th",{style:{width:160},children:"부서"}),e.jsx("th",{style:{width:140},children:"사번"}),e.jsx("th",{style:{width:140},children:"assignee_id"})]})}),e.jsx("tbody",{children:B.map((y,A)=>e.jsxs("tr",{onDoubleClick:()=>p(y),onClick:()=>p(y),children:[e.jsx("td",{children:y.empName||""}),e.jsx("td",{children:y.deptName||""}),e.jsx("td",{children:y.empId||""}),e.jsx("td",{children:y.assigneeId||""})]},A))})]})})]})]})}function qa({compact:s=!1,maxHeight:u}){const[p,_]=t.useState([]),[F,B]=t.useState(!1),[q,X]=t.useState(null),[R,se]=t.useState(()=>{try{const A=localStorage.getItem("tnt.sales.selectedEstimate");if(A){const O=JSON.parse(A),b=Number(O==null?void 0:O.id);return Number.isFinite(b)?b:null}}catch{}return null});async function V(){X(null),B(!0);try{const A=["/api/v1/estimates","/api/v1/quotes"];let O=null;for(const d of A)try{const x=await fetch(d);if(x.ok){O=await x.json();break}}catch{}let b=[];Array.isArray(O)?b=O.map((d,x)=>({id:Number((d==null?void 0:d.id)??x+1),estimateNumber:String((d==null?void 0:d.estimateNumber)??(d==null?void 0:d.estimate_number)??""),title:String((d==null?void 0:d.title)??""),status:String((d==null?void 0:d.status)??""),owner:String((d==null?void 0:d.owner)??(d==null?void 0:d.ownerId)??(d==null?void 0:d.owner_id)??""),issuedAt:String((d==null?void 0:d.issuedAt)??(d==null?void 0:d.issued_at)??"")})):b=[{id:1,estimateNumber:"E-2025-0001",title:"제품 견적 A",status:"draft",owner:"kim",issuedAt:"2025-02-01T10:00:00Z"},{id:2,estimateNumber:"E-2025-0002",title:"서비스 견적 B",status:"sent",owner:"lee",issuedAt:"2025-02-03T11:00:00Z"}],b.sort((d,x)=>(d.title||"").localeCompare(x.title||"","ko",{sensitivity:"base"})),_(b),b.length>0&&R==null&&N(b[0])}catch(A){X((A==null?void 0:A.message)||"조회 중 오류가 발생했습니다")}finally{B(!1)}}t.useEffect(()=>{V()},[]);function N(A){se(A.id);try{localStorage.setItem("tnt.sales.selectedEstimate",JSON.stringify(A)),window.dispatchEvent(new CustomEvent("tnt.sales.estimate.selected",{detail:{estimate:A}}))}catch{}}return t.useMemo(()=>e.jsx("div",{className:"table-container",style:{maxHeight:u??(s?"32vh":void 0)},children:p.length===0?e.jsx("div",{className:"empty-state",children:F?"불러오는 중…":q||"데이터가 없습니다"}):e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:140},children:"견적번호"}),e.jsx("th",{children:"제목"}),e.jsx("th",{style:{width:120},children:"상태"}),e.jsx("th",{style:{width:140},children:"소유자"}),e.jsx("th",{style:{width:180},children:"발행시각"})]})}),e.jsx("tbody",{children:p.map((A,O)=>e.jsxs("tr",{className:R===A.id?"selected":void 0,onClick:()=>N(A),children:[e.jsx("td",{children:A.estimateNumber||""}),e.jsx("td",{children:A.title||""}),e.jsx("td",{children:A.status||""}),e.jsx("td",{children:A.owner||""}),e.jsx("td",{children:A.issuedAt?(()=>{const b=new Date(A.issuedAt);if(isNaN(b.getTime()))return A.issuedAt;const d=String(b.getFullYear()%100).padStart(2,"0"),x=String(b.getMonth()+1).padStart(2,"0"),r=String(b.getDate()).padStart(2,"0"),T=String(b.getHours()).padStart(2,"0"),S=String(b.getMinutes()).padStart(2,"0");return`${d}-${x}-${r} ${T}:${S}`})():""})]},O))})]})}),[p,R,F,q,s,u])}function Wa(){const[s,u]=t.useState(()=>{try{const B=localStorage.getItem("tnt.sales.selectedEstimate");return B?JSON.parse(B):null}catch{return null}});t.useEffect(()=>{const B=()=>{try{const q=localStorage.getItem("tnt.sales.selectedEstimate");u(q?JSON.parse(q):null)}catch{u(null)}};return window.addEventListener("tnt.sales.estimate.selected",B),()=>window.removeEventListener("tnt.sales.estimate.selected",B)},[]);const p=t.useMemo(()=>e.jsx("div",{className:"card",style:{padding:12},children:s?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"견적번호"}),e.jsx("div",{className:"subject-input",children:s.estimateNumber||""})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"상태"}),e.jsx("div",{className:"subject-input",children:s.status||""})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"제목"}),e.jsx("div",{className:"subject-input",children:s.title||""})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"소유자"}),e.jsx("div",{className:"subject-input",children:s.owner||""})]})]}):e.jsx("div",{className:"empty-state",children:"선택된 견적이 없습니다."})}),[s]),[_,F]=t.useState("details");return e.jsxs("section",{children:[e.jsx("div",{className:"page-title",children:e.jsx("h2",{children:"견적"})}),e.jsx(qa,{compact:!0,maxHeight:"32vh"}),e.jsxs("section",{className:"card",style:{marginTop:12,minHeight:240},children:[e.jsxs("div",{className:"tabs c360-tabs",children:[e.jsx("button",{className:_==="details"?"tab active":"tab",onClick:()=>F("details"),children:"상세"}),e.jsx("button",{className:_==="items"?"tab active":"tab",onClick:()=>F("items"),children:"품목"}),e.jsx("button",{className:_==="attachments"?"tab active":"tab",onClick:()=>F("attachments"),children:"첨부"})]}),e.jsxs("div",{style:{marginTop:12},children:[_==="details"&&p,_==="items"&&e.jsx("div",{className:"empty-state",children:"견적 품목(추후)"}),_==="attachments"&&e.jsx("div",{className:"empty-state",children:"첨부 파일(추후)"})]})]})]})}function za(){const[s,u]=t.useState(()=>an()),[p,_]=t.useState(Bs());t.useEffect(()=>Yn(()=>_(Bs())),[]);function F(B){const q=!Us(B);Kn(B,q),_(Bs())}return e.jsxs("section",{children:[e.jsx("h1",{children:"설정"}),e.jsx("p",{className:"muted",children:"좌측 메뉴(1, 2 레벨)를 표시/숨김으로 제어합니다. 모든 사용자에게 동일하게 적용됩니다(임시: 로컬 저장소 기반)."}),e.jsx("div",{style:{display:"flex",gap:24,alignItems:"flex-start",marginTop:12},children:e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("h3",{style:{margin:"12px 0"},children:"메뉴 표시 설정"}),e.jsx("button",{className:"btn",onClick:()=>u(an()),children:"메뉴 다시 읽기"})]}),e.jsx("ul",{style:{listStyle:"none",padding:0,margin:0},children:s.map(B=>{var q;return e.jsxs("li",{style:{marginBottom:10},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("input",{type:"checkbox",checked:Us(B.key),onChange:()=>F(B.key)}),e.jsx("strong",{children:B.label}),e.jsxs("span",{className:"muted",style:{fontSize:12},children:["(",B.key,")"]})]}),(q=B.children)!=null&&q.length?e.jsx("ul",{style:{listStyle:"none",padding:"6px 0 0 22px",margin:0},children:B.children.map(X=>e.jsx("li",{style:{marginBottom:6},children:e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("input",{type:"checkbox",checked:Us(X.key),onChange:()=>F(X.key)}),e.jsx("span",{children:X.label}),e.jsxs("span",{className:"muted",style:{fontSize:12},children:["(",X.key,")"]})]})},X.key))}):null]},B.key)})})]})})]})}function Oa(){const[s,u]=t.useState(null),[p,_]=t.useState({}),[F,B]=t.useState(null),[q,X]=t.useState({open:!1,text:""}),[R,se]=t.useState([]),V=t.useMemo(()=>{try{return localStorage.getItem("tnt.sales.assigneeId")||""}catch{return""}},[]),N=t.useMemo(()=>{try{return localStorage.getItem("tnt.sales.empId")||""}catch{return""}},[]);t.useEffect(()=>{const c=()=>{try{const i=localStorage.getItem("tnt.sales.selectedLead"),v=i?JSON.parse(i):null;u(v),_({...v||{}}),B(null)}catch{u(null),_({}),B(null)}};return window.addEventListener("tnt.sales.lead.selected",c),()=>window.removeEventListener("tnt.sales.lead.selected",c)},[]);function y(c,i){_(v=>({...v,[c]:i})),F&&B(null)}async function A(){if(!(!p||p.id==null))try{const c={...p};delete c.created_by_name,delete c.updated_by_name,delete c.created_at,delete c.updated_at;try{(!p.assignee_id||String(p.assignee_id).trim()==="")&&(delete c.assignee_id,delete c.owner_name,delete c.owner_id)}catch{}try{const g=localStorage.getItem("tnt.sales.assigneeId")||"";g&&(c.updated_by=g)}catch{}const i=await fetch(`/api/v1/leads/${p.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(!i.ok)throw new Error(`HTTP ${i.status}`);const v=await i.json().catch(()=>({}));if(v!=null&&v.ok){const g=p.company_name||"";X({open:!0,text:`${g} 수정되었습니다.`});try{const z=await fetch(`/api/v1/leads/${p.id}`),I=z.ok?await z.json():p;_(ge=>({...ge,...I||{}})),u(ge=>({...ge||{},...I||{}})),localStorage.setItem("tnt.sales.selectedLead",JSON.stringify(I||p)),window.dispatchEvent(new CustomEvent("tnt.sales.lead.selected",{detail:{lead:I||p}})),window.dispatchEvent(new CustomEvent("tnt.sales.lead.updated",{detail:{lead:I||p}}))}catch{try{localStorage.setItem("tnt.sales.selectedLead",JSON.stringify(p)),window.dispatchEvent(new CustomEvent("tnt.sales.lead.selected",{detail:{lead:p}})),window.dispatchEvent(new CustomEvent("tnt.sales.lead.updated",{detail:{lead:p}}))}catch{}}}else throw new Error("저장 실패")}catch(c){B((c==null?void 0:c.message)||"저장 중 오류가 발생했습니다")}}t.useEffect(()=>{(async()=>{try{const c=await fetch("/api/v1/employees");if(!c.ok)return;const i=await c.json();if(Array.isArray(i)){let v=[...i];if(!v.some(z=>String((z==null?void 0:z.emp_name)||"")==="윤이랑"))try{const z=await fetch("/api/v1/employees?depts=all");if(z.ok){const I=await z.json();if(Array.isArray(I)){const ge=I.find(re=>String((re==null?void 0:re.emp_name)||"")==="윤이랑");ge&&(v=[...v,ge])}}}catch{}se(v)}}catch{}})()},[]);const O=!p||p.id==null,[b,d]=t.useState(!1),[x,r]=t.useState(""),[T,S]=t.useState(""),[w,l]=t.useState(!1),[C,Y]=t.useState({}),[ue,ie]=t.useState(!1),{ref:n,style:m,bindHeader:P,bindContainer:h}=At("lead.tm",b,c=>{const i=document.querySelector(".pane.center"),v=i?i.getBoundingClientRect():null,g=c.getBoundingClientRect(),z=g.width,I=g.height,ge=v?v.left+(v.width-z)/2:(window.innerWidth-z)/2,re=Math.max(0,window.innerHeight-I-16),Z=Math.min(Math.max(0,ge),window.innerWidth-z),ye=Math.min(Math.max(0,re),window.innerHeight-I);return{x:Z,y:ye}},{persist:!1,resetOnOpen:!0}),{ref:o,style:M,bindHeader:G,bindContainer:H}=At("lead.new",w,c=>{const i=document.querySelector(".pane.center"),v=i?i.getBoundingClientRect():null,g=c.getBoundingClientRect(),z=g.width,I=g.height,ge=v?v.left+(v.width-z)/2:(window.innerWidth-z)/2,re=Math.max(0,window.innerHeight*.1),Z=Math.min(Math.max(0,ge),window.innerWidth-z),ye=Math.min(Math.max(0,re),window.innerHeight-I);return{x:Z,y:ye}},{persist:!1,resetOnOpen:!0});t.useEffect(()=>{if(!w)return;const c=i=>{i.key==="Escape"&&l(!1)};return window.addEventListener("keydown",c,!0),()=>window.removeEventListener("keydown",c,!0)},[w]),t.useEffect(()=>{if(!b)return;const c=i=>{i.key==="Escape"&&d(!1)};return window.addEventListener("keydown",c,!0),()=>window.removeEventListener("keydown",c,!0)},[b]);function j(c){if(!c)return"";const i=new Date(c);return isNaN(i.getTime())?String(c):new Intl.DateTimeFormat("ko-KR",{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}).format(i)}const te=t.useMemo(()=>{const c=["신규등록","접촉 중","영업 접촉 중","전환성공"],i=((p==null?void 0:p.lead_status)||"").trim(),v=i==="자격미달"||i==="전환실패";let g=c.indexOf(i);i==="자격미달"&&(g=1),i==="전환실패"&&(g=c.length-1),g<0&&(g=0);const z=Math.max(0,Math.min(100,Math.round(g/Math.max(1,c.length-1)*100)));return e.jsxs("div",{className:"page-title",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,minWidth:0,flex:"1 1 auto"},children:[e.jsx("h2",{style:{margin:0},children:"잠재고객"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4,flex:"0 1 520px"},children:[e.jsx("div",{className:"progress",style:{width:"min(520px, 48vw)"},children:e.jsx("div",{className:"progress-bar",style:{width:`${z}%`,background:v?"#ef4444":"var(--accent)"}})}),e.jsx("div",{style:{display:"flex",justifyContent:"space-between",width:"min(520px, 48vw)",fontSize:11,color:"var(--muted)"},children:c.map(I=>e.jsx("span",{style:{fontWeight:i===I?700:400},children:I},I))})]})]}),e.jsxs("div",{className:"controls",style:{gap:8},children:[e.jsx("button",{className:"btn",onClick:()=>{Y({}),l(!0)},children:"신규"}),e.jsx("button",{className:"btn",onClick:()=>ie(!0),disabled:O,children:"영업활동 등록"}),e.jsx("button",{className:"btn",onClick:()=>{d(!0),B(null)},disabled:O,children:"TM활동 등록"})]})]})},[O,p.lead_status]);return e.jsxs("section",{children:[te,e.jsx("div",{className:"card",style:{padding:12},children:p&&p.id!=null?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-grid",style:{columnGap:10,rowGap:6},children:[e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"상태"}),e.jsxs("select",{className:"search-input",value:p.lead_status||"",onChange:c=>y("lead_status",c.target.value),children:[e.jsx("option",{value:"",children:"(선택)"}),e.jsx("option",{value:"신규등록",children:"신규등록"}),e.jsx("option",{value:"자격미달",children:"자격미달"}),e.jsx("option",{value:"접촉 중",children:"접촉 중"}),e.jsx("option",{value:"영업 접촉 중",children:"영업 접촉 중"}),e.jsx("option",{value:"전환성공",children:"전환성공"}),e.jsx("option",{value:"전환실패",children:"전환실패"})]})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"소스"}),e.jsxs("select",{className:"search-input",value:p.lead_source||"",onChange:c=>y("lead_source",c.target.value),children:[e.jsx("option",{value:"",children:"(선택)"}),e.jsx("option",{value:"목록구매",children:"목록구매"}),e.jsx("option",{value:"내부추천",children:"내부추천"}),e.jsx("option",{value:"외부추천",children:"외부추천"}),e.jsx("option",{value:"전시회/행사",children:"전시회/행사"})]})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"회사"}),e.jsx("input",{className:"search-input",type:"text",value:p.company_name||"",onChange:c=>y("company_name",c.target.value)})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"거래처 담당자"}),e.jsx("input",{className:"search-input",type:"text",value:p.contact_name||"",onChange:c=>y("contact_name",c.target.value)})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"이메일"}),e.jsx("input",{className:"search-input",type:"text",value:p.email||"",onChange:c=>y("email",c.target.value)})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"연락처"}),e.jsx("input",{className:"search-input",type:"text",value:p.contact_phone||"",onChange:c=>y("contact_phone",c.target.value)})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"대표번호"}),e.jsx("input",{className:"search-input",type:"text",value:p.office_phone||"",onChange:c=>y("office_phone",c.target.value)})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"업종"}),e.jsxs("select",{className:"search-input",value:p.biz_type||"",onChange:c=>y("biz_type",c.target.value),children:[e.jsx("option",{value:"",children:"(선택)"}),e.jsx("option",{value:"가공",children:"가공"}),e.jsx("option",{value:"시공",children:"시공"}),e.jsx("option",{value:"가시공",children:"가시공"}),e.jsx("option",{value:"유통",children:"유통"}),e.jsx("option",{value:"알수없음",children:"알수없음"})]})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"사업자번호"}),e.jsx("input",{className:"search-input",type:"text",value:p.biz_no||"",onChange:c=>y("biz_no",c.target.value)})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"지역(도/광역)"}),e.jsx("input",{className:"search-input",type:"text",value:p.addr_province_name||"",onChange:c=>y("addr_province_name",c.target.value)})]}),e.jsxs("div",{className:"field inline-field row-2",children:[e.jsx("label",{children:"주소"}),e.jsx("input",{className:"search-input",type:"text",value:p.address||"",onChange:c=>y("address",c.target.value)})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"팩스"}),e.jsx("input",{className:"search-input",type:"text",value:p.fax_no||"",onChange:c=>y("fax_no",c.target.value)})]}),e.jsxs("div",{className:"field inline-field row-2",children:[e.jsx("label",{children:"비고"}),e.jsx("textarea",{className:"search-input",value:p.note||"",onChange:c=>y("note",c.target.value),style:{minHeight:80}})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"소유자"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8,alignItems:"center"},children:[e.jsxs("select",{className:"search-input",value:p.assignee_id||"",onChange:c=>y("assignee_id",c.target.value||null),children:[e.jsx("option",{value:"",children:"(선택)"}),R.map(c=>e.jsxs("option",{value:c.assignee_id,children:[c.dept_name," · ",c.emp_name]},c.assignee_id))]}),e.jsx("div",{style:{whiteSpace:"nowrap",alignSelf:"center",fontSize:12},children:(()=>{const c=p.owner_name&&String(p.owner_name).trim()?String(p.owner_name):"",i=p.assignee_id||"",v=R.find(z=>z.assignee_id===i);return`현재소유자 : ${c||(v?v.emp_name:"")||"-"}`})()})]})]}),e.jsxs("div",{className:"field inline-four row-2",children:[e.jsx("label",{children:"작성자"}),e.jsxs("div",{className:"subject-input",style:{padding:"6px 8px"},children:[p.created_by_name||(p.created_by??"")||V||N,p.created_at?`, ${j(p.created_at)}`:""]}),e.jsx("label",{children:"최종 수정자"}),e.jsxs("div",{className:"subject-input",style:{padding:"6px 8px"},children:[p.updated_by_name||(p.updated_by??"")||V||N,p.updated_at?`, ${j(p.updated_at)}`:""]})]})]}),e.jsxs("div",{className:"controls",style:{justifyContent:"space-between",marginTop:10,gap:8},children:[e.jsx("div",{"aria-live":"polite",style:{fontSize:12,color:"var(--accent)"},children:F||""}),e.jsx("div",{children:e.jsxs("div",{style:{display:"inline-flex",gap:8},children:[e.jsx("button",{className:"btn",onClick:A,disabled:O,children:"저장"}),O?null:e.jsx("button",{className:"btn btn-danger",onClick:async()=>{if(p!=null&&p.id){`${p.id}`;try{const c=await fetch(`/api/v1/leads/${p.id}`,{method:"DELETE"});if(!c.ok){const i=await c.json().catch(()=>null);throw new Error((i==null?void 0:i.message)||`HTTP ${c.status}`)}X({open:!0,text:"삭제되었습니다."}),_({}),u(null),localStorage.removeItem("tnt.sales.selectedLead"),window.dispatchEvent(new CustomEvent("tnt.sales.lead.selected",{detail:{lead:null}})),window.dispatchEvent(new CustomEvent("tnt.sales.lead.updated",{detail:{lead:null}}))}catch(c){B((c==null?void 0:c.message)||"삭제 중 오류가 발생했습니다")}}},children:"삭제"})]})})]})]}):e.jsx("div",{className:"empty-state",children:"우측에서 잠재고객을 선택하세요."})}),b&&e.jsxs("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:1e4,pointerEvents:"none"},children:[e.jsx("div",{style:{position:"absolute",inset:0,background:"rgba(0,0,0,.25)",pointerEvents:"none"}}),e.jsxs("div",{ref:n,className:"card",style:{...m,width:"min(720px, 92vw)",maxHeight:"80vh",overflow:"auto",padding:16,pointerEvents:"auto"},...h,children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:10,cursor:"move"},...P,children:[e.jsx("h3",{style:{margin:0},children:"TM 활동 등록"}),e.jsx("span",{role:"button",tabIndex:0,className:"icon-button","aria-label":"닫기",title:"닫기",onClick:()=>d(!1),onKeyDown:c=>{(c.key==="Enter"||c.key===" ")&&(c.preventDefault(),d(!1))},children:e.jsx("img",{src:dt,className:"icon",alt:"닫기"})})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"제목"}),e.jsx("input",{className:"search-input",type:"text",value:x,onChange:c=>r(c.target.value),placeholder:"제목"})]}),e.jsxs("div",{className:"field inline-field row-2",children:[e.jsx("label",{children:"활동 설명"}),e.jsx("textarea",{className:"search-input",value:T,onChange:c=>S(c.target.value),placeholder:"활동 설명",style:{minHeight:100}})]}),e.jsxs("div",{className:"field inline-field row-2",children:[e.jsx("label",{children:"잠재고객"}),e.jsxs("div",{className:"subject-input",style:{padding:"6px 8px"},children:[p.company_name||"",p.contact_name?` / ${p.contact_name}`:"",p.contact_phone?` / ${p.contact_phone}`:""]})]}),e.jsxs("div",{className:"controls",style:{justifyContent:"flex-end",marginTop:10,gap:8},children:[e.jsx("button",{className:"btn",onClick:()=>d(!1),children:"취소"}),e.jsx("button",{className:"btn",onClick:async()=>{try{const c=localStorage.getItem("tnt.sales.assigneeId")||localStorage.getItem("tnt.sales.empId")||"";if(!c){B("로그인이 필요합니다");return}const i={sfOwnerId:c,subject:x||"",description:T||"",activityType:"전화",activityStatus:"계획",channel:"전화",sfLeadId:(p==null?void 0:p.id)!=null?String(p.id):void 0,createdBy:localStorage.getItem("tnt.sales.empId")||void 0,updatedBy:localStorage.getItem("tnt.sales.empId")||void 0},v=await fetch("/api/v1/sales-activities",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!v.ok){let g=`HTTP ${v.status}`;try{const z=await v.json();z!=null&&z.error&&(g=z.error)}catch{}throw new Error(g)}d(!1),r(""),S("");try{window.dispatchEvent(new CustomEvent("tnt.sales.activity.updated",{detail:{leadId:p==null?void 0:p.id}}))}catch{}X({open:!0,text:"TM 활동이 등록되었습니다."})}catch(c){B((c==null?void 0:c.message)||"TM 활동 등록 실패")}},children:"저장"})]})]})]}),w&&e.jsxs("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:1e4,pointerEvents:"none"},children:[e.jsx("div",{style:{position:"absolute",inset:0,background:"rgba(0,0,0,.25)",pointerEvents:"none"}}),e.jsxs("div",{ref:o,className:"card",style:{...M,width:"min(880px, 96vw)",maxHeight:"86vh",overflow:"auto",padding:16,pointerEvents:"auto"},...H,children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:10,cursor:"move"},...G,children:[e.jsx("h3",{style:{margin:0},children:"잠재고객 신규"}),e.jsx("span",{role:"button",tabIndex:0,className:"icon-button","aria-label":"닫기",title:"닫기",onClick:()=>l(!1),children:e.jsx("img",{src:dt,className:"icon",alt:"닫기"})})]}),e.jsxs("div",{className:"form-grid",style:{columnGap:10,rowGap:6},children:[e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"상태"}),e.jsxs("select",{className:"search-input",value:C.lead_status||"",onChange:c=>Y(i=>({...i,lead_status:c.target.value})),children:[e.jsx("option",{value:"",children:"(선택)"}),e.jsx("option",{value:"신규등록",children:"신규등록"}),e.jsx("option",{value:"자격미달",children:"자격미달"}),e.jsx("option",{value:"접촉 중",children:"접촉 중"}),e.jsx("option",{value:"영업 접촉 중",children:"영업 접촉 중"}),e.jsx("option",{value:"전환성공",children:"전환성공"}),e.jsx("option",{value:"전환실패",children:"전환실패"})]})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"소스"}),e.jsxs("select",{className:"search-input",value:C.lead_source||"",onChange:c=>Y(i=>({...i,lead_source:c.target.value})),children:[e.jsx("option",{value:"",children:"(선택)"}),e.jsx("option",{value:"목록구매",children:"목록구매"}),e.jsx("option",{value:"내부추천",children:"내부추천"}),e.jsx("option",{value:"외부추천",children:"외부추천"}),e.jsx("option",{value:"전시회/행사",children:"전시회/행사"})]})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"회사"}),e.jsx("input",{className:"search-input",type:"text",value:C.company_name||"",onChange:c=>Y(i=>({...i,company_name:c.target.value}))})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"거래처 담당자"}),e.jsx("input",{className:"search-input",type:"text",value:C.contact_name||"",onChange:c=>Y(i=>({...i,contact_name:c.target.value}))})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"이메일"}),e.jsx("input",{className:"search-input",type:"text",value:C.email||"",onChange:c=>Y(i=>({...i,email:c.target.value}))})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"연락처"}),e.jsx("input",{className:"search-input",type:"text",value:C.contact_phone||"",onChange:c=>Y(i=>({...i,contact_phone:c.target.value}))})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"대표번호"}),e.jsx("input",{className:"search-input",type:"text",value:C.office_phone||"",onChange:c=>Y(i=>({...i,office_phone:c.target.value}))})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"업종"}),e.jsxs("select",{className:"search-input",value:C.biz_type||"",onChange:c=>Y(i=>({...i,biz_type:c.target.value})),children:[e.jsx("option",{value:"",children:"(선택)"}),e.jsx("option",{value:"가공",children:"가공"}),e.jsx("option",{value:"시공",children:"시공"}),e.jsx("option",{value:"가시공",children:"가시공"}),e.jsx("option",{value:"유통",children:"유통"}),e.jsx("option",{value:"알수없음",children:"알수없음"})]})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"사업자번호"}),e.jsx("input",{className:"search-input",type:"text",value:C.biz_no||"",onChange:c=>Y(i=>({...i,biz_no:c.target.value}))})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"지역(도/광역)"}),e.jsx("input",{className:"search-input",type:"text",value:C.addr_province_name||"",onChange:c=>Y(i=>({...i,addr_province_name:c.target.value}))})]}),e.jsxs("div",{className:"field inline-field row-2",children:[e.jsx("label",{children:"주소"}),e.jsx("input",{className:"search-input",type:"text",value:C.address||"",onChange:c=>Y(i=>({...i,address:c.target.value}))})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"팩스"}),e.jsx("input",{className:"search-input",type:"text",value:C.fax_no||"",onChange:c=>Y(i=>({...i,fax_no:c.target.value}))})]}),e.jsxs("div",{className:"field inline-field row-2",children:[e.jsx("label",{children:"비고"}),e.jsx("textarea",{className:"search-input",value:C.note||"",onChange:c=>Y(i=>({...i,note:c.target.value})),style:{minHeight:80}})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"소유자"}),e.jsxs("select",{className:"search-input",value:C.assignee_id||"",onChange:c=>Y(i=>({...i,assignee_id:c.target.value||null})),children:[e.jsx("option",{value:"",children:"(선택)"}),R.map(c=>e.jsxs("option",{value:c.assignee_id,children:[c.dept_name," · ",c.emp_name]},c.assignee_id))]})]})]}),e.jsxs("div",{className:"controls",style:{justifyContent:"flex-end",marginTop:10,gap:8},children:[e.jsx("button",{className:"btn",onClick:()=>l(!1),children:"취소"}),e.jsx("button",{className:"btn",onClick:async()=>{try{const c={...C},i=localStorage.getItem("tnt.sales.empId")||void 0;i&&(c.created_by=i,c.updated_by=i);const v=await fetch("/api/v1/leads",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}),g=await v.json().catch(()=>({}));if(!v.ok||g&&g.error)throw new Error((g==null?void 0:g.error)||`HTTP ${v.status}`);const z=g==null?void 0:g.id,I={...C||{},id:z};try{localStorage.setItem("tnt.sales.selectedLead",JSON.stringify(I)),window.dispatchEvent(new CustomEvent("tnt.sales.lead.selected",{detail:{lead:I}})),window.dispatchEvent(new CustomEvent("tnt.sales.lead.updated",{detail:{lead:I}}))}catch{}l(!1);const ge=C.company_name||"";X({open:!0,text:`${ge} 신규 생성되었습니다.`})}catch{}},children:"저장"})]})]})]}),e.jsx(In,{open:ue,onClose:()=>ie(!1),leadId:(p==null?void 0:p.id)??null,leadName:(p==null?void 0:p.company_name)||""}),q.open?e.jsx("div",{role:"dialog","aria-modal":"true",className:"card",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.45)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:70},children:e.jsxs("div",{className:"card",style:{background:"var(--panel)",padding:12,border:"1px solid var(--border)",borderRadius:10,minWidth:260,maxWidth:"86vw"},children:[e.jsx("div",{style:{marginBottom:8,fontWeight:700,textAlign:"center"},children:q.text}),e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx("button",{className:"btn btn-card btn-3d",onClick:()=>X({open:!1,text:""}),children:"확인"})})]})}):null]})}function Ks(s){if(!s)return"";const u=s instanceof Date?s:new Date(s);if(isNaN(u.getTime()))return"";const p=String(u.getFullYear()%100).padStart(2,"0"),_=String(u.getMonth()+1).padStart(2,"0"),F=String(u.getDate()).padStart(2,"0"),B=String(u.getHours()).padStart(2,"0"),q=String(u.getMinutes()).padStart(2,"0");return`${p}-${_}-${F} ${B}:${q}`}function Fa({leadId:s}){const[u,p]=t.useState([]),[_,F]=t.useState(!1),[B,q]=t.useState(null),[X,R]=t.useState(()=>({open:!1,x:0,y:0})),[se,V]=t.useState(!1),[N,y]=t.useState(""),[A,O]=t.useState(""),[b,d]=t.useState(null),[x,r]=t.useState({open:!1,text:""});async function T(){if(!s){p([]);return}F(!0),q(null);try{const C=new URL("/api/v1/sales-activities",window.location.origin);C.searchParams.set("mineOnly","false"),C.searchParams.set("sfLeadId",String(s));const Y=await fetch(C.toString());if(!Y.ok)throw new Error(`HTTP ${Y.status}`);const ue=await Y.json(),ie=Array.isArray(ue)?ue.map(n=>({id:Number(n==null?void 0:n.id),subject:(n==null?void 0:n.subject)??"",description:(n==null?void 0:n.description)??"",activityType:(n==null?void 0:n.activityType)??"",activityStatus:(n==null?void 0:n.activityStatus)??"",channel:(n==null?void 0:n.channel)??"",plannedStartAt:(n==null?void 0:n.plannedStartAt)??null,plannedEndAt:(n==null?void 0:n.plannedEndAt)??null,createdAt:(n==null?void 0:n.createdAt)??null,lastUpdateAt:(n==null?void 0:n.lastUpdateAt)??null,ownerName:(n==null?void 0:n.ownerName)??(n==null?void 0:n.owner_name)??""})):[];p(ie)}catch(C){q((C==null?void 0:C.message)||"조회 중 오류가 발생했습니다"),p([])}finally{F(!1)}}t.useEffect(()=>{T()},[s]),t.useEffect(()=>{const C=()=>{T()};return window.addEventListener("tnt.sales.activity.updated",C),()=>window.removeEventListener("tnt.sales.activity.updated",C)},[s]),t.useEffect(()=>{if(!se)return;const C=Y=>{Y.key==="Escape"&&V(!1)};return window.addEventListener("keydown",C,!0),()=>window.removeEventListener("keydown",C,!0)},[se]),t.useEffect(()=>{se||(S.current=null)},[se]),t.useEffect(()=>{if(!X.open)return;const C=()=>R({open:!1,x:0,y:0}),Y=ue=>{ue.key==="Escape"&&R({open:!1,x:0,y:0})};return window.addEventListener("click",C,!1),window.addEventListener("keydown",Y,!0),()=>{window.removeEventListener("click",C,!1),window.removeEventListener("keydown",Y,!0)}},[X.open]);const S=t.useRef(null);function w(C){d(C.id),S.current!==C.id&&(y(C.subject||""),O(C.description||""),S.current=C.id),V(!0)}const l=t.useMemo(()=>e.jsxs("div",{className:"table-container",style:{maxHeight:"50vh",overflow:"auto"},children:[u.length===0?e.jsx("div",{className:"empty-state",children:_?"불러오는 중…":B||"활동이 없습니다."}):e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:120},children:"담당자"}),e.jsx("th",{style:{width:260},children:"제목"}),e.jsx("th",{children:"활동내역"}),e.jsx("th",{style:{width:150},children:"계획일시"}),e.jsx("th",{style:{width:150},children:"종료 일시"}),e.jsx("th",{style:{width:120},children:"활동유형"}),e.jsx("th",{style:{width:120},children:"활동상태"}),e.jsx("th",{style:{width:180},children:"최종 수정일"})]})}),e.jsx("tbody",{children:u.map(C=>e.jsxs("tr",{onContextMenu:Y=>{Y.preventDefault(),Y.stopPropagation(),R({open:!0,x:Y.clientX,y:Y.clientY,row:C})},children:[e.jsx("td",{title:C.ownerName||"",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:C.ownerName||""}),e.jsx("td",{title:C.subject||"",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:C.subject||""}),e.jsx("td",{title:C.description||"",style:{maxWidth:600,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:C.description||""}),e.jsx("td",{children:Ks(C.plannedStartAt)}),e.jsx("td",{children:Ks(C.plannedEndAt)}),e.jsx("td",{children:C.activityType||""}),e.jsx("td",{children:C.activityStatus||""}),e.jsx("td",{children:Ks(C.lastUpdateAt)})]},C.id))})]}),X.open&&X.row&&e.jsx("div",{className:"context-menu",style:{left:X.x+4,top:X.y+4},onClick:C=>C.stopPropagation(),children:e.jsx("button",{className:"context-item",style:{width:96,padding:"4px 6px"},onClick:C=>{C.preventDefault(),C.stopPropagation(),w(X.row),R({open:!1,x:0,y:0})},children:"수정"})})]}),[u,_,B,X]);return e.jsxs("section",{children:[l,se&&e.jsxs("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:2e4},children:[e.jsx("div",{style:{position:"absolute",inset:0,background:"rgba(0,0,0,.25)"}}),e.jsxs("div",{className:"card",style:{position:"absolute",left:"50%",top:"20%",transform:"translateX(-50%)",width:"min(720px, 92vw)",maxHeight:"80vh",overflow:"auto",padding:16},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:10},children:[e.jsx("h3",{style:{margin:0},children:"TM 활동 수정"}),e.jsx("span",{role:"button",tabIndex:0,className:"icon-button","aria-label":"닫기",title:"닫기",onClick:()=>V(!1),children:e.jsx("img",{src:dt,className:"icon",alt:"닫기"})})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"제목"}),e.jsx("input",{className:"search-input",type:"text",value:N,onChange:C=>y(C.target.value),placeholder:"제목"})]}),e.jsxs("div",{className:"field inline-field row-2",children:[e.jsx("label",{children:"활동 설명"}),e.jsx("textarea",{className:"search-input",value:A,onChange:C=>O(C.target.value),placeholder:"활동 설명",style:{minHeight:100}})]}),e.jsxs("div",{className:"controls",style:{justifyContent:"flex-end",marginTop:10,gap:8},children:[e.jsx("button",{className:"btn",onClick:()=>V(!1),children:"취소"}),e.jsx("button",{className:"btn",onClick:async()=>{try{if(!b)return;const C={subject:N||"",description:A||""},Y=await fetch(`/api/v1/sales-activities/${b}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(C)});if(!Y.ok)throw new Error(`HTTP ${Y.status}`);V(!1),r({open:!0,text:`${(N||"").trim()||"(제목없음)"} 변경되었습니다.`});try{window.dispatchEvent(new CustomEvent("tnt.sales.activity.updated",{detail:{id:b}}))}catch{}}catch{}},children:"저장"})]})]})]}),x.open?e.jsx("div",{role:"dialog","aria-modal":"true",className:"card",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.45)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:70},children:e.jsxs("div",{className:"card",style:{background:"var(--panel)",padding:12,border:"1px solid var(--border)",borderRadius:10,minWidth:260,maxWidth:"86vw"},children:[e.jsx("div",{style:{marginBottom:8,fontWeight:700,textAlign:"center"},children:x.text}),e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx("button",{className:"btn btn-card btn-3d",onClick:()=>r({open:!1,text:""}),children:"확인"})})]})}):null]})}function Ba(){const[s,u]=t.useState(null);return t.useEffect(()=>{try{localStorage.removeItem("tnt.sales.selectedLead")}catch{}const p=()=>{try{const _=localStorage.getItem("tnt.sales.selectedLead");u(_?JSON.parse(_):null)}catch{u(null)}};return window.addEventListener("tnt.sales.lead.selected",p),()=>window.removeEventListener("tnt.sales.lead.selected",p)},[]),e.jsxs("section",{children:[e.jsx(Oa,{}),e.jsxs("section",{className:"card",style:{marginTop:12,minHeight:240},children:[e.jsx("div",{className:"tabs c360-tabs",children:e.jsx("button",{className:"tab active",children:"활동"})}),e.jsx("div",{style:{marginTop:12},children:s!=null&&s.id?e.jsx(Fa,{leadId:s.id}):e.jsx("div",{style:{minHeight:160}})})]})]})}function Ua(s){if(!s)return"-";const u=new Date(s);if(Number.isNaN(u.getTime()))return"-";const p=R=>String(R).padStart(2,"0"),_=p(u.getFullYear()%100),F=p(u.getMonth()+1),B=p(u.getDate()),q=p(u.getHours()),X=p(u.getMinutes());return`${_}-${F}-${B} ${q}:${X}`}function Ha(){const[s,u]=t.useState("weekly"),[p,_]=t.useState("owner"),[F,B]=t.useState(""),[q,X]=t.useState(()=>new Date().toISOString().split("T")[0]),[R,se]=t.useState([]),[V,N]=t.useState([]),[y,A]=t.useState(null),[O,b]=t.useState([]),[d,x]=t.useState(null),[r,T]=t.useState(!1),[S,w]=t.useState([]);t.useEffect(()=>{(async()=>{try{const n=await fetch("/api/v1/employees");if(!n.ok)return;const m=await n.json();if(Array.isArray(m)){let P=[...m];if(!P.some(o=>String((o==null?void 0:o.emp_name)||"")==="윤이랑"))try{const o=await fetch("/api/v1/employees?depts=all");if(o.ok){const M=await o.json();if(Array.isArray(M)){const G=M.find(H=>String((H==null?void 0:H.emp_name)||"")==="윤이랑");G&&(P=[...P,G])}}}catch{}w(P)}}catch{}})()},[]);function l(){const n=new Date(q);if(s==="daily"){const m=new Date(n);m.setDate(m.getDate()-1);const P=new Date(n);return P.setDate(P.getDate()+1),[{label:"전일",startDate:m.toISOString().split("T")[0],endDate:m.toISOString().split("T")[0],count:0},{label:"금일",startDate:q,endDate:q,count:0},{label:"익일",startDate:P.toISOString().split("T")[0],endDate:P.toISOString().split("T")[0],count:0}]}else if(s==="weekly"){const m=new Date(n),P=m.getDay(),h=m.getDate()-P+(P===0?-6:1),o=new Date(m.setDate(h)),M=o.toISOString().split("T")[0],G=new Date(o);G.setDate(G.getDate()+6);const H=new Date(o);H.setDate(H.getDate()-7);const j=new Date(H);j.setDate(j.getDate()+6);const te=new Date(o);te.setDate(te.getDate()+7);const c=new Date(te);return c.setDate(c.getDate()+6),[{label:"전주",startDate:H.toISOString().split("T")[0],endDate:j.toISOString().split("T")[0],count:0},{label:"금주",startDate:M,endDate:G.toISOString().split("T")[0],count:0},{label:"차주",startDate:te.toISOString().split("T")[0],endDate:c.toISOString().split("T")[0],count:0}]}else{const m=new Date(n),P=new Date(m.getFullYear(),m.getMonth(),1),h=new Date(m.getFullYear(),m.getMonth()+1,0),o=new Date(m.getFullYear(),m.getMonth()-1,1),M=new Date(m.getFullYear(),m.getMonth(),0),G=new Date(m.getFullYear(),m.getMonth()+1,1),H=new Date(m.getFullYear(),m.getMonth()+2,0);return[{label:"전월",startDate:o.toISOString().split("T")[0],endDate:M.toISOString().split("T")[0],count:0},{label:"금월",startDate:P.toISOString().split("T")[0],endDate:h.toISOString().split("T")[0],count:0},{label:"익월",startDate:G.toISOString().split("T")[0],endDate:H.toISOString().split("T")[0],count:0}]}}async function C(){T(!0),A(null),b([]),x(null);const n=l();try{const m={period:s,filterType:p,baseDate:q};F&&(m.empId=F);const P=new URLSearchParams(m),[h,o]=await Promise.all([fetch(`/api/v1/lead-stats/registration?${P.toString()}`),fetch(`/api/v1/lead-stats/activity?${P.toString()}`)]);if(h.ok&&o.ok){const M=await h.json(),G=await o.json(),H=(j,te)=>!Array.isArray(j)||j.length===0?te:j.map(c=>({label:c.label,count:Number(c.count)||0,startDate:c.startDate||q,endDate:c.endDate||q}));se(H(M,n)),N(H(G,n))}else{if(console.error("Failed to fetch stats. Reg:",h.status,"Act:",o.status),!h.ok){const M=await h.text();console.error("Registration error:",M)}if(!o.ok){const M=await o.text();console.error("Activity error:",M)}se(n),N(n)}}catch(m){console.error("Failed to load stats",m),se(n),N(n)}finally{T(!1)}}async function Y(n){try{const m=p==="owner"&&F?`AND CAST(l.assignee_id AS TEXT) = '${F}'`:"",P=p==="creator"&&F?`AND CAST(l.created_by AS TEXT) = '${F}'`:"",h={filterType:p,startDate:n.startDate,endDate:n.endDate};F&&(h.empId=F);const o=new URLSearchParams(h),M=await fetch(`/api/v1/lead-stats/registration/details?${o.toString()}`);if(M.ok){const G=await M.json();b(G),A(n),x(null)}}catch(m){console.error("Failed to load registration details",m)}}function ue(n){const m=new Date(q);let P;s==="daily"?P=n==="prev"?new Date(m.setDate(m.getDate()-1)):new Date(m.setDate(m.getDate()+1)):s==="weekly"?P=n==="prev"?new Date(m.setDate(m.getDate()-7)):new Date(m.setDate(m.getDate()+7)):P=n==="prev"?new Date(m.setMonth(m.getMonth()-1)):new Date(m.setMonth(m.getMonth()+1));const h=P.toISOString().split("T")[0];X(h),setTimeout(()=>{ie(h)},0)}async function ie(n){T(!0),A(null),b([]),x(null);const P=(()=>{const h=new Date(n);if(s==="daily"){const o=new Date(h);o.setDate(o.getDate()-1);const M=new Date(h);return M.setDate(M.getDate()+1),[{label:"전일",startDate:o.toISOString().split("T")[0],endDate:o.toISOString().split("T")[0],count:0},{label:"금일",startDate:n,endDate:n,count:0},{label:"익일",startDate:M.toISOString().split("T")[0],endDate:M.toISOString().split("T")[0],count:0}]}else if(s==="weekly"){const o=new Date(h),M=o.getDay(),G=o.getDate()-M+(M===0?-6:1),H=new Date(o.setDate(G)),j=H.toISOString().split("T")[0],te=new Date(H);te.setDate(te.getDate()+6);const c=new Date(H);c.setDate(c.getDate()-7);const i=new Date(c);i.setDate(i.getDate()+6);const v=new Date(H);v.setDate(v.getDate()+7);const g=new Date(v);return g.setDate(g.getDate()+6),[{label:"전주",startDate:c.toISOString().split("T")[0],endDate:i.toISOString().split("T")[0],count:0},{label:"금주",startDate:j,endDate:te.toISOString().split("T")[0],count:0},{label:"차주",startDate:v.toISOString().split("T")[0],endDate:g.toISOString().split("T")[0],count:0}]}else{const o=new Date(h),M=new Date(o.getFullYear(),o.getMonth(),1),G=new Date(o.getFullYear(),o.getMonth()+1,0),H=new Date(o.getFullYear(),o.getMonth()-1,1),j=new Date(o.getFullYear(),o.getMonth(),0),te=new Date(o.getFullYear(),o.getMonth()+1,1),c=new Date(o.getFullYear(),o.getMonth()+2,0);return[{label:"전월",startDate:H.toISOString().split("T")[0],endDate:j.toISOString().split("T")[0],count:0},{label:"금월",startDate:M.toISOString().split("T")[0],endDate:G.toISOString().split("T")[0],count:0},{label:"익월",startDate:te.toISOString().split("T")[0],endDate:c.toISOString().split("T")[0],count:0}]}})();try{const h={period:s,filterType:p,baseDate:n};F&&(h.empId=F);const o=new URLSearchParams(h),[M,G]=await Promise.all([fetch(`/api/v1/lead-stats/registration?${o.toString()}`),fetch(`/api/v1/lead-stats/activity?${o.toString()}`)]);if(M.ok&&G.ok){const H=await M.json(),j=await G.json(),te=(c,i)=>!Array.isArray(c)||c.length===0?i:c.map(v=>({label:v.label,count:Number(v.count)||0,startDate:v.startDate||n,endDate:v.endDate||n}));se(te(H,P)),N(te(j,P))}else se(P),N(P)}catch(h){console.error("Failed to load stats",h),se(P),N(P)}finally{T(!1)}}return e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[e.jsx("div",{style:{padding:"16px 20px",borderBottom:"1px solid var(--border)",background:"var(--panel)"},children:e.jsx("h2",{style:{margin:0,fontSize:18,fontWeight:700,color:"var(--text)"},children:"TM현황"})}),e.jsxs("div",{style:{padding:"12px 20px",borderBottom:"1px solid var(--border)",background:"var(--panel)",display:"flex",gap:12,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("label",{style:{fontSize:13,color:"var(--muted)",whiteSpace:"nowrap"},children:"조회기간:"}),e.jsxs("select",{value:s,onChange:n=>u(n.target.value),style:{height:32,padding:"0 8px",borderRadius:6,border:"1px solid var(--border)",background:"var(--panel)",color:"var(--text)",fontSize:13},children:[e.jsx("option",{value:"daily",children:"일별"}),e.jsx("option",{value:"weekly",children:"주간"}),e.jsx("option",{value:"monthly",children:"월간"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("label",{style:{fontSize:13,color:"var(--muted)",whiteSpace:"nowrap"},children:"구분:"}),e.jsxs("select",{value:p,onChange:n=>_(n.target.value),style:{height:32,padding:"0 8px",borderRadius:6,border:"1px solid var(--border)",background:"var(--panel)",color:"var(--text)",fontSize:13},children:[e.jsx("option",{value:"owner",children:"소유자"}),e.jsx("option",{value:"creator",children:"등록자"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsxs("label",{style:{fontSize:13,color:"var(--muted)",whiteSpace:"nowrap"},children:[p==="owner"?"소유자":"등록자",":"]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8,alignItems:"center"},children:[e.jsxs("select",{className:"search-input",value:F||"",onChange:n=>B(n.target.value||""),style:{height:32,padding:"0 8px",borderRadius:6,border:"1px solid var(--border)",background:"var(--panel)",color:"var(--text)",fontSize:13,minWidth:160},children:[e.jsx("option",{value:"",children:"전체"}),S.map(n=>e.jsxs("option",{value:n.assignee_id,children:[n.dept_name," · ",n.emp_name]},n.assignee_id))]}),e.jsx("div",{style:{whiteSpace:"nowrap",alignSelf:"center",fontSize:12,color:"var(--muted)"},children:(()=>{const n=S.find(P=>P.assignee_id===F);return`현재선택 : ${n?n.emp_name:"전체"}`})()})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("label",{style:{fontSize:13,color:"var(--muted)",whiteSpace:"nowrap"},children:"기준일자:"}),e.jsx("input",{type:"date",value:q,onChange:n=>X(n.target.value),style:{height:32,padding:"0 8px",borderRadius:6,border:"1px solid var(--border)",background:"var(--panel)",color:"var(--text)",fontSize:13}})]}),e.jsx("button",{onClick:C,disabled:r,className:"btn btn-card btn-3d",style:{height:32,fontSize:13,padding:"0 20px",fontWeight:600},children:r?"조회 중...":"조회"}),e.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:8},children:[e.jsx("button",{onClick:()=>ue("prev"),className:"btn btn-card",style:{height:32,width:32,padding:0,display:"flex",alignItems:"center",justifyContent:"center"},title:"이전",disabled:R.length===0&&V.length===0,children:e.jsx("img",{src:jn,alt:"이전",style:{width:16,height:16}})}),e.jsx("button",{onClick:()=>ue("next"),className:"btn btn-card",style:{height:32,width:32,padding:0,display:"flex",alignItems:"center",justifyContent:"center"},title:"다음",disabled:R.length===0&&V.length===0,children:e.jsx("img",{src:vn,alt:"다음",style:{width:16,height:16}})})]})]}),e.jsx("div",{style:{flex:1,minHeight:0,overflow:"auto",padding:20},children:r?e.jsx("div",{style:{textAlign:"center",padding:40,color:"var(--muted)"},children:"데이터를 불러오는 중..."}):e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:20,height:"100%"},children:[e.jsxs("div",{style:{flex:"0 0 auto",display:"flex",gap:20,flexWrap:"wrap"},children:[e.jsxs("div",{style:{flex:1,minWidth:0,display:"flex",flexDirection:"column",gap:12},children:[e.jsx("h3",{style:{margin:0,fontSize:15,fontWeight:600,color:"var(--text)"},children:"잠재고객 등록현황"}),R.length===0?e.jsxs("div",{style:{textAlign:"center",padding:40,background:"var(--panel)",border:"1px solid var(--border)",borderRadius:8},children:[e.jsx("div",{style:{fontSize:48,marginBottom:16,opacity:.3},children:"📊"}),e.jsx("div",{style:{fontSize:15,color:"var(--muted)",marginBottom:8},children:"조회 조건을 설정하고 조회 버튼을 클릭하세요"})]}):e.jsx(e.Fragment,{children:e.jsx("div",{style:{display:"flex",gap:12},children:R.map((n,m)=>e.jsxs("button",{onClick:()=>Y(n),className:"btn btn-card btn-3d",style:{flex:1,minHeight:120,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",gap:8,background:(y==null?void 0:y.label)===n.label?"var(--primary)":"var(--panel)",color:(y==null?void 0:y.label)===n.label?"#fff":"var(--text)",border:(y==null?void 0:y.label)===n.label?"2px solid var(--primary)":"1px solid var(--border)"},children:[e.jsx("div",{style:{fontSize:14,fontWeight:600},children:n.label}),e.jsx("div",{style:{fontSize:28,fontWeight:700},children:n.count}),e.jsx("div",{style:{fontSize:11,opacity:.7},children:n.startDate===n.endDate?n.startDate:`${n.startDate} ~ ${n.endDate}`})]},m))})})]}),e.jsxs("div",{style:{flex:1,minWidth:0,display:"flex",flexDirection:"column",gap:12},children:[e.jsx("h3",{style:{margin:0,fontSize:15,fontWeight:600,color:"var(--text)"},children:"잠재고객 활동현황"}),V.length===0?e.jsxs("div",{style:{textAlign:"center",padding:40,background:"var(--panel)",border:"1px solid var(--border)",borderRadius:8},children:[e.jsx("div",{style:{fontSize:48,marginBottom:16,opacity:.3},children:"📊"}),e.jsx("div",{style:{fontSize:15,color:"var(--muted)",marginBottom:8},children:"조회 조건을 설정하고 조회 버튼을 클릭하세요"})]}):e.jsx("div",{style:{display:"flex",gap:12},children:V.map((n,m)=>e.jsxs("div",{className:"btn-card btn-3d",style:{flex:1,minHeight:120,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",gap:8,background:"var(--panel)",color:"var(--text)",border:"1px solid var(--border)",cursor:"default",opacity:.8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:600},children:n.label}),e.jsx("div",{style:{fontSize:28,fontWeight:700},children:n.count}),e.jsx("div",{style:{fontSize:11,opacity:.7},children:n.startDate===n.endDate?n.startDate:`${n.startDate} ~ ${n.endDate}`})]},m))})]})]}),y&&O.length>0&&e.jsxs("div",{style:{flex:1,minHeight:0,display:"flex",gap:12},children:[e.jsxs("div",{style:{flex:1,minWidth:0,overflow:"auto",background:"var(--panel)",border:"1px solid var(--border)",borderRadius:8,padding:12},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[e.jsxs("h4",{style:{margin:0,fontSize:14,fontWeight:600,color:"var(--text)"},children:[y.label," 등록 목록 (",O.length,"건)"]}),e.jsx("span",{style:{fontSize:12,color:"#e11d48",fontWeight:600},children:"잠재고객 클릭시 활동 조회"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:O.map(n=>e.jsxs("button",{onClick:()=>x(n.id),style:{padding:10,background:d===n.id?"var(--primary-light)":"var(--background)",border:d===n.id?"2px solid var(--primary)":"1px solid var(--border)",borderRadius:6,fontSize:13,textAlign:"left",cursor:"pointer",transition:"all 0.2s"},children:[e.jsxs("div",{style:{fontWeight:600,color:d===n.id?"var(--primary)":"var(--text)",marginBottom:4},children:[n.company_name||"-",n.activities&&n.activities.length>0&&e.jsxs("span",{style:{marginLeft:8,fontSize:11,color:"var(--muted)"},children:["(활동 ",n.activities.length,"건)"]})]}),e.jsxs("div",{style:{color:"var(--muted)",fontSize:12},children:["담당자: ",n.contact_name||"-"]}),e.jsxs("div",{style:{color:"var(--muted)",fontSize:12,marginTop:4},children:["상태: ",n.lead_status||"-"," | 업종: ",n.biz_type||"-"]}),e.jsxs("div",{style:{color:"var(--muted)",fontSize:12,marginTop:4},children:["지역: ",n.addr_province_name||"-"]}),e.jsxs("div",{style:{color:"var(--muted)",fontSize:12,marginTop:4},children:["최종수정: ",Ua(n.updated_at)]})]},n.id))})]}),d&&(()=>{var m;const n=O.find(P=>P.id===d);return n?e.jsxs("div",{style:{flex:1,minWidth:0,overflow:"auto",background:"var(--panel)",border:"1px solid var(--border)",borderRadius:8,padding:12},children:[e.jsxs("h4",{style:{margin:"0 0 12px",fontSize:14,fontWeight:600,color:"var(--text)"},children:[n.company_name||"-"," 활동 목록 (",((m=n.activities)==null?void 0:m.length)||0,"건)"]}),!n.activities||n.activities.length===0?e.jsx("div",{style:{textAlign:"center",padding:20,color:"var(--muted)",fontSize:13},children:"활동 데이터가 없습니다"}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:n.activities.map(P=>e.jsxs("div",{style:{padding:10,background:"var(--background)",border:"1px solid var(--border)",borderRadius:6,fontSize:13},children:[e.jsx("div",{style:{fontWeight:600,color:"var(--text)",marginBottom:4},children:P.subject||"-"}),e.jsxs("div",{style:{color:"var(--muted)",fontSize:12},children:["유형: ",P.activity_type||"-"," | 상태: ",P.activity_status||"-"]}),e.jsxs("div",{style:{color:"var(--muted)",fontSize:12,marginTop:4},children:["계획: ",P.planned_start_at?new Date(P.planned_start_at).toLocaleString("ko-KR"):"-"]}),P.actual_start_at&&e.jsxs("div",{style:{color:"var(--muted)",fontSize:12,marginTop:4},children:["실제: ",new Date(P.actual_start_at).toLocaleString("ko-KR")]}),P.description&&e.jsx("div",{style:{color:"var(--muted)",fontSize:12,marginTop:4},children:P.description}),e.jsxs("div",{style:{color:"var(--muted)",fontSize:12,marginTop:4},children:["수정: ",P.updated_at?new Date(P.updated_at).toLocaleString("ko-KR"):"-"]})]},P.id))})]}):null})()]})]})})]})}const gn="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%20fill='none'%20stroke='currentColor'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'%3e%3cline%20x1='12'%20y1='5'%20x2='12'%20y2='19'/%3e%3cline%20x1='5'%20y1='12'%20x2='19'%20y2='12'/%3e%3c/svg%3e";function Ya(){const[s,u]=t.useState(""),[p,_]=t.useState(""),[F,B]=t.useState([]),[q,X]=t.useState(!1),[R,se]=t.useState(null),[V,N]=t.useState(null),[y,A]=t.useState([]),[O,b]=t.useState(!1),[d,x]=t.useState(!1),[r,T]=t.useState({open:!1,x:0,y:0}),S=t.useRef(null);async function w(g){try{b(!0);const z=V!=null?F[V]:null,I=new URLSearchParams;I.set("q",p.trim()||s.trim());const ge=g??(z==null?void 0:z.customerSeq);ge!=null&&I.set("customerSeq",String(ge));const re=await fetch(`/api/v1/items/search?${I.toString()}`),Z=re.ok?await re.json():[],ye=Array.isArray(Z)?Z.map(L=>({itemSeq:L==null?void 0:L.itemSeq,itemName:String((L==null?void 0:L.itemName)??""),recentInvoiceDate:(L==null?void 0:L.recentInvoiceDate)??(L==null?void 0:L.recent_invoice_date)??null,curAmt:(L==null?void 0:L.curAmt)??null,qty:(L==null?void 0:L.qty)??null,srcPri:(L==null?void 0:L.srcPri)!=null?Number(L.srcPri):void 0,itemStdUnit:(L==null?void 0:L.itemStdUnit)??(L==null?void 0:L.item_std_unit)??null,companyType:(L==null?void 0:L.companyType)||(L==null?void 0:L.company_type)||null})):[];A(ye)}catch{A([])}finally{b(!1)}}const[l,C]=t.useState(()=>({open:!1,text:""})),[Y,ue]=t.useState([]);async function ie(g){if(!(g==null||g.itemName==null)){x(!0);try{let z,I=typeof g.itemStdUnit=="string"?g.itemStdUnit:void 0,ge,re;const Z=await fetch(`/api/v1/items/spec?itemName=${encodeURIComponent(String(g.itemName))}`);if(Z.ok){const fe=await Z.json().catch(()=>({}));fe&&fe.itemSpec&&(z=String(fe.itemSpec)),!I&&fe&&fe.itemStdUnit&&(ge=String(fe.itemStdUnit),I=ge),fe&&fe.companyType&&(re=String(fe.companyType))}const ye=localStorage.getItem("tnt.sales.ordersheet.cart"),L=ye?JSON.parse(ye):[];if((Array.isArray(L)?L.findIndex(fe=>String(fe.itemName)===String(g.itemName)):-1)>=0){alert("이미 주문에 포함되어 있습니다."),x(!1);return}else{const fe=re||g.companyType||null,Se={itemSeq:g.itemSeq,itemName:g.itemName,itemSpec:z||"",qty:"",itemStdUnit:I||void 0,companyType:fe};L.push(Se)}localStorage.setItem("tnt.sales.ordersheet.cart",JSON.stringify(L)),window.dispatchEvent(new CustomEvent("tnt.sales.ordersheet.cart.changed",{detail:{cart:L}}))}catch{}finally{x(!1)}}}function n(g){try{const I=[JSON.parse(g)];let ge=null;for(;I.length;){const re=I.shift();if(Array.isArray(re)){if(re.length&&typeof re[0]=="object"){ge=re;break}}else if(re&&typeof re=="object")for(const Z of Object.keys(re))I.push(re[Z])}return ge?ge.map(re=>{const Z=(re==null?void 0:re.WHName)??(re==null?void 0:re.whName)??(re==null?void 0:re.warehouseName)??(re==null?void 0:re.WH_NM)??(re==null?void 0:re.wh_nm)??"",ye=Number((re==null?void 0:re.AvailStock)??(re==null?void 0:re.availStock)??(re==null?void 0:re.AVAIL_STOCK)??(re==null?void 0:re.qty)??0)||0,L=(re==null?void 0:re.UnitName)??(re==null?void 0:re.unitName)??(re==null?void 0:re.UNIT_NAME)??(re==null?void 0:re.salesMgmtUnit)??"";return{whName:String(Z||""),avail:ye,unitName:String(L||"")}}):[]}catch{return[]}}async function m(g,z){const ge=g.currentTarget.getBoundingClientRect(),re=ge.right,Z=ge.bottom;T({open:!0,x:re,y:Z,loading:!0});try{const ye={bizUnit:"",stdDate:"",whSeq:"",itemName:String(z.itemName||""),itemNo:"",itemSeq:String(z.itemSeq||""),pageNo:"",pageSize:""},L=await fetch("/api/v1/items/avail-stock",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ye)});if(L.ok){const he=await L.json().catch(()=>({})),fe=he&&(he.receivedPayload||he),Se=JSON.stringify(fe,null,2),Ae=n(Se);T({open:!0,x:re,y:Z,loading:!1,error:null,rows:Ae})}else T({open:!0,x:re,y:Z,loading:!1,error:`HTTP ${L.status}`})}catch(ye){T({open:!0,x:re,y:Z,loading:!1,error:(ye==null?void 0:ye.message)||"재고 조회 실패"})}}t.useEffect(()=>{if(!r.open)return;const g=I=>{const ge=S.current;ge&&I.target instanceof Node&&!ge.contains(I.target)&&T({open:!1,x:0,y:0})},z=I=>{I.key==="Escape"&&T({open:!1,x:0,y:0})};return document.addEventListener("mousedown",g,!0),window.addEventListener("keydown",z,!0),()=>{document.removeEventListener("mousedown",g,!0),window.removeEventListener("keydown",z,!0)}},[r.open]);async function P(){var g;X(!0),se(null);try{const z=new URLSearchParams;s.trim()&&z.set("name",s.trim()),z.set("mineOnly","false");const I=await fetch(`/api/v1/customers?${z.toString()}`);if(!I.ok)throw new Error(`HTTP ${I.status}`);const ge=await I.json(),re=Array.isArray(ge)?ge.map(Z=>({customerId:(Z==null?void 0:Z.customerId)??"",customerName:(Z==null?void 0:Z.customerName)??"",bizNo:(Z==null?void 0:Z.bizNo)??"",ownerName:(Z==null?void 0:Z.ownerName)??(Z==null?void 0:Z.empName)??"",telNo:(Z==null?void 0:Z.telNo)??"",customerSeq:(Z==null?void 0:Z.customerSeq)!=null?Number(Z.customerSeq):void 0,addrProvinceName:(Z==null?void 0:Z.addrProvinceName)??(Z==null?void 0:Z.addr_province_name)??"",addrCityName:(Z==null?void 0:Z.addrCityName)??(Z==null?void 0:Z.addr_city_name)??"",companyType:String((Z==null?void 0:Z.company_type)??(Z==null?void 0:Z.companyType)??(Z==null?void 0:Z.company)??"").toUpperCase(),companyCode:String((Z==null?void 0:Z.companyCode)??(Z==null?void 0:Z.company_code)??(Z==null?void 0:Z.company_type)??(Z==null?void 0:Z.companyType)??(Z==null?void 0:Z.company)??"").toUpperCase()})):[];if(re.sort((Z,ye)=>String(Z.customerName||"").localeCompare(String(ye.customerName||""),"ko-KR")),B(re),re.length>0){N(0);try{localStorage.setItem("tnt.sales.ordersheet.selectedCustomer",JSON.stringify(re[0])),window.dispatchEvent(new CustomEvent("tnt.sales.ordersheet.customer.selected",{detail:{customer:re[0]}}))}catch{}await w((g=re[0])==null?void 0:g.customerSeq)}else N(null),A([])}catch(z){se((z==null?void 0:z.message)||"조회 중 오류가 발생했습니다"),B([])}finally{X(!1)}}t.useEffect(()=>{try{localStorage.removeItem("tnt.sales.ordersheet.selectedCustomer"),localStorage.removeItem("tnt.sales.ordersheet.cart"),localStorage.removeItem("tnt.sales.ordersheet.regionGroup"),localStorage.removeItem("tnt.sales.ordersheet.requests"),localStorage.removeItem("tnt.sales.ordersheet.deliveryDueDate")}catch{}},[]);function h(g,z){N(z);try{localStorage.setItem("tnt.sales.ordersheet.selectedCustomer",JSON.stringify(g)),window.dispatchEvent(new CustomEvent("tnt.sales.ordersheet.customer.selected",{detail:{customer:g}}))}catch{}w(g.customerSeq),o(g.customerSeq)}async function o(g){try{ue([]);const z=g!=null?Number(g):NaN;if(!Number.isFinite(z))return;const I=await fetch(`/api/v1/customers/${z}/transactions`,{cache:"no-store"});if(!I.ok)return;const ge=await I.json().catch(()=>[]);if(!Array.isArray(ge)){ue([]);return}const re=Date.now()-365*24*60*60*1e3,Z={};for(const L of ge){const he=String((L==null?void 0:L.itemName)??(L==null?void 0:L.item_name)??"").trim();if(!he)continue;const fe=(L==null?void 0:L.itemSeq)??(L==null?void 0:L.item_seq)??null,Se=(L==null?void 0:L.companyType)??(L==null?void 0:L.company_type)??null,Ae=Number((L==null?void 0:L.curAmt)??(L==null?void 0:L.cur_amt)??0)||0,E=Number((L==null?void 0:L.qty)??0)||0,ve=String((L==null?void 0:L.invoiceDate)??(L==null?void 0:L.invoice_date)??""),ee=Date.parse(ve)||Date.parse(ve.replace(" ","T"))||NaN;if(!Number.isFinite(ee)||ee<re)continue;const _e=fe!=null?String(fe):he,Pe=Z[_e]||{itemSeq:fe,itemName:he,companyType:Se||null,recent:0,totalAmt:0,totalQty:0};Pe.totalAmt+=Ae,Pe.totalQty+=E,ee>Pe.recent&&(Pe.recent=ee),Pe.itemSeq==null&&fe!=null&&(Pe.itemSeq=fe),!Pe.companyType&&Se&&(Pe.companyType=Se),Z[_e]=Pe}const ye=Object.values(Z).sort((L,he)=>he.recent-L.recent||L.itemName.localeCompare(he.itemName,"ko",{sensitivity:"base"})).map(L=>({itemSeq:L.itemSeq,itemName:L.itemName,companyType:L.companyType,recentDate:new Date(L.recent).toISOString().slice(0,10),totalAmt:L.totalAmt,totalQty:L.totalQty}));ue(ye)}catch{ue([])}}const M=t.useMemo(()=>e.jsx("div",{className:"table-container",style:{maxHeight:"40vh"},children:F.length===0?e.jsx("div",{className:"empty-state",children:q?"불러오는 중…":R||"데이터가 없습니다"}):e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:160},children:"회사코드"}),e.jsx("th",{children:"거래처명"}),e.jsx("th",{style:{width:160},children:"대표자"}),e.jsx("th",{style:{width:180},children:"사업자번호"}),e.jsx("th",{style:{width:160},children:"대표번호"})]})}),e.jsx("tbody",{children:F.map((g,z)=>e.jsxs("tr",{className:V===z?"selected":void 0,onClick:()=>h(g,z),children:[e.jsx("td",{children:g.companyCode||g.companyType||""}),e.jsx("td",{children:g.customerName}),e.jsx("td",{children:g.ownerName}),e.jsx("td",{children:g.bizNo}),e.jsx("td",{children:g.telNo})]},z))})]})}),[F,q,R,V]),G=t.useMemo(()=>Y.length===0?null:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"muted",style:{fontSize:12,marginTop:8,marginBottom:4},children:"최근거래내역"}),e.jsx("div",{className:"table-container",style:{maxHeight:"24vh"},children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"품목"}),e.jsx("th",{style:{width:120},children:"최근거래일"}),e.jsx("th",{style:{width:140,textAlign:"right"},children:"총금액"}),e.jsx("th",{style:{width:100,textAlign:"right"},children:"총수량"}),e.jsx("th",{style:{width:80}})]})}),e.jsx("tbody",{children:Y.map((g,z)=>e.jsxs("tr",{children:[e.jsx("td",{children:g.itemName}),e.jsx("td",{children:g.recentDate}),e.jsx("td",{style:{textAlign:"right"},children:Number(g.totalAmt||0).toLocaleString()}),e.jsx("td",{style:{textAlign:"right"},children:Number(g.totalQty||0).toLocaleString()}),e.jsxs("td",{children:[e.jsx("span",{role:"button",tabIndex:0,className:"icon-button","aria-label":"재고 조회",title:"재고 조회",onClick:I=>te(I,g.itemName),onKeyDown:I=>{(I.key==="Enter"||I.key===" ")&&(I.preventDefault(),te(I,g.itemName))},children:e.jsx("img",{src:rn,className:"icon",alt:"재고"})}),e.jsx("span",{role:"button",tabIndex:0,className:"icon-button","aria-label":"담기",title:"담기",onClick:()=>c(g),onKeyDown:I=>{(I.key==="Enter"||I.key===" ")&&(I.preventDefault(),c(g))},children:e.jsx("img",{src:gn,className:"icon",alt:"담기"})})]})]},z))})]})})]}),[Y]);function H(){try{const g=localStorage.getItem("tnt.sales.ordersheet.selectedCustomer");if(!g)return null;const z=JSON.parse(g),I=Number(z==null?void 0:z.customerSeq);return Number.isFinite(I)?I:null}catch{return null}}async function j(g){const z=y.find(I=>String(I.itemName).trim()===String(g).trim());if(z&&z.itemSeq!=null)return{itemSeq:z.itemSeq,itemName:z.itemName};try{const I=new URLSearchParams;I.set("q",g);const ge=H();ge!=null&&I.set("customerSeq",String(ge));const re=await fetch(`/api/v1/items/search?${I.toString()}`),Z=re.ok?await re.json():[],ye=Array.isArray(Z)?Z:[],L=ye.find(he=>String((he==null?void 0:he.itemName)||"").trim()===String(g).trim())||ye[0];if(L&&L.itemSeq!=null)return{itemSeq:L.itemSeq,itemName:String(L.itemName||g)}}catch{}return null}async function te(g,z){const I=await j(z);I&&await m(g,I)}async function c(g){let z=g;if(!z.itemSeq){const I=await j(g.itemName);if(!I)return;z={...z,...I}}await ie({itemSeq:z.itemSeq,itemName:z.itemName,companyType:z.companyType||void 0})}const i=new Intl.NumberFormat("ko-KR"),v=t.useMemo(()=>e.jsx("div",{className:"table-container",style:{maxHeight:"32vh",marginTop:12},children:y.length===0?e.jsx("div",{className:"empty-state",children:O?"품목 불러오는 중…":"품목 데이터가 없습니다"}):e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"품목명"}),e.jsx("th",{style:{width:140},children:"최근거래일시"}),e.jsx("th",{style:{width:120,textAlign:"right"},children:"총금액"}),e.jsx("th",{style:{width:100,textAlign:"right"},children:"총수량"}),e.jsx("th",{style:{width:90}})]})}),e.jsx("tbody",{children:y.map((g,z)=>e.jsxs("tr",{className:g.srcPri===0?"inv-row":void 0,onDoubleClick:()=>ie(g),title:"더블클릭하면 우측 수주장에 담습니다",children:[e.jsxs("td",{style:{display:"flex",alignItems:"center",gap:6},children:[(()=>{const ge=(g.companyType||g.company_type||g.companyCode||g.company_code||"").toString().toUpperCase(),re=ge==="TNT"?"T":ge==="DYS"?"D":ge==="ALL"?"A":"",Z=ge==="TNT"?"#2563eb":ge==="DYS"?"#10b981":ge==="ALL"?"#f59e0b":"#9ca3af";return re?e.jsx("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:18,height:18,borderRadius:"50%",background:Z,color:"#fff",fontSize:11,fontWeight:800,boxShadow:"0 0 0 1px rgba(0,0,0,.08)"},children:re}):null})(),e.jsx("span",{children:g.itemName}),g.itemStdUnit?e.jsxs("span",{style:{fontSize:11,color:"var(--text-muted)"},children:["(",g.itemStdUnit,")"]}):null]}),e.jsx("td",{children:g.recentInvoiceDate||""}),e.jsx("td",{style:{textAlign:"right"},children:g.curAmt!=null&&g.curAmt!==""?i.format(Number(g.curAmt)):""}),e.jsx("td",{style:{textAlign:"right"},children:g.qty!=null&&g.qty!==""?i.format(Number(g.qty)):""}),e.jsxs("td",{children:[e.jsx("span",{role:"button",tabIndex:0,className:"icon-button","aria-label":"재고 조회",title:"재고 조회",onClick:I=>m(I,g),onKeyDown:I=>{(I.key==="Enter"||I.key===" ")&&(I.preventDefault(),m({currentTarget:I.currentTarget},g))},children:e.jsx("img",{src:rn,className:"icon",alt:"재고"})}),e.jsx("span",{role:"button",tabIndex:0,className:"icon-button","aria-label":"담기",title:"담기",onClick:()=>ie(g),onKeyDown:I=>{(I.key==="Enter"||I.key===" ")&&(I.preventDefault(),ie(g))},children:e.jsx("img",{src:gn,className:"icon",alt:"담기"})})]})]},z))})]})}),[y,O]);return e.jsxs("section",{children:[e.jsxs("div",{className:"page-title",children:[e.jsx("h2",{children:"수주장"}),e.jsxs("div",{className:"controls",style:{gap:8},children:[e.jsx("input",{className:"search-input",type:"text",placeholder:"거래처명",value:s,onChange:g=>u(g.target.value),onKeyDown:g=>{g.key==="Enter"&&P()},style:{width:240}}),e.jsx("button",{className:"btn",onClick:P,disabled:q,children:"조회"})]})]}),M,G,e.jsxs("div",{className:"controls",style:{gap:8,marginTop:10},children:[e.jsx("input",{className:"search-input",type:"text",placeholder:"품목명",value:p,onChange:g=>_(g.target.value),onKeyDown:g=>{g.key==="Enter"&&w()},style:{width:240}}),e.jsx("button",{className:"btn",onClick:()=>w(),disabled:O,children:"품목 조회"})]}),v,r.open&&e.jsx("div",{ref:S,className:"context-menu",style:{left:r.x+6,top:r.y+6,position:"fixed",maxWidth:420,padding:8},onClick:g=>g.stopPropagation(),children:r.loading?e.jsx("div",{className:"muted",children:"재고 불러오는 중…"}):r.error?e.jsx("div",{className:"error",children:r.error}):!r.rows||r.rows.length===0?e.jsx("div",{className:"empty-state",children:"재고 데이터가 없습니다"}):e.jsx("div",{className:"table-container",style:{maxHeight:200,overflow:"auto",border:0},children:e.jsxs("table",{className:"table",style:{width:"100%",fontSize:12},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"창고명"}),e.jsx("th",{style:{width:100,textAlign:"right"},children:"가용재고"}),e.jsx("th",{style:{width:120},children:"단위"})]})}),e.jsx("tbody",{children:(r.rows||[]).map((g,z)=>e.jsxs("tr",{children:[e.jsx("td",{children:g.whName||"-"}),e.jsx("td",{style:{textAlign:"right"},children:Number(g.avail||0).toLocaleString()}),e.jsx("td",{children:g.unitName||""})]},z))})]})})})]})}function Ka(){const s=[];for(let u=2030;u>=2026;u--)s.push(u);return s}function Qa(){const[s,u]=t.useState(2026),[p,_]=t.useState(()=>{try{return localStorage.getItem("tnt.sales.assign.mode")==="Moderate"?"Moderate":"Best"}catch{return"Best"}}),[F,B]=t.useState([{company:"TNT",group:"TNT",name:"복층유리",amount:0,stage:""},{company:"TNT",group:"TNT",name:"건자재",amount:0,stage:""},{company:"DYS",group:"DYS",name:"실란트",amount:0,stage:""}]),[q,X]=t.useState(!1),[R,se]=t.useState(null),[V,N]=t.useState(null),y=new Intl.NumberFormat("ko-KR");async function A(){X(!0),se(null);try{const S=new URL("/api/v1/targets/year",window.location.origin);S.searchParams.set("year",String(s)),S.searchParams.set("versionNo",p==="Moderate"?"2":"1");const w=await fetch(S.toString()),l=w.ok?await w.json():[],C=new Map;if(Array.isArray(l))for(const Y of l){const ue=String((Y==null?void 0:Y.company_name)||"").toUpperCase()==="DYS"?"DYS":"TNT",ie=String((Y==null?void 0:Y.biz_area_name)||""),n=Number((Y==null?void 0:Y.version_no)??0),m=Number((Y==null?void 0:Y.target_amount_max)??(Y==null?void 0:Y.target_amount_min)??0),P=String((Y==null?void 0:Y.target_stage)??""),h=`${ue}||${ie}`,o=C.get(h);(!o||n>o.ver)&&C.set(h,{ver:n,amt:Number.isFinite(m)?m:0,stage:P,company:ue,name:ie})}C.size===0?(B(Y=>Y.map(ue=>({...ue,amount:0,stage:""}))),N("영업목표가 수립되지 않았습니다.")):(B(Y=>Y.map(ue=>{const ie=`${ue.company}||${ue.name}`,n=C.get(ie);return n?{...ue,amount:n.amt,stage:n.stage}:ue})),N(null))}catch(S){se((S==null?void 0:S.message)||"조회 오류")}finally{X(!1)}}t.useEffect(()=>{A()},[s,p]),t.useEffect(()=>{try{localStorage.setItem("tnt.sales.assign.mode",p)}catch{}try{window.dispatchEvent(new CustomEvent("tnt.sales.assign.mode.changed",{detail:{mode:p}}))}catch{}},[p]),t.useEffect(()=>{try{localStorage.setItem("tnt.sales.assign.year",String(s)),window.dispatchEvent(new CustomEvent("tnt.sales.assign.year.changed"))}catch{}},[s]);const O=t.useMemo(()=>F.filter(S=>S.company==="TNT").reduce((S,w)=>S+(Number(w.amount)||0),0),[F]),b=t.useMemo(()=>F.filter(S=>S.company==="DYS").reduce((S,w)=>S+(Number(w.amount)||0),0),[F]);t.useEffect(()=>{try{const S={tnt:Number(O)||0,dys:Number(b)||0,year:s};localStorage.setItem("tnt.sales.assign.companyTotals",JSON.stringify(S)),window.dispatchEvent(new CustomEvent("tnt.sales.assign.companyTotals.changed"))}catch{}},[O,b,s]);function d(S,w){const l=Number((w||"").replace(/[\s,]/g,""));B(C=>C.map((Y,ue)=>ue===S?{...Y,amount:Number.isFinite(l)?l:0}:Y))}async function x(S=!1){try{const w=F.map(ue=>({targetYear:`${s}-01-01`,versionNo:1,companyName:ue.company,bizAreaGroup:ue.group,bizAreaName:ue.name,targetAmountMin:ue.amount,targetAmountMax:ue.amount,targetStage:S?"확정":"기안중"})),l=localStorage.getItem("tnt.sales.empSeq")||"",C={"Content-Type":"application/json"};l&&(C["X-EMP-SEQ"]=String(l));const Y=await fetch("/api/v1/targets/year/upsert",{method:"POST",headers:C,body:JSON.stringify(w)});if(!Y.ok)throw new Error(`HTTP ${Y.status}`);S&&await fetch(`/api/v1/targets/year/confirm?year=${s}`,{method:"POST",headers:C}),await A(),alert(S?"확정되었습니다.":"저장되었습니다.")}catch(w){alert((w==null?void 0:w.message)||"저장 중 오류")}}const r=t.useMemo(()=>{const S=F.filter(w=>w.company==="TNT").map(w=>(w.stage||"").trim());return S.includes("확정")?"확정":S.includes("기안중")?"기안중":""},[F]),T=t.useMemo(()=>{const S=F.filter(w=>w.company==="DYS").map(w=>(w.stage||"").trim());return S.includes("확정")?"확정":S.includes("기안중")?"기안중":""},[F]);return e.jsxs("section",{className:"card",style:{padding:12},children:[e.jsxs("div",{className:"page-title",style:{marginBottom:12},children:[e.jsx("h2",{style:{margin:0},children:"회사별 목표 입력"}),e.jsxs("div",{className:"controls",style:{gap:8},children:[e.jsxs("div",{role:"radiogroup","aria-label":"목표 산정 모드",className:"segmented",children:[e.jsxs("label",{className:`seg ${p==="Best"?"selected":""}`,children:[e.jsx("input",{type:"radio",name:"assign-mode",checked:p==="Best",onChange:()=>_("Best")}),e.jsx("span",{children:"Best"})]}),e.jsxs("label",{className:`seg ${p==="Moderate"?"selected":""}`,children:[e.jsx("input",{type:"radio",name:"assign-mode",checked:p==="Moderate",onChange:()=>_("Moderate")}),e.jsx("span",{children:"Moderate"})]})]}),e.jsx("select",{className:"search-input",value:s,onChange:S=>u(Number(S.target.value)),children:Ka().map(S=>e.jsxs("option",{value:S,children:[S,"년"]},S))}),e.jsx("button",{className:"btn btn-3d btn-card",onClick:()=>x(!1),children:"저장"}),e.jsx("button",{className:"btn btn-3d btn-card",onClick:()=>x(!0),children:"확정"})]})]}),R&&e.jsx("div",{className:"error",children:R}),V&&!R&&e.jsx("div",{className:"empty-state",style:{marginBottom:12},children:V}),e.jsxs("div",{style:{display:"flex",gap:12,flexWrap:"nowrap",width:"100%"},children:[e.jsxs("div",{className:"card",style:{padding:12,flex:"1 1 0",minWidth:0},children:[e.jsxs("div",{style:{fontWeight:700,marginBottom:8,display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{children:"TNT"}),r?e.jsx("span",{className:"badge",children:r}):null,q&&e.jsx("span",{className:"muted",style:{marginLeft:"auto",fontSize:12},children:"불러오는 중…"})]}),F.filter(S=>S.company==="TNT").map(S=>{const w=F.findIndex(l=>l.company===S.company&&l.name===S.name);return e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"180px 1fr 42px",alignItems:"center",gap:8,marginBottom:8},children:[e.jsx("div",{children:e.jsx("span",{className:"muted",children:S.name})}),e.jsx("input",{className:"assign-input",style:{textAlign:"right"},value:S.amount?y.format(S.amount):"",onChange:l=>d(w,l.target.value),placeholder:"0",disabled:p==="Moderate",title:p==="Moderate"?"Moderate 모드에서는 회사별 목표 수정이 비활성화됩니다":"값을 입력하세요"}),e.jsx("div",{className:"muted",style:{textAlign:"left"},children:"억원"})]},`TNT-${S.name}`)}),e.jsxs("div",{style:{textAlign:"right",fontWeight:700},children:["합계: ",y.format(O)," 억원"]})]}),e.jsxs("div",{className:"card",style:{padding:12,flex:"1 1 0",minWidth:0},children:[e.jsxs("div",{style:{fontWeight:700,marginBottom:8,display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{children:"DYS"}),T?e.jsx("span",{className:"badge",children:T}):null,q&&e.jsx("span",{className:"muted",style:{marginLeft:"auto",fontSize:12},children:"불러오는 중…"})]}),F.filter(S=>S.company==="DYS").map(S=>{const w=F.findIndex(l=>l.company===S.company&&l.name===S.name);return e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"180px 1fr 42px",alignItems:"center",gap:8,marginBottom:8},children:[e.jsx("div",{children:e.jsx("span",{className:"muted",children:S.name})}),e.jsx("input",{className:"assign-input",style:{textAlign:"right"},value:S.amount?y.format(S.amount):"",onChange:l=>d(w,l.target.value),placeholder:"0",disabled:p==="Moderate",title:p==="Moderate"?"Moderate 모드에서는 회사별 목표 수정이 비활성화됩니다":"값을 입력하세요"}),e.jsx("div",{className:"muted",style:{textAlign:"left"},children:"억원"})]},`DYS-${S.name}`)}),e.jsxs("div",{style:{textAlign:"right",fontWeight:700},children:["합계: ",y.format(b)," 억원"]})]})]})]})}const Ja=["영업1본부","영업1팀","영업2본부","영업2팀"];function Xa(){const[s,u]=t.useState([]),[p,_]=t.useState(!1),[F,B]=t.useState(null),[q,X]=t.useState(!1),[R,se]=t.useState(()=>{try{const h=localStorage.getItem("tnt.sales.assign.year");return h?Number(h):new Date().getFullYear()}catch{return new Date().getFullYear()}}),[V,N]=t.useState({}),[y,A]=t.useState(null),[O,b]=t.useState({}),[d,x]=t.useState(""),r=new Intl.NumberFormat("ko-KR"),[T,S]=t.useState(0);t.useEffect(()=>{const h=()=>S(o=>o+1);return window.addEventListener("tnt.sales.assign.mode.changed",h),()=>window.removeEventListener("tnt.sales.assign.mode.changed",h)},[]);const w=t.useMemo(()=>{try{return(localStorage.getItem("tnt.sales.assign.mode")||"").toLowerCase()==="moderate"}catch{return!1}},[T]);async function l(){_(!0),B(null);try{const h=new URL("/api/v1/targets/assigned",window.location.origin);h.searchParams.set("year",String(R));try{const i=(localStorage.getItem("tnt.sales.assign.mode")||"").toLowerCase(),v=i==="moderate"?"2":i==="best"?"1":"";v&&h.searchParams.set("versionNo",v)}catch{}const o=await fetch(h.toString()),M=o.ok?await o.json():[],G=Array.isArray(M)?M:[];if(G.length>0){const i=G.reduce((v,g)=>{const z=String(g.emp_id??g.empId??"").trim(),I=String(g.emp_name??g.empName??"").trim(),ge=String(g.dept_name??g.deptName??""),re=z||(I?`name:${I}`:"");return re&&(v.some(Z=>Z.key===re)||v.push({key:re,empId:z,empName:I,deptName:ge})),v},[]);i.sort((v,g)=>(v.deptName||"").localeCompare(g.deptName||"")||(v.empName||"").localeCompare(g.empName||"")),u(i),_(!1);return}const H=new URL("/api/v1/employees",window.location.origin);H.searchParams.set("depts",Ja.join(","));const j=await fetch(H.toString());if(!j.ok)throw new Error(`HTTP ${j.status}`);const te=await j.json(),c=Array.isArray(te)?te.map(i=>{const v=String(i.empId??i.emp_id??"").trim(),g=String(i.empName??i.emp_name??"").trim(),z=String(i.deptName??i.dept_name??""),I=String(i.assignee_id??i.assigneeId??"").trim()||void 0;return{key:v||I||(g?`name:${g}`:""),empId:v,empName:g,deptName:z,assigneeId:I}}).filter(i=>!!i.key):[];c.sort((i,v)=>(i.deptName||"").localeCompare(v.deptName||"")||(i.empName||"").localeCompare(v.empName||"")),u(c)}catch(h){B((h==null?void 0:h.message)||"조회 중 오류"),u([])}finally{_(!1)}}t.useEffect(()=>{l()},[]),t.useEffect(()=>{try{localStorage.setItem("tnt.sales.assign.empList",JSON.stringify(s)),window.dispatchEvent(new CustomEvent("tnt.sales.assign.emps.changed"))}catch{}},[s]),t.useEffect(()=>{const h=()=>{try{const o=localStorage.getItem("tnt.sales.assign.year");o&&se(Number(o)),b({}),x&&x("")}catch{}};return window.addEventListener("tnt.sales.assign.year.changed",h),()=>window.removeEventListener("tnt.sales.assign.year.changed",h)},[]),t.useEffect(()=>{async function h(){try{if(!s.length){b({});return}const o=new URL("/api/v1/targets/assigned",window.location.origin);o.searchParams.set("year",String(R));try{const c=(localStorage.getItem("tnt.sales.assign.mode")||"").toLowerCase(),i=c==="moderate"?"2":c==="best"?"1":"";i&&o.searchParams.set("versionNo",i)}catch{}const M=await fetch(o.toString()),G=M.ok?await M.json():[],H={};let j="";Array.isArray(G)&&G.forEach(c=>{const i=String(c.emp_id??c.empId??"").trim(),v=String(c.emp_name??c.empName??"").trim(),g=i||(v?`name:${v}`:"");if(!g)return;const z=String(c.company_name??c.companyName??"").toUpperCase(),I=Number(c.assigned_amount??c.assignedAmount??0),ge=String(c.target_stage??c.targetStage??"").trim(),re=H[g]||{tnt:0,dys:0};z==="TNT"?re.tnt=Math.round(I):z==="DYS"&&(re.dys=Math.round(I)),H[g]=re,ge==="확정"?j="확정":!j&&ge==="기안중"&&(j="기안중")});const te={};s.forEach(c=>{const i=H[c.key];i&&(te[c.key]={tnt:i.tnt||0,dys:i.dys||0})}),b(te),x(j)}catch{}}h()},[R,s,T]),t.useEffect(()=>{async function h(){try{const o=Array.from(new Set(s.map(c=>String(c.empName||"").trim()).filter(Boolean)));if(!o.length){N({});return}const M=new URL("/api/v1/sales/employee-yearly",window.location.origin);M.searchParams.set("year",String(R)),M.searchParams.set("empNames",o.join(",")),M.searchParams.set("joinKey","emp_name");const G=await fetch(M.toString()),H=G.ok?await G.json():[],j=Array.isArray(H)?H:Array.isArray(H==null?void 0:H.employees)?H.employees:[],te={};j.forEach(c=>{const i=String(c.emp_name??c.empName??"").trim();if(!i)return;const v=Number(c.tnt_amount??0),g=Number(c.dys_amount??0),z=te[i]||{tnt:0,dys:0};te[i]={tnt:z.tnt+(Number.isFinite(v)?v:0),dys:z.dys+(Number.isFinite(g)?g:0)}}),N(te)}catch{N({})}}h()},[R,s]);function C(h,o){const M=Number(o);return!Number.isFinite(M)||M<=0?"-":`${(Math.max(0,Number(h||0))*1e8/M*100).toFixed(1)}%`}const Y=s;function ue(h){A(h);try{localStorage.setItem("tnt.sales.selectedEmployee",JSON.stringify(h))}catch{}try{window.dispatchEvent(new CustomEvent("tnt.sales.employee.selected"))}catch{}}function ie(h,o,M){const G=Number((M||"").replace(/[,\s]/g,"")),H=Number.isFinite(G)?G:0;b(j=>{const c={...j[h]||{tnt:0,dys:0},[o]:H};return{...j,[h]:c}})}function n(h,o){const M=Math.max(0,Math.round(Number(h)||0)),G=o.reduce((v,g)=>v+(Number(g.value)||0),0);if(!Number.isFinite(G)||G<=0||M<=0){const v={};return o.forEach(g=>{v[g.key]=0}),v}const j=o.map(v=>({key:v.key,exact:M*((Number(v.value)||0)/G)})).map(v=>({key:v.key,floor:Math.floor(v.exact),frac:v.exact-Math.floor(v.exact)}));let te=j.reduce((v,g)=>v+g.floor,0),c=M-te;j.sort((v,g)=>g.frac-v.frac);for(let v=0;v<c&&j.length>0;v++){const g=v%j.length;j[g].floor+=1}const i={};return j.forEach(v=>{i[v.key]=v.floor}),i}async function m(){if(!q){X(!0);try{let h=null;try{const ye=localStorage.getItem("tnt.sales.assign.companyTotals");h=ye?JSON.parse(ye):null}catch{}const o=Math.round(Number((h==null?void 0:h.tnt)||0)),M=Math.round(Number((h==null?void 0:h.dys)||0));if(!Number.isFinite(o)||!Number.isFinite(M)){alert("회사별 목표 합계를 찾을 수 없습니다. 상단 패널을 확인하세요.");return}const G=s.map(ye=>String(ye.empName||"").trim()).filter(ye=>!!ye);if(!G.length){alert("대상 직원이 없습니다.");return}const H=new URL("/api/v1/sales/employee-yearly",window.location.origin);H.searchParams.set("year",String(R)),H.searchParams.set("empNames",G.join(",")),H.searchParams.set("joinKey","emp_name");const j=await fetch(H.toString()),te=j.ok?await j.json():[],c=Array.isArray(te)?te:Array.isArray(te==null?void 0:te.employees)?te.employees:[],i={};Array.isArray(c)&&c.forEach(ye=>{const L=String(ye.emp_name??ye.empName??"").trim();if(!L)return;const he=Number(ye.tnt_amount??0),fe=Number(ye.dys_amount??0),Se=i[L]||{tnt:0,dys:0};i[L]={tnt:Se.tnt+(Number.isFinite(he)?he:0),dys:Se.dys+(Number.isFinite(fe)?fe:0)}});const v={};s.forEach(ye=>{const L=String(ye.empName||"").trim();v[L]=(v[L]||0)+1});const g=[],z=[];s.forEach(ye=>{const L=String(ye.empName||"").trim(),he=i[L]||{tnt:0,dys:0},fe=Math.max(1,v[L]||1);g.push({key:ye.key,value:he.tnt/fe}),z.push({key:ye.key,value:he.dys/fe})});const I=n(o,g),ge=n(M,z);b(ye=>{const L={...ye};return s.forEach(he=>{L[he.key]={tnt:I[he.key]??0,dys:ge[he.key]??0}}),L});const re=ye=>Object.values(ye||{}).reduce((L,he)=>L+(Number(he)||0),0),Z=`TNT 합계 ${r.format(re(I))} / 목표 ${r.format(o)}
DYS 합계 ${r.format(re(ge))} / 목표 ${r.format(M)}`;re(I)!==o||re(ge)!==M?alert(`배정 완료(합계 보정 필요):
`+Z):alert(`배정이 완료되었습니다.
`+Z)}catch(h){alert((h==null?void 0:h.message)||"배정 중 오류가 발생했습니다.")}finally{X(!1)}}}return e.jsxs("section",{children:[e.jsx(Qa,{}),e.jsxs("div",{className:"page-title",style:{alignItems:"center",marginTop:12},children:[e.jsxs("h2",{style:{margin:0,fontSize:18,display:"flex",alignItems:"center",gap:8},children:["목표배정",d?e.jsx("span",{className:"badge",title:"해당 연도 전체 단계",children:d}):null]}),e.jsxs("div",{style:{marginLeft:"auto",display:"inline-flex",alignItems:"center",gap:8},children:[e.jsx("button",{className:"btn btn-card btn-3d",onClick:()=>m(),disabled:q,title:"전년도 매출 비율로 자동 배정",children:"할당(매출 기반)"}),e.jsx("button",{className:"btn btn-card btn-3d",onClick:()=>P(!1),title:"현재 배정값 저장",children:"저장"}),e.jsx("button",{className:"btn btn-card btn-3d",onClick:()=>P(!0),title:"현재 배정값 확정",children:"확정"})]})]}),F&&e.jsx("div",{className:"error",children:F}),e.jsx("div",{className:"table-container",style:{height:"calc(100vh - 140px)"},children:p?e.jsx("div",{className:"empty-state",children:"불러오는 중…"}):Y.length===0?e.jsx("div",{className:"empty-state",children:"데이터가 없습니다"}):e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:140},children:"부서"}),e.jsx("th",{style:{width:140},children:"사번"}),e.jsx("th",{style:{width:180,textAlign:"left"},children:"이름"}),e.jsx("th",{style:{width:140,textAlign:"right"},children:"TNT"}),e.jsx("th",{style:{width:110,textAlign:"right"},children:"TNT 전년대비"}),e.jsx("th",{style:{width:140,textAlign:"right"},children:"DYS"}),e.jsx("th",{style:{width:110,textAlign:"right"},children:"DYS 전년대비"})]})}),e.jsx("tbody",{children:Y.map((h,o)=>{var te,c;const M=O[h.key]||{tnt:0,dys:0},G=String(h.empName||"").trim(),H=Number(((te=V[G])==null?void 0:te.tnt)||0),j=Number(((c=V[G])==null?void 0:c.dys)||0);return e.jsxs("tr",{onClick:()=>ue(h),"aria-selected":(y==null?void 0:y.key)===h.key?!0:void 0,style:(y==null?void 0:y.key)===h.key?{background:"rgba(59,130,246,.12)"}:void 0,children:[e.jsx("td",{children:h.deptName}),e.jsx("td",{children:h.empId}),e.jsx("td",{style:{textAlign:"left"},children:h.empName}),e.jsx("td",{style:{textAlign:"right"},children:e.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9,]*",value:M.tnt?r.format(M.tnt):"",onChange:i=>ie(h.key,"tnt",i.target.value),placeholder:"0",style:{width:"100%",textAlign:"right"},className:"assign-input","aria-label":`TNT 목표(${h.empName})`,title:w?"Moderate 모드에서는 목표 수정이 비활성화됩니다":"TNT 매출목표",disabled:w})}),e.jsx("td",{style:{textAlign:"right"},title:"해당 직원 전년도 TNT 매출 대비 올해 목표 비율",children:e.jsx("span",{className:"muted",children:C(M.tnt,H)})}),e.jsx("td",{style:{textAlign:"right"},children:e.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9,]*",value:M.dys?r.format(M.dys):"",onChange:i=>ie(h.key,"dys",i.target.value),placeholder:"0",style:{width:"100%",textAlign:"right"},className:"assign-input","aria-label":`DYS 목표(${h.empName})`,title:w?"Moderate 모드에서는 목표 수정이 비활성화됩니다":"DYS 매출목표",disabled:w})}),e.jsx("td",{style:{textAlign:"right"},title:"해당 직원 전년도 DYS 매출 대비 올해 목표 비율",children:e.jsx("span",{className:"muted",children:C(M.dys,j)})})]},o)})})]})})]});async function P(h){try{const o=h?"확정":"기안중",G=(localStorage.getItem("tnt.sales.assign.mode")||"").toLowerCase()==="moderate"?2:1,H=[],j=`${R}-01-01`;s.forEach(v=>{const g=O[v.key]||{tnt:0,dys:0};H.push({targetYear:j,empName:v.empName,companyName:"TNT",targetAmount:Math.round(g.tnt||0),targetStage:o,versionNo:G}),H.push({targetYear:j,empName:v.empName,companyName:"DYS",targetAmount:Math.round(g.dys||0),targetStage:o,versionNo:G})});const te=localStorage.getItem("tnt.sales.empSeq")||"",c={"Content-Type":"application/json"};te&&(c["X-EMP-SEQ"]=String(te));const i=await fetch("/api/v1/targets/assigned/upsert",{method:"POST",headers:c,body:JSON.stringify(H)});if(!i.ok)throw new Error(`HTTP ${i.status}`);h&&await fetch(`/api/v1/targets/assigned/confirm?year=${R}`,{method:"POST",headers:c}),alert(h?"배정이 확정되었습니다.":"배정이 저장되었습니다.")}catch(o){alert((o==null?void 0:o.message)||"배정 저장 중 오류가 발생했습니다.")}}}function Ga(){const[s,u]=t.useState([]),[p,_]=t.useState(!1),[F,B]=t.useState(null),[q,X]=t.useState("TNT"),[R,se]=t.useState("mine");function V(){const c=new Date,i=String(c.getFullYear()%100).padStart(2,"0"),v=String(c.getMonth()+1).padStart(2,"0"),g=String(c.getDate()).padStart(2,"0");return`${i}-${v}-${g}`}const[N,y]=t.useState(V()),[A,O]=t.useState(V()),[b,d]=t.useState(null),[x,r]=t.useState(null),T=t.useRef(null),[S,w]=t.useState(null),[l,C]=t.useState(null),[Y,ue]=t.useState(null),[ie,n]=t.useState("");async function m(c){try{const i=typeof window<"u"&&localStorage.getItem("tnt.sales.assigneeId")||"",v=typeof window<"u"&&localStorage.getItem("tnt.sales.empId")||"",g=new URLSearchParams;i&&g.set("assigneeId",i),v&&g.set("empId",v),g.set("companyCode",c);const z=await fetch(`/api/v1/employee/by-assignee?${g.toString()}`,{cache:"no-store"});if(!z.ok)return"";const I=await z.json().catch(()=>null),ge=(I==null?void 0:I.resolvedSalesEmpSeq)??(c==="DYS"?I==null?void 0:I.dys_emp_seq:I==null?void 0:I.tnt_emp_seq);return ge!=null&&String(ge)?String(ge):""}catch{return""}}function P(c){if(!c)return"";let i=String(c).trim();const v=i.replace(/[^0-9]/g,"");if(v.length===6){const I=v.slice(0,2),ge=v.slice(2,4),re=v.slice(4,6);return h(I,ge,re)?`${I}-${ge}-${re}`:null}if(v.length===8){const I=v.slice(2,4),ge=v.slice(4,6),re=v.slice(6,8);return h(I,ge,re)?`${I}-${ge}-${re}`:null}const g=i.match(/^\s*(\d{2})[-/](\d{2})[-/](\d{2})\s*$/);if(g){const[,I,ge,re]=g;return h(I,ge,re)?`${I}-${ge}-${re}`:null}const z=i.match(/^\s*(\d{4})[-/](\d{2})[-/](\d{2})\s*$/);if(z){const[,I,ge,re]=z,Z=I.slice(2);return h(Z,ge,re)?`${Z}-${ge}-${re}`:null}return null}function h(c,i,v){const g=Number(c),z=Number(i),I=Number(v);return!(!Number.isInteger(g)||!Number.isInteger(z)||!Number.isInteger(I)||z<1||z>12||I<1||I>31||I>[31,28,31,30,31,30,31,31,30,31,30,31][z-1])}function o(c){const i=c.match(/^(\d{2})-(\d{2})-(\d{2})$/);return i?`20${i[1]}-${i[2]}-${i[3]}`:null}function M(c){try{let i=String(c??"");return i=i.replace(/\r\n/g,`
`).replace(/\r/g,`
`).replace(/\\n/g,`
`),i}catch{return String(c??"")}}function G(c){const i=String(c??"").trim();if(!i)return"";const v=i.replace(/[^0-9]/g,"");return v.length===8?`${v.slice(0,4)}-${v.slice(4,6)}-${v.slice(6,8)}`:v.length===6?`20${v.slice(0,2)}-${v.slice(2,4)}-${v.slice(4,6)}`:i}async function H(c=!1){const i=N.trim(),v=A.trim();let g=i?P(i):"",z=v?P(v):"";if(C(null),ue(null),i&&!g){C("형식: YY-MM-DD");return}if(v&&!z){ue("형식: YY-MM-DD");return}if(typeof g=="string"&&y(g),typeof z=="string"&&O(z),g&&z){const I=o(g),ge=o(z);if(I>ge){ue("종료일이 시작일보다 빠릅니다");return}}_(!0),B(null);try{const I=new URL("/api/v1/orders/external/tsl-order-text",window.location.origin);if(I.searchParams.set("company",q),g&&I.searchParams.set("fromDate",g),z&&I.searchParams.set("toDate",z),R==="mine"){const L=await m(q);L&&I.searchParams.set("salesEmpSeq",L)}const ge=await fetch(I.toString(),{cache:"no-store"});if(!ge.ok)throw new Error(`HTTP ${ge.status}`);const re=await ge.json().catch(()=>[]);let Z=Array.isArray(re)?re:[];const ye=ie.trim();if(ye){const L=ye.split(/\s+/).map(he=>he.toLowerCase());Z=Z.filter(he=>{const fe=(()=>{const Se=Object.entries(he);let Ae=null;for(const[E,ve]of Se){const ee=String(E).toLowerCase();if(ee==="custseq"||ee==="custname"||ee==="customername"||ee==="customer_name"){Ae=ve;break}}return String(Ae??"")})().toLowerCase();return L.every(Se=>fe.includes(Se))})}u(Z)}catch(I){B((I==null?void 0:I.message)||"조회 실패"),u([])}finally{_(!1)}}t.useEffect(()=>{if(!(x!=null&&x.open))return;const c=v=>{const g=T.current;g&&v.target instanceof Node&&!g.contains(v.target)&&r(null)},i=v=>{v.key==="Escape"&&r(null)};return document.addEventListener("mousedown",c,!0),window.addEventListener("keydown",i,!0),()=>{document.removeEventListener("mousedown",c,!0),window.removeEventListener("keydown",i,!0)}},[x==null?void 0:x.open]);const j=t.useMemo(()=>{if(!s.length)return[];const c=s[0];return Object.keys(c)},[s]);function te(c){const i=(c||"").toString();return/^OrderTextNo$/i.test(i)?"수주장번호":/^OrderTextDate$/i.test(i)||/^OrderTextDat$/i.test(i)?"주문일자":/^CustSeq$/i.test(i)||/^CustName$/i.test(i)||/^CustomerName$/i.test(i)?"거래처명":/^RegionGroup$/i.test(i)||/^region_group$/i.test(i)?"지역그룹":/^SalesEmpSeq$/i.test(i)?"영업":/^OrderText$/i.test(i)?"수주내역":/^IsCancel$/i.test(i)?"중단여부":/^CancelText$/i.test(i)?"중단사유":/^Remark$/i.test(i)?"비고":/^LastDateTime$/i.test(i)?"최종수정일시":/^WHSeq$/i.test(i)?"창고번호":/^DelvDate$/i.test(i)?"납기예정일":/^CustEmpName$/i.test(i)?"거래처담당":/^IsClaim$/i.test(i)?"Claim":/^OrderRemark$/i.test(i)?"주문요청사항":/^Request(Date|Dt)$/i.test(i)||/^ReqDate$/i.test(i)?"요청일자":i}return e.jsxs("section",{children:[e.jsxs("div",{className:"page-title",style:{alignItems:"center"},children:[e.jsx("h2",{style:{margin:0,fontSize:18},children:"수주장 조회"}),e.jsxs("div",{style:{marginLeft:"auto",display:"flex",flexDirection:"column",alignItems:"flex-end",gap:8},children:[e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:12,fontSize:12},children:[e.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:4},children:[e.jsx("input",{type:"radio",name:"company",checked:q==="TNT",onChange:()=>X("TNT")})," TNT"]}),e.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:4},children:[e.jsx("input",{type:"radio",name:"company",checked:q==="DYS",onChange:()=>X("DYS")})," DYS"]}),e.jsxs("select",{className:"search-input",value:R,onChange:c=>se(c.target.value||"all"),title:"조회 범위",style:{minWidth:110},children:[e.jsx("option",{value:"mine",children:"내수주"}),e.jsx("option",{value:"all",children:"전체"})]}),e.jsx("div",{style:{width:8}}),e.jsx("label",{className:"muted",children:"수주일"}),e.jsx("input",{className:"search-input",placeholder:"YY-MM-DD",value:N,onChange:c=>{y(c.target.value),l&&C(null)},onBlur:c=>{const i=P(c.target.value);i===null&&c.target.value.trim()?C("형식: YY-MM-DD"):typeof i=="string"&&y(i)},style:{width:90}}),l?e.jsx("div",{className:"error",style:{fontSize:11},children:l}):null,e.jsx("span",{className:"muted",children:"~"}),e.jsx("input",{className:"search-input",placeholder:"YY-MM-DD",value:A,onChange:c=>{O(c.target.value),Y&&ue(null)},onBlur:c=>{const i=P(c.target.value);i===null&&c.target.value.trim()?ue("형식: YY-MM-DD"):typeof i=="string"&&O(i)},style:{width:90}}),Y?e.jsx("div",{className:"error",style:{fontSize:11},children:Y}):null,e.jsx("button",{className:"btn btn-card btn-3d",onClick:()=>H(!0),disabled:!!l||!!Y||p,children:"조회"})]}),e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:6,alignSelf:"stretch",fontSize:12},children:[e.jsx("label",{className:"muted",children:"거래처명"}),e.jsx("input",{className:"search-input",placeholder:"검색어(공백으로 AND)",value:ie,onChange:c=>n(c.target.value),style:{width:320}})]})]})]}),F?e.jsx("div",{className:"error",children:F}):null,e.jsx("div",{className:"table-container",style:{height:"calc(100vh - 160px)"},children:p?e.jsx("div",{className:"empty-state",children:"불러오는 중…"}):s.length===0?e.jsx("div",{className:"empty-state",children:"데이터가 없습니다"}):e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{children:j.map(c=>e.jsx("th",{children:te(c)},c))})}),e.jsx("tbody",{children:s.map((c,i)=>e.jsx("tr",{onMouseEnter:v=>{const g=(v.clientX||0)+12,z=(v.clientY||0)+12;x!=null&&x.open||d({open:!0,x:g,y:z,rec:c})},onMouseMove:v=>{if(!(b!=null&&b.open))return;const g=(v.clientX||0)+12,z=(v.clientY||0)+12;x!=null&&x.open||d({open:!0,x:g,y:z,rec:c})},onMouseLeave:()=>d(null),onContextMenu:v=>{v.preventDefault();const g=v.clientX,z=v.clientY;r({open:!0,x:g,y:z,rec:c})},children:j.map(v=>e.jsx("td",{children:String((c==null?void 0:c[v])??"")},v))},i))})]})}),b!=null&&b.open&&!(x!=null&&x.open)?e.jsx("div",{role:"dialog","aria-live":"polite",style:{position:"fixed",left:Math.min(Math.max(8,b.x),window.innerWidth-460),top:Math.min(Math.max(8,b.y),window.innerHeight-300),zIndex:80,pointerEvents:"none"},children:e.jsx("div",{className:"card",style:{background:"var(--panel)",padding:12,border:"1px solid var(--border)",borderRadius:8,minWidth:320,maxWidth:600,maxHeight:"85vh",overflow:"auto",boxShadow:"0 8px 24px rgba(0,0,0,.18)"},children:e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:6},children:j.map(c=>{const i=(b.rec||{})[c],v=M(i);return e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:10,paddingBottom:6,borderBottom:"1px solid var(--border-light)"},children:[e.jsx("div",{style:{minWidth:120,fontWeight:600,fontSize:12,color:"var(--text-secondary)"},children:te(c)}),e.jsx("div",{style:{flex:1,whiteSpace:"pre-wrap",fontSize:12,wordBreak:"break-word"},children:v||e.jsx("span",{style:{color:"var(--text-muted)",fontStyle:"italic"},children:"-"})})]},c)})})})}):null,x!=null&&x.open?(()=>{const c=Math.min(Math.max(8,x.x),window.innerWidth-220),i=Math.min(Math.max(8,x.y),window.innerHeight-120);async function v(){try{const z=j.find(ee=>/^OrderText$/i.test(ee))||j.find(ee=>te(ee)==="수주내역"),I=j.find(ee=>/^OrderRemark$/i.test(ee))||j.find(ee=>te(ee)==="주문요청사항"),ge=j.find(ee=>te(ee)==="거래처명")||j.find(ee=>/^(CustName|CustomerName|customer_name|CustSeq)$/i.test(ee)),re=j.find(ee=>/^(UserName|CreatedBy|created_by)$/i.test(ee)),Z=j.find(ee=>/^(RegionGroup|region_group)$/i.test(ee)),ye=q,L=ge?String((x.rec||{})[ge]??""):"";let he=re?String((x.rec||{})[re]??""):"",fe=Z?String((x.rec||{})[Z]??""):"",Se=z?M((x.rec||{})[z]):"";const Ae=I?M((x.rec||{})[I]):"";if(!he){const ee=j.find(_e=>te(_e)==="영업");ee&&(he=String((x.rec||{})[ee]??""))}if(Se){const ee=String(Se).split(/\n/),_e=[];for(const Pe of ee){const Te=Pe.match(/^\s*지역\s*그룹\s*[:：]\s*(.*)\s*$/)||Pe.match(/^\s*지역그룹\s*[:：]\s*(.*)\s*$/);if(Te){const me=(Te[1]||"").trim();!fe&&me&&(fe=me)}else _e.push(Pe)}Se=_e.join(`
`)}let E=[];E.push(`회사코드: ${ye}`),E.push(`거래처: ${L}`),E.push(`등록자: ${he}`),E.push(`지역 그룹: ${fe}`),E.push("주문내용:"),E.push(Se),E.push("요청사항:"),E.push(Ae);let ve=E.join(`
`);if(!Se&&!Ae&&(ve=JSON.stringify(x.rec??{},null,2)),navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(ve);else{const ee=document.createElement("textarea");ee.value=ve,ee.style.position="fixed",ee.style.left="-9999px",document.body.appendChild(ee),ee.focus(),ee.select(),document.execCommand("copy"),document.body.removeChild(ee)}w({open:!0,x:c+8,y:i+8}),setTimeout(()=>w(null),1200)}catch{}r(null)}async function g(){try{const z=j.find(Te=>/^OrderText$/i.test(Te))||j.find(Te=>te(Te)==="수주내역"),I=j.find(Te=>/^OrderRemark$/i.test(Te))||j.find(Te=>te(Te)==="주문요청사항"),ge=j.find(Te=>te(Te)==="거래처명")||j.find(Te=>/^(CustName|CustomerName|customer_name|CustSeq)$/i.test(Te)),re=j.find(Te=>te(Te)==="수주장번호")||j.find(Te=>/^OrderTextNo$/i.test(Te)),Z=[j.find(Te=>te(Te)==="요청일자"),j.find(Te=>/^Request(Date|Dt)$/i.test(Te)),j.find(Te=>/^DelvDate$/i.test(Te)),j.find(Te=>/^OrderTextDate$/i.test(Te))].filter(Boolean);let ye="";const L=j.find(Te=>/^(UserName|CreatedBy|created_by)$/i.test(Te));if(L&&(ye=String((x.rec||{})[L]??"")),!ye){const Te=j.find(me=>te(me)==="영업");Te&&(ye=String((x.rec||{})[Te]??""))}let he="";const fe=j.find(Te=>/^(RegionGroup|region_group)$/i.test(Te));fe&&(he=String((x.rec||{})[fe]??""));let Se=z?M((x.rec||{})[z]):"";const Ae=I?M((x.rec||{})[I]):"";if(Se){const Te=String(Se).split(/\n/),me=[];for(const Ue of Te){const Je=Ue.match(/^\s*지역\s*그룹\s*[:：]\s*(.*)\s*$/)||Ue.match(/^\s*지역그룹\s*[:：]\s*(.*)\s*$/);if(Je){const ht=(Je[1]||"").trim();!he&&ht&&(he=ht)}else me.push(Ue)}Se=me.join(`
`)}const E=re?String((x.rec||{})[re]??"").trim():"";let ve="";for(const Te of Z){const me=Te?String((x.rec||{})[Te]??"").trim():"";if(me){ve=G(me);break}}const ee={orderNo:E,companyCode:q,customerName:ge?String((x.rec||{})[ge]??""):"",createdBy:ye,regionGroup:he,orderText:Se,orderRemark:Ae,requestDate:ve},_e=await fetch("/api/v1/slack/send-order-copy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ee)}),Pe=await _e.json().catch(()=>({}));_e.ok&&Pe.success?(w({open:!0,x:c+8,y:i+8,message:"Slack 전송 완료"}),setTimeout(()=>w(null),1500)):alert(Pe.message||`Slack 전송 실패 (HTTP ${_e.status})`)}catch(z){console.error("Slack 전송 실패:",z),alert("Slack 전송 중 오류가 발생했습니다.")}r(null)}return e.jsx("div",{ref:T,role:"menu",style:{position:"fixed",left:c,top:i,zIndex:90,minWidth:180},children:e.jsxs("div",{className:"card",style:{background:"var(--panel)",padding:4,border:"1px solid var(--border)",borderRadius:8,boxShadow:"0 8px 24px rgba(0,0,0,.18)",display:"flex",flexDirection:"column",gap:2,fontSize:13},children:[e.jsx("button",{className:"btn-plain",style:{width:"100%",textAlign:"left",padding:"4px 6px",fontSize:13},onClick:g,children:"Slack전송"}),e.jsx("button",{className:"btn-plain",style:{width:"100%",textAlign:"left",padding:"4px 6px",fontSize:13},onClick:v,children:"복사"})]})})})():null,S!=null&&S.open?e.jsx("div",{style:{position:"fixed",left:S.x,top:S.y,zIndex:95},children:e.jsx("div",{className:"card",style:{background:"var(--panel)",padding:"2px 6px",border:"1px solid var(--border)",borderRadius:6,fontSize:11},children:S.message||"복사했습니다"})}):null]})}const Va=["매출","가격","재고","경쟁사","Complaint","품질관리","공급사"];function Za(){const[s,u]=t.useState(""),[p,_]=t.useState([]),[F,B]=t.useState(!1),[q,X]=t.useState(null),[R,se]=t.useState("매출"),V=new Intl.NumberFormat("ko-KR");async function N(){B(!0),X(null);try{const y=new URL("/api/v1/items/search",window.location.origin);y.searchParams.set("q",s||""),y.searchParams.set("limit","100");const A=await fetch(y.toString());if(!A.ok)throw new Error(`HTTP ${A.status}`);const O=await A.json(),b=Array.isArray(O)?O.map(d=>({itemSeq:Number(d.itemSeq??d.item_seq??0),itemName:String(d.itemName??d.item_name??""),recentInvoiceDate:String(d.recentInvoiceDate??d.recent_invoice_date??""),curAmt:Number(d.curAmt??d.cur_amt??0),qty:Number(d.qty??0)})):[];_(b)}catch(y){X((y==null?void 0:y.message)||"조회 오류"),_([])}finally{B(!1)}}return t.useEffect(()=>{N()},[]),e.jsxs("section",{children:[e.jsxs("div",{className:"page-title",style:{alignItems:"center"},children:[e.jsx("h2",{style:{margin:0,fontSize:18},children:"Item360"}),e.jsxs("div",{className:"controls",style:{gap:8},children:[e.jsx("input",{className:"search-input",value:s,onChange:y=>u(y.target.value),placeholder:"품목명 검색",onKeyDown:y=>{y.key==="Enter"&&N()}}),e.jsx("button",{className:"btn btn-card btn-3d",onClick:N,disabled:F,children:"검색"})]})]}),q&&e.jsx("div",{className:"error",children:q}),e.jsx("div",{className:"table-container",style:{height:300},children:F?e.jsx("div",{className:"empty-state",children:"불러오는 중…"}):p.length===0?e.jsx("div",{className:"empty-state",children:"데이터가 없습니다"}):e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:120},children:"품목코드"}),e.jsx("th",{style:{textAlign:"left"},children:"품목명"}),e.jsx("th",{style:{width:140},children:"최근 매출일"}),e.jsx("th",{style:{width:140,textAlign:"right"},children:"매출금액"}),e.jsx("th",{style:{width:120,textAlign:"right"},children:"수량"})]})}),e.jsx("tbody",{children:p.map((y,A)=>e.jsxs("tr",{children:[e.jsx("td",{children:y.itemSeq||""}),e.jsx("td",{style:{textAlign:"left"},children:y.itemName||""}),e.jsx("td",{children:y.recentInvoiceDate||""}),e.jsxs("td",{style:{textAlign:"right"},children:[V.format(Math.round(Number(y.curAmt||0)))," 원"]}),e.jsx("td",{style:{textAlign:"right"},children:V.format(Math.round(Number(y.qty||0)))})]},A))})]})}),e.jsxs("div",{style:{marginTop:12},children:[e.jsx("div",{style:{display:"flex",gap:6,borderBottom:"1px solid var(--border)"},children:Va.map(y=>e.jsx("button",{className:"btn btn-card",style:{borderBottom:R===y?"2px solid var(--accent)":"2px solid transparent"},onClick:()=>se(y),children:y},y))}),e.jsx("div",{style:{padding:12},children:e.jsxs("div",{className:"empty-state",children:[R," 탭은 준비중입니다."]})})]})]})}const er=["영업1본부","영업1팀","영업2본부","영업2팀"];function tr(){const[s,u]=t.useState(()=>{try{const i=localStorage.getItem("tnt.sales.assign.year");return i?Number(i):new Date().getFullYear()}catch{return new Date().getFullYear()}}),[p,_]=t.useState([]),[F,B]=t.useState(!1),[q,X]=t.useState(null),[R,se]=t.useState([]),[V,N]=t.useState(!1),y=t.useRef(null),[A,O]=t.useState([]),[b,d]=t.useState(!1),[x,r]=t.useState(null),[T,S]=t.useState({tnt:0,dys:0}),[w,l]=t.useState([]),[C,Y]=t.useState(!1),[ue,ie]=t.useState(null),n=t.useMemo(()=>{try{let i=0,v=0;for(const g of A){const z=String((g==null?void 0:g.company_name)??(g==null?void 0:g.companyName)??"").toUpperCase(),I=Number((g==null?void 0:g.target_amount_max)??0);Number.isFinite(I)&&(z==="TNT"?i+=I:z==="DYS"&&(v+=I))}return{tnt:i,dys:v}}catch{return{tnt:0,dys:0}}},[A]),m=t.useMemo(()=>({tnt:T.tnt/1e8,dys:T.dys/1e8}),[T]),P=t.useMemo(()=>({tnt:n.tnt-m.tnt,dys:n.dys-m.dys}),[n,m]),h=t.useMemo(()=>{try{const i=ge=>A.reduce((re,Z)=>{const ye=String((Z==null?void 0:Z.biz_area_name)??(Z==null?void 0:Z.bizAreaName)??""),L=Number((Z==null?void 0:Z.target_amount_max)??0);return re+(ye===ge&&Number.isFinite(L)?L:0)},0),v=i("복층유리"),g=i("건자재"),z=i("실란트");return(Number.isFinite(v)?v:0)+(Number.isFinite(g)?g:0)+(Number.isFinite(z)?z:0)}catch{return 0}},[A]),o=t.useMemo(()=>{const i=[];for(let v=2030;v>=2026;v--)i.push(v);return i},[]);async function M(i){B(!0),X(null);try{const v=new URL("/api/v1/targets/assigned",window.location.origin);v.searchParams.set("year",String(i));const g=await fetch(v.toString()),z=g.ok?await g.json():[],I=Array.isArray(z)?z:[];if(I.length>0){const L=I.reduce((he,fe)=>{const Se=String(fe.emp_id??fe.empId??"").trim(),Ae=String(fe.emp_name??fe.empName??"").trim(),E=String(fe.dept_name??fe.deptName??""),ve=Se||(Ae?`name:${Ae}`:"");return ve&&(he.some(ee=>ee.key===ve)||he.push({key:ve,empId:Se,empName:Ae,deptName:E})),he},[]);L.sort((he,fe)=>(he.deptName||"").localeCompare(fe.deptName||"")||(he.empName||"").localeCompare(fe.empName||"")),_(L),B(!1);return}const ge=new URL("/api/v1/employees",window.location.origin);ge.searchParams.set("depts",er.join(","));const re=await fetch(ge.toString());if(!re.ok)throw new Error(`HTTP ${re.status}`);const Z=await re.json(),ye=Array.isArray(Z)?Z.map(L=>{const he=String(L.empId??L.emp_id??"").trim(),fe=String(L.empName??L.emp_name??"").trim(),Se=String(L.deptName??L.dept_name??""),Ae=String(L.assignee_id??L.assigneeId??"").trim()||void 0;return{key:he||Ae||(fe?`name:${fe}`:""),empId:he,empName:fe,deptName:Se,assigneeId:Ae}}).filter(L=>!!L.key):[];ye.sort((L,he)=>(L.deptName||"").localeCompare(he.deptName||"")||(L.empName||"").localeCompare(he.empName||"")),_(ye)}catch(v){X((v==null?void 0:v.message)||"조회 중 오류"),_([])}finally{B(!1)}}t.useEffect(()=>{M(s)},[s]),t.useEffect(()=>{async function i(){d(!0),r(null);try{const v=new URL("/api/v1/targets/year",window.location.origin);v.searchParams.set("year",String(s));const g=await fetch(v.toString());if(!g.ok)throw new Error(`HTTP ${g.status}`);const z=await g.json();O(Array.isArray(z)?z:[])}catch(v){O([]),r((v==null?void 0:v.message)||"조회 오류")}finally{d(!1)}}i()},[s]),t.useEffect(()=>{async function i(){const v=R.length?p.filter(I=>R.includes(I.key)):p,g=v.map(I=>String(I.empId||"").trim()).filter(Boolean),z=v.map(I=>String(I.assigneeId||"").trim()).filter(Boolean);if(!s||g.length===0&&z.length===0){l([]),ie(null);return}Y(!0),ie(null);try{const I=new URL("/api/v1/sales/plan/customer-counts",window.location.origin);I.searchParams.set("year",String(s)),g.length>0&&I.searchParams.set("empIds",g.join(",")),z.length>0&&I.searchParams.set("assigneeIds",z.join(","));const ge=await fetch(I.toString());if(!ge.ok)throw new Error(`HTTP ${ge.status}`);const re=await ge.json();l(Array.isArray(re)?re:[])}catch(I){l([]),ie((I==null?void 0:I.message)||"고객수 요약 조회 오류")}finally{Y(!1)}}i()},[s,R,p]),t.useEffect(()=>{async function i(){try{const v=new URL("/api/v1/sales/plan/totals",window.location.origin);v.searchParams.set("year",String(s));const g=await fetch(v.toString());if(!g.ok)throw new Error(`HTTP ${g.status}`);const z=await g.json().catch(()=>[]);let I=0,ge=0;Array.isArray(z)&&z.forEach(re=>{const Z=String((re==null?void 0:re.company)||(re==null?void 0:re.company_type)||(re==null?void 0:re.companyName)||"").toUpperCase(),ye=Number((re==null?void 0:re.total)||(re==null?void 0:re.total_amount)||0);Z==="TNT"?I+=Number.isFinite(ye)?ye:0:Z==="DYS"&&(ge+=Number.isFinite(ye)?ye:0)}),S({tnt:I,dys:ge})}catch{S({tnt:0,dys:0})}}i()},[s]);function G(i){const v=Number(i.target.value);if(!(!Number.isFinite(v)||v<=0)){u(v);try{localStorage.setItem("tnt.sales.assign.year",String(v))}catch{}}}function H(i){se(i);const v=p.filter(z=>i.includes(z.key));try{localStorage.setItem("tnt.sales.selectedEmployees",JSON.stringify(v))}catch{}const g=v[0]||null;try{g?localStorage.setItem("tnt.sales.selectedEmployee",JSON.stringify(g)):localStorage.removeItem("tnt.sales.selectedEmployee")}catch{}try{window.dispatchEvent(new CustomEvent("tnt.sales.employees.selected",{detail:{items:v}}))}catch{}try{g&&window.dispatchEvent(new CustomEvent("tnt.sales.employee.selected"))}catch{}}function j(i){H(i?p.map(v=>v.key):[])}function te(i,v){const g=new Set(R);v?g.add(i):g.delete(i),H(Array.from(g))}t.useEffect(()=>{if(!V)return;const i=g=>{y.current&&(y.current.contains(g.target)||N(!1))},v=g=>{g.key==="Escape"&&N(!1)};return window.addEventListener("click",i,!0),window.addEventListener("keydown",v,!0),()=>{window.removeEventListener("click",i,!0),window.removeEventListener("keydown",v,!0)}},[V]);const c=t.useMemo(()=>{if(!R.length)return"전체";const i=p.filter(v=>R.includes(v.key)).map(v=>v.empName||v.empId||v.key);return i.length<=2?i.join(", "):`${i.slice(0,2).join(", ")} 외 ${i.length-2}명`},[R,p]);return e.jsxs("section",{children:[e.jsxs("div",{className:"card",style:{padding:8,marginBottom:12,display:"flex",alignItems:"center",gap:16,flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:8},children:[e.jsx("div",{className:"muted",children:"목표년도"}),e.jsx("select",{className:"search-input",value:s,onChange:G,"aria-label":"목표년도",style:{height:28},children:o.map(i=>e.jsxs("option",{value:String(i),children:[i,"년"]},i))})]}),e.jsxs("div",{ref:y,style:{position:"relative",display:"inline-flex",alignItems:"center",gap:8},children:[e.jsx("div",{className:"muted",children:"영업사원"}),e.jsxs("button",{type:"button",className:"search-input","aria-haspopup":"listbox","aria-expanded":V,onClick:()=>N(i=>!i),style:{height:28,minWidth:260,display:"inline-flex",alignItems:"center",justifyContent:"space-between",gap:8},children:[e.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:c}),e.jsx("span",{"aria-hidden":!0,children:"▾"})]}),V&&e.jsxs("div",{role:"listbox",className:"card",style:{position:"absolute",zIndex:60,top:"100%",left:0,width:380,maxHeight:260,overflow:"auto",background:"var(--panel)",border:"1px solid var(--border)",borderRadius:8,padding:8,marginTop:6,fontSize:11},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,padding:"4px 6px"},children:[e.jsx("input",{type:"checkbox",checked:R.length===p.length&&p.length>0,onChange:i=>j(i.target.checked)}),e.jsx("span",{children:"전체"})]}),F?e.jsx("div",{className:"muted",style:{padding:"6px 6px"},children:"불러오는 중…"}):p.length===0?e.jsx("div",{className:"muted",style:{padding:"6px 6px"},children:"목록이 없습니다"}):p.map(i=>{const v=R.includes(i.key),g=`${i.deptName||"-"} / ${i.empName||""}${i.empId?` (${i.empId})`:""}`;return e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,padding:"4px 6px",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:v,onChange:z=>te(i.key,z.target.checked)}),e.jsx("span",{children:g})]},i.key)}),q?e.jsx("div",{className:"error",style:{padding:"6px 6px"},children:q}):null]})]})]}),e.jsxs("div",{className:"card",style:{padding:8},children:[x?e.jsx("div",{className:"error",style:{marginBottom:8},children:x}):null,b?e.jsx("div",{className:"muted",style:{padding:"8px 6px"},children:"불러오는 중…"}):e.jsxs("div",{style:{display:"flex",alignItems:"stretch",gap:12},children:[e.jsxs("div",{style:{flex:"1 1 auto",display:"flex",flexDirection:"column",gap:6},children:[e.jsxs("div",{style:{display:"flex",alignItems:"baseline",justifyContent:"space-between",margin:"0 2px"},children:[e.jsx("div",{className:"muted",style:{fontWeight:800},children:"회사 목표"}),e.jsx("div",{style:{fontWeight:800},children:Number.isFinite(h)?`${Number(h).toLocaleString(void 0,{maximumFractionDigits:1})} 억원`:"-"})]}),(()=>{let i=0,v=0,g,z=0,I;A.forEach(Z=>{const ye=String((Z==null?void 0:Z.company_name)??(Z==null?void 0:Z.companyName)??"").toUpperCase(),L=String((Z==null?void 0:Z.biz_area_name)??(Z==null?void 0:Z.bizAreaName)??""),he=Number((Z==null?void 0:Z.target_amount_max)??0),fe=String((Z==null?void 0:Z.target_stage)??(Z==null?void 0:Z.targetStage)??"")||void 0;ye==="TNT"?(L==="복층유리"&&Number.isFinite(he)?i+=he:L==="건자재"&&Number.isFinite(he)&&(v+=he),fe&&(g=fe)):ye==="DYS"&&L==="실란트"&&(Number.isFinite(he)&&(z+=he),fe&&(I=fe))});const ge=[{company:"TNT",biz:"복층유리+건자재",max:i+v,stage:g},{company:"DYS",biz:"실란트",max:z,stage:I}];return e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:8},children:ge.map((Z,ye)=>{const L=Z.company,he=Z.biz,fe=Z.max,Se=Z.stage||"";return e.jsx("div",{className:"card",style:{padding:8,border:"1px solid var(--border)",borderRadius:10,display:"flex",alignItems:"center",minHeight:92,position:"relative"},children:e.jsxs("div",{style:{flex:1},children:[Se?e.jsx("div",{style:{position:"absolute",top:6,left:6},children:e.jsx("span",{className:"badge",style:{fontSize:8,padding:"0 4px",lineHeight:1.1,border:"1px solid var(--border)",borderRadius:6},children:Se})}):null,L==="TNT"&&he==="복층유리+건자재"?(()=>{try{let Ae=0,E=0;for(const ee of A){const _e=String((ee==null?void 0:ee.company_name)??(ee==null?void 0:ee.companyName)??"").toUpperCase(),Pe=String((ee==null?void 0:ee.biz_area_name)??(ee==null?void 0:ee.bizAreaName)??""),Te=Number((ee==null?void 0:ee.target_amount_max)??0);_e==="TNT"&&Number.isFinite(Te)&&(Pe==="복층유리"?Ae+=Te:Pe==="건자재"&&(E+=Te))}const ve=Number.isFinite(fe)?Number(fe):Ae+E;return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4,textAlign:"center"},children:[e.jsxs("div",{style:{fontWeight:800,fontSize:18,lineHeight:1.1},children:["TNT ",ve.toLocaleString(void 0,{maximumFractionDigits:1}),"억원"]}),e.jsxs("div",{className:"muted",style:{fontSize:10,lineHeight:1.1},children:["(",`복층${Ae.toLocaleString(void 0,{maximumFractionDigits:1})}억원+건자재${E.toLocaleString(void 0,{maximumFractionDigits:1})}억원`,")"]})]})}catch{return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4,textAlign:"center"},children:[e.jsx("div",{style:{fontWeight:700,fontSize:11},children:"TNT"}),e.jsx("div",{className:"muted",style:{fontSize:11,lineHeight:1.1},children:"데이터 없음"})]})}})():e.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4,textAlign:"center"},children:String(L||"").toUpperCase()==="DYS"&&he==="실란트"?e.jsx(e.Fragment,{children:e.jsxs("div",{style:{fontWeight:800,fontSize:18,lineHeight:1.1},children:["DYS ",Number(fe).toLocaleString(void 0,{maximumFractionDigits:1}),"억원"]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{fontWeight:700,fontSize:11},children:he||"-"}),e.jsx("div",{style:{fontSize:11,fontWeight:800,lineHeight:1.1},children:Number.isFinite(fe)?`${Number(fe).toLocaleString(void 0,{maximumFractionDigits:1})} 억원`:"-"})]})})]})},ye)})})})()]}),e.jsx("div",{style:{flex:"0 0 auto",width:1,background:"var(--border)"}}),e.jsxs("aside",{style:{flex:"0 0 260px",maxWidth:320,paddingLeft:8,display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.jsx("div",{style:{fontWeight:800,marginBottom:8},children:"목표수립 현황"}),e.jsx("div",{className:"card",style:{padding:10,border:"1px solid var(--border)",borderRadius:10,display:"flex",alignItems:"center",justifyContent:"center",minHeight:92},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:10,width:"100%"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%"},children:e.jsx("strong",{style:{fontSize:18,lineHeight:1.1},children:`TNT ${m.tnt.toLocaleString(void 0,{maximumFractionDigits:1})} 억원`})}),e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%"},children:e.jsx("strong",{style:{fontSize:18,lineHeight:1.1},children:`DYS ${m.dys.toLocaleString(void 0,{maximumFractionDigits:1})} 억원`})})]})})]}),e.jsx("div",{style:{flex:"0 0 auto",width:1,background:"var(--border)"}}),e.jsxs("aside",{style:{flex:"0 0 260px",maxWidth:320,paddingLeft:8,display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.jsx("div",{style:{fontWeight:800,marginBottom:8},children:"차액"}),e.jsx("div",{className:"card",style:{padding:10,border:"1px solid var(--border)",borderRadius:10,display:"flex",alignItems:"center",justifyContent:"center",minHeight:92},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:10,width:"100%"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%"},children:e.jsx("strong",{style:{fontSize:18,lineHeight:1.1},children:`TNT ${P.tnt.toLocaleString(void 0,{maximumFractionDigits:1})} 억원`})}),e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%"},children:e.jsx("strong",{style:{fontSize:18,lineHeight:1.1},children:`DYS ${P.dys.toLocaleString(void 0,{maximumFractionDigits:1})} 억원`})})]})})]})]})]}),e.jsxs("div",{className:"card",style:{padding:8,marginTop:12},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:6},children:[e.jsx("div",{style:{fontWeight:800},children:"고객수 요약"}),C?e.jsx("div",{className:"muted",style:{fontSize:12},children:"불러오는 중…"}):null]}),ue?e.jsx("div",{className:"error",style:{marginBottom:8},children:ue}):null,(()=>{const i=R.length?p.filter(g=>R.includes(g.key)):p,v=new Map;for(const g of w){const z=String((g==null?void 0:g.assignee_id)||(g==null?void 0:g.emp_id)||"").trim();if(!z)continue;const I=v.get(z)||[];I.push(g),v.set(z,I)}return e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(320px, 1fr))",gap:10},children:i.map(g=>{const z=String(g.assigneeId||g.empId||g.key||""),I=v.get(z)||[],ge=["TNT","DYS"],re=[...I].sort((Z,ye)=>ge.indexOf(String(Z.company||"").toUpperCase())-ge.indexOf(String(ye.company||"").toUpperCase()));return e.jsxs("div",{className:"card",style:{padding:10,border:"1px solid var(--border)",borderRadius:10},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:6},children:[e.jsxs("div",{style:{fontWeight:700},children:[g.deptName||"-"," / ",g.empName||g.empId||g.key]}),e.jsxs("div",{className:"muted",style:{fontSize:11},children:[s,"년"]})]}),re.length===0?e.jsx("div",{className:"muted",style:{fontSize:12},children:"데이터가 없습니다"}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:8},children:re.map((Z,ye)=>e.jsxs("div",{className:"card",style:{padding:8,border:"1px solid var(--border)",borderRadius:8,minHeight:92,display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:6},children:String(Z.company||"").toUpperCase()}),e.jsxs("div",{style:{display:"flex",gap:16,fontSize:12,justifyContent:"space-between"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",flex:1},children:[e.jsx("span",{className:"muted",children:"수립대상"}),e.jsx("strong",{children:Number(Z.total_customers||0).toLocaleString()})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",flex:1},children:[e.jsx("span",{className:"muted",children:"확정"}),e.jsx("strong",{children:Number(Z.confirmed_customers||0).toLocaleString()})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",flex:1},children:[e.jsx("span",{className:"muted",children:"진행 중"}),e.jsx("strong",{children:Number(Z.planning_customers||0).toLocaleString()})]})]})]},ye))})]},z)})})})()]})]})}function sr(){return e.jsxs("section",{children:[e.jsx("h1",{children:"매출관리"}),e.jsx("div",{className:"empty-state",children:"초기 스켈레톤: 매출관리 화면"})]})}const yn="http://220.73.213.73/Angkor.Ylw.Common.HttpExecute/RestOutsideService.svc/OpenApi/IsStoredProcedure/tnt_SWAPISLCustCreditListInfo",nr={certId:"TNT_CRM",certKey:"9836164F-3601-4DBB-9D6D-54685CD89B95",dsn:"tnt_bis",dsnOper:"tnt_oper",securityType:0,CompanySeq:1},Qs=[20,50,100],Qt=s=>new Intl.NumberFormat("ko-KR",{maximumFractionDigits:0}).format(Math.round(s||0)),ar=s=>{const u=p=>{const _=Number(p);return Number.isFinite(_)?_:0};return{CustName:String(s.CustName??""),CustNo:String(s.CustNo??""),CustSeq:String(s.CustSeq??""),IsCreditCheck:s.IsCreditCheck==="Y"?"Y":s.IsCreditCheck==="N"?"N":"",CurrName:String(s.CurrName??""),PrevCreditAmt:u(s.PrevCreditAmt),SalesAmt:u(s.SalesAmt),SalesVat:u(s.SalesVat),TotSalesAmt:u(s.TotSalesAmt),ReceiptAmt:u(s.ReceiptAmt),NoReceiptAmt:u(s.NoReceiptAmt)}},rr=({stdDate:s,custSeq:u,empSeq:p,pageNo:_,pageSize:F})=>({ROOT:{...nr,data:{ROOT:{DataBlock1:{StdDate:s.replace(/-/g,""),CustSeq:u.trim()?Number(u):"",EmpSeq:p.trim()?Number(p):"",SMQryType:1078004,IncludeMiNote:1,PAGE_NO:_,PAGE_SIZE:F}}}}});function ir(){const s=new Date().toISOString().slice(0,10),[u,p]=t.useState({stdDate:s,custSeq:"",empSeq:""}),[_,F]=t.useState(u),[B,q]=t.useState(1),[X,R]=t.useState(Qs[0]),[se,V]=t.useState([]),[N,y]=t.useState({PAGE_NO:1,PAGE_SIZE:Qs[0],TotalData:0,TotalPage:0}),[A,O]=t.useState(!1),[b,d]=t.useState(null),[x,r]=t.useState(null),[T,S]=t.useState(null),[w,l]=t.useState(!1),[C,Y]=t.useState(null),ue=(o,M)=>{p(G=>({...G,[o]:M}))},ie=()=>{F(u),q(1)},n=o=>{R(o),q(1)},m=o=>{q(M=>o==="next"?N.TotalPage&&M>=N.TotalPage?M:M+1:Math.max(1,M-1))},P=t.useMemo(()=>se.reduce((o,M)=>(o.sales+=M.SalesAmt,o.receipt+=M.ReceiptAmt,o.noReceipt+=M.NoReceiptAmt,o),{sales:0,receipt:0,noReceipt:0}),[se]),h=t.useCallback(async()=>{O(!0),d(null);try{const o=rr({stdDate:_.stdDate,custSeq:_.custSeq,empSeq:_.empSeq,pageNo:B,pageSize:X}),M=JSON.stringify(o,null,2);S(M),l(!0);const G=await fetch(yn,{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(o)});if(!G.ok)throw new Error(`서버 응답이 존재하지 않거나 상태값 ${G.status}`);const H=await G.json(),j=H==null?void 0:H.ROOT,te=j==null?void 0:j.ReturnCode;if(te!=="0000"){const v=`ReturnCode: ${te??"N/A"}${j!=null&&j.ReturnMessage?` • ${j.ReturnMessage}`:""}`;throw Y(v),new Error((j==null?void 0:j.ReturnMessage)??"데이터를 불러오는 데 실패했습니다.")}Y(`ReturnCode: ${te??"N/A"}${j!=null&&j.ReturnMessage?` • ${j.ReturnMessage}`:""}`);const c=Array.isArray(j==null?void 0:j.DataBlock1)?j.DataBlock1:[];V(c.map(ar));const i=Array.isArray(j==null?void 0:j.DataBlock2)?j.DataBlock2[0]:null;y(i?{PAGE_NO:Number(i.PAGE_NO??B),PAGE_SIZE:Number(i.PAGE_SIZE??X),TotalData:Number(i.TotalData??c.length),TotalPage:Number(i.TotalPage??0)}:v=>({...v,PAGE_NO:B,PAGE_SIZE:X,TotalData:c.length,TotalPage:Math.max(1,Math.ceil(c.length/X))})),r(new Date().toLocaleString())}catch(o){d(o.message??"데이터를 불러오는 중 알 수 없는 오류가 발생했습니다."),V([])}finally{O(!1)}},[_,B,X]);return t.useEffect(()=>{h()},[h]),e.jsxs("section",{className:"receivables-page",children:[e.jsxs("div",{className:"page-title",children:[e.jsx("h1",{children:"미수현황"}),e.jsx("p",{children:"기준일/필터를 설정하고 서버에서 고객 미수/판매/수금 데이터를 조회하세요."})]}),e.jsxs("div",{className:"filters-grid",children:[e.jsxs("label",{className:"field",children:[e.jsx("span",{children:"기준일"}),e.jsx("input",{type:"date",value:u.stdDate,onChange:o=>ue("stdDate",o.target.value),className:"search-input"})]}),e.jsxs("label",{className:"field",children:[e.jsx("span",{children:"거래처 코드(CustSeq)"}),e.jsx("input",{type:"number",placeholder:"전체",value:u.custSeq,min:0,onChange:o=>ue("custSeq",o.target.value),className:"search-input"})]}),e.jsxs("label",{className:"field",children:[e.jsx("span",{children:"사원 코드(EmpSeq)"}),e.jsx("input",{type:"number",placeholder:"전체",value:u.empSeq,min:0,onChange:o=>ue("empSeq",o.target.value),className:"search-input"})]}),e.jsxs("label",{className:"field",children:[e.jsx("span",{children:"페이지 크기"}),e.jsx("select",{value:X,onChange:o=>n(Number(o.target.value)),className:"search-input",children:Qs.map(o=>e.jsxs("option",{value:o,children:[o,"개"]},o))})]}),e.jsxs("div",{className:"field actions",children:[e.jsx("button",{type:"button",className:"btn",onClick:ie,disabled:A,children:"조회하기"}),e.jsx("button",{type:"button",className:"btn secondary",onClick:()=>q(1),disabled:B===1,children:"첫 페이지"}),e.jsx("button",{type:"button",className:"btn secondary",onClick:()=>T&&l(!0),disabled:!T,children:"최근 전문 보기"})]})]}),e.jsxs("div",{className:"summary-cards",children:[e.jsxs("article",{className:"summary-card",children:[e.jsxs("div",{children:[e.jsx("p",{className:"muted",children:"총 데이터"}),e.jsxs("strong",{children:[N.TotalData.toLocaleString(),"건"]})]}),e.jsxs("span",{className:"muted",children:[N.PAGE_NO," / ",Math.max(1,N.TotalPage)," 페이지"]})]}),e.jsxs("article",{className:"summary-card",children:[e.jsxs("div",{children:[e.jsx("p",{className:"muted",children:"금월 판매"}),e.jsxs("strong",{children:[Qt(P.sales)," 원"]})]}),e.jsx("span",{className:"muted",children:"합계"})]}),e.jsxs("article",{className:"summary-card",children:[e.jsxs("div",{children:[e.jsx("p",{className:"muted",children:"금월 수금"}),e.jsxs("strong",{children:[Qt(P.receipt)," 원"]})]}),e.jsx("span",{className:"muted",children:"합계"})]}),e.jsxs("article",{className:"summary-card highlight",children:[e.jsxs("div",{children:[e.jsx("p",{className:"muted",children:"현미수액"}),e.jsxs("strong",{children:[Qt(P.noReceipt)," 원"]})]}),e.jsx("span",{className:"muted",children:"수금과 대비"})]})]}),e.jsxs("div",{className:"table-panel",children:[e.jsxs("div",{className:"table-panel-header",children:[e.jsx("div",{children:e.jsxs("p",{className:"muted",children:["마지막 업데이트: ",x??"—"]})}),e.jsxs("div",{className:"pagination-controls",children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:()=>m("prev"),disabled:B===1,children:"이전"}),e.jsxs("span",{children:[B," page / ",Math.max(1,N.TotalPage)," page"]}),e.jsx("button",{type:"button",className:"btn secondary",onClick:()=>m("next"),disabled:N.TotalPage>0?B>=N.TotalPage:se.length<X,children:"다음"})]})]}),b&&e.jsx("div",{className:"empty-state",children:b}),e.jsx("div",{className:"table-container receivables-table",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"거래처 코드"}),e.jsx("th",{children:"거래처명"}),e.jsx("th",{children:"통화"}),e.jsx("th",{children:"전월이월"}),e.jsx("th",{children:"금월판매"}),e.jsx("th",{children:"부가세"}),e.jsx("th",{children:"금월판매계"}),e.jsx("th",{children:"금월수금"}),e.jsx("th",{children:"현미수액"}),e.jsx("th",{children:"미수 여부"})]})}),e.jsx("tbody",{children:A?e.jsx("tr",{children:e.jsx("td",{colSpan:10,children:e.jsx("div",{className:"empty-state",children:"데이터를 불러오는 중입니다…"})})}):se.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:10,children:e.jsx("div",{className:"empty-state",children:"조회 결과가 없습니다."})})}):se.map(o=>e.jsxs("tr",{children:[e.jsx("td",{children:o.CustSeq}),e.jsx("td",{children:o.CustName}),e.jsx("td",{children:o.CurrName}),e.jsxs("td",{children:[Qt(o.PrevCreditAmt)," 원"]}),e.jsxs("td",{children:[Qt(o.SalesAmt)," 원"]}),e.jsxs("td",{children:[Qt(o.SalesVat)," 원"]}),e.jsxs("td",{children:[Qt(o.TotSalesAmt)," 원"]}),e.jsxs("td",{children:[Qt(o.ReceiptAmt)," 원"]}),e.jsxs("td",{className:"highlight-cell",children:[Qt(o.NoReceiptAmt)," 원"]}),e.jsx("td",{children:o.IsCreditCheck||"N"})]},`${o.CustSeq}-${o.CustNo}`))})]})})]}),w&&T?e.jsx("div",{className:"json-modal-backdrop",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"json-modal",children:[e.jsx("div",{className:"json-modal-header",children:e.jsx("strong",{children:"직전 요청 전문"})}),e.jsxs("p",{className:"muted",style:{fontSize:12},children:["요청 URL: ",yn]}),e.jsx("pre",{children:T}),C?e.jsx("p",{className:"muted",style:{wordBreak:"break-all"},children:C}):null,e.jsx("div",{className:"json-modal-actions",children:e.jsx("button",{type:"button",className:"btn secondary",onClick:()=>l(!1),children:"닫기"})})]})}):null]})}function Ps({value:s,max:u,color:p,label:_}){const F=Math.max(0,Math.min(100,u>0?s/u*100:0));return e.jsxs("div",{"aria-label":_,style:{position:"relative",width:"100%",height:11,background:"rgba(0,0,0,.04)",borderRadius:999,overflow:"hidden"},children:[e.jsx("div",{style:{width:`${F}%`,height:"100%",background:p,borderRadius:999,transition:"width .2s ease"}}),e.jsx("div",{style:{position:"absolute",right:6,top:0,bottom:0,display:"flex",alignItems:"center",fontSize:10,color:"var(--text)"},children:s})]})}function lr(){const[s,u]=t.useState(!0),[p,_]=t.useState(null),[F,B]=t.useState([]),[q,X]=t.useState(0),[R,se]=t.useState("default"),[V,N]=t.useState([]),[y,A]=t.useState(!0),[O,b]=t.useState(null);t.useEffect(()=>{let n=!1;async function m(){u(!0),_(null);try{const P=await fetch("/api/v1/employees");if(!P.ok)throw new Error(`EMP HTTP ${P.status}`);const h=await P.json();if(n)return;const o=(Array.isArray(h)?h:[]).map((M,G)=>({id:String(M.assignee_id??M.emp_id??G),name:String(M.emp_name??""),prevWeek:{plan:0,actual:0},thisWeek:{plan:0,actual:0},nextWeek:{plan:0,actual:0}}));B(o);try{const[M,G]=await Promise.all([Ls(q),Ls(q-1)]);if(n)return;const H=xn(M),j=Js(G);B(o.map(te=>{const c=H.get(te.id),i=j.get(te.id);return{...te,prevWeek:{plan:(i==null?void 0:i.plan)??0,actual:(i==null?void 0:i.actual)??0},thisWeek:{plan:(c==null?void 0:c.thisPlan)??0,actual:(c==null?void 0:c.thisActual)??0},nextWeek:{plan:(c==null?void 0:c.nextPlan)??0,actual:(c==null?void 0:c.nextActual)??0}}}))}catch{_("주간 활동 요약을 불러오지 못했습니다")}}catch{if(n)return;_("직원 목록을 불러오지 못했습니다");try{const h=await Ls(q),o=await Ls(q-1).catch(()=>[]);if(n)return;const M=Js(o),G=(Array.isArray(h)?h:[]).map((H,j)=>{var i,v,g,z;const te=String(H.assignee_id??H.emp_id??j),c=M.get(te);return{id:te,name:String(H.emp_name??""),prevWeek:{plan:(c==null?void 0:c.plan)??0,actual:(c==null?void 0:c.actual)??0},thisWeek:{plan:Number(((i=H.thisWeek)==null?void 0:i.plan)??0),actual:Number(((v=H.thisWeek)==null?void 0:v.actual)??0)},nextWeek:{plan:Number(((g=H.nextWeek)==null?void 0:g.plan)??0),actual:Number(((z=H.nextWeek)==null?void 0:z.actual)??0)}}});B(G)}catch{B([{id:"e01",name:"김영업",prevWeek:{plan:0,actual:0},thisWeek:{plan:0,actual:0},nextWeek:{plan:0,actual:0}},{id:"e02",name:"박세일",prevWeek:{plan:0,actual:0},thisWeek:{plan:0,actual:0},nextWeek:{plan:0,actual:0}}])}}finally{n||u(!1)}}return m(),()=>{n=!0}},[q]),t.useEffect(()=>{let n=!1;async function m(){A(!0),b(null);try{const[P,h]=await Promise.all([fn(q),fn(q-1)]);if(n)return;const o=xn(P),M=Js(h),G=new Set;for(const j of[...P,...h]){const te=String(j.assignee_id??j.emp_id??"");te&&G.add(te)}const H=Array.from(G).map(j=>{const te=o.get(j),c=M.get(j),i=P.find(g=>String(g.assignee_id??g.emp_id)===j)||h.find(g=>String(g.assignee_id??g.emp_id)===j),v=i?String(i.emp_name??j):j;return{id:j,name:v,prevWeek:{plan:(c==null?void 0:c.plan)??0,actual:(c==null?void 0:c.actual)??0},thisWeek:{plan:(te==null?void 0:te.thisPlan)??0,actual:(te==null?void 0:te.thisActual)??0},nextWeek:{plan:(te==null?void 0:te.nextPlan)??0,actual:(te==null?void 0:te.nextActual)??0}}});H.sort((j,te)=>j.name.localeCompare(te.name)),N(H)}catch{if(n)return;b("지역 활동 계획을 불러오지 못했습니다"),N([])}finally{n||A(!1)}}return m(),()=>{n=!0}},[q]);const d=t.useMemo(()=>{let n=1;for(const m of F)n=Math.max(n,m.prevWeek.plan,m.prevWeek.actual,m.thisWeek.plan,m.thisWeek.actual,m.nextWeek.plan,m.nextWeek.actual);return n},[F]),x=t.useMemo(()=>{let n=1;for(const m of V)n=Math.max(n,m.prevWeek.plan,m.prevWeek.actual,m.thisWeek.plan,m.thisWeek.actual,m.nextWeek.plan,m.nextWeek.actual);return n},[V]),r=t.useMemo(()=>F.map(n=>{const m=n.prevWeek.plan,P=n.prevWeek.actual,h=m+P,o=h>0?P/h*100:0;return{...n,achievementRate:o,prevTotal:h}}),[F]),T=t.useMemo(()=>V.map(n=>{const m=n.prevWeek.plan,P=n.prevWeek.actual,h=m+P,o=h>0?P/h*100:0;return{...n,achievementRate:o,prevTotal:h}}),[V]),S=t.useMemo(()=>{const n=[...r];return R==="rate-high"?n.sort((m,P)=>P.achievementRate-m.achievementRate):R==="rate-low"?n.sort((m,P)=>m.achievementRate-P.achievementRate):n},[r,R]),w=t.useMemo(()=>{const n=[...T];return R==="rate-high"?n.sort((m,P)=>P.achievementRate-m.achievementRate):R==="rate-low"?n.sort((m,P)=>m.achievementRate-P.achievementRate):n},[T,R]),l="#3b82f6",C="#10b981",Y=ke.useCallback((n,m,P,h)=>{const o=ln(q+m);try{window.dispatchEvent(new CustomEvent(h?"tnt.sales.region-plans.select":"tnt.sales.activities.select",{detail:{assigneeId:n.id,empName:n.name,startIso:o.start.toISOString(),endIso:o.end.toISOString(),label:`${n.name} · ${P} 계획/실적`,isRegion:h||!1}}))}catch{}},[q]),ue=t.useMemo(()=>Xn(ln(q)),[q]);function ie(n,m){const P=n>=90?"#10b981":n>=70?"#f59e0b":"#ef4444";return{display:m?`${Math.round(n)}%`:"-",color:P}}return e.jsxs("section",{className:"sales-activities-panel",style:{display:"flex",flexDirection:"column",gap:20},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:16,paddingBottom:12,borderBottom:"2px solid var(--border)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"baseline",gap:12},children:[e.jsx("h1",{style:{margin:0,fontSize:24,fontWeight:700},children:"활동관리"}),e.jsx("div",{className:"muted",style:{fontSize:13,fontWeight:500},children:"주간 계획·실적"})]}),e.jsxs("div",{style:{display:"flex",gap:10,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs("div",{className:"card",style:{display:"inline-flex",alignItems:"center",gap:8,padding:"0 12px",border:"1px solid var(--border)",borderRadius:10,background:"var(--panel)",boxShadow:"0 1px 3px rgba(0,0,0,.05)",height:44},children:[e.jsx("button",{className:"icon-button",title:"전주","aria-label":"전주",onClick:()=>X(n=>n-1),onKeyDown:n=>{(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),X(m=>m-1))},style:{width:30,height:30,borderRadius:6},children:e.jsx("img",{src:jn,className:"icon",alt:"전주"})}),e.jsx("button",{className:"icon-button",title:"이번주로","aria-label":"이번주로",onClick:()=>X(0),onKeyDown:n=>{(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),X(0))},style:{width:30,height:30,borderRadius:6},children:e.jsx("img",{src:Qn,className:"icon",alt:"이번주로"})}),e.jsx("button",{className:"icon-button",title:"다음주","aria-label":"다음주",onClick:()=>X(n=>n+1),onKeyDown:n=>{(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),X(m=>m+1))},style:{width:30,height:30,borderRadius:6},children:e.jsx("img",{src:vn,className:"icon",alt:"다음주"})}),e.jsx("span",{className:"muted",style:{fontSize:12,marginLeft:4,whiteSpace:"nowrap",fontWeight:600,minWidth:140,textAlign:"center"},children:ue})]}),e.jsxs("div",{className:"card",style:{padding:"0 12px",border:"1px solid var(--border)",borderRadius:10,display:"inline-flex",alignItems:"center",gap:8,background:"var(--panel)",boxShadow:"0 1px 3px rgba(0,0,0,.05)",height:44},children:[e.jsx("label",{htmlFor:"sort-select",style:{fontSize:12,color:"var(--text-muted)",fontWeight:500,display:"flex",alignItems:"center"},children:"정렬"}),e.jsxs("select",{id:"sort-select",value:R,onChange:n=>se(n.target.value),style:{fontSize:12,padding:"4px 8px",border:"1px solid var(--border)",borderRadius:6,background:"var(--panel)",color:"var(--text)",cursor:"pointer",fontWeight:500},children:[e.jsx("option",{value:"default",children:"기본"}),e.jsx("option",{value:"rate-high",children:"달성률 높은순"}),e.jsx("option",{value:"rate-low",children:"달성률 낮은순"})]})]}),e.jsxs("div",{className:"card",style:{padding:"0 14px",border:"1px solid var(--border)",borderRadius:10,display:"inline-flex",alignItems:"center",gap:12,fontSize:11,background:"var(--panel)",boxShadow:"0 1px 3px rgba(0,0,0,.05)",height:44},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("span",{style:{width:10,height:10,background:l,borderRadius:2}}),e.jsx("span",{style:{fontWeight:500},children:"계획"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("span",{style:{width:10,height:10,background:C,borderRadius:2}}),e.jsx("span",{style:{fontWeight:500},children:"실적"})]})]})]})]}),s?e.jsx("div",{className:"muted",style:{padding:12,textAlign:"center",fontSize:13},children:"직원 목록을 불러오는 중…"}):null,p?e.jsx("div",{className:"error",style:{padding:12,borderRadius:8,background:"rgba(239,68,68,.1)",fontSize:13},children:p}):null,e.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--border)",borderRadius:12,padding:20,boxShadow:"0 2px 8px rgba(0,0,0,.04)"},children:[e.jsxs("div",{style:{fontSize:15,fontWeight:700,color:"var(--text)",marginBottom:16,paddingBottom:12,borderBottom:"1px solid var(--border)",display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{style:{width:4,height:18,background:"#3b82f6",borderRadius:2}}),"영업 활동"]}),S.length===0?e.jsx("div",{className:"empty-state",style:{padding:16},children:"조회된 활동 데이터가 없습니다."}):e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"140px 90px repeat(3, minmax(0, 1fr))",gap:"6px 12px",alignItems:"center"},children:[e.jsx("div",{className:"muted",style:{fontSize:12,fontWeight:700},children:"영업사원"}),e.jsx("div",{className:"muted",style:{fontSize:12,textAlign:"center",fontWeight:700},children:"전주 달성률"}),e.jsx("div",{className:"muted",style:{fontSize:12,fontWeight:700},children:"전주"}),e.jsx("div",{className:"muted",style:{fontSize:12,fontWeight:700},children:"이번주"}),e.jsx("div",{className:"muted",style:{fontSize:12,fontWeight:700},children:"차주"}),S.map(n=>{const m=ie(n.achievementRate,n.prevTotal>0),P=[{key:"prev",label:"전주",data:n.prevWeek,offset:-1},{key:"this",label:"이번주",data:n.thisWeek,offset:0},{key:"next",label:"차주",data:n.nextWeek,offset:1}];return e.jsxs(ke.Fragment,{children:[e.jsx("div",{style:{padding:"3px 0",fontWeight:600,fontSize:12},children:n.name}),e.jsx("div",{style:{padding:"3px 0",textAlign:"center",fontWeight:700,color:m.color},children:m.display}),P.map(h=>e.jsx("div",{role:"button",tabIndex:0,title:`${h.label} 계획/실적 (클릭하여 상세보기)`,style:{cursor:"pointer",padding:"3px 0"},onClick:()=>Y(n,h.offset,h.label),onKeyDown:o=>{(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),Y(n,h.offset,h.label))},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:3,pointerEvents:"none"},children:[e.jsx(Ps,{value:h.data.plan,max:d,color:l,label:`${n.name} ${h.label} 계획`}),e.jsx(Ps,{value:h.data.actual,max:d,color:C,label:`${n.name} ${h.label} 실적`})]})},`${n.id}-${h.key}`))]},n.id)})]})]}),e.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--border)",borderRadius:12,padding:20,boxShadow:"0 2px 8px rgba(0,0,0,.04)"},children:[e.jsxs("div",{style:{fontSize:15,fontWeight:700,color:"var(--text)",marginBottom:16,paddingBottom:12,borderBottom:"1px solid var(--border)",display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{style:{width:4,height:18,background:"#10b981",borderRadius:2}}),"지역 활동 계획"]}),y?e.jsx("div",{className:"muted",style:{padding:12,textAlign:"center",fontSize:13},children:"지역 활동 계획을 불러오는 중…"}):O?e.jsx("div",{className:"error",style:{padding:12,borderRadius:8,background:"rgba(239,68,68,.1)",fontSize:13},children:O}):w.length===0?e.jsx("div",{className:"muted",style:{padding:12,textAlign:"center",fontSize:13},children:"지역 활동 계획 데이터가 없습니다."}):e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"140px 90px repeat(3, minmax(0, 1fr))",gap:"6px 12px",alignItems:"center"},children:[e.jsx("div",{className:"muted",style:{fontSize:12,fontWeight:700},children:"영업사원"}),e.jsx("div",{className:"muted",style:{fontSize:12,textAlign:"center",fontWeight:700},children:"전주 달성률"}),e.jsx("div",{className:"muted",style:{fontSize:12,fontWeight:700},children:"전주"}),e.jsx("div",{className:"muted",style:{fontSize:12,fontWeight:700},children:"이번주"}),e.jsx("div",{className:"muted",style:{fontSize:12,fontWeight:700},children:"차주"}),w.map(n=>{const m=ie(n.achievementRate,n.prevTotal>0),P=[{key:"prev",label:"전주",data:n.prevWeek,offset:-1},{key:"this",label:"이번주",data:n.thisWeek,offset:0},{key:"next",label:"차주",data:n.nextWeek,offset:1}];return e.jsxs(ke.Fragment,{children:[e.jsx("div",{style:{padding:"3px 0",fontWeight:600,fontSize:12},children:n.name}),e.jsx("div",{style:{padding:"3px 0",textAlign:"center",fontWeight:700,color:m.color},children:m.display}),P.map(h=>e.jsx("div",{role:"button",tabIndex:0,title:`${h.label} 계획/실적 (클릭하여 상세보기)`,style:{cursor:"pointer",padding:"3px 0"},onClick:()=>Y(n,h.offset,h.label,!0),onKeyDown:o=>{(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),Y(n,h.offset,h.label,!0))},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:3,pointerEvents:"none"},children:[e.jsx(Ps,{value:h.data.plan,max:x,color:l,label:`${n.name} ${h.label} 계획`}),e.jsx(Ps,{value:h.data.actual,max:x,color:C,label:`${n.name} ${h.label} 실적`})]})},`${n.id}-${h.key}`))]},n.id)})]})]})]})}async function Ls(s){const u=await fetch(`/api/v1/sales-activities/summary/weekly?offsetWeeks=${encodeURIComponent(s)}&depts=all`);if(!u.ok)throw new Error(`SUM HTTP ${u.status}`);const p=await u.json();return Array.isArray(p)?p:[]}async function fn(s){const u=await fetch(`/api/v1/region-activity-plans/summary/weekly?offsetWeeks=${encodeURIComponent(s)}&depts=all`);if(!u.ok)throw new Error(`REGION HTTP ${u.status}`);const p=await u.json();return Array.isArray(p)?p:[]}function xn(s){const u=new Map;for(const p of s){const _=String(p.assignee_id??p.emp_id??"");if(!_)continue;const F=p.thisWeek||{},B=p.nextWeek||{};u.set(_,{thisPlan:Number(F.plan??0),thisActual:Number(F.actual??0),nextPlan:Number(B.plan??0),nextActual:Number(B.actual??0)})}return u}function Js(s){const u=new Map;for(const p of s){const _=String(p.assignee_id??p.emp_id??"");if(!_)continue;const F=p.thisWeek||{};u.set(_,{plan:Number(F.plan??0),actual:Number(F.actual??0)})}return u}function or(){const[s,u]=t.useState([]),[p,_]=t.useState([]),[F,B]=t.useState(!1),[q,X]=t.useState(null),[R,se]=t.useState(""),[V,N]=t.useState(""),[y,A]=t.useState(()=>new Date().toISOString().split("T")[0]),[O,b]=t.useState(null),[d,x]=t.useState(null),[r,T]=t.useState([]),[S,w]=t.useState(!1);t.useEffect(()=>{l()},[]),t.useEffect(()=>{if(!O)return;const h=o=>{o.key==="Escape"&&(b(null),x(null))};return window.addEventListener("keydown",h,!0),()=>window.removeEventListener("keydown",h,!0)},[O]);async function l(){try{const h=await fetch("/api/v1/inventory/warehouses");if(!h.ok)throw new Error(`HTTP ${h.status}`);const o=await h.json();_(Array.isArray(o)?o:[])}catch(h){console.error("창고 목록 조회 실패:",h)}}async function C(){B(!0),X(null);try{const h=new URLSearchParams;R&&h.set("whSeq",R),V.trim()&&h.set("itemName",V.trim()),y&&h.set("asOfDate",y);const o=await fetch(`/api/v1/inventory/stock-aging?${h.toString()}`);if(!o.ok)throw new Error(`HTTP ${o.status}`);const M=await o.json();u(Array.isArray(M)?M:[])}catch(h){X((h==null?void 0:h.message)||"재고 조회 중 오류가 발생했습니다"),u([])}finally{B(!1)}}function Y(h){return h==null?"0":h.toLocaleString("ko-KR",{maximumFractionDigits:2})}function ue(h){return h==null?"0":h.toLocaleString("ko-KR",{maximumFractionDigits:0})}const ie=h=>{var H,j,te,c,i,v;if(!h)return[];const o=["BizUnit","StdDate","WHSeq","ItemName","ItemNo","ItemSeq","PAGE_NO","PAGE_SIZE","AvailStock","StockQty","InQty","OutQty","SafetyQty","WHName","UnitName"],M=[h==null?void 0:h.DataBlock1,(H=h==null?void 0:h.ROOT)==null?void 0:H.DataBlock1,(te=(j=h==null?void 0:h.data)==null?void 0:j.ROOT)==null?void 0:te.DataBlock1,(v=(i=(c=h==null?void 0:h.ROOT)==null?void 0:c.data)==null?void 0:i.ROOT)==null?void 0:v.DataBlock1];for(const g of M)if(g){if(Array.isArray(g))return g;if(typeof g=="object")return[g]}const G=[h];for(;G.length;){const g=G.shift();if(Array.isArray(g)&&g.length>0&&typeof g[0]=="object")return g;if(g&&typeof g=="object"){if(Object.keys(g).some(I=>o.includes(I)))return[g];Object.values(g).forEach(I=>G.push(I))}}return[]},n=h=>{if(h==null||h==="")return"-";const o=Number(h);return Number.isFinite(o)?o.toLocaleString("ko-KR"):String(h)};async function m(){try{const o={bizUnit:"1",stdDate:y.replace(/-/g,""),whSeq:R||"",itemName:V.trim(),itemNo:"",itemSeq:"",pageNo:"1",pageSize:"10000",userId:localStorage.getItem("tnt.sales.empId")||""};b(JSON.stringify(o,null,2))}catch(h){window.alert("JSON 생성 중 오류가 발생했습니다: "+h.message)}}async function P(){B(!0),X(null),x(null);try{const o={bizUnit:"1",stdDate:y.replace(/-/g,""),whSeq:R||"",itemName:V.trim(),itemNo:"",itemSeq:"",pageNo:"1",pageSize:"10000",userId:localStorage.getItem("tnt.sales.empId")||""},M=await fetch("/api/v1/items/avail-stock",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!M.ok)throw new Error(`HTTP ${M.status}`);const G=await M.json(),H=ie(G.receivedPayload||G),j={...G,parsedItems:H};x(j),T(H),b(JSON.stringify(o,null,2)),sessionStorage.setItem("tnt.sales.inventory.lastErpResult",JSON.stringify(j)),window.dispatchEvent(new CustomEvent("tnt.sales.inventory.erpResult",{detail:j}))}catch(h){X((h==null?void 0:h.message)||"ERP 재고조회 중 오류가 발생했습니다");const o={error:(h==null?void 0:h.message)||"ERP 재고조회 중 오류가 발생했습니다"};x(o),T([]),window.dispatchEvent(new CustomEvent("tnt.sales.inventory.erpResult",{detail:o}))}finally{B(!1)}}return e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[e.jsx("div",{style:{padding:"16px 20px",borderBottom:"1px solid var(--border)",background:"var(--panel)"},children:e.jsx("h2",{style:{margin:0,fontSize:18,fontWeight:700,color:"var(--text)"},children:"재고현황 (품목별 Aging)"})}),e.jsxs("div",{style:{padding:"12px 20px",borderBottom:"1px solid var(--border)",background:"var(--panel)",display:"flex",gap:12,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("label",{style:{fontSize:13,color:"var(--muted)",whiteSpace:"nowrap"},children:"기준일자:"}),e.jsx("input",{type:"date",value:y,onChange:h=>A(h.target.value),style:{height:32,padding:"0 8px",borderRadius:6,border:"1px solid var(--border)",background:"var(--panel)",color:"var(--text)",fontSize:13}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("label",{style:{fontSize:13,color:"var(--muted)",whiteSpace:"nowrap"},children:"창고:"}),e.jsxs("select",{value:R,onChange:h=>se(h.target.value),style:{height:32,padding:"0 8px",borderRadius:6,border:"1px solid var(--border)",background:"var(--panel)",color:"var(--text)",fontSize:13,minWidth:120},children:[e.jsx("option",{value:"",children:"전체"}),p.map(h=>e.jsx("option",{value:h.WHSeq,children:h.WHName},h.WHSeq))]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("label",{style:{fontSize:13,color:"var(--muted)",whiteSpace:"nowrap"},children:"품목명:"}),e.jsx("input",{type:"text",value:V,onChange:h=>N(h.target.value),placeholder:"검색...",style:{height:32,padding:"0 8px",borderRadius:6,border:"1px solid var(--border)",background:"var(--panel)",color:"var(--text)",fontSize:13,minWidth:200}})]}),e.jsx("button",{onClick:C,disabled:F,className:"btn btn-card btn-3d",style:{height:32,fontSize:13,padding:"0 16px"},children:F?"조회 중...":"조회"}),e.jsx("button",{onClick:m,disabled:F,className:"btn btn-card btn-3d",style:{height:32,fontSize:13,padding:"0 16px",background:"#3b82f6",color:"#ffffff",border:"1px solid #2563eb"},children:"ERP 조회"})]}),e.jsx("div",{style:{flex:1,minHeight:0,overflow:"auto",padding:20},children:q?e.jsx("div",{style:{padding:20,textAlign:"center",color:"var(--error)"},children:q}):F?e.jsx("div",{style:{padding:20,textAlign:"center",color:"var(--muted)"},children:"재고 데이터를 불러오는 중..."}):s.length===0?e.jsx("div",{style:{padding:20,textAlign:"center",color:"var(--muted)"},children:"조회된 재고가 없습니다"}):e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{className:"data-table",style:{width:"100%",borderCollapse:"collapse",fontSize:13},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"var(--panel)",borderBottom:"2px solid var(--border)"},children:[e.jsx("th",{style:{padding:"10px 12px",textAlign:"left",whiteSpace:"nowrap",color:"var(--muted)",fontWeight:600},children:"품목코드"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"left",whiteSpace:"nowrap",color:"var(--muted)",fontWeight:600},children:"품목명"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"left",whiteSpace:"nowrap",color:"var(--muted)",fontWeight:600},children:"LOT No."}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"left",whiteSpace:"nowrap",color:"var(--muted)",fontWeight:600},children:"규격"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"right",whiteSpace:"nowrap",color:"var(--muted)",fontWeight:600},children:"총재고수량"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"right",whiteSpace:"nowrap",color:"var(--muted)",fontWeight:600},children:"총재고금액"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"right",whiteSpace:"nowrap",color:"var(--muted)",fontWeight:600,background:"#e8f5e9"},children:"0-30일"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"right",whiteSpace:"nowrap",color:"var(--muted)",fontWeight:600,background:"#fff9c4"},children:"31-60일"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"right",whiteSpace:"nowrap",color:"var(--muted)",fontWeight:600,background:"#ffe0b2"},children:"61-90일"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"right",whiteSpace:"nowrap",color:"var(--muted)",fontWeight:600,background:"#ffccbc"},children:"91-180일"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"right",whiteSpace:"nowrap",color:"var(--muted)",fontWeight:600,background:"#ffcdd2"},children:"180일+"})]})}),e.jsx("tbody",{children:s.map((h,o)=>e.jsxs("tr",{style:{borderBottom:"1px solid var(--border)"},children:[e.jsx("td",{style:{padding:"10px 12px",color:"var(--text)"},children:h.itemNo||"-"}),e.jsx("td",{style:{padding:"10px 12px",color:"var(--text)",fontWeight:500},children:h.itemName||"-"}),e.jsx("td",{style:{padding:"10px 12px",color:"var(--primary)",fontWeight:500,fontSize:12},children:h.lotNo||"-"}),e.jsx("td",{style:{padding:"10px 12px",color:"var(--muted)",fontSize:12},children:h.spec||"-"}),e.jsx("td",{style:{padding:"10px 12px",textAlign:"right",color:"var(--text)",fontWeight:600},children:Y(h.totalQty)}),e.jsx("td",{style:{padding:"10px 12px",textAlign:"right",color:"var(--text)"},children:ue(h.totalAmt)}),e.jsx("td",{style:{padding:"10px 12px",textAlign:"right",color:"#2e7d32",background:"#f1f8e9"},children:Y(h.days0to30Qty)}),e.jsx("td",{style:{padding:"10px 12px",textAlign:"right",color:"#f57f17",background:"#fffde7"},children:Y(h.days31to60Qty)}),e.jsx("td",{style:{padding:"10px 12px",textAlign:"right",color:"#e65100",background:"#fff3e0"},children:Y(h.days61to90Qty)}),e.jsx("td",{style:{padding:"10px 12px",textAlign:"right",color:"#d84315",background:"#fbe9e7"},children:Y(h.days91to180Qty)}),e.jsx("td",{style:{padding:"10px 12px",textAlign:"right",color:"#c62828",background:"#ffebee",fontWeight:600},children:Y(h.days180PlusQty)})]},o))})]})})}),s.length>0&&!F&&e.jsxs("div",{style:{padding:"12px 20px",borderTop:"2px solid var(--border)",background:"var(--panel)",display:"flex",gap:20,fontSize:13,color:"var(--muted)"},children:[e.jsxs("div",{children:["총 ",e.jsx("strong",{style:{color:"var(--text)"},children:s.length}),"개 품목"]}),e.jsxs("div",{children:["총 재고수량: ",e.jsx("strong",{style:{color:"var(--text)"},children:Y(s.reduce((h,o)=>h+(o.totalQty||0),0))})]}),e.jsxs("div",{children:["총 재고금액: ",e.jsx("strong",{style:{color:"var(--text)"},children:ue(s.reduce((h,o)=>h+(o.totalAmt||0),0))})]})]}),O&&e.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,.5)"},onClick:()=>b(null),children:e.jsxs("div",{className:"card",style:{width:"min(800px, 90vw)",maxHeight:"80vh",overflow:"auto",padding:20,background:"var(--panel)",border:"1px solid var(--border)",borderRadius:12,boxShadow:"0 8px 32px rgba(0,0,0,.3)"},onClick:h=>h.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:16},children:[e.jsx("h3",{style:{margin:0,fontSize:16,fontWeight:700},children:"ERP 재고조회"}),e.jsx("button",{onClick:()=>{b(null),x(null)},style:{width:32,height:32,display:"flex",alignItems:"center",justifyContent:"center",background:"transparent",border:"none",borderRadius:4,cursor:"pointer",color:"var(--muted)",fontSize:20},title:"닫기 (ESC)",children:"×"})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("h4",{style:{margin:"0 0 8px 0",fontSize:14,fontWeight:600,color:"var(--text)"},children:"전송 JSON"}),e.jsx("pre",{style:{background:"#1e1e1e",color:"#d4d4d4",padding:16,borderRadius:8,overflow:"auto",fontSize:13,lineHeight:1.6,margin:0,maxHeight:d?"200px":"400px"},children:O})]}),d&&e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("h4",{style:{margin:"0 0 8px 0",fontSize:14,fontWeight:600,color:d.error?"#ef4444":"#10b981"},children:d.error?"오류 발생":"ERP 응답"}),e.jsx("pre",{style:{background:"#1e1e1e",color:"#d4d4d4",padding:16,borderRadius:8,overflow:"auto",fontSize:13,lineHeight:1.6,margin:0,maxHeight:"400px"},children:JSON.stringify(d,null,2)})]}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{className:"btn btn-card btn-3d",onClick:()=>{b(null),x(null)},style:{fontSize:13,padding:"8px 16px"},children:"닫기"}),!d&&e.jsx("button",{className:"btn btn-card btn-3d",onClick:()=>{P()},disabled:F,style:{fontSize:13,padding:"8px 16px",background:"#3b82f6",color:"#fff",border:"1px solid #2563eb"},children:F?"전송 중...":"전송"}),d&&!d.error&&r.length>0&&e.jsx("button",{className:"btn btn-card btn-3d",onClick:()=>w(!0),style:{fontSize:13,padding:"8px 16px"},children:"테이블 보기"})]})]})}),S&&e.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:1e4,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,.55)"},onClick:()=>w(!1),children:e.jsxs("div",{className:"card",style:{width:"min(960px, 92vw)",maxHeight:"82vh",overflow:"hidden",padding:16,background:"var(--panel)",border:"1px solid var(--border)",borderRadius:12,boxShadow:"0 12px 32px rgba(0,0,0,.35)"},onClick:h=>h.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:12},children:[e.jsx("h3",{style:{margin:0,fontSize:16,fontWeight:700},children:"ERP 결과 (테이블)"}),e.jsx("button",{onClick:()=>w(!1),style:{width:32,height:32,display:"flex",alignItems:"center",justifyContent:"center",background:"transparent",border:"none",borderRadius:4,cursor:"pointer",color:"var(--muted)",fontSize:20},title:"닫기",children:"×"})]}),r.length===0?e.jsx("div",{className:"empty-state",children:"표시할 데이터가 없습니다"}):e.jsx("div",{className:"table-container",style:{maxHeight:"68vh",overflow:"auto"},children:e.jsxs("table",{className:"table",style:{width:"100%",fontSize:12},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:50,textAlign:"center"},children:"#"}),e.jsx("th",{style:{minWidth:80},children:"품목코드"}),e.jsx("th",{style:{minWidth:140},children:"품목명"}),e.jsx("th",{style:{minWidth:120},children:"규격"}),e.jsx("th",{style:{minWidth:80},children:"단위"}),e.jsx("th",{style:{minWidth:120},children:"창고"}),e.jsx("th",{style:{minWidth:90,textAlign:"right"},children:"재고수량"}),e.jsx("th",{style:{minWidth:90,textAlign:"right"},children:"입고예정"}),e.jsx("th",{style:{minWidth:90,textAlign:"right"},children:"출고예정"}),e.jsx("th",{style:{minWidth:90,textAlign:"right"},children:"가용재고"}),e.jsx("th",{style:{minWidth:90,textAlign:"right"},children:"안전재고"})]})}),e.jsx("tbody",{children:r.map((h,o)=>e.jsxs("tr",{children:[e.jsx("td",{style:{textAlign:"center",color:"var(--muted)"},children:o+1}),e.jsx("td",{children:h.ItemNo||"-"}),e.jsx("td",{children:h.ItemName||"-"}),e.jsx("td",{children:h.Spec||"-"}),e.jsx("td",{children:h.UnitName||"-"}),e.jsx("td",{children:h.WHName||"-"}),e.jsx("td",{style:{textAlign:"right"},children:n(h.StockQty)}),e.jsx("td",{style:{textAlign:"right"},children:n(h.InQty)}),e.jsx("td",{style:{textAlign:"right"},children:n(h.OutQty)}),e.jsx("td",{style:{textAlign:"right"},children:n(h.AvailStock)}),e.jsx("td",{style:{textAlign:"right"},children:n(h.SafetyQty)})]},o))})]})})]})})]})}function cr(){const[s,u]=t.useState([]),[p,_]=t.useState(!1),[F,B]=t.useState(null),[q,X]=t.useState("all"),[R,se]=t.useState("30"),[V,N]=t.useState(""),[y,A]=t.useState(""),[O,b]=t.useState(""),[d,x]=t.useState({totalItems:0,expiredQty:0,warningQty:0,safeQty:0,expiredCount:0,warningCount:0}),r=async()=>{_(!0),B(null);try{const l=new URLSearchParams;q!=="all"&&l.append("expChk",q),R&&l.append("remainDayThreshold",R),V&&l.append("whSeq",V),y&&l.append("itemName",y),O&&l.append("category",O);const C=await fetch(`/api/v1/inventory/expiry-stock?${l.toString()}`);if(!C.ok)throw new Error(`API 호출 실패: ${C.status}`);const Y=await C.json();u(Y.items||[]);const ue=Y.items.filter(n=>n.expChk==="expired"),ie=Y.items.filter(n=>n.expChk==="warning");x({totalItems:Y.items.length,expiredQty:ue.reduce((n,m)=>n+(m.stockQty||0),0),warningQty:ie.reduce((n,m)=>n+(m.stockQty||0),0),safeQty:Y.items.reduce((n,m)=>n+(m.stockQty||0),0)-ue.reduce((n,m)=>n+(m.stockQty||0),0)-ie.reduce((n,m)=>n+(m.stockQty||0),0),expiredCount:ue.length,warningCount:ie.length})}catch(l){B(l.message||"데이터 조회 중 오류가 발생했습니다.")}finally{_(!1)}};t.useEffect(()=>{r()},[]);const T=l=>{if(l==null||l==="")return"-";const C=Number(l);return Number.isFinite(C)?C.toLocaleString("ko-KR"):String(l)},S=l=>{if(!l)return"-";const C=String(l);return C.length===8?`${C.substring(0,4)}-${C.substring(4,6)}-${C.substring(6,8)}`:C},w=l=>l==="expired"?e.jsx("span",{style:{padding:"2px 8px",background:"#ef4444",color:"white",borderRadius:4,fontSize:11},children:"만료"}):l==="warning"?e.jsx("span",{style:{padding:"2px 8px",background:"#f59e0b",color:"white",borderRadius:4,fontSize:11},children:"주의"}):l==="safe"?e.jsx("span",{style:{padding:"2px 8px",background:"#10b981",color:"white",borderRadius:4,fontSize:11},children:"안전"}):e.jsx("span",{style:{padding:"2px 8px",background:"#6b7280",color:"white",borderRadius:4,fontSize:11},children:"-"});return e.jsxs("div",{style:{padding:16,height:"100%",display:"flex",flexDirection:"column",gap:16},children:[e.jsx("div",{className:"pane-header",children:"유통기한재고 조회"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:12},children:[e.jsxs("div",{className:"card",style:{padding:12},children:[e.jsx("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:4},children:"전체 품목"}),e.jsx("div",{style:{fontSize:20,fontWeight:600},children:T(d.totalItems)})]}),e.jsxs("div",{className:"card",style:{padding:12,borderLeft:"3px solid #ef4444"},children:[e.jsxs("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:4},children:["만료 (",d.expiredCount,"건)"]}),e.jsx("div",{style:{fontSize:20,fontWeight:600,color:"#ef4444"},children:T(d.expiredQty)})]}),e.jsxs("div",{className:"card",style:{padding:12,borderLeft:"3px solid #f59e0b"},children:[e.jsxs("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:4},children:["주의 (",d.warningCount,"건)"]}),e.jsx("div",{style:{fontSize:20,fontWeight:600,color:"#f59e0b"},children:T(d.warningQty)})]}),e.jsxs("div",{className:"card",style:{padding:12,borderLeft:"3px solid #10b981"},children:[e.jsx("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:4},children:"안전 재고"}),e.jsx("div",{style:{fontSize:20,fontWeight:600,color:"#10b981"},children:T(d.safeQty)})]})]}),e.jsx("div",{className:"card",style:{padding:16},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:12},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:12,marginBottom:4},children:"상태 필터"}),e.jsxs("select",{className:"input",value:q,onChange:l=>X(l.target.value),style:{width:"100%"},children:[e.jsx("option",{value:"all",children:"전체"}),e.jsx("option",{value:"expired",children:"만료"}),e.jsx("option",{value:"warning",children:"주의"}),e.jsx("option",{value:"safe",children:"안전"})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:12,marginBottom:4},children:"잔여일수 기준"}),e.jsx("input",{type:"number",className:"input",value:R,onChange:l=>se(l.target.value),placeholder:"30",style:{width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:12,marginBottom:4},children:"창고"}),e.jsx("input",{type:"text",className:"input",value:V,onChange:l=>N(l.target.value),placeholder:"창고 번호",style:{width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:12,marginBottom:4},children:"품목명"}),e.jsx("input",{type:"text",className:"input",value:y,onChange:l=>A(l.target.value),placeholder:"품목명 검색",style:{width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:12,marginBottom:4},children:"카테고리"}),e.jsx("input",{type:"text",className:"input",value:O,onChange:l=>b(l.target.value),placeholder:"대분류",style:{width:"100%"}})]}),e.jsx("div",{style:{display:"flex",alignItems:"flex-end"},children:e.jsx("button",{className:"button primary",onClick:r,disabled:p,style:{width:"100%"},children:p?"조회 중...":"조회"})})]})}),e.jsx("div",{className:"card",style:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column"},children:F?e.jsx("div",{style:{padding:16,color:"#ef4444"},children:F}):s.length===0?e.jsx("div",{className:"empty-state",children:"조회된 데이터가 없습니다"}):e.jsx("div",{style:{overflow:"auto",flex:1},children:e.jsxs("table",{className:"table",style:{fontSize:12},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:40,textAlign:"center"},children:"#"}),e.jsx("th",{style:{width:80},children:"상태"}),e.jsx("th",{style:{minWidth:100},children:"품목코드"}),e.jsx("th",{style:{minWidth:160},children:"품목명"}),e.jsx("th",{style:{minWidth:100},children:"LOT번호"}),e.jsx("th",{style:{minWidth:100},children:"규격"}),e.jsx("th",{style:{minWidth:100},children:"창고"}),e.jsx("th",{style:{minWidth:80,textAlign:"right"},children:"재고수량"}),e.jsx("th",{style:{minWidth:100},children:"입고일"}),e.jsx("th",{style:{minWidth:100},children:"유통기한"}),e.jsx("th",{style:{minWidth:80,textAlign:"right"},children:"잔여일수"}),e.jsx("th",{style:{minWidth:80,textAlign:"right"},children:"잔여율(%)"}),e.jsx("th",{style:{minWidth:100},children:"최종출고일"}),e.jsx("th",{style:{minWidth:120},children:"대분류"}),e.jsx("th",{style:{minWidth:120},children:"중분류"}),e.jsx("th",{style:{minWidth:120},children:"소분류"})]})}),e.jsx("tbody",{children:s.map((l,C)=>e.jsxs("tr",{children:[e.jsx("td",{style:{textAlign:"center",color:"var(--muted)"},children:C+1}),e.jsx("td",{children:w(l.expChk||"")}),e.jsx("td",{children:l.itemNo||"-"}),e.jsx("td",{children:l.itemName||"-"}),e.jsx("td",{children:l.lotNo||"-"}),e.jsx("td",{children:l.spec||"-"}),e.jsx("td",{children:l.whName||"-"}),e.jsx("td",{style:{textAlign:"right"},children:T(l.stockQty)}),e.jsx("td",{children:S(l.inDate)}),e.jsx("td",{children:S(l.expDate)}),e.jsx("td",{style:{textAlign:"right"},children:T(l.remainDay)}),e.jsx("td",{style:{textAlign:"right"},children:l.remainRate?`${l.remainRate.toFixed(1)}%`:"-"}),e.jsx("td",{children:S(l.lastOutDate)}),e.jsx("td",{children:l.itemCategory||"-"}),e.jsx("td",{children:l.itemSubcategory||"-"}),e.jsx("td",{children:l.itemSmallCategory||"-"})]},C))})]})})})]})}function dr(){const[s,u]=t.useState([]),[p,_]=t.useState(0),[F,B]=t.useState(0),[q,X]=t.useState(!1),[R,se]=t.useState(!1),[V,N]=t.useState(null),[y,A]=t.useState("all"),[O,b]=t.useState(""),[d,x]=t.useState(""),[r,T]=t.useState(""),[S,w]=t.useState(""),[l,C]=t.useState(""),[Y,ue]=t.useState(""),[ie,n]=t.useState(""),[m,P]=t.useState(""),[h,o]=t.useState(""),[M,G]=t.useState(""),[H,j]=t.useState(""),[te,c]=t.useState(""),[i,v]=t.useState(""),[g,z]=t.useState(""),[I,ge]=t.useState(""),[re,Z]=t.useState(""),[ye,L]=t.useState(""),[he,fe]=t.useState(""),Se=100,Ae=t.useMemo(()=>{const me=new URLSearchParams;return me.set("limit",String(Se)),y!=="all"&&me.set("mode",y),O&&me.set("itemNo",O.trim()),d&&me.set("itemName",d.trim()),r&&me.set("lotNo",r.trim()),S&&me.set("whSeq",S.trim()),l&&me.set("expChk",l),Y&&me.set("expDateFrom",Y.replaceAll("-","")),ie&&me.set("expDateTo",ie.replaceAll("-","")),m&&me.set("remainDayMin",m),h&&me.set("remainDayMax",h),M&&me.set("remainRateMin",M),H&&me.set("remainRateMax",H),te&&me.set("outNotUseMin",te),i&&me.set("outNotUseMax",i),g&&me.set("inNotUseMin",g),I&&me.set("inNotUseMax",I),re&&me.set("categorySeq",re),ye&&me.set("subcategorySeq",ye),he&&me.set("smallCategorySeq",he),me},[Se,y,O,d,r,S,l,Y,ie,m,h,M,H,te,i,g,I,re,ye,he]),E=async me=>{var Ue;se(!0),N(null);try{const Je=new URLSearchParams(Ae);Je.set("offset",me?"0":String(F));const ht=await fetch(`/api/v1/inventory/dex?${Je.toString()}`),We=await ht.json();if(!ht.ok||We.error)throw new Error(We.error||`API 오류: ${ht.status}`);_(We.totalCount||0),X(!!We.hasMore),B((We.offset??0)+(((Ue=We.items)==null?void 0:Ue.length)||0)),u(Ve=>me?We.items||[]:[...Ve,...We.items||[]])}catch(Je){N(Je.message||"조회 중 오류가 발생했습니다.")}finally{se(!1)}};t.useEffect(()=>{E(!0)},[]);const ve=(me,Ue=0)=>{if(me==null)return"-";const Je=Number(me);return Number.isFinite(Je)?Je.toLocaleString("ko-KR",{maximumFractionDigits:Ue,minimumFractionDigits:Ue}):String(me)},ee=me=>{if(!me)return"-";const Ue=String(me);return Ue.length===8?`${Ue.slice(0,4)}-${Ue.slice(4,6)}-${Ue.slice(6,8)}`:Ue},_e=me=>me==="expired"?e.jsx("span",{style:{padding:"3px 8px",borderRadius:6,background:"#ef4444",color:"white",fontSize:11},children:"만료"}):me==="warning"?e.jsx("span",{style:{padding:"3px 8px",borderRadius:6,background:"#f59e0b",color:"white",fontSize:11},children:"임박"}):e.jsx("span",{style:{padding:"3px 8px",borderRadius:6,background:"#4b5563",color:"white",fontSize:11},children:"정상"}),Pe=me=>{me==="expired"?(A("expired"),o("0"),j("")):me==="near14"?(A("near"),o("14"),j("")):me==="near21"?(A("near"),o("21"),j("")):me==="rate10"?(A("near"),j("0.10"),o("")):me==="idle30"?(A("idle"),c("30"),z("30")):me==="idle60"&&(A("idle"),c("60"),z("60"))},Te=()=>{A("all"),b(""),x(""),T(""),w(""),C(""),ue(""),n(""),P(""),o(""),G(""),j(""),c(""),v(""),z(""),ge(""),Z(""),L(""),fe(""),B(0),u([])};return e.jsxs("div",{style:{padding:16,height:"100%",display:"flex",flexDirection:"column",gap:12},children:[e.jsx("div",{className:"pane-header",children:"유통기한재고(DEX)"}),e.jsxs("div",{className:"card",style:{padding:12},children:[e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginBottom:8},children:[e.jsx("span",{style:{color:"var(--muted)",fontSize:12,alignSelf:"center"},children:"빠른 조건"}),e.jsx("button",{className:"button",onClick:()=>Pe("expired"),children:"판매금지(만료/0일 이하)"}),e.jsx("button",{className:"button",onClick:()=>Pe("near14"),children:"임박 ≤14일"}),e.jsx("button",{className:"button",onClick:()=>Pe("near21"),children:"임박 ≤21일"}),e.jsx("button",{className:"button",onClick:()=>Pe("rate10"),children:"잔여율 ≤10%"}),e.jsx("button",{className:"button",onClick:()=>Pe("idle30"),children:"미사용 ≥30일"}),e.jsx("button",{className:"button",onClick:()=>Pe("idle60"),children:"미사용 ≥60일"}),e.jsx("button",{className:"button",onClick:Te,children:"초기화"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:8},children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"모드"}),e.jsxs("select",{className:"input",value:y,onChange:me=>A(me.target.value),children:[e.jsx("option",{value:"all",children:"전체"}),e.jsx("option",{value:"expired",children:"만료/판매금지"}),e.jsx("option",{value:"near",children:"임박/신속처분"}),e.jsx("option",{value:"idle",children:"장기미사용"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"품목코드"}),e.jsx("input",{className:"input",value:O,onChange:me=>b(me.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"품목명"}),e.jsx("input",{className:"input",value:d,onChange:me=>x(me.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"창고"}),e.jsx("input",{className:"input",value:S,onChange:me=>w(me.target.value),placeholder:"wh_seq"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"LOT"}),e.jsx("input",{className:"input",value:r,onChange:me=>T(me.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"만료여부"}),e.jsxs("select",{className:"input",value:l,onChange:me=>C(me.target.value),children:[e.jsx("option",{value:"",children:"전체"}),e.jsx("option",{value:"expired",children:"만료"}),e.jsx("option",{value:"warning",children:"임박"}),e.jsx("option",{value:"safe",children:"정상"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"유통기한 From"}),e.jsx("input",{type:"date",className:"input",value:Y,onChange:me=>ue(me.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"유통기한 To"}),e.jsx("input",{type:"date",className:"input",value:ie,onChange:me=>n(me.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"잔여일수 Min"}),e.jsx("input",{className:"input",value:m,onChange:me=>P(me.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"잔여일수 Max"}),e.jsx("input",{className:"input",value:h,onChange:me=>o(me.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"잔여율 Min"}),e.jsx("input",{className:"input",value:M,onChange:me=>G(me.target.value),placeholder:"0.15"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"잔여율 Max"}),e.jsx("input",{className:"input",value:H,onChange:me=>j(me.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"출고미사용 Min"}),e.jsx("input",{className:"input",value:te,onChange:me=>c(me.target.value),placeholder:"30"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"출고미사용 Max"}),e.jsx("input",{className:"input",value:i,onChange:me=>v(me.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"입고미사용 Min"}),e.jsx("input",{className:"input",value:g,onChange:me=>z(me.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"입고미사용 Max"}),e.jsx("input",{className:"input",value:I,onChange:me=>ge(me.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"대분류 Seq"}),e.jsx("input",{className:"input",value:re,onChange:me=>Z(me.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"중분류 Seq"}),e.jsx("input",{className:"input",value:ye,onChange:me=>L(me.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"소분류 Seq"}),e.jsx("input",{className:"input",value:he,onChange:me=>fe(me.target.value)})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:12},children:[e.jsx("button",{className:"button primary",onClick:()=>E(!0),disabled:R,children:R?"조회 중...":"조회"}),e.jsxs("div",{style:{color:"var(--muted)",display:"flex",alignItems:"center"},children:["총 ",ve(p)," 건"]})]})]}),e.jsxs("div",{className:"card",style:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column"},children:[V?e.jsx("div",{style:{padding:12,color:"#ef4444"},children:V}):s.length===0?e.jsx("div",{className:"empty-state",children:"조회된 데이터가 없습니다"}):e.jsx("div",{style:{overflow:"auto"},children:e.jsxs("table",{className:"table",style:{fontSize:12},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:40},children:"#"}),e.jsx("th",{style:{width:80},children:"상태"}),e.jsx("th",{style:{minWidth:130},children:"품목"}),e.jsx("th",{style:{minWidth:80},children:"LOT"}),e.jsx("th",{style:{minWidth:120},children:"창고"}),e.jsx("th",{style:{minWidth:90,textAlign:"right"},children:"재고수량"}),e.jsx("th",{style:{minWidth:90,textAlign:"right"},children:"잔여일수"}),e.jsx("th",{style:{minWidth:90,textAlign:"right"},children:"잔여율"}),e.jsx("th",{style:{minWidth:110},children:"유통기한"}),e.jsx("th",{style:{minWidth:110},children:"최종출고"}),e.jsx("th",{style:{minWidth:110,textAlign:"right"},children:"출고미사용"}),e.jsx("th",{style:{minWidth:110,textAlign:"right"},children:"입고미사용"}),e.jsx("th",{style:{minWidth:110},children:"유통기한설정"}),e.jsx("th",{style:{minWidth:140},children:"분류(대/중/소)"})]})}),e.jsx("tbody",{children:s.map((me,Ue)=>e.jsxs("tr",{children:[e.jsx("td",{children:Ue+1}),e.jsx("td",{children:_e(me.exp_chk)}),e.jsxs("td",{children:[e.jsx("div",{style:{fontWeight:600},children:me.item_no||"-"}),e.jsx("div",{style:{color:"var(--muted)"},children:me.item_name||"-"})]}),e.jsx("td",{children:me.lot_no||"-"}),e.jsx("td",{children:me.wh_name||"-"}),e.jsx("td",{style:{textAlign:"right"},children:ve(me.stock_qty,2)}),e.jsx("td",{style:{textAlign:"right"},children:ve(me.remain_day)}),e.jsx("td",{style:{textAlign:"right"},children:me.remain_rate!=null?`${Number(me.remain_rate).toFixed(2)}%`:"-"}),e.jsx("td",{children:ee(me.exp_date)}),e.jsx("td",{children:ee(me.last_out_date)}),e.jsx("td",{style:{textAlign:"right"},children:ve(me.out_not_use_date)}),e.jsx("td",{style:{textAlign:"right"},children:ve(me.in_not_use_date)}),e.jsx("td",{children:me.exp_period||"-"}),e.jsxs("td",{children:[e.jsx("div",{children:me.item_category||"-"}),e.jsxs("div",{style:{color:"var(--muted)"},children:[me.item_subcategory||"-"," / ",me.item_small_category||"-"]})]})]},me.id??`${me.item_no}-${me.lot_no}-${Ue}`))})]})}),q&&!V&&e.jsx("div",{style:{padding:12,display:"flex",justifyContent:"center"},children:e.jsx("button",{className:"button",onClick:()=>E(!1),disabled:R,children:R?"불러오는 중...":"더 보기"})})]})]})}function fr({selectedKey:s}){return e.jsx("div",{className:"main-view",children:s==="dashboard"?e.jsx(Sa,{}):s==="calendar"?e.jsx(wa,{}):s==="demand"&&wt.demandManagement?e.jsxs("section",{children:[e.jsx("h1",{children:"수요관리"}),e.jsx("p",{children:"여기에서 수요 데이터를 조회/분석/관리하는 기능이 표시됩니다."}),e.jsx("div",{className:"empty-state",children:"초기 버전: 메인 화면 스켈레톤"})]}):s==="customer"&&wt.customerManagement?e.jsxs("section",{children:[e.jsx("h1",{children:"고객관리"}),e.jsx("p",{children:"고객관리 요구사항은 별도로 정의/입력됩니다. 현재는 플레이스홀더입니다."}),e.jsx("div",{className:"empty-state",children:"초기 버전: 고객관리 화면 스켈레톤"})]}):s==="customer"&&wt.customerManagement?e.jsxs("section",{children:[e.jsx("h1",{children:"고객관리"}),e.jsx("p",{children:"고객관리 요구사항은 별도로 정의/입력됩니다. 현재는 플레이스홀더입니다."}),e.jsx("div",{className:"empty-state",children:"초기 버전: 고객관리 화면 스켈레톤"})]}):s==="customer:list"&&wt.customerManagement?e.jsx(wn,{}):s==="customer:sales-activity-new"&&wt.customerManagement?e.jsx(ia,{}):s==="customer:c360"&&wt.customerManagement?e.jsx(ha,{}):s==="sales-mgmt:activity-plan"?e.jsx(va,{}):s==="customer:c360-old"&&wt.customerManagement?e.jsx(ba,{}):s==="customer:my-activities"&&wt.customerManagement?e.jsx(Aa,{}):s==="lead:register"||s==="lead"?e.jsx(Ba,{}):s==="lead:tm-status"?e.jsx(Ha,{}):s==="order-sheet"?e.jsx(Ya,{}):s==="order-list"?e.jsx(Ga,{}):s==="inquiry"?e.jsx($a,{}):s==="estimate"?e.jsx(Wa,{}):s==="item360"?e.jsx(Za,{}):s==="inventory"||s==="inventory:old"?e.jsx(or,{}):s==="inventory:expiry"?e.jsx(cr,{}):s==="inventory:dex"?e.jsx(dr,{}):s==="complaint"?e.jsx(Ia,{}):s==="settings"?e.jsx(za,{}):s==="sales-mgmt:sales"?e.jsx(sr,{}):s==="sales-mgmt:receivables"?e.jsx(ir,{}):s==="sales-mgmt:activities"?e.jsx(lr,{}):s==="demand:list"&&wt.demandManagement?e.jsx(Jn,{}):s==="sales-targets"&&wt.demandManagement?e.jsx(cn,{}):s==="sales-dashboard"&&wt.demandManagement?e.jsx(tr,{}):s==="sales-assign"&&wt.demandManagement?e.jsx(Xa,{}):s==="sales-plan"&&wt.demandManagement?e.jsx(ra,{}):s==="sales-plan-new"&&wt.demandManagement?e.jsx(cn,{}):s==="sales-plan-s"&&wt.demandManagement?e.jsx(na,{}):s==="demand:excel-upload"&&wt.demandManagement?e.jsx(Gn,{}):e.jsxs("section",{children:[e.jsx("h1",{children:s}),e.jsx("div",{className:"empty-state",children:"콘텐츠가 준비중입니다."})]})})}export{fr as MainView};
