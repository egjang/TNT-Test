import{r as d,j as e}from"./index-BDCdW1US.js";import{t as o}from"./tone-B1QjB-CC.js";function k(){const[l,h]=d.useState([]),[i,c]=d.useState(()=>new Set),[g,m]=d.useState(null),[f,u]=d.useState(!1),[x,j]=d.useState([]);function p(){try{const t=localStorage.getItem("tnt.sales.visitPlanActivities"),s=t?JSON.parse(t):[];h(Array.isArray(s)?s:[]),c(new Set)}catch{h([])}}d.useEffect(()=>{p();const t=()=>p();return window.addEventListener("tnt.sales.visitPlanUpdated",t),()=>window.removeEventListener("tnt.sales.visitPlanUpdated",t)},[]);function v(t){if(!t){c(new Set);return}const s=new Set;l.forEach(n=>s.add(n.id)),c(s)}function b(t,s){c(n=>{const r=new Set(n);return s?r.add(t):r.delete(t),r})}function w(){if(i.size===0)return;const t=l.filter(n=>!i.has(n.id)),s=l.filter(n=>i.has(n.id));try{localStorage.setItem("tnt.sales.visitPlanActivities",JSON.stringify(t));let n=[];try{const a=localStorage.getItem("tnt.sales.availableActivities");if(a){const y=JSON.parse(a);Array.isArray(y)&&(n=y)}}catch{}const r=new Map;n.forEach(a=>r.set(a.id,a)),s.forEach(a=>r.set(a.id,a));const A=Array.from(r.values());localStorage.setItem("tnt.sales.availableActivities",JSON.stringify(A)),h(t),c(new Set),m("선택된 활동을 목록에서 제거했습니다"),window.dispatchEvent(new CustomEvent("tnt.sales.visitPlanUpdated")),window.dispatchEvent(new CustomEvent("tnt.sales.availableActivitiesUpdated"))}catch{m("제거 중 오류가 발생했습니다")}}function S(){if(m(null),i.size===0){u(!1);return}const t=l.filter(s=>i.has(s.id));j(t),u(!0)}return e.jsxs("div",{style:{padding:8,display:"flex",flexDirection:"column",height:"100%"},children:[e.jsxs("div",{style:{marginBottom:8,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{className:"pane-header",style:{margin:0},children:o.title.visitTargets}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("button",{className:"btn",onClick:w,disabled:i.size===0,children:o.action.cancelVisit}),e.jsx("button",{className:"btn",onClick:S,disabled:i.size===0,children:o.action.simulate}),e.jsxs("div",{className:"muted",children:[l.length,"건",i.size?` · 선택 ${i.size}건`:""]})]})]}),l.length===0?e.jsx("div",{className:"empty-state",children:"선택된 활동이 없습니다."}):e.jsx("div",{style:{overflow:"auto",border:"1px solid var(--border)",borderRadius:8},children:e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:36,textAlign:"center"},children:e.jsx("input",{type:"checkbox",checked:l.length>0&&i.size===l.length,onChange:t=>v(t.target.checked)})}),e.jsx("th",{style:{width:240,textAlign:"left"},children:"주제"}),e.jsx("th",{style:{width:140},children:"거래처번호"}),e.jsx("th",{style:{width:200,textAlign:"left"},children:"거래처명"}),e.jsx("th",{style:{width:170},children:"예정 시작"}),e.jsx("th",{style:{width:170},children:"예정 종료"})]})}),e.jsx("tbody",{children:l.map(t=>e.jsxs("tr",{children:[e.jsx("td",{style:{textAlign:"center"},children:e.jsx("input",{type:"checkbox",checked:i.has(t.id),onChange:s=>b(t.id,s.target.checked)})}),e.jsx("td",{style:{textAlign:"left"},children:t.subject||""}),e.jsx("td",{children:t.customerId||""}),e.jsx("td",{style:{textAlign:"left"},children:t.customerName||""}),e.jsx("td",{children:t.plannedStartAt||""}),e.jsx("td",{children:t.plannedEndAt||""})]},t.id))})]})}),f&&e.jsxs("div",{className:"card",style:{marginTop:8,padding:12},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:8},children:"방문동선 Simulatiom (지도)"}),e.jsxs("div",{className:"muted",style:{marginBottom:8},children:["선택한 방문 계획 수: ",x.length]}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:12,alignItems:"center",minHeight:80,padding:8,border:"1px dashed var(--border)",borderRadius:8,marginBottom:12},children:x.length===0?e.jsx("div",{className:"muted",children:"선택된 방문이 없습니다"}):x.map((t,s)=>e.jsx("div",{title:`방문 ${s+1}`,style:{width:16,height:16,borderRadius:"50%",background:"var(--primary, #4e8cff)",display:"inline-block"}},s))}),e.jsx("button",{className:"btn",children:o.action.sendKakao})]}),g&&e.jsx("div",{className:"muted",style:{marginTop:8},children:g})]})}export{k as VisitPlanPanel};
