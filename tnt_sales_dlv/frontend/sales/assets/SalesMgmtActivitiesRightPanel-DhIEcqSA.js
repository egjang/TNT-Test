import{r as d,j as t,R as lt}from"./index-DnWsTnd7.js";import{a as dt,g as ot}from"./week-71ul24EN.js";import"./check-CbDrRJmJ.js";function gt(){const[s,T]=d.useState(null),[f,E]=d.useState([]),[k,C]=d.useState(!1),[w,M]=d.useState(null),[v,D]=d.useState([]),[B,$]=d.useState(!1),[L,P]=d.useState(null),[I,X]=d.useState([]),[G,_]=d.useState(!0),[H,O]=d.useState(null),[S,z]=d.useState(null),[J,R]=d.useState(!1),[m,K]=d.useState(null);d.useEffect(()=>{if(!S)return;const e=()=>z(null),n=a=>{a.key==="Escape"&&z(null)};return window.addEventListener("click",e),window.addEventListener("keydown",n),()=>{window.removeEventListener("click",e),window.removeEventListener("keydown",n)}},[S]);const Z=(e,n)=>{e.preventDefault(),e.stopPropagation(),z({x:e.clientX,y:e.clientY,activity:n})},tt=e=>{K(e),R(!0),z(null)};d.useEffect(()=>{let e=!1;async function n(){_(!0),O(null);try{const a=ot(0),i=new URLSearchParams;i.set("mineOnly","false"),i.set("start",a.start.toISOString()),i.set("end",a.end.toISOString());const l=await fetch(`/api/v1/sales-activities?${i.toString()}`);if(!l.ok)throw new Error(`HTTP ${l.status}`);const h=await l.json();if(e)return;const r=new Map;for(const u of Array.isArray(h)?h:[]){const x=u.sfOwnerId||u.assigneeId;if(!x)continue;const b=String(x);r.has(b)||r.set(b,[]),r.get(b).push({id:Number(u.id),subject:u.subject,activityType:u.activityType,activityStatus:u.activityStatus,plannedStartAt:u.plannedStartAt,plannedEndAt:u.plannedEndAt,customerName:u.customerName,sfAccountId:u.sfAccountId})}const c=await fetch("/api/v1/employees"),o=c.ok?await c.json():[],g=new Map;for(const u of Array.isArray(o)?o:[]){const x=String(u.assignee_id??u.emp_id);g.set(x,String(u.emp_name??x))}const j=[];for(const[u,x]of r.entries()){const b=x.length,V=x.filter(N=>N.activityStatus==="완료"||N.activityStatus==="completed").length,at=x.filter(N=>N.activityStatus==="계획"||N.activityStatus==="scheduled").length,rt=b>0?Math.round(V/b*100):0;j.push({empName:g.get(u)||u,assigneeId:u,totalActivities:b,completed:V,scheduled:at,completionRate:rt})}j.sort((u,x)=>x.totalActivities-u.totalActivities),X(j)}catch{if(e)return;O("전체 활동 요약을 불러오지 못했습니다")}finally{e||_(!1)}}return n(),()=>{e=!0}},[]),d.useEffect(()=>{const e=a=>{const i=(a==null?void 0:a.detail)||{};!i.assigneeId||!i.startIso||!i.endIso||T({assigneeId:String(i.assigneeId),empName:String(i.empName||""),startIso:String(i.startIso),endIso:String(i.endIso),status:i.status==="completed"?"completed":i.status==="scheduled"?"scheduled":void 0,label:i.label,isRegion:i.isRegion||!1})},n=a=>{const i=(a==null?void 0:a.detail)||{};!i.assigneeId||!i.startIso||!i.endIso||T({assigneeId:String(i.assigneeId),empName:String(i.empName||""),startIso:String(i.startIso),endIso:String(i.endIso),label:i.label,isRegion:!0})};return window.addEventListener("tnt.sales.activities.select",e),window.addEventListener("tnt.sales.region-plans.select",n),()=>{window.removeEventListener("tnt.sales.activities.select",e),window.removeEventListener("tnt.sales.region-plans.select",n)}},[]),d.useEffect(()=>{if(!s||s.isRegion)return;let e=!1;async function n(){C(!0),M(null);try{const a=new URLSearchParams;a.set("mineOnly","true"),a.set("assigneeId",s.assigneeId),a.set("start",s.startIso),a.set("end",s.endIso);const i=await fetch(`/api/v1/sales-activities?${a.toString()}`);if(!i.ok)throw new Error(`HTTP ${i.status}`);const l=await i.json();if(e)return;const h=(Array.isArray(l)?l:[]).map(r=>({id:Number(r.id),subject:r.subject,activityType:r.activityType,activityStatus:r.activityStatus,plannedStartAt:r.plannedStartAt,plannedEndAt:r.plannedEndAt,actualStartAt:r.actualStartAt,customerName:r.customerName,sfAccountId:r.sfAccountId,sfLeadId:r.sfLeadId,companyType:r.companyType,description:r.description,channel:r.channel}));E(h)}catch{if(e)return;M("활동 내역을 불러오지 못했습니다"),E([])}finally{e||C(!1)}}return n(),()=>{e=!0}},[s==null?void 0:s.assigneeId,s==null?void 0:s.startIso,s==null?void 0:s.endIso,s==null?void 0:s.isRegion]),d.useEffect(()=>{if(!s||!s.isRegion)return;let e=!1;async function n(){$(!0),P(null);try{const a=new URLSearchParams;a.set("assigneeId",s.assigneeId),a.set("start",s.startIso),a.set("end",s.endIso);const i=await fetch(`/api/v1/region-activity-plans?${a.toString()}`);if(!i.ok)throw new Error(`HTTP ${i.status}`);const l=await i.json();if(e)return;const h=(Array.isArray(l)?l:[]).map(r=>({id:Number(r.id),subject:r.subject,plannedStartAt:r.planned_start_at||r.plannedStartAt,plannedEndAt:r.planned_end_at||r.plannedEndAt,actualStartAt:r.actual_start_at||r.actualStartAt,actualEndAt:r.actual_end_at||r.actualEndAt,addrProvinceName:r.addr_province_name||r.addrProvinceName,addrDistrictName:r.addr_district_name||r.addrDistrictName,targetCount:typeof r.target_count=="number"?r.target_count:typeof r.targetCount=="number"?r.targetCount:0,targetLabels:r.target_labels||r.targetLabels||null}));D(h)}catch{if(e)return;P("지역 활동 계획을 불러오지 못했습니다"),D([])}finally{e||$(!1)}}return n(),()=>{e=!0}},[s==null?void 0:s.assigneeId,s==null?void 0:s.startIso,s==null?void 0:s.endIso,s==null?void 0:s.isRegion]),d.useMemo(()=>s?`${s.empName||s.assigneeId} — ${s.label||""}`.trim():"활동 상세",[s]);function W(e){if(!e)return"";const n=new Date(e);if(isNaN(n.getTime()))return"";const a=String(n.getMonth()+1).padStart(2,"0"),i=String(n.getDate()).padStart(2,"0"),l=String(n.getHours()).padStart(2,"0"),h=String(n.getMinutes()).padStart(2,"0");return`${a}-${i} ${l}:${h}`}const[y,Y]=d.useState(null),[et,U]=d.useState(!1),[F,q]=d.useState(null),Q=d.useRef(null),[nt,it]=d.useState(0);d.useEffect(()=>{const e=Q.current;if(!e)return;const n=new ResizeObserver(a=>{for(const i of a)it(i.contentRect.width)});return n.observe(e),()=>n.disconnect()},[]);async function st(e){Y(null),U(!0),q(null);try{const n=new Date().getFullYear(),a=new URLSearchParams;a.set("year",String(n)),e.sfAccountId?a.set("sfAccountId",String(e.sfAccountId)):e.sfLeadId?a.set("sfLeadId",String(e.sfLeadId)):e.customerName&&a.set("customerName",String(e.customerName));const i=await fetch(`/api/v1/sales-activities/quarterly-completed?${a.toString()}`);if(!i.ok)throw new Error(`HTTP ${i.status}`);const l=await i.json(),h=(Array.isArray(l)?l:[]).map(g=>Number(g.quarter)),r=(Array.isArray(l)?l:[]).map(g=>Number(g.count)),c=Math.max(...r,0),o=Math.max(20,Math.ceil(c/10)*10);Y({quarters:h,counts:r,max:o,customerName:e.customerName})}catch{q("분기별 완료 활동 집계를 불러오지 못했습니다")}finally{U(!1)}}const p=d.useMemo(()=>{const e=f.length,n=f.filter(o=>o.activityStatus==="완료"||o.activityStatus==="completed").length,a=f.filter(o=>o.activityStatus==="계획"||o.activityStatus==="scheduled").length,i=f.filter(o=>o.activityStatus==="취소"||o.activityStatus==="cancelled").length,l=f.filter(o=>o.activityStatus==="연기"||o.activityStatus==="postponed").length,h=f.filter(o=>o.activityStatus==="미방문"||o.activityStatus==="no_visit").length,r=e>0?Math.round(n/e*100):0,c=new Map;for(const o of f){const g=o.activityType||"기타";c.set(g,(c.get(g)||0)+1)}return{total:e,completed:n,scheduled:a,cancelled:i,postponed:l,noVisit:h,completionRate:r,typeDistribution:c}},[f]),A=d.useMemo(()=>{const e=v.length,n=v.filter(l=>l.actualStartAt!=null||l.actualEndAt!=null).length,a=v.filter(l=>l.actualStartAt==null&&l.actualEndAt==null).length,i=e>0?Math.round(n/e*100):0;return{total:e,completed:n,scheduled:a,completionRate:i}},[v]);return s?s!=null&&s.isRegion?t.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",gap:12},children:[t.jsx("div",{style:{padding:"6px 10px",fontWeight:600,fontSize:13,borderBottom:"1px solid var(--border)"},children:s.empName||s.assigneeId}),B?t.jsx("div",{className:"muted",style:{fontSize:12,padding:8},children:"불러오는 중…"}):null,L?t.jsx("div",{className:"error",style:{fontSize:12,padding:8},children:L}):null,!B&&!L&&v.length>0&&t.jsx("div",{className:"card",style:{padding:12,border:"1px solid var(--border)",borderRadius:8,background:"var(--panel)"},children:t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:8},children:[t.jsxs("div",{style:{textAlign:"center",padding:"8px 0"},children:[t.jsx("div",{className:"muted",style:{fontSize:10,marginBottom:4},children:"전체"}),t.jsx("div",{style:{fontSize:18,fontWeight:700,color:"#3b82f6"},children:A.total})]}),t.jsxs("div",{style:{textAlign:"center",padding:"8px 0"},children:[t.jsx("div",{className:"muted",style:{fontSize:10,marginBottom:4},children:"완료"}),t.jsx("div",{style:{fontSize:18,fontWeight:700,color:"#10b981"},children:A.completed})]}),t.jsxs("div",{style:{textAlign:"center",padding:"8px 0"},children:[t.jsx("div",{className:"muted",style:{fontSize:10,marginBottom:4},children:"계획"}),t.jsx("div",{style:{fontSize:18,fontWeight:700,color:"#f59e0b"},children:A.scheduled})]}),t.jsxs("div",{style:{textAlign:"center",padding:"8px 0",borderLeft:"1px solid var(--border)"},children:[t.jsx("div",{className:"muted",style:{fontSize:10,marginBottom:4},children:"달성률"}),t.jsxs("div",{style:{fontSize:18,fontWeight:700,color:A.completionRate>=80?"#10b981":A.completionRate>=50?"#f59e0b":"#ef4444"},children:[A.completionRate,"%"]})]})]})}),t.jsx("div",{className:"table-container",style:{flex:1,minHeight:0},children:t.jsxs("table",{className:"table",style:{width:"100%"},children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"제목"}),t.jsx("th",{style:{width:160},children:"지역"}),t.jsx("th",{style:{width:80},children:"상태"}),t.jsx("th",{style:{width:120},children:"시작"}),t.jsx("th",{style:{width:120},children:"거래처수"}),t.jsx("th",{style:{width:140},children:"종료"})]})}),t.jsx("tbody",{children:v.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:6,className:"muted",style:{textAlign:"center"},children:"데이터가 없습니다."})}):v.map(e=>{const n=!!(e.actualStartAt||e.actualEndAt),a=[e.addrProvinceName,e.addrDistrictName].filter(Boolean).join(" "),i=e.actualEndAt?e.actualEndAt:e.actualStartAt?e.actualStartAt:null,l=(e.targetLabels||"").split(/\n+/).map(h=>h.trim()).filter(Boolean);return t.jsxs(lt.Fragment,{children:[t.jsxs("tr",{children:[t.jsx("td",{title:e.subject||"",children:e.subject||""}),t.jsx("td",{children:a||"-"}),t.jsx("td",{children:t.jsx("span",{style:{padding:"2px 6px",borderRadius:4,fontSize:11,fontWeight:600,background:n?"rgba(16,185,129,.15)":"rgba(245,158,11,.15)",color:n?"#10b981":"#f59e0b"},children:n?"완료":"계획"})}),t.jsx("td",{children:W(e.plannedStartAt)}),t.jsx("td",{style:{textAlign:"center",fontWeight:600},children:e.targetCount??0}),t.jsx("td",{children:W(i||void 0)})]}),l.length>0?t.jsx("tr",{children:t.jsx("td",{colSpan:6,style:{background:"var(--panel-2)",borderBottom:"1px solid var(--border)"},children:t.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:10,marginLeft:28},children:l.map((h,r)=>{const c=h.charAt(0),o=h.slice(1).trim(),g=c==="T"?"#3b82f6":c==="D"?"#f97316":c==="잠"?"#a855f7":"#6b7280",j=c==="잠"?"잠":c==="T"||c==="D"?c:"거";return t.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:4,fontSize:11},children:[t.jsx("span",{style:{width:14,height:14,borderRadius:"50%",background:g,color:"#fff",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:9,fontWeight:700},children:j}),t.jsx("span",{children:o})]},`${e.id}-target-${r}`)})})})}):null]},e.id)})})]})})]}):t.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",gap:12},children:[t.jsx("div",{style:{padding:"6px 10px",fontWeight:600,fontSize:13,borderBottom:"1px solid var(--border)"},children:s.empName||s.assigneeId}),k?t.jsx("div",{className:"muted",style:{fontSize:12,padding:8},children:"불러오는 중…"}):null,w?t.jsx("div",{className:"error",style:{fontSize:12,padding:8},children:w}):null,!k&&!w&&f.length>0&&t.jsxs("div",{className:"card",style:{padding:12,border:"1px solid var(--border)",borderRadius:8,background:"var(--panel)"},children:[t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:8,marginBottom:8},children:[t.jsxs("div",{style:{textAlign:"center",padding:"6px 0"},children:[t.jsx("div",{className:"muted",style:{fontSize:10,marginBottom:4},children:"전체"}),t.jsx("div",{style:{fontSize:18,fontWeight:700,color:"#3b82f6"},children:p.total})]}),t.jsxs("div",{style:{textAlign:"center",padding:"6px 0"},children:[t.jsx("div",{className:"muted",style:{fontSize:10,marginBottom:4},children:"완료"}),t.jsx("div",{style:{fontSize:18,fontWeight:700,color:"#10b981"},children:p.completed})]}),t.jsxs("div",{style:{textAlign:"center",padding:"6px 0"},children:[t.jsx("div",{className:"muted",style:{fontSize:10,marginBottom:4},children:"계획"}),t.jsx("div",{style:{fontSize:18,fontWeight:700,color:"#f59e0b"},children:p.scheduled})]})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:8,borderTop:"1px solid var(--border)",paddingTop:8},children:[t.jsxs("div",{style:{textAlign:"center",padding:"6px 0"},children:[t.jsx("div",{className:"muted",style:{fontSize:10,marginBottom:4},children:"취소"}),t.jsx("div",{style:{fontSize:16,fontWeight:600,color:"#6b7280"},children:p.cancelled})]}),t.jsxs("div",{style:{textAlign:"center",padding:"6px 0"},children:[t.jsx("div",{className:"muted",style:{fontSize:10,marginBottom:4},children:"연기"}),t.jsx("div",{style:{fontSize:16,fontWeight:600,color:"#6b7280"},children:p.postponed})]}),t.jsxs("div",{style:{textAlign:"center",padding:"6px 0"},children:[t.jsx("div",{className:"muted",style:{fontSize:10,marginBottom:4},children:"미방문"}),t.jsx("div",{style:{fontSize:16,fontWeight:600,color:"#6b7280"},children:p.noVisit})]}),t.jsxs("div",{style:{textAlign:"center",padding:"6px 0",borderLeft:"1px solid var(--border)"},children:[t.jsx("div",{className:"muted",style:{fontSize:10,marginBottom:4},children:"달성률"}),t.jsxs("div",{style:{fontSize:16,fontWeight:700,color:p.completionRate>=80?"#10b981":p.completionRate>=50?"#f59e0b":"#ef4444"},children:[p.completionRate,"%"]})]})]})]}),!k&&!w&&f.length>0&&p.typeDistribution.size>0&&t.jsxs("div",{className:"card",style:{padding:10,border:"1px solid var(--border)",borderRadius:8,background:"var(--panel)"},children:[t.jsx("div",{style:{fontSize:11,marginBottom:6,color:"var(--text-muted)",fontWeight:600},children:"활동 유형"}),t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:4},children:Array.from(p.typeDistribution.entries()).sort((e,n)=>n[1]-e[1]).slice(0,5).map(([e,n])=>{const a=Math.round(n/p.total*100);return t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[t.jsx("div",{style:{minWidth:70,fontSize:11,color:"var(--text)"},children:e}),t.jsxs("div",{style:{flex:1,position:"relative",height:18,background:"rgba(0,0,0,.06)",borderRadius:3},children:[t.jsx("div",{style:{width:`${a}%`,height:"100%",background:"linear-gradient(90deg, #3b82f6, #6366f1)",borderRadius:3,transition:"width .3s ease"}}),t.jsx("div",{style:{position:"absolute",right:4,top:0,bottom:0,display:"flex",alignItems:"center",fontSize:10,fontWeight:600,color:"var(--text)"},children:n})]})]},e)})})]}),t.jsx("div",{className:"table-container",style:{flex:"0 0 40%",minHeight:0},children:t.jsxs("table",{className:"table",style:{width:"100%"},children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"거래처"}),t.jsx("th",{children:"제목"}),t.jsx("th",{style:{width:110},children:"유형"}),t.jsx("th",{style:{width:110},children:"상태"}),t.jsx("th",{style:{width:120},children:"시작"}),t.jsx("th",{style:{width:120},children:"종료"})]})}),t.jsx("tbody",{children:f.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:6,className:"muted",style:{textAlign:"center"},children:"데이터가 없습니다."})}):f.map(e=>t.jsxs("tr",{onClick:()=>st(e),onContextMenu:n=>Z(n,e),style:{cursor:"pointer"},title:"좌클릭: 분기별 완료 활동 집계 / 우클릭: 활동 상세",children:[t.jsx("td",{title:e.customerName||"",children:t.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[(()=>{const n=(e.companyType||"").toUpperCase(),a=!!e.sfLeadId;return n.includes("TNT")?t.jsx("span",{style:{width:16,height:16,borderRadius:"50%",background:"#3b82f6",color:"#fff",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:700},children:"T"}):n.includes("DYS")?t.jsx("span",{style:{width:16,height:16,borderRadius:"50%",background:"#f97316",color:"#fff",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:700},children:"D"}):a?t.jsx("span",{style:{width:16,height:16,borderRadius:"50%",background:"#a855f7",color:"#fff",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:700},children:"잠"}):null})(),t.jsx("span",{children:e.customerName||"-"})]})}),t.jsx("td",{title:e.subject||"",children:e.subject||""}),t.jsx("td",{children:e.activityType||""}),t.jsx("td",{children:e.activityStatus||""}),t.jsx("td",{children:W(e.plannedStartAt)}),t.jsx("td",{children:W(e.plannedEndAt)})]},e.id))})]})}),t.jsxs("div",{style:{marginTop:8,flex:"1 1 auto",minHeight:0,display:"flex",flexDirection:"column"},children:[et?t.jsx("div",{className:"muted",style:{fontSize:12},children:"분기별 집계를 불러오는 중…"}):null,F?t.jsx("div",{className:"error",style:{fontSize:12},children:F}):null,y&&(()=>{const e=y.quarters.length,n=12,i=Math.max(0,nt-32-16),l=e>0?Math.floor((i-n*(e-1))/e):60,h=140,r=new Date().getFullYear();return t.jsxs("div",{ref:Q,className:"card",style:{padding:12,border:"1px solid var(--border)",borderRadius:10},children:[t.jsxs("div",{style:{fontSize:12,fontWeight:600,marginBottom:8,color:"var(--text)"},children:[y.customerName||"거래처"," - ",r,"년 분기별 완료 활동"]}),t.jsxs("div",{style:{display:"flex",alignItems:"flex-end",gap:8},children:[t.jsxs("div",{style:{height:h,display:"flex",flexDirection:"column",justifyContent:"space-between",paddingRight:6,color:"var(--muted)",fontSize:10,fontWeight:500},children:[t.jsx("div",{children:y.max}),t.jsx("div",{children:"0"})]}),t.jsxs("div",{style:{position:"relative",flex:1},children:[t.jsx("div",{style:{position:"absolute",left:0,right:0,bottom:0,height:1,background:"var(--border)"}}),t.jsx("div",{style:{display:"flex",alignItems:"flex-end",justifyContent:"space-around",height:h,gap:n},children:y.quarters.map((c,o)=>{const g=y.counts[o],j=y.max>0?Math.round(g/y.max*100):0;return t.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-end",width:l,height:h},children:g>0&&t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{fontSize:11,fontWeight:600,color:"#3b82f6",marginBottom:4},children:g}),t.jsx("div",{style:{height:`${j}%`,minHeight:8,width:"100%",maxWidth:l-8,background:"linear-gradient(180deg, #3b82f6, #6366f1)",borderRadius:6},title:`${c}분기: ${g}건`})]})},c)})}),t.jsx("div",{style:{display:"flex",justifyContent:"space-around",marginTop:6,gap:n},children:y.quarters.map(c=>t.jsxs("div",{className:"muted",style:{width:l,textAlign:"center",fontSize:11,fontWeight:600},children:["Q",c]},`label-${c}`))})]})]})]})})()]}),S&&t.jsx("div",{style:{position:"fixed",left:S.x,top:S.y,background:"var(--panel)",border:"1px solid var(--border)",borderRadius:8,boxShadow:"0 4px 12px rgba(0,0,0,.15)",zIndex:1e4,minWidth:160,padding:"4px 0"},onClick:e=>e.stopPropagation(),children:t.jsx("button",{className:"btn",onClick:()=>tt(S.activity),style:{width:"100%",textAlign:"left",padding:"8px 16px",border:"none",background:"transparent",cursor:"pointer",fontSize:13,fontWeight:500,borderRadius:0},onMouseEnter:e=>{e.currentTarget.style.background="rgba(59,130,246,.1)"},onMouseLeave:e=>{e.currentTarget.style.background="transparent"},children:"활동 상세"})}),J&&m&&t.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,.4)"},onClick:()=>R(!1),children:t.jsxs("div",{className:"card",style:{width:"min(920px, 92vw)",maxHeight:"90vh",overflow:"auto",padding:16,background:"var(--panel)",border:"1px solid var(--border)",borderRadius:12,boxShadow:"0 8px 32px rgba(0,0,0,.2)"},onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:12},children:[t.jsx("h3",{style:{margin:0,fontSize:16,fontWeight:700},children:"영업활동 상세"}),t.jsx("button",{className:"btn",onClick:()=>R(!1),style:{padding:"4px 12px",fontSize:13,background:"var(--panel-2)",border:"1px solid var(--border)"},children:"닫기"})]}),t.jsx(dt,{bare:!0,editId:m.id,initial:{id:m.id,subject:m.subject,description:m.description,channel:m.channel,activityType:m.activityType,activityStatus:m.activityStatus,plannedStartAt:m.plannedStartAt,actualStartAt:m.actualStartAt,sfAccountId:m.sfAccountId,customerName:m.customerName},onSaved:()=>{if(R(!1),s&&!s.isRegion){const e=new URLSearchParams;e.set("mineOnly","true"),e.set("assigneeId",s.assigneeId),e.set("start",s.startIso),e.set("end",s.endIso),fetch(`/api/v1/sales-activities?${e.toString()}`).then(n=>n.ok?n.json():[]).then(n=>{const a=(Array.isArray(n)?n:[]).map(i=>({id:Number(i.id),subject:i.subject,activityType:i.activityType,activityStatus:i.activityStatus,plannedStartAt:i.plannedStartAt,plannedEndAt:i.plannedEndAt,actualStartAt:i.actualStartAt,customerName:i.customerName,sfAccountId:i.sfAccountId,sfLeadId:i.sfLeadId,companyType:i.companyType,description:i.description,channel:i.channel}));E(a)}).catch(()=>{})}}})]})})]}):t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12,padding:12},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[t.jsx("h2",{style:{margin:0,fontSize:14,fontWeight:600},children:"영업사원 전체 활동 현황"}),t.jsx("div",{className:"muted",style:{fontSize:11},children:"이번주"})]}),G?t.jsx("div",{className:"muted",style:{fontSize:12},children:"불러오는 중…"}):H?t.jsx("div",{className:"error",style:{fontSize:12},children:H}):I.length===0?t.jsx("div",{className:"muted",style:{fontSize:12},children:"활동 데이터가 없습니다."}):t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:8},children:[t.jsxs("div",{className:"card",style:{padding:12,border:"1px solid var(--border)",borderRadius:8,textAlign:"center"},children:[t.jsx("div",{className:"muted",style:{fontSize:10,marginBottom:4},children:"전체 활동"}),t.jsx("div",{style:{fontSize:20,fontWeight:700,color:"#3b82f6"},children:I.reduce((e,n)=>e+n.totalActivities,0)})]}),t.jsxs("div",{className:"card",style:{padding:12,border:"1px solid var(--border)",borderRadius:8,textAlign:"center"},children:[t.jsx("div",{className:"muted",style:{fontSize:10,marginBottom:4},children:"완료"}),t.jsx("div",{style:{fontSize:20,fontWeight:700,color:"#10b981"},children:I.reduce((e,n)=>e+n.completed,0)})]}),t.jsxs("div",{className:"card",style:{padding:12,border:"1px solid var(--border)",borderRadius:8,textAlign:"center"},children:[t.jsx("div",{className:"muted",style:{fontSize:10,marginBottom:4},children:"계획"}),t.jsx("div",{style:{fontSize:20,fontWeight:700,color:"#f59e0b"},children:I.reduce((e,n)=>e+n.scheduled,0)})]})]}),t.jsx("div",{className:"card",style:{border:"1px solid var(--border)",borderRadius:8,overflow:"hidden"},children:t.jsx("div",{style:{maxHeight:"60vh",overflowY:"auto"},children:t.jsxs("table",{className:"table",style:{width:"100%"},children:[t.jsx("thead",{style:{position:"sticky",top:0,background:"var(--panel)",zIndex:1},children:t.jsxs("tr",{children:[t.jsx("th",{style:{textAlign:"left"},children:"영업사원"}),t.jsx("th",{style:{textAlign:"center",width:80},children:"전체"}),t.jsx("th",{style:{textAlign:"center",width:80},children:"완료"}),t.jsx("th",{style:{textAlign:"center",width:80},children:"계획"}),t.jsx("th",{style:{textAlign:"center",width:80},children:"달성률"})]})}),t.jsx("tbody",{children:I.map(e=>{const n=e.completionRate>=80?"#10b981":e.completionRate>=50?"#f59e0b":"#ef4444";return t.jsxs("tr",{children:[t.jsx("td",{style:{fontWeight:500},children:e.empName}),t.jsx("td",{style:{textAlign:"center",color:"#3b82f6",fontWeight:600},children:e.totalActivities}),t.jsx("td",{style:{textAlign:"center",color:"#10b981",fontWeight:600},children:e.completed}),t.jsx("td",{style:{textAlign:"center",color:"#f59e0b",fontWeight:600},children:e.scheduled}),t.jsxs("td",{style:{textAlign:"center",color:n,fontWeight:700},children:[e.completionRate,"%"]})]},e.assigneeId)})})]})})}),t.jsx("div",{className:"muted",style:{fontSize:11,padding:8,textAlign:"center"},children:"좌측 그래프를 클릭하면 개별 영업사원의 상세 활동을 볼 수 있습니다."})]})]})}export{gt as SalesMgmtActivitiesRightPanel};
