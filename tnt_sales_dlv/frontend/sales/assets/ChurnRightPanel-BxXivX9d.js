import{r as o,j as n}from"./index-C5CiSje-.js";function y(){const[l,u]=o.useState([]),[v,m]=o.useState("이탈거래처"),[h,x]=o.useState("prevAmount"),[r,i]=o.useState({open:!1,x:0,y:0,row:null}),d=o.useRef(null);o.useEffect(()=>{const t=e=>{var c;const a=Array.isArray((c=e==null?void 0:e.detail)==null?void 0:c.items)?e.detail.items:[];u(a),m("이탈거래처"),x("prevAmount")},s=e=>{var c;const a=Array.isArray((c=e==null?void 0:e.detail)==null?void 0:c.items)?e.detail.items:[];u(a),m("신규 거래처"),x("curAmount")};return window.addEventListener("tnt.sales.dashboard.churn",t),window.addEventListener("tnt.sales.dashboard.newcustomers",s),()=>{window.removeEventListener("tnt.sales.dashboard.churn",t),window.removeEventListener("tnt.sales.dashboard.newcustomers",s)}},[]),o.useEffect(()=>{const t=e=>{r.open&&d.current&&!d.current.contains(e.target)&&i({open:!1,x:0,y:0,row:null})},s=e=>{e.key==="Escape"&&i({open:!1,x:0,y:0,row:null})};return document.addEventListener("click",t,!0),document.addEventListener("contextmenu",t,!0),document.addEventListener("keydown",s,!0),()=>{document.removeEventListener("click",t,!0),document.removeEventListener("contextmenu",t,!0),document.removeEventListener("keydown",s,!0)}},[r.open]);const w=t=>new Intl.NumberFormat("ko-KR").format(Math.round(t||0));return n.jsxs("div",{ref:d,className:"card",style:{padding:12,height:"100%",overflow:"auto",position:"relative"},children:[n.jsx("div",{style:{fontWeight:700,marginBottom:8},children:v}),!l||l.length===0?n.jsx("div",{className:"empty-state",children:"데이터가 없습니다"}):n.jsx("div",{className:"table-container",style:{maxHeight:"70vh"},children:n.jsxs("table",{className:"table",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"거래처명"}),n.jsx("th",{style:{width:160,textAlign:"right"},children:h==="prevAmount"?"작년매출":"올해매출"})]})}),n.jsx("tbody",{children:l.map((t,s)=>n.jsxs("tr",{onClick:()=>{try{const a={customerSeq:t.customerSeq,customerName:t.customerName};localStorage.setItem("tnt.sales.selectedCustomer",JSON.stringify(a)),window.dispatchEvent(new CustomEvent("tnt.sales.customer.selected",{detail:{source:"dashboard-churn",customer:a}}))}catch{}const e=document.querySelector('button[data-key="customer:sales-activity-new"]');e&&e.click()},onContextMenu:e=>{e.preventDefault(),i({open:!0,x:e.clientX,y:e.clientY,row:t})},style:{cursor:"pointer"},title:"클릭하면 영업활동 등록으로 이동",children:[n.jsx("td",{children:t.customerName||""}),n.jsx("td",{style:{textAlign:"right"},children:w(t[h])})]},s))})]})}),r.open&&r.row&&n.jsx("div",{role:"menu",style:{position:"fixed",left:r.x,top:r.y,zIndex:9999,background:"var(--panel)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:8,boxShadow:"0 10px 24px rgba(0,0,0,.2)"},children:n.jsx("button",{role:"menuitem",className:"btn",style:{display:"block",width:"100%",padding:"8px 12px",background:"transparent",color:"inherit",border:"none",borderRadius:8},onClick:()=>{const t=r.row;try{const s={customerSeq:t.customerSeq,customerName:t.customerName};localStorage.setItem("tnt.sales.selectedCustomer",JSON.stringify(s)),window.dispatchEvent(new CustomEvent("tnt.sales.customer.selected",{detail:{source:"dashboard-churn",customer:s}})),window.dispatchEvent(new CustomEvent("tnt.sales.navigate",{detail:{key:"customer:sales-activity-new"}}))}catch{}i({open:!1,x:0,y:0,row:null})},children:"영업활동 이동"})})]})}export{y as ChurnRightPanel};
