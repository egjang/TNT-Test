import{j as e,r as i,R as A}from"./index-BmcpNj69.js";import{C as ue}from"./check-Bie4bzYh.js";function Kt({value:h,onChange:g,placeholder:l,readOnly:S,className:b,style:$}){return e.jsx("input",{type:"text",className:["subject-input",b].filter(Boolean).join(" "),style:$,value:h,onChange:L=>g==null?void 0:g(L.target.value),placeholder:l,readOnly:S})}const me=[{value:"Ï†ïÍ∏∞Î∞©Î¨∏",label:"Ï†ïÍ∏∞Î∞©Î¨∏"},{value:"ÏòÅÏóÖÍ∏∞Ìöå",label:"ÏòÅÏóÖÍ∏∞Ìöå"},{value:"Ï±ÑÍ∂åÍ¥ÄÎ¶¨",label:"Ï±ÑÍ∂åÍ¥ÄÎ¶¨"}],pe=[{value:"Í≥ÑÌöç",label:"Í≥ÑÌöç"},{value:"ÏôÑÎ£å",label:"ÏôÑÎ£å"},{value:"Ï∑®ÏÜå",label:"Ï∑®ÏÜå"},{value:"Ïó∞Í∏∞",label:"Ïó∞Í∏∞"},{value:"ÎØ∏Î∞©Î¨∏",label:"ÎØ∏Î∞©Î¨∏"}],fe=[{value:"Î∞©Î¨∏",label:"Î∞©Î¨∏"},{value:"Ï†ÑÌôî",label:"Ï†ÑÌôî"},{value:"Î¨∏Ïûê/Î©îÏùº/Ìå©Ïä§",label:"Î¨∏Ïûê/Î©îÏùº/Ìå©Ïä§"},{value:"Í∏∞ÌÉÄ",label:"Í∏∞ÌÉÄ"}],ge=["Í≥µÍ∞ú","ÌåÄÍ≥µÏú†","Í∞úÏù∏"];function Ie({bare:h=!1,initial:g,editId:l,leadId:S,onSaved:b,onNoticeClose:$,lockSubject:L,planMode:c,multiTargets:_}){const[m,St]=i.useState(null),[xt,he]=i.useState(""),[q,nt]=i.useState(""),[V,rt]=i.useState(""),[K,Qt]=i.useState(!1),[J,Gt]=i.useState(!1),[Q,bt]=i.useState("Í≥µÍ∞ú"),[G,it]=i.useState("Î∞©Î¨∏"),[B,jt]=i.useState("Ï†ïÍ∏∞Î∞©Î¨∏"),[I,wt]=i.useState("Í≥ÑÌöç"),[Nt,Xt]=i.useState(""),[ve,Zt]=i.useState(""),[Se,Mt]=i.useState(!1),[At,xe]=i.useState(""),te=!1,[k,X]=i.useState(""),[C,z]=i.useState(""),[ct,Tt]=i.useState(""),[H,lt]=i.useState(""),[y,ot]=i.useState(null),[dt,It]=i.useState(g??null),[kt,be]=i.useState(""),[Ct,je]=i.useState(""),[D,Dt]=i.useState(""),[ee,ut]=i.useState([]),[mt,U]=i.useState(!1),[we,se]=i.useState(null),[Et,E]=i.useState(null),[Ot,O]=i.useState(()=>({open:!1,text:""})),[Pt,Z]=i.useState(null),[ae,pt]=i.useState(!1),[Lt,ne]=i.useState(new Date),[W,Y]=i.useState(!1),[M,re]=i.useState(""),[ft,_t]=i.useState(!1),[Rt,$t]=i.useState(null),[qt,Bt]=i.useState([]),gt=A.useRef(null),F=dt??g,tt=(F==null?void 0:F.id)??l??(c?"plan":"new"),j=i.useMemo(()=>localStorage.getItem("tnt.sales.empId"),[]),P=i.useMemo(()=>localStorage.getItem("tnt.sales.assigneeId"),[]),et=A.useCallback(async()=>{try{const t=[],n=!!(P||j);P?t.push(["assigneeId",String(P)]):j&&t.push(["empId",String(j)]);async function s(d){const p=new URL("/api/v1/sales-activities",window.location.origin);d&&p.searchParams.set("sfAccountId",d),t.forEach(([N,R])=>p.searchParams.set(N,R)),p.searchParams.set("mineOnly",n?"true":"false"),p.searchParams.set("onlyRoot","true"),p.searchParams.set("limit","200");const f=await fetch(p.toString());if(!f.ok)return[];const v=await f.json();return Array.isArray(v)?v:[]}if(S){const d=new URL("/api/v1/sales-activities",window.location.origin);d.searchParams.set("sfLeadId",String(S)),t.forEach(([N,R])=>d.searchParams.set(N,R)),d.searchParams.set("mineOnly",n?"true":"false"),d.searchParams.set("onlyRoot","true"),d.searchParams.set("limit","200");const p=await fetch(d.toString()),f=p.ok?await p.json():[],v=Array.isArray(f)?f:[];ut(v.slice(0,200));return}const o=[];y!=null&&y.id&&o.push(String(y.id)),m!=null&&m.customerId&&o.push(String(m.customerId)),(m==null?void 0:m.customerSeq)!=null&&o.push(String(m.customerSeq)),H&&o.push(String(H));const a=Array.from(new Set(o.filter(Boolean)));let u=[];a.length>0?u=(await Promise.all(a.map(p=>s(p)))).flat():u=await s(void 0);const w=new Map;u.forEach(d=>{d&&d.id!=null&&w.set(Number(d.id),d)});let r=Array.from(w.values());const T=g||{},x=T.parentActivitySeq!=null?Number(T.parentActivitySeq):void 0;x&&!r.some(d=>Number(d.id)===x)&&(r=[{id:x,subject:T.parentSubject||"ÏÉÅÏúÑÌôúÎèô"},...r]),r.sort((d,p)=>{const f=d.createdAt?new Date(d.createdAt).getTime():0;return(p.createdAt?new Date(p.createdAt).getTime():0)-f}),ut(r.slice(0,200))}catch{ut([])}},[y==null?void 0:y.id,m==null?void 0:m.customerSeq,m==null?void 0:m.customerId,H,j,P,g==null?void 0:g.parentActivitySeq,g==null?void 0:g.parentSubject,S]);A.useEffect(()=>{et()},[et]),A.useEffect(()=>{if(!l){It(g??null);return}let t=!1;return(async()=>{try{const n=await fetch(`/api/v1/sales-activities/${l}`);if(!n.ok)throw new Error(`HTTP ${n.status}`);const s=await n.json();if(t)return;const o={id:s.id,subject:s.subject,description:s.description,channel:s.channel,activityType:s.activityType,activityStatus:s.activityStatus,plannedStartAt:s.plannedStartAt||s.planned_start_at,actualStartAt:s.actualStartAt||s.actual_start_at,sfAccountId:s.sfAccountId??s.sf_account_id,customerName:s.customerName??s.customer_name,parentActivitySeq:s.parentSeq??s.parent_activity_seq,parentSubject:s.parentSubject??s.parent_subject};It(o)}catch(n){console.error("Failed to load activity detail for edit:",n)}})(),()=>{t=!0}},[l,g]),A.useEffect(()=>{if(!(gt.current!==tt||l&&dt)&&gt.current===tt)return;gt.current=tt;const n=T=>{if(!T)return"";const x=new Date(T);if(isNaN(x.getTime()))return"";const d=x.getTimezoneOffset();return new Date(x.getTime()-d*6e4).toISOString().slice(0,16)},s=F||{};nt(s.subject??""),rt(s.description??"");const o={in_person:"Î∞©Î¨∏",phone:"Ï†ÑÌôî",email:"Î¨∏Ïûê/Î©îÏùº/Ìå©Ïä§",other:"Í∏∞ÌÉÄ"},a={site_visit:"Ï†ïÍ∏∞Î∞©Î¨∏",opportunity:"ÏòÅÏóÖÍ∏∞Ìöå",AR_mgmt:"Ï±ÑÍ∂åÍ¥ÄÎ¶¨",meeting:"ÎØ∏ÌåÖ",call:"Ï†ÑÌôî",email:"Ïù¥Î©îÏùº",demo:"Îç∞Î™®",task:"ÏóÖÎ¨¥",other:"Í∏∞ÌÉÄ"},u={scheduled:"Í≥ÑÌöç",completed:"ÏôÑÎ£å",canceled:"Ï∑®ÏÜå",postponed:"Ïó∞Í∏∞",no_show:"ÎØ∏Î∞©Î¨∏"},w={public:"Í≥µÍ∞ú",team:"ÌåÄÍ≥µÏú†",private:"Í∞úÏù∏"};it(s.channel&&(o[s.channel]||s.channel)||"Î∞©Î¨∏"),jt(s.activityType&&(a[s.activityType]||s.activityType)||"Ï†ïÍ∏∞Î∞©Î¨∏"),wt(c?"Í≥ÑÌöç":s.activityStatus&&(u[s.activityStatus]||s.activityStatus)||"Í≥ÑÌöç"),bt(s.visibility?w[s.visibility]||String(s.visibility):"Í≥µÍ∞ú"),X(n(s.plannedStartAt));const r=n(s.actualStartAt);z(r),Tt(r),lt(s.sfAccountId!=null?String(s.sfAccountId):""),Dt(s.parentActivitySeq!=null?String(s.parentActivitySeq):""),s.sfAccountId&&String(s.sfAccountId)||s.customerName?(ot({id:s.sfAccountId?String(s.sfAccountId):void 0,name:s.customerName?String(s.customerName):void 0}),St({customerId:s.sfAccountId?String(s.sfAccountId):void 0,customerName:s.customerName})):ot(null)},[F,tt,c,l,dt]),A.useEffect(()=>{l||c||X(t=>{if(t&&String(t).trim()!=="")return t;const n=new Date,s=n.getTimezoneOffset();return new Date(n.getTime()-s*6e4).toISOString().slice(0,16)})},[l,c]);const[zt,Ht]=A.useState(""),[Ut,ie]=A.useState(!0);A.useEffect(()=>{if(Ut){Ht(I),ie(!1);return}if(!(zt===I||c)){if(I==="ÏôÑÎ£å"&&(!ct||String(ct).trim()==="")){const t=new Date,n=t.getTimezoneOffset(),o=new Date(t.getTime()-n*6e4).toISOString().slice(0,16);z(o)}Ht(I)}},[I,ct,c,zt,Ut]),A.useEffect(()=>{!C||k||X(C)},[C,k]);const[ce,st]=i.useState(!1);A.useEffect(()=>{let t=!1;async function n(){try{if(!l){t||st(!1);return}const s=new URL("/api/v1/sales-activities",window.location.origin);s.searchParams.set("parentSeq",String(l)),s.searchParams.set("mineOnly","false"),s.searchParams.set("limit","1");const o=await fetch(s.toString());if(!o.ok){t||st(!1);return}const a=await o.json(),u=Array.isArray(a)?a:[];t||st(u.length>0)}catch{t||st(!1)}}return n(),()=>{t=!0}},[l]);const yt=!!(l&&ce),at=A.useCallback(async()=>{$t(null),_t(!0);try{const t=new URL("/api/v1/customers",window.location.origin);M.trim()&&t.searchParams.set("name",M.trim()),t.searchParams.set("mineOnly","false"),t.searchParams.set("limit","50");const n=await fetch(t.toString());if(!n.ok){let a=`HTTP ${n.status}`;try{const u=await n.json();u!=null&&u.error&&(a=u.error)}catch{}throw new Error(a)}const s=await n.json(),o=Array.isArray(s)?s:[];Bt(o.map(a=>({customerId:(a==null?void 0:a.customerId)??(a==null?void 0:a.customer_id),customerName:(a==null?void 0:a.customerName)??(a==null?void 0:a.customer_name),companyType:(a==null?void 0:a.companyType)??(a==null?void 0:a.company_type),ownerName:(a==null?void 0:a.ownerName)??(a==null?void 0:a.owner_name)})))}catch(t){$t((t==null?void 0:t.message)||"Ï°∞Ìöå Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§"),Bt([])}finally{_t(!1)}},[M]);A.useEffect(()=>{W&&at()},[W,at]),A.useEffect(()=>{if(!W)return;const t=n=>{n.key==="Escape"&&(n.preventDefault(),n.stopPropagation(),Y(!1))};return window.addEventListener("keydown",t,!0),()=>window.removeEventListener("keydown",t,!0)},[W]);async function le(){if(E(null),Z(null),se(null),!j){E("Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§");return}let t=C;if(["ÏôÑÎ£å","Ï∑®ÏÜå","ÎØ∏Î∞©Î¨∏"].includes(I)&&(!C||C.trim()==="")){const s=new Date,o=s.getTimezoneOffset();t=new Date(s.getTime()-o*6e4).toISOString().slice(0,16),z(t)}if(t&&!["ÏôÑÎ£å","Ï∑®ÏÜå","ÎØ∏Î∞©Î¨∏"].includes(I)){O({open:!0,text:"Ï¢ÖÎ£åÏùºÏãúÍ∞Ä ÏûÖÎ†•Îêú Í≤ΩÏö∞ ÏÉÅÌÉúÎäî ÏôÑÎ£å, Ï∑®ÏÜå, ÎØ∏Î∞©Î¨∏ Ï§ë ÌïòÎÇòÏó¨Ïïº Ìï©ÎãàÎã§."});return}const n=xt&&xt.trim()||P||j||"";if(!n||!B||!I){E("ÌïÑÏàò Ìï≠Î™©: ÌôúÎèôÏú†Ìòï, ÏÉÅÌÉú (Î°úÍ∑∏Ïù∏ ÌïÑÏöî)");return}U(!0);try{const s=u=>u?new Date(u).toISOString():void 0;let o=!1,a;if(l){const u=s(k),w=t?t.trim():"",r=s(w),T=w?r:"",x={subject:q||void 0,description:V||void 0,activityStatus:I||void 0,activityType:B||void 0,channel:G||void 0,isAllDay:K,isPrivate:J,visibility:Q,parentActivitySeq:yt?void 0:D?Number(D):void 0,plannedStartAt:u,actualStartAt:T},d=k?new Date(k).getTime():u?new Date(u).getTime():NaN,p=w?new Date(w).getTime():r?new Date(r).getTime():NaN;if(!isNaN(d)&&!isNaN(p)&&p<d){const N="Ï¢ÖÎ£åÏùºÏãúÎäî Í≥ÑÌöç ÏùºÏãúÎ≥¥Îã§ Ïª§Ïïº Ìï©ÎãàÎã§.";U(!1),E(N),Z(N);return}const f=await fetch(`/api/v1/sales-activities/${l}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(x)}),v=await f.json().catch(()=>({}));if(!f.ok||v.error)throw new Error(v.error||`HTTP ${f.status}`);o=!0,a=l;try{const N=new URL("/api/v1/sales-activities",window.location.origin);P&&N.searchParams.set("assigneeId",P),j&&N.searchParams.set("empId",j),N.searchParams.set("mineOnly","true"),N.searchParams.set("_t",Date.now().toString());const R=await fetch(N.toString(),{cache:"no-cache"});if(R.ok){const Wt=await R.json(),ht=Array.isArray(Wt)?Wt.find(Yt=>Yt.id===l):null;if(ht){const Ft=(Vt=>{if(!Vt)return"";const vt=new Date(Vt);if(isNaN(vt.getTime()))return"";const de=vt.getTimezoneOffset();return new Date(vt.getTime()-de*6e4).toISOString().slice(0,16)})(ht.actualStartAt||ht.actual_start_at);z(Ft),Tt(Ft)}}}catch(N){console.error("Failed to reload activity data:",N)}O({open:!0,text:"ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§."});try{window.dispatchEvent(new CustomEvent("tnt.sales.activity.updated",{detail:{id:a}}))}catch{}try{b&&b(a)}catch{}}else{const u=new Date().toISOString(),w=c&&Array.isArray(_)&&_.length>0?_:null;if(w){for(const r of w){const T=((r==null?void 0:r.customerName)||"").trim(),x=T?`${T} (ÌôúÎèôÍ≥ÑÌöç)`:q||void 0,d=r!=null&&r.customerId?String(r.customerId):(r==null?void 0:r.customerSeq)!=null?String(r.customerSeq):void 0;if(!d)continue;const p={sfOwnerId:n,subject:x,description:V||void 0,isAllDay:K,isPrivate:J,visibility:Q,channel:G,activityType:B,activityStatus:I,nextStep:Nt||void 0,nextStepDueAt:s(At),plannedStartAt:s(k),actualStartAt:s(t)||u,parentActivitySeq:D?Number(D):void 0,sfLeadId:S?String(S):void 0,sfAccountId:S?void 0:d,sfContactId:kt||void 0,sfOpportunityId:Ct||void 0,createdBy:j,updatedBy:j,createdAt:u,updatedAt:u},f=await fetch("/api/v1/sales-activities",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)}),v=await f.json().catch(()=>({}));if(!f.ok||v.error)throw new Error(v.error||`HTTP ${f.status}`);a=v.id;try{window.dispatchEvent(new CustomEvent("tnt.sales.activity.updated",{detail:{id:a}}))}catch{}}o=!0,O({open:!0,text:"Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§."});try{b&&b(a)}catch{}}else{const r=((y==null?void 0:y.name)||(m==null?void 0:m.customerName)||"").trim(),T=c&&r?`${r} (ÌôúÎèôÍ≥ÑÌöç)`:q||void 0,x=new Date().toISOString(),d=(y==null?void 0:y.id)??(m!=null&&m.customerId?String(m.customerId):void 0)??(H||void 0),p={sfOwnerId:n,subject:T,description:V||void 0,isAllDay:K,isPrivate:J,visibility:Q,channel:G,activityType:B,activityStatus:I,nextStep:Nt||void 0,nextStepDueAt:s(At),plannedStartAt:s(k),actualStartAt:s(t)||x,parentActivitySeq:D?Number(D):void 0,sfLeadId:S?String(S):void 0,sfAccountId:S?void 0:d||void 0,sfContactId:kt||void 0,sfOpportunityId:Ct||void 0,createdBy:j,updatedBy:j,createdAt:x,updatedAt:x},f=await fetch("/api/v1/sales-activities",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)}),v=await f.json().catch(()=>({}));if(!f.ok||v.error)throw new Error(v.error||`HTTP ${f.status}`);o=!0,a=v.id,O({open:!0,text:"Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§."});try{window.dispatchEvent(new CustomEvent("tnt.sales.activity.updated",{detail:{id:a}}))}catch{}try{b&&b(a)}catch{}}}ne(new Date),l||(nt(""),rt(""),Xt(""),Zt(""),Mt(!1))}catch(s){O({open:!0,text:s.message||"Ï†ÄÏû• Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§"})}finally{U(!1)}}const oe=async()=>{if(l){pt(!1),U(!0),E(null);try{const t=await fetch(`/api/v1/sales-activities/${l}`,{method:"DELETE"});if(!t.ok){const n=await t.json().catch(()=>({}));throw new Error(n.error||`HTTP ${t.status}`)}O({open:!0,text:"ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§."});try{window.dispatchEvent(new CustomEvent("tnt.sales.activity.updated",{detail:{id:l}}))}catch{}try{b&&b(void 0)}catch{}}catch(t){const n=t.message||"ÏÇ≠Ï†ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§";E(n),Z(n)}finally{U(!1)}}};return e.jsxs("section",{children:[!h&&e.jsxs("div",{className:"page-title",children:[e.jsx("h2",{children:"ÏòÅÏóÖÌôúÎèô Îì±Î°ù"}),e.jsxs("div",{className:"meta",children:[e.jsx("span",{className:"badge",children:"Draft"}),e.jsxs("span",{className:"badge",children:["Last Saved: ",e.jsx("time",{children:Lt?Lt.toLocaleString():"‚Äî"})]})]})]}),!j&&e.jsx("div",{className:"error",style:{marginBottom:8},children:"Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§"}),e.jsxs("section",{className:h?void 0:c?"card plan-compact-card":"card",children:[e.jsxs("div",{className:c?"plan-compact":"form-grid",style:c?{display:"flex",flexDirection:"column",gap:6}:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px 16px"},children:[e.jsxs("div",{className:"field",style:{display:"grid",gridTemplateColumns:c?"90px 260px":"120px 1fr",gap:c?6:8,alignItems:"center",gridColumn:"1 / -1"},children:[e.jsx("label",{children:"Ï†úÎ™©"}),e.jsx(Kt,{value:q,onChange:L?void 0:nt,placeholder:"Ïòà: Í≥†Í∞ùÏÇ¨ Ï£ºÍ∞Ñ ÎØ∏ÌåÖ",readOnly:!!L})]}),!c&&e.jsxs("div",{className:"field",style:{display:"grid",gridTemplateColumns:"120px 1fr",gap:8,alignItems:"start",gridColumn:"1 / -1"},children:[e.jsx("label",{style:{paddingTop:8},children:"ÌôúÎèô ÏÑ§Î™Ö"}),e.jsx("textarea",{value:V,onChange:t=>rt(t.target.value),placeholder:"ÌôúÎèô ÏÑ§Î™Ö ÏûÖÎ†•",rows:3})]}),e.jsxs("div",{className:"field",style:{display:"grid",gridTemplateColumns:c?"90px 260px":"120px 1fr",gap:c?6:8,alignItems:"center"},children:[e.jsx("label",{children:"ÌôúÎèôÏú†Ìòï *"}),e.jsx("select",{value:B,onChange:t=>{const n=t.target.value;jt(n);const s={Ï†ïÍ∏∞Î∞©Î¨∏:"Î∞©Î¨∏",ÏòÅÏóÖÍ∏∞Ìöå:"Î∞©Î¨∏",Ï±ÑÍ∂åÍ¥ÄÎ¶¨:"Ï†ÑÌôî"};s[n]&&it(s[n])},children:me.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{className:"field",style:{display:"grid",gridTemplateColumns:c?"90px 260px":"120px 1fr",gap:c?6:8,alignItems:"center"},children:[e.jsx("label",{children:"ÌôúÎèôÎ∞©Î≤ï"}),e.jsx("select",{value:G,onChange:t=>it(t.target.value),children:fe.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{className:"field",style:{display:"grid",gridTemplateColumns:c?"90px 260px":"120px 1fr",gap:c?6:8,alignItems:"center"},children:[e.jsx("label",{children:"ÏÉÅÌÉú *"}),e.jsx("select",{value:I,onChange:t=>wt(t.target.value),disabled:!!c,children:pe.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),!c&&e.jsxs("div",{className:"field",style:{display:"grid",gridTemplateColumns:"120px 1fr",gap:8,alignItems:"center"},children:[e.jsx("label",{children:"ÏÉÅÏúÑ ÌôúÎèô"}),e.jsxs("select",{value:D,onChange:t=>Dt(t.target.value),onFocus:()=>{try{et()}catch{}},onClick:()=>{try{et()}catch{}},disabled:yt,title:yt?"ÌïòÏúÑÌôúÎèôÏù¥ Ï°¥Ïû¨ÌïòÏó¨ ÏÉÅÏúÑÌôúÎèôÏùÑ Î≥ÄÍ≤ΩÌï† Ïàò ÏóÜÏäµÎãàÎã§":void 0,children:[e.jsx("option",{value:"",children:"ÏÑ†ÌÉù"}),ee.map(t=>{const n={site_visit:"Ï†ïÍ∏∞Î∞©Î¨∏",opportunity:"ÏòÅÏóÖÍ∏∞Ìöå",AR_mgmt:"Ï±ÑÍ∂åÍ¥ÄÎ¶¨",meeting:"ÎØ∏ÌåÖ",call:"Ï†ÑÌôî",email:"Ïù¥Î©îÏùº",demo:"Îç∞Î™®",task:"ÏóÖÎ¨¥",other:"Í∏∞ÌÉÄ"},s={scheduled:"Í≥ÑÌöç",completed:"ÏôÑÎ£å",canceled:"Ï∑®ÏÜå",postponed:"Ïó∞Í∏∞",no_show:"ÎØ∏Î∞©Î¨∏"},o=t.activityType?n[t.activityType]||t.activityType:"",a=t.activityStatus?s[t.activityStatus]||t.activityStatus:"",u=`${t.subject||""}${o||a?` ¬∑ ${o}${o&&a?" / ":""}${a}`:""}`;return e.jsx("option",{value:t.id,children:u},t.id)})]})]}),e.jsxs("div",{className:"field",style:{display:"grid",gridTemplateColumns:c?"90px 260px":"120px 1fr",gap:c?6:8,alignItems:"center"},children:[e.jsx("label",{children:"Í≥ÑÌöç ÏùºÏãú"}),e.jsxs("div",{className:"datetime-wrapper",children:[e.jsx("input",{type:"datetime-local",className:k?"":"empty",value:k,onChange:t=>X(t.target.value),autoComplete:"off",disabled:!!c,title:c?"Îã¨Î†•ÏóêÏÑú ÏÑ†ÌÉùÎêú ÏùºÏãúÎ°ú ÏÑ§Ï†ïÎê©ÎãàÎã§":void 0}),!k&&e.jsx("span",{className:"datetime-placeholder",children:"YYYY-MM-DD HH:MM"})]})]}),!c&&e.jsxs("div",{className:"field",style:{display:"grid",gridTemplateColumns:"120px 1fr",gap:8,alignItems:"center"},children:[e.jsx("label",{children:"Ï¢ÖÎ£å ÏùºÏãú"}),e.jsxs("div",{className:"datetime-wrapper",children:[e.jsx("input",{type:"datetime-local",className:C?"":"empty",value:C,onChange:t=>z(t.target.value),autoComplete:"off"}),!C&&e.jsx("span",{className:"datetime-placeholder",children:"YYYY-MM-DD HH:MM"})]})]}),te,!c&&!S&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"field",style:{display:"grid",gridTemplateColumns:"120px 1fr",gap:8,alignItems:"center",gridColumn:"1 / -1"},children:[e.jsx("label",{children:"Í±∞ÎûòÏ≤ò"}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx(Kt,{value:y?y.name||y.id||"":m?m.customerName||String(m.customerId||""):H||"",onChange:y||m?void 0:lt,placeholder:"Í±∞ÎûòÏ≤òÎ™Ö ÎòêÎäî ID",readOnly:!!y||!!m||!!l,style:{flex:"1 1 auto"}}),!l&&e.jsx("button",{className:"btn secondary",style:{height:30,padding:"0 10px"},onClick:()=>{Y(!0)},title:"Í±∞ÎûòÏ≤ò Í≤ÄÏÉâ",children:"üîç"})]})]})}),!c&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"field",style:{display:"grid",gridTemplateColumns:"120px 1fr",gap:8,alignItems:"center"},children:[e.jsx("label",{children:"Ï¢ÖÏùº / ÎπÑÍ≥µÍ∞ú"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:16},children:[e.jsxs("label",{className:"muted",style:{display:"inline-flex",alignItems:"center",gap:8},children:[e.jsx("input",{className:"checkbox-accent",type:"checkbox",checked:K,onChange:t=>Qt(t.target.checked)}),e.jsx("span",{children:"Ï¢ÖÏùº"})]}),e.jsxs("label",{className:"muted",style:{display:"inline-flex",alignItems:"center",gap:8},children:[e.jsx("input",{className:"checkbox-accent",type:"checkbox",checked:J,onChange:t=>Gt(t.target.checked)}),e.jsx("span",{children:"ÎπÑÍ≥µÍ∞ú"})]})]})]}),e.jsxs("div",{className:"field",style:{display:"grid",gridTemplateColumns:"120px 1fr",gap:8,alignItems:"center"},children:[e.jsx("label",{children:"Í∞ÄÏãúÏÑ±"}),e.jsx("select",{value:Q,onChange:t=>bt(t.target.value),children:ge.map(t=>e.jsx("option",{value:t,children:t},t))})]})]})]}),Et&&e.jsx("div",{className:"error",style:{marginBottom:8},children:Et}),e.jsxs("div",{className:"controls",style:{display:"flex",gap:8},children:[e.jsx("button",{className:"btn",onClick:le,disabled:mt||!j,children:mt?l?"ÏàòÏ†ï Ï§ë‚Ä¶":"Ï†ÄÏû• Ï§ë‚Ä¶":l?"ÏàòÏ†ï":"Ï†ÄÏû•"}),l&&e.jsx("button",{className:"btn",onClick:()=>pt(!0),disabled:mt,style:{background:"#dc2626",borderColor:"#dc2626"},children:"ÏÇ≠Ï†ú"})]})]}),Ot.open?e.jsx("div",{role:"dialog","aria-modal":"true",className:"card",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.45)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:70},children:e.jsxs("div",{className:"card",style:{background:"var(--panel)",padding:12,border:"1px solid var(--border)",borderRadius:10,minWidth:260,maxWidth:"86vw"},children:[e.jsx("div",{style:{marginBottom:8,fontWeight:700,textAlign:"center"},children:Ot.text}),e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx("button",{className:"btn btn-card btn-3d",onClick:()=>{O({open:!1,text:""});try{$&&$()}catch{}},children:"ÌôïÏù∏"})})]})}):null,Pt?e.jsx("div",{role:"dialog","aria-modal":"true",className:"card",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.3)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:70},children:e.jsxs("div",{className:"card",style:{background:"var(--panel)",padding:12,border:"1px solid var(--border)",borderRadius:10,minWidth:260,maxWidth:"86vw"},children:[e.jsx("div",{style:{marginBottom:8,fontWeight:700,textAlign:"center",color:"#b91c1c"},children:Pt}),e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx("button",{className:"btn btn-card btn-3d",onClick:()=>{Z(null),E(null)},children:"ÌôïÏù∏"})})]})}):null,ae?e.jsx("div",{role:"dialog","aria-modal":"true",className:"card",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.45)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:70},children:e.jsxs("div",{className:"card",style:{background:"var(--panel)",padding:12,border:"1px solid var(--border)",borderRadius:10,minWidth:260,maxWidth:"86vw"},children:[e.jsx("div",{style:{marginBottom:8,fontWeight:700,textAlign:"center"},children:"Ïù¥ ÌôúÎèôÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?"}),e.jsx("div",{style:{marginBottom:12,fontSize:13,textAlign:"center",color:"#6b7280"},children:"ÏÇ≠Ï†úÎêú Îç∞Ïù¥ÌÑ∞Îäî Î≥µÍµ¨Ìï† Ïàò ÏóÜÏäµÎãàÎã§."}),e.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:8},children:[e.jsx("button",{className:"btn btn-card btn-3d",onClick:()=>pt(!1),style:{background:"#6b7280",borderColor:"#6b7280"},children:"Ï∑®ÏÜå"}),e.jsx("button",{className:"btn btn-card btn-3d",onClick:oe,style:{background:"#dc2626",borderColor:"#dc2626"},children:"ÏÇ≠Ï†ú"})]})]})}):null,W&&!l?e.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.45)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:80},onClick:()=>Y(!1),children:e.jsxs("div",{className:"card",style:{background:"var(--panel)",padding:16,border:"1px solid var(--border)",borderRadius:12,boxShadow:"0 8px 32px rgba(0,0,0,.2)",width:"min(720px, 92vw)",maxHeight:"80vh",overflow:"auto"},onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:12},children:[e.jsx("h3",{style:{margin:0,fontSize:16,fontWeight:700},children:"Í±∞ÎûòÏ≤ò ÏÑ†ÌÉù"}),e.jsx("button",{onClick:()=>Y(!1),style:{width:32,height:32,display:"flex",alignItems:"center",justifyContent:"center",background:"transparent",border:"none",borderRadius:4,cursor:"pointer",color:"var(--muted)",fontSize:20,transition:"all 0.2s"},onMouseEnter:t=>{t.currentTarget.style.background="var(--panel-2)",t.currentTarget.style.color="var(--text)"},onMouseLeave:t=>{t.currentTarget.style.background="transparent",t.currentTarget.style.color="var(--muted)"},title:"Îã´Í∏∞ (ESC)","aria-label":"Îã´Í∏∞",children:"√ó"})]}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:8},children:[e.jsx("input",{className:"search-input",value:M,onChange:t=>re(t.target.value),onKeyDown:t=>{t.key==="Enter"&&at()},placeholder:"Í±∞ÎûòÏ≤òÎ™Ö",style:{flex:"1 1 auto",background:"#fff",border:"1px solid var(--border)"}}),e.jsx("button",{className:"btn",style:{height:30,padding:"0 12px"},onClick:at,disabled:ft,children:ft?"Ï°∞ÌöåÏ§ë...":"Ï°∞Ìöå"})]}),Rt&&e.jsx("div",{className:"error",style:{marginBottom:8},children:Rt}),e.jsx("div",{className:"table-container",style:{maxHeight:"50vh"},children:qt.length===0&&!ft?e.jsx("div",{className:"empty-state",children:"Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§."}):e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:60,textAlign:"center"},children:"Íµ¨Î∂Ñ"}),e.jsx("th",{children:"Í±∞ÎûòÏ≤òÎ™Ö"}),e.jsx("th",{style:{width:140},children:"ÎåÄÌëúÏûêÎ™Ö"}),e.jsx("th",{style:{width:60,textAlign:"center"}})]})}),e.jsx("tbody",{children:qt.map((t,n)=>{const s=(t.companyType||"").toString().trim().toUpperCase(),o=s.includes("TNT"),a=s.includes("DYS"),u=o?"T":a?"D":(t.companyType||"Í±∞")[0],w=o?"#1d4ed8":a?"#059669":"#6b7280";return e.jsxs("tr",{children:[e.jsx("td",{style:{textAlign:"center"},children:e.jsx("span",{title:t.companyType||"",style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:24,height:24,borderRadius:"50%",background:w,color:"#fff",fontSize:12,fontWeight:700},children:u})}),e.jsx("td",{children:t.customerName||""}),e.jsx("td",{children:t.ownerName||""}),e.jsx("td",{style:{textAlign:"center"},children:e.jsx("button",{style:{width:32,height:32,display:"inline-flex",alignItems:"center",justifyContent:"center",background:"transparent",border:"1px solid var(--border)",borderRadius:6,cursor:"pointer",color:"var(--text)",transition:"all 0.2s"},onMouseEnter:r=>{r.currentTarget.style.background="var(--accent)",r.currentTarget.style.borderColor="var(--accent)",r.currentTarget.style.color="#fff"},onMouseLeave:r=>{r.currentTarget.style.background="transparent",r.currentTarget.style.borderColor="var(--border)",r.currentTarget.style.color="var(--text)"},onClick:()=>{const r=t.customerId?String(t.customerId):"";ot({id:r,name:t.customerName||""}),St({customerId:r,customerName:t.customerName}),lt(r),Y(!1)},title:"ÏÑ†ÌÉù","aria-label":"ÏÑ†ÌÉù",children:e.jsx(ue,{size:18})})})]},n)})})]})})]})}):null]})}function ye(h){return new Date(h.getFullYear(),h.getMonth(),h.getDate())}function ke(h=0,g){const b=ye(new Date),L=(b.getDay()-1+7)%7,c=new Date(b);c.setDate(b.getDate()-L+h*7);const _=new Date(c);return _.setDate(c.getDate()+6),{start:c,end:_}}function Jt(h){const g=h.getFullYear(),l=String(h.getMonth()+1).padStart(2,"0"),S=String(h.getDate()).padStart(2,"0");return`${g}-${l}-${S}`}function Ce(h){return`${Jt(h.start)} ~ ${Jt(h.end)}`}export{Kt as S,Ie as a,Ce as f,ke as g};
