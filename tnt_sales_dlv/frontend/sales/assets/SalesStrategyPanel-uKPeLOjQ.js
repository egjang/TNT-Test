import{r,j as e,f as O}from"./index-C5CiSje-.js";import{u as P}from"./useDraggableModal-B1Qj3P7J.js";import{c as R}from"./close-CV7tuFPj.js";function L(){const[i,k]=r.useState(new Date().getFullYear()),E=r.useMemo(()=>{const t=[];for(let l=2030;l>=2025;l--)t.push(l);return t},[]),[S,y]=r.useState([]),[d,o]=r.useState(!1),[h,c]=r.useState(""),[u,m]=r.useState(""),[f,p]=r.useState(""),[N,w]=r.useState(!1),[x,j]=r.useState(null),[n,v]=r.useState(null),b=P("sales-strategy-new",d,void 0,{persist:!1,resetOnOpen:!0});r.useEffect(()=>{if(!d)return;const t=l=>{l.key==="Escape"&&o(!1)};return window.addEventListener("keydown",t,!0),()=>window.removeEventListener("keydown",t,!0)},[d]),r.useEffect(()=>{(async()=>{try{const t=new URL("/api/v1/strategy",window.location.origin);t.searchParams.set("year",String(i));const l=await fetch(t.toString());if(!l.ok)throw new Error(`HTTP ${l.status}`);const g=await l.json(),T=Array.isArray(g)?g.map(s=>({id:String((s==null?void 0:s.id)??""),strategyType:String((s==null?void 0:s.strategy_type)??(s==null?void 0:s.strategyType)??""),title:String((s==null?void 0:s.title)??""),summary:String((s==null?void 0:s.summary)??""),fileUrl:String((s==null?void 0:s.file_url)??(s==null?void 0:s.fileUrl)??"")||void 0})):[];y(T)}catch{y([])}})()},[i]);async function z(t){t.preventDefault();try{w(!0),j(null);const l={year:i,strategyType:h,title:u,summary:f,fileUrl:`https://example.invalid/sharepoint/test/${i}/${encodeURIComponent(u||"strategy")}.pdf`},g=n?`/api/v1/strategy/${encodeURIComponent(n)}`:"/api/v1/strategy",s=await fetch(g,{method:n?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!s.ok)throw new Error(`HTTP ${s.status}`);const a=await s.json(),C={id:String((a==null?void 0:a.id)||n||Date.now()),strategyType:String((a==null?void 0:a.strategy_type)??(a==null?void 0:a.strategyType)??h),title:String((a==null?void 0:a.title)??u),summary:String((a==null?void 0:a.summary)??f),fileUrl:String((a==null?void 0:a.file_url)??(a==null?void 0:a.fileUrl)??l.fileUrl)};y(I=>n?I.map(U=>U.id===n?C:U):[C,...I]),o(!1),c(""),m(""),p(""),v(null)}catch(l){j((l==null?void 0:l.message)||"저장 실패")}finally{w(!1)}}return e.jsxs("section",{style:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:8},children:[e.jsx("strong",{children:"영업전략"}),e.jsxs("div",{style:{marginLeft:"auto",display:"inline-flex",alignItems:"center",gap:8},children:[e.jsx("span",{className:"muted",children:"연도"}),e.jsx("select",{className:"search-input",value:i,onChange:t=>k(Number(t.target.value)),"aria-label":"연도",style:{height:28},children:E.map(t=>e.jsxs("option",{value:String(t),children:[t,"년"]},t))}),e.jsx("button",{className:"btn btn-card btn-3d",onClick:()=>{v(null),c(""),m(""),p(""),j(null),o(!0)},children:"새 전략"})]})]}),e.jsx("div",{style:{flex:1,minHeight:0,overflow:"auto",padding:8},children:S.length===0?e.jsx("div",{className:"muted",style:{padding:8},children:"등록된 전략이 없습니다. “새 전략”을 눌러 추가하세요."}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(1, minmax(0, 1fr))",gap:8},children:S.map(t=>e.jsxs("article",{className:"card",style:{padding:10,border:"1px solid var(--border)",borderRadius:10,fontSize:12},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{className:"badge","aria-label":"전략유형",title:"전략유형",style:{fontSize:10},children:t.strategyType||"유형"}),e.jsx("div",{style:{fontWeight:700,fontSize:12,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.title||"(제목)"}),e.jsxs("div",{style:{marginLeft:"auto",display:"inline-flex",alignItems:"center",gap:8},children:[t.fileUrl?e.jsx("a",{href:t.fileUrl,target:"_blank",rel:"noreferrer",className:"btn-plain",title:"열기","aria-label":"열기",children:e.jsx("img",{src:O,className:"icon",alt:"열기"})}):e.jsx("span",{className:"muted",children:"링크없음"}),e.jsx("button",{className:"btn btn-card btn-3d",style:{fontSize:12,padding:"4px 8px"},onClick:()=>{v(t.id),c(t.strategyType),m(t.title),p(t.summary||""),o(!0)},children:"수정"})]})]}),e.jsx("div",{className:"muted",style:{marginTop:6,fontSize:11},children:t.summary||""})]},t.id))})}),d&&e.jsx("div",{role:"dialog","aria-modal":"true",className:"card",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.35)",zIndex:60},children:e.jsxs("div",{ref:b.ref,className:"card",style:{...b.style,width:624,maxWidth:"92vw",background:"var(--panel)",padding:12,fontSize:12},children:[e.jsx("div",{...b.bindHeader,style:{position:"absolute",top:0,left:0,right:36,height:32,cursor:"move"},"aria-hidden":"true"}),e.jsx("button",{"aria-label":"닫기",title:"닫기",onClick:()=>o(!1),className:"btn-plain",style:{position:"absolute",top:8,right:8},children:e.jsx("img",{src:R,className:"icon",alt:"닫기"})}),e.jsx("div",{className:"page-title",style:{marginBottom:8},children:e.jsx("h2",{style:{margin:0},children:n?"영업전략 수정":"새 영업전략"})}),e.jsxs("form",{onSubmit:z,children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"120px 1fr",gap:8,alignItems:"center"},children:[e.jsx("label",{className:"muted",children:"연도"}),e.jsx("input",{className:"search-input",value:`${i}`,readOnly:!0}),e.jsx("label",{className:"muted",children:"전략유형"}),e.jsxs("select",{className:"search-input",value:h,onChange:t=>c(t.target.value),required:!0,"aria-label":"전략유형",children:[e.jsx("option",{value:"",disabled:!0,children:"선택"}),e.jsx("option",{value:"제품전략",children:"제품전략"}),e.jsx("option",{value:"고객전략",children:"고객전략"}),e.jsx("option",{value:"경쟁전략",children:"경쟁전략"}),e.jsx("option",{value:"신사업",children:"신사업"}),e.jsx("option",{value:"채널전략",children:"채널전략"})]}),e.jsx("label",{className:"muted",children:"제목"}),e.jsx("input",{className:"search-input",placeholder:"전략 제목",value:u,onChange:t=>m(t.target.value),required:!0}),e.jsx("label",{className:"muted",children:"내용요약"}),e.jsx("textarea",{className:"search-input",placeholder:"간단한 요약",rows:12,style:{minHeight:180},value:f,onChange:t=>p(t.target.value)}),e.jsx("label",{className:"muted",children:"파일"}),e.jsx("input",{type:"file"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:12},children:[x?e.jsx("span",{className:"error",style:{marginRight:"auto"},children:x}):null,e.jsx("button",{type:"submit",className:"btn btn-card btn-3d",disabled:N,children:N?"저장중…":"저장"})]})]})]})})]})}export{L as SalesStrategyPanel};
