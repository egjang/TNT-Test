import{r as n,j as t}from"./index-BmcpNj69.js";const $="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%20width='16'%20height='16'%20fill='currentColor'%20aria-hidden='true'%3e%3cpath%20d='M6.62%2010.79a15.053%2015.053%200%20006.59%206.59l2.2-2.2a1%201%200%20011.01-.24c1.11.37%202.31.57%203.58.57a1%201%200%20011%201v3.49a1%201%200%2001-1%201C10.2%2022.01%202%2013.81%202%203.99a1%201%200%20011-1H6.5a1%201%200%20011%201c0%201.27.2%202.47.57%203.58a1%201%200%2001-.24%201.01l-2.2%202.2z'/%3e%3c/svg%3e";function U(){const[c,j]=n.useState(()=>{try{return localStorage.getItem("tnt.sales.assigneeId")||""||""}catch{return""}}),[x,H]=n.useState([]),[g,R]=n.useState(!1),[b,N]=n.useState(!1),[u,S]=n.useState(""),[h,k]=n.useState(""),[m,C]=n.useState(""),[p,E]=n.useState(""),[f,v]=n.useState([]),[I,L]=n.useState(!1),[z,T]=n.useState(null),[s,_]=n.useState({open:!1,x:0,y:0}),[O,A]=n.useState(null),[K,M]=n.useState("mouse");n.useEffect(()=>{const a=()=>M("mouse"),i=r=>{(r.key==="Tab"||r.key==="Shift"||r.key==="ArrowDown"||r.key==="ArrowUp")&&M("keyboard")};return window.addEventListener("mousedown",a,!0),window.addEventListener("keydown",i,!0),()=>{window.removeEventListener("mousedown",a,!0),window.removeEventListener("keydown",i,!0)}},[]);async function y(){L(!0),T(null);try{const a=new URLSearchParams;u.trim()&&a.set("company_name",u.trim()),h.trim()&&a.set("contact_name",h.trim()),m.trim()&&a.set("lead_status",m.trim()),p.trim()&&a.set("region",p.trim()),c&&c.trim()&&a.set("assignee_id",c.trim()),b&&a.set("lead_status","영업 접촉 중"),g&&a.set("has_sales_activity","true");const i=await fetch(`/api/v1/leads?${a.toString()}`);if(!i.ok)throw new Error(`HTTP ${i.status}`);const r=await i.json();if(Array.isArray(r)){let d=r.map(e=>({id:Number(e==null?void 0:e.id),lead_status:String((e==null?void 0:e.lead_status)??""),lead_source:(e==null?void 0:e.lead_source)??null,contact_name:(e==null?void 0:e.contact_name)??null,email:(e==null?void 0:e.email)??null,company_name:(e==null?void 0:e.company_name)??null,biz_type:(e==null?void 0:e.biz_type)??null,office_phone:(e==null?void 0:e.office_phone)??null,biz_no:(e==null?void 0:e.biz_no)??null,addr_province_name:(e==null?void 0:e.addr_province_name)??null,address:(e==null?void 0:e.address)??null,fax_no:(e==null?void 0:e.fax_no)??null,contact_phone:(e==null?void 0:e.contact_phone)??null,note:(e==null?void 0:e.note)??null,last_activity_at:(e==null?void 0:e.last_activity_at)??null,has_activity:(e==null?void 0:e.has_activity)===!0,owner_id:(e==null?void 0:e.owner_id)!=null?Number(e.owner_id):null,owner_name:(e==null?void 0:e.owner_name)??null,created_by:(e==null?void 0:e.created_by)??null,created_at:e!=null&&e.created_at?String(e.created_at):null,updated_by:(e==null?void 0:e.updated_by)??null,updated_at:e!=null&&e.updated_at?String(e.updated_at):null,created_by_name:(e==null?void 0:e.created_by_name)??null,updated_by_name:(e==null?void 0:e.updated_by_name)??null}));g&&(d=d.filter(e=>!!(e.has_activity===!0||e.last_activity_at))),d.sort((e,l)=>{const o=e.updated_at?new Date(e.updated_at).getTime():0;return(l.updated_at?new Date(l.updated_at).getTime():0)-o}),v(d),A(e=>d.some(l=>l.id===e)?e:null)}else v([])}catch(a){T((a==null?void 0:a.message)||"조회 중 오류가 발생했습니다"),v([])}finally{L(!1)}}n.useEffect(()=>{y()},[]),n.useEffect(()=>{try{localStorage.removeItem("tnt.sales.selectedLead")}catch{}},[]),n.useEffect(()=>{(async()=>{try{const a=await fetch("/api/v1/employees");if(!a.ok)return;const i=await a.json();if(Array.isArray(i)){let r=[...i];if(!r.some(e=>String((e==null?void 0:e.emp_name)||"")==="윤이랑"))try{const e=await fetch("/api/v1/employees?depts=all");if(e.ok){const l=await e.json();if(Array.isArray(l)){const o=l.find(w=>String((w==null?void 0:w.emp_name)||"")==="윤이랑");o&&(r=[...r,o])}}}catch{}if(H(r),!c)try{const e=localStorage.getItem("tnt.sales.assigneeId")||"";e&&i.some(l=>String(l==null?void 0:l.assignee_id)===String(e))&&j(e)}catch{}}}catch{}})()},[]),n.useEffect(()=>{function a(){y()}return window.addEventListener("tnt.sales.lead.updated",a),()=>window.removeEventListener("tnt.sales.lead.updated",a)},[u,h,m,p,c]);function B(a){A(a.id);try{localStorage.setItem("tnt.sales.selectedLead",JSON.stringify(a)),window.dispatchEvent(new CustomEvent("tnt.sales.lead.selected",{detail:{lead:a}}))}catch{}}function D(a){if(!a)return"";const i=new Date(a);return isNaN(i.getTime())?String(a):new Intl.DateTimeFormat("ko-KR",{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}).format(i)}const Y=n.useMemo(()=>t.jsxs("div",{className:"table-container",style:{height:"calc(100% - 120px)",minHeight:160,overflow:"auto"},children:[f.length===0?t.jsx("div",{className:"empty-state",children:I?"불러오는 중…":z||"결과가 없습니다"}):t.jsxs("table",{className:"table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{style:{width:120},children:"상태"}),t.jsx("th",{style:{width:60},children:"활동"}),t.jsx("th",{style:{width:200},children:"회사"}),t.jsx("th",{style:{width:120},children:"지역"}),t.jsx("th",{style:{width:140},children:"업종"}),t.jsx("th",{style:{width:140},children:"소유자"}),t.jsx("th",{style:{width:160},children:"거래처담당자"}),t.jsx("th",{style:{width:140},children:"소스"})]})}),t.jsx("tbody",{children:f.map(a=>{const i=!!a.owner_name||a.owner_id!=null,d=String(a.lead_status||"").replace(/\s+/g,""),e=i&&(d==="신규등록"||d==="접촉중");return t.jsxs("tr",{tabIndex:0,className:O===a.id?"selected":void 0,onClick:()=>{B(a),_({open:!1,x:0,y:0})},onMouseEnter:l=>_({open:!0,x:l.clientX+8,y:l.clientY+8,row:a}),onMouseMove:l=>_(o=>({...o,x:l.clientX+8,y:l.clientY+8})),onMouseLeave:()=>_({open:!1,x:0,y:0}),style:e?{color:"#ef4444"}:void 0,children:[t.jsx("td",{children:a.lead_status}),t.jsx("td",{children:a.has_activity===!0||a.last_activity_at?t.jsx("img",{className:"icon",src:$,alt:"활동",title:"최근 활동 있음"}):""}),t.jsx("td",{children:a.company_name||""}),t.jsx("td",{children:a.addr_province_name||""}),t.jsx("td",{children:a.biz_type||""}),t.jsx("td",{children:a.owner_name||(a.owner_id??"")}),t.jsx("td",{children:a.contact_name||""}),t.jsx("td",{children:a.lead_source||""})]},a.id)})})]}),s.open&&s.row&&t.jsxs("div",{role:"dialog","aria-label":"리드 상세",style:{position:"fixed",left:Math.min(s.x,window.innerWidth-380),top:Math.min(s.y,window.innerHeight-260),zIndex:9999,maxWidth:360,background:"var(--panel)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:10,boxShadow:"0 12px 28px rgba(0,0,0,.25)",padding:10,fontSize:12,lineHeight:1.4,pointerEvents:"none"},children:[t.jsx("div",{style:{fontWeight:700,marginBottom:6},children:s.row.company_name||"(잠재고객)"}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"120px 1fr",columnGap:8,rowGap:4},children:[t.jsx("span",{className:"muted",children:"상태"}),t.jsx("span",{children:s.row.lead_status||""}),t.jsx("span",{className:"muted",children:"소스"}),t.jsx("span",{children:s.row.lead_source||""}),t.jsx("span",{className:"muted",children:"거래처 담당자"}),t.jsx("span",{children:s.row.contact_name||""}),t.jsx("span",{className:"muted",children:"연락처"}),t.jsx("span",{children:s.row.contact_phone||""}),t.jsx("span",{className:"muted",children:"업종"}),t.jsx("span",{children:s.row.biz_type||""}),t.jsx("span",{className:"muted",children:"지역"}),t.jsx("span",{children:s.row.addr_province_name||""}),t.jsx("span",{className:"muted",children:"이메일"}),t.jsx("span",{children:s.row.email||""}),t.jsx("span",{className:"muted",children:"대표번호"}),t.jsx("span",{children:s.row.office_phone||""}),t.jsx("span",{className:"muted",children:"사업자번호"}),t.jsx("span",{children:s.row.biz_no||""}),t.jsx("span",{className:"muted",children:"주소"}),t.jsx("span",{children:s.row.address||""}),t.jsx("span",{className:"muted",children:"비고"}),t.jsx("span",{children:s.row.note||""}),t.jsx("span",{className:"muted",children:"최근활동"}),t.jsx("span",{children:s.row.last_activity_at||""}),t.jsx("span",{className:"muted",children:"소유자"}),t.jsx("span",{children:s.row.owner_name||(s.row.owner_id??"")}),t.jsx("span",{className:"muted",children:"ID"}),t.jsx("span",{children:s.row.id}),t.jsx("span",{className:"muted",children:"작성자"}),t.jsxs("span",{children:[s.row.created_by_name||(s.row.created_by??""),s.row.created_at?`, ${D(s.row.created_at)}`:""]}),t.jsx("span",{className:"muted",children:"최종 수정자"}),t.jsxs("span",{children:[s.row.updated_by_name||(s.row.updated_by??""),s.row.updated_at?`, ${D(s.row.updated_at)}`:""]})]})]})]}),[f,I,z,s]);return t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8,height:"100%",fontSize:12},children:[t.jsxs("div",{className:"card",style:{padding:10},children:[t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8,alignItems:"end",marginBottom:8},children:[t.jsxs("div",{className:"field",style:{margin:0},children:[t.jsx("label",{children:"소유자명"}),t.jsxs("select",{className:"search-input",value:c,onChange:a=>j(a.target.value),children:[t.jsx("option",{value:"",children:"(전체)"}),x.map(a=>t.jsxs("option",{value:a.assignee_id,children:[a.dept_name," · ",a.emp_name]},a.assignee_id))]})]}),t.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:6,margin:0},children:[t.jsx("input",{type:"checkbox",checked:g,onChange:a=>R(a.target.checked)})," 통화여부"]}),t.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:6,margin:0},children:[t.jsx("input",{type:"checkbox",checked:b,onChange:a=>N(a.target.checked)})," 소유자확인"]})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[t.jsx("div",{className:"field",children:t.jsx("input",{type:"text",className:"search-input",value:u,onChange:a=>S(a.target.value),placeholder:"잠재고객명"})}),t.jsx("div",{className:"field",children:t.jsx("input",{type:"text",className:"search-input",value:h,onChange:a=>k(a.target.value),placeholder:"거래처 담당자"})}),t.jsx("div",{className:"field",children:t.jsxs("select",{className:"search-input",value:m,onChange:a=>C(a.target.value),children:[t.jsx("option",{value:"",children:"상태"}),t.jsx("option",{value:"신규등록",children:"신규등록"}),t.jsx("option",{value:"자격미달",children:"자격미달"}),t.jsx("option",{value:"접촉 중",children:"접촉 중"}),t.jsx("option",{value:"영업 접촉 중",children:"영업 접촉 중"}),t.jsx("option",{value:"전환성공",children:"전환성공"}),t.jsx("option",{value:"전환실패",children:"전환실패"})]})}),t.jsx("div",{className:"field",children:t.jsx("input",{type:"text",className:"search-input",value:p,onChange:a=>E(a.target.value),placeholder:"지역"})})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:8},children:[t.jsx("button",{className:"btn",onClick:y,children:"조회"}),t.jsx("button",{className:"btn",onClick:()=>{j(""),N(!1),S(""),k(""),C(""),E(""),y()},children:"초기화"})]})]}),t.jsx("div",{style:{flex:1,minHeight:0},children:Y})]})}export{U as LeadRightPanel};
