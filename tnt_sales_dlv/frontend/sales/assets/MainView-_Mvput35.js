import{r as t,j as e,_ as nn,R as Ne,m as Bn,d as Hn,a as Un,g as an,b as Bs,o as Yn,i as Hs,s as Kn,c as jn,e as vn,w as rn,t as Jn}from"./index-C5CiSje-.js";import{DemandList as Qn}from"./DemandList-LzSqhB-6.js";import{c as ct}from"./close-CV7tuFPj.js";import{t as Ze}from"./tone-B1QjB-CC.js";import{u as At}from"./useDraggableModal-B1Qj3P7J.js";import{S as gt,a as Ss,g as ln,f as Xn}from"./week-DsVo_lhH.js";const wt={demandManagement:!0,customerManagement:!0};function Gn(){const s=t.useRef(null),[o,d]=t.useState(null),[D,H]=t.useState([]),[U,q]=t.useState(null),[Q,W]=t.useState([]),[se,ee]=t.useState([]),[S,g]=t.useState(null),[M,Y]=t.useState(!1),[v,c]=t.useState(null),[f,a]=t.useState(0),[C,w]=t.useState(""),b=()=>{var de;return(de=s.current)==null?void 0:de.click()},p=async de=>{var u;g(null);const r=(u=de.target.files)==null?void 0:u[0];if(d(r?r.name:null),W([]),H([]),q(null),!!r)try{const $=await nn(()=>import("./xlsx-D_0l8YDs.js"),[]),N=await r.arrayBuffer(),m=$.read(N,{type:"array"}),P=m.SheetNames||[];H(P);const te=P[0];if(q(te||null),te){const K=m.Sheets[te],j=$.utils.sheet_to_json(K,{header:1});ee(j),W(j)}}catch($){g("엑셀 파일을 읽는 중 오류가 발생했습니다. 파일 형식을 확인해 주세요."),console.error($)}},L=Q&&Q.length>0,X=t.useMemo(()=>{if(!L)return null;const de=Q.reduce((r,u)=>Math.max(r,Array.isArray(u)?u.length:0),0);return e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsx("tr",{children:Array.from({length:de}).map((r,u)=>e.jsxs("th",{children:["C",u+1]},u))})}),e.jsx("tbody",{children:Q.map((r,u)=>e.jsx("tr",{children:Array.from({length:de}).map(($,N)=>e.jsx("td",{children:Array.isArray(r)&&r[N]!=null?String(r[N]):""},N))},u))})]})})},[Q,L]),ue=async de=>{var $,N;const r=de.target.value;q(r);const u=(N=($=s.current)==null?void 0:$.files)==null?void 0:N[0];if(u)try{const m=await nn(()=>import("./xlsx-D_0l8YDs.js"),[]),P=await u.arrayBuffer(),K=m.read(P,{type:"array"}).Sheets[r],j=m.utils.sheet_to_json(K,{header:1});ee(j),W(j)}catch(m){g("시트를 전환하는 중 오류가 발생했습니다."),console.error(m)}};return e.jsxs("section",{children:[e.jsxs("div",{className:"page-title",style:{alignItems:"center"},children:[e.jsx("h2",{style:{margin:0,fontSize:18},children:"Excel Upload"}),e.jsx("div",{className:"muted count-text"})]}),e.jsx("p",{children:"로컬 PC에서 엑셀 파일(.xlsx, .xls)만 선택할 수 있습니다."}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[e.jsx("input",{ref:s,type:"file",accept:".xlsx,.xls,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel",onChange:p,style:{display:"none"}}),e.jsx("button",{className:"btn",onClick:b,children:"엑셀 파일 선택"}),o&&e.jsxs("span",{className:"muted",children:["선택됨: ",o]})]}),D.length>1&&e.jsx("div",{style:{marginTop:10},children:e.jsxs("label",{children:["시트 선택: ",e.jsx("select",{value:U??"",onChange:ue,children:D.map(de=>e.jsx("option",{value:de,children:de},de))})]})}),S&&e.jsx("div",{className:"error",children:S}),X,L&&e.jsxs("div",{style:{marginTop:12,display:"flex",alignItems:"center",gap:10},children:[e.jsx("button",{type:"button",className:"btn",disabled:M,onClick:async de=>{de.preventDefault(),de.stopPropagation(),c(null),g(null);try{Y(!0),a(0),w("데이터 준비 중...");const r=Vn(se);if(!r.length)throw new Error("업로드할 데이터가 없습니다. 엑셀 내용을 확인해 주세요.");const $=ea(r,250);let N=0,m=0,P=0;for(let te=0;te<$.length;te++){const K=$[te];w(`업로드 중... (${te+1}/${$.length})`);const j=await fetch("/api/v1/demand/upload",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:K})});if(!j.ok){const l=await j.text();try{const i=JSON.parse(l),x=(i==null?void 0:i.error)||l||`Upload failed: ${j.status}`;throw new Error(x)}catch{throw new Error(`Upload failed: ${j.status} ${l}`)}}const ne=await j.json();m+=Number(ne.updated||0),P+=Number(ne.inserted||0),N+=K.length,a(Math.min(100,Math.round(N/r.length*100)))}w("완료"),c(`성공: 총 ${m+P}건 (업데이트 ${m}, 신규 ${P})`)}catch(r){g(r.message||"업로드 중 오류가 발생했습니다")}finally{Y(!1),setTimeout(()=>{a(0),w("")},1200)}},children:"업로드"}),v&&e.jsx("span",{className:"muted",children:v})]}),M&&e.jsxs("div",{style:{marginTop:10,width:"100%"},children:[e.jsx("div",{className:"progress",children:e.jsx("div",{className:"progress-bar",style:{width:`${f}%`}})}),e.jsxs("div",{className:"muted",style:{marginTop:6},children:[C," ",f>0?`${f}%`:""]})]})]})}function Vn(s){if(!s||s.length===0)return[];const o=s[0].map(v=>String(v||"").trim()),d=s.slice(1);function D(v){return o.map((c,f)=>v.some(a=>Ds(c,a))?f:-1).filter(c=>c>=0)}const H=o.findIndex(v=>["영업담당자","영업사원","sales_owner","sales_rep","sales_rep_name"].some(c=>Ds(v,c))),U=o.findIndex(v=>["거래처","고객","customer"].some(c=>Ds(v,c))),q=o.findIndex(v=>["중분류","품목중분류","종분류","category_mid","item_subcategory"].some(c=>Ds(v,c))),Q=D(["공급사(tnt)","공급사 tnt","tnt","공급사","공급자","supplier"]),W=D(["영업관리단위","관리단위","mgmt_unit","sales_mgmt_unit"]),se=D(["점유율(%)","점유율","share","share_rate"]),ee=Math.max(Q.length,W.length,se.length),S=[];let g=null,M=null,Y=null;for(const v of d){let c=ds(v,H).trim(),f=ds(v,U).trim(),a=ds(v,q).trim();if(c||(c=g||""),f||(f=M||""),a||(a=Y||""),!c||!f||!a){c&&(g=c),f&&(M=f),a&&(Y=a);continue}g=c,M=f,Y=a;for(let C=0;C<ee;C++){const w=ds(v,Q[C]).trim(),b=ds(v,W[C]).trim(),p=Zn(ds(v,se[C])),L=p!=null&&p!==0;if(!(w||b||L))continue;const X=L?p:null;S.push({salesRepName:c,customerName:f,itemSubcategory:a,supplierName:w,salesMgmtUnit:b,shareRate:X,priority:C+1})}}return S}function ds(s,o){return o>=0?s[o]??"":""}function on(s){return String(s||"").replace(/[\s\-_%()\[\]{}]/g,"").replace(/tnt/gi,"").toLowerCase()}function Ds(s,o){return on(s)===on(o)}function Zn(s){if(s==null)return null;const o=Number(String(s).replace(/[,\s%]/g,""));return Number.isFinite(o)?o:null}function ea(s,o){const d=[];for(let D=0;D<s.length;D+=o)d.push(s.slice(D,D+o));return d}const bn="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='20'%20height='20'%20viewBox='0%200%2024%2024'%20fill='none'%20stroke='currentColor'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'%20aria-hidden='true'%3e%3cpath%20d='M20.59%2013.41%2011%203H4v7l9.59%209.59a2%202%200%200%200%202.82%200l4.18-4.18a2%202%200%200%200%200-2.82Z'/%3e%3ccircle%20cx='7.5'%20cy='7.5'%20r='1.5'/%3e%3c/svg%3e";function ta(s){if(!s)return"";const o=s instanceof Date?s:new Date(s);if(isNaN(o.getTime()))return"";const d=String(o.getFullYear()%100).padStart(2,"0"),D=String(o.getMonth()+1).padStart(2,"0"),H=String(o.getDate()).padStart(2,"0"),U=String(o.getHours()).padStart(2,"0"),q=String(o.getMinutes()).padStart(2,"0");return`${d}-${D}-${H} ${U}:${q}`}function cn(){const[s,o]=t.useState(""),[d,D]=t.useState(""),[H,U]=t.useState(""),[q,Q]=t.useState(!1),[W,se]=t.useState(null),[ee,S]=t.useState([]),[g,M]=t.useState(""),[Y,v]=t.useState(!1),[c,f]=t.useState({open:!1,x:0,y:0}),[a,C]=t.useState(()=>new Set),[w,b]=t.useState({open:!1,x:0,y:0}),[p,L]=t.useState(void 0),[X,ue]=t.useState("init"),[de,r]=t.useState({}),[u,$]=t.useState("TNT"),N=100,[m,P]=t.useState(0),[te,K]=t.useState(!0),[j,ne]=t.useState(!1),l=Ne.useRef(null),[i,x]=t.useState(0),h=["init","sim","apply","confirm"],O=[{key:"init",label:"초기설정"},{key:"sim",label:"Simulation"},{key:"apply",label:"목표반영"},{key:"confirm",label:"확정"}],E=h.indexOf(X),pe=()=>{const k=Math.max(0,E-1);ue(h[k])},re=()=>{const k=Math.min(h.length-1,E+1);ue(h[k])};function G(){const k=[];for(let ae=2030;ae>=2026;ae--)k.push(ae);return k}const[xe,_]=t.useState(""),[me,fe]=t.useState(!1),[Se,Ce]=t.useState(null),[I,je]=t.useState({tnt:0,dys:0}),[V,_e]=t.useState({tnt:0,dys:0}),[qe,Te]=t.useState({tnt:0,dys:0}),Ue=new Intl.NumberFormat("ko-KR");function at(k,ae){return Number.isFinite(k)?k:0}function dt(k,ae){const ye=Number.isFinite(k)&&k>0,Ae=ye?at(k):0;return e.jsxs("div",{style:{textAlign:"right",lineHeight:1.15},children:[e.jsx("div",{children:ye?k%1===0?Math.round(k).toLocaleString():k.toFixed(2):"-"}),e.jsx("div",{className:"muted",style:{fontSize:11},children:ye?`${Ue.format(Math.round(Ae))} 원`:""})]})}async function xt(){fe(!0),Ce(null);try{const k=(localStorage.getItem("tnt.sales.empName")||"").trim();if(!k){je({tnt:0,dys:0}),Ce("로그인이 필요합니다");return}if(!xe||isNaN(Number(xe))){je({tnt:0,dys:0});return}const ae=new URL("/api/v1/targets/assigned",window.location.origin);ae.searchParams.set("year",String(xe)),ae.searchParams.set("empNames",k);try{const Ie=(localStorage.getItem("tnt.sales.assign.mode")||"").toLowerCase(),Pe=Ie==="moderate"?"2":Ie==="best"?"1":"";Pe&&ae.searchParams.set("versionNo",Pe)}catch{}const ye=await fetch(ae.toString());if(!ye.ok)throw new Error(`HTTP ${ye.status}`);const Ae=await ye.json().catch(()=>[]),$e=Array.isArray(Ae)?Ae.find(Ie=>String(Ie.company_name||"").toUpperCase()==="TNT"):null,we=Array.isArray(Ae)?Ae.find(Ie=>String(Ie.company_name||"").toUpperCase()==="DYS"):null;je({tnt:Math.round(Number(($e==null?void 0:$e.assigned_amount)||0)),dys:Math.round(Number((we==null?void 0:we.assigned_amount)||0)),tntStage:String(($e==null?void 0:$e.target_stage)||"").trim()||void 0,dysStage:String((we==null?void 0:we.target_stage)||"").trim()||void 0})}catch(k){Ce((k==null?void 0:k.message)||"조회 오류"),je({tnt:0,dys:0})}finally{fe(!1)}}const[ze,et]=t.useState(0);t.useEffect(()=>{const k=()=>et(ae=>ae+1);return window.addEventListener("tnt.sales.assign.mode.changed",k),()=>window.removeEventListener("tnt.sales.assign.mode.changed",k)},[]),t.useEffect(()=>{xt()},[xe,ze]);const[nt,jt]=t.useState(!1),[tt,ut]=t.useState(null);new Date().getFullYear();const[Xe,Tt]=t.useState("prev1"),[pt,Zt]=t.useState(()=>new Array(12).fill(0)),[es,kt]=t.useState({loading:!1});async function Nt(){if(!(p!=null&&p.customerSeq)){Zt(new Array(12).fill(0));return}jt(!0),ut(null);try{const k=new Date().getFullYear(),ae=Xe==="prev1"?[k-1]:Xe==="last2"?[k-1,k-2]:[k-1,k-2,k-3],ye=[];await Promise.all(ae.map(async Ie=>{try{const Pe=await fetch(`/api/v1/customers/${p.customerSeq}/invoice-monthly-by-dim?year=${Ie}`);if(!Pe.ok)return;const st=await Pe.json().catch(()=>[]),yt=He=>{const rt=String(He??"").trim();return rt.toLowerCase()==="na"?"":rt},bt=(Array.isArray(st)?st:[]).map(He=>({itemSubcategorySeq:Number(He.itemSubcategorySeq??He.item_subcategory_seq??0),salesMgmtUnitSeq:Number(He.salesMgmtUnitSeq??He.sales_mgmt_unit_seq??0),itemSubcategory:yt(He.itemSubcategory??He.item_subcategory),salesMgmtUnit:yt(He.salesMgmtUnit??He.sales_mgmt_unit),month:Number(He.month??0),amount:Number(He.amount??0)}));ye.push(...bt)}catch{}}));const Ae=new Map,$e=(Ie,Pe)=>`${(Ie||"").trim().toLowerCase()}||${(Pe||"").trim().toLowerCase()}`;for(const Ie of ye){const Pe=$e(Ie.itemSubcategory,Ie.salesMgmtUnit);let st=Ae.get(Pe);st||(st={sub:Ie.itemSubcategory||"",unit:Ie.salesMgmtUnit||"",months:new Array(12).fill(0)},Ae.set(Pe,st));const yt=Math.min(12,Math.max(1,Number(Ie.month)||0))-1;st.months[yt]+=Number.isFinite(Ie.amount)?Number(Ie.amount):0}const we=Array.from(Ae.values()).sort((Ie,Pe)=>(Ie.sub||"").localeCompare(Pe.sub||"")||(Ie.unit||"").localeCompare(Pe.unit||""));is(we)}catch(k){ut(k.message||"조회 중 오류가 발생했습니다"),is([])}finally{jt(!1)}}t.useEffect(()=>{X==="init"&&Nt()},[X,p==null?void 0:p.customerSeq,Xe]);async function vt(){if(!(p!=null&&p.customerSeq)){kt({loading:!1,hasRecent:void 0,error:null});return}kt({loading:!0,hasRecent:void 0,error:null});try{const k=new URL("/api/v1/customers/recent-invoice-flags",window.location.origin);k.searchParams.set("custSeq",String(p.customerSeq)),k.searchParams.set("years","2");const ae=await fetch(k.toString());if(!ae.ok){let $e=`HTTP ${ae.status}`;try{const we=await ae.json();we!=null&&we.error&&($e=we.error)}catch{}throw new Error($e)}const ye=await ae.json(),Ae=Array.isArray(ye)&&ye.some($e=>Number(($e==null?void 0:$e.customerSeq)||($e==null?void 0:$e.customerSeqText)||0)===Number(p.customerSeq)&&!!($e!=null&&$e.hasRecent));kt({loading:!1,hasRecent:Ae,error:null})}catch(k){kt({loading:!1,hasRecent:void 0,error:k.message||"오류"})}}t.useEffect(()=>{X==="init"&&vt()},[X,p==null?void 0:p.customerSeq]);const[_t,is]=t.useState([]),ls=t.useMemo(()=>e.jsx("div",{className:"table-container",style:{border:"1px solid var(--border)",borderRadius:8,marginTop:8},children:e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:220,textAlign:"left"},children:"중분류"}),e.jsx("th",{style:{width:220,textAlign:"left"},children:"영업관리단위"}),e.jsx("th",{style:{width:120,textAlign:"center"},children:"목표입력"}),Array.from({length:12},(k,ae)=>e.jsxs("th",{style:{width:90,textAlign:"right"},children:[String(ae+1).padStart(2,"0"),"월"]},ae))]})}),e.jsx("tbody",{children:_t.length===0?e.jsx("tr",{children:e.jsx("td",{className:"muted",colSpan:15,style:{padding:"12px 10px"},children:nt?"불러오는 중…":"데이터가 없습니다"})}):_t.map((k,ae)=>e.jsxs("tr",{children:[e.jsx("td",{children:k.sub}),e.jsx("td",{children:k.unit}),e.jsx("td",{style:{textAlign:"center"},children:e.jsx("button",{className:"btn btn-card btn-3d",onClick:()=>ps(k.sub,k.unit),children:"목표입력"})}),k.months.map((ye,Ae)=>e.jsx("td",{style:{textAlign:"right"},children:Math.round(ye).toLocaleString()},Ae))]},ae))})]})}),[_t,nt]),[it,Rt]=t.useState({open:!1,dist:new Array(12).fill(0)});function ps(k,ae){Rt({open:!0,sub:k,unit:ae,month:"",qty:"",dist:new Array(12).fill(0)})}function qt(){Rt({open:!1,dist:new Array(12).fill(0)})}function Wt(k,ae){const ye=Number(k),Ae=Number(ae),$e=new Array(12).fill(0);if(Number.isFinite(ye)&&ye>=1&&ye<=12&&Number.isFinite(Ae)&&Ae>0){const we=12-ye+1,Ie=Ae/we;for(let Pe=ye-1;Pe<12;Pe++)$e[Pe]=Ie}Rt(we=>({...we,month:k,qty:ae,dist:$e}))}const[Ct,$t]=t.useState({open:!1,rows:[]});function Ke(){const k=(_t||[]).map((ae,ye)=>({key:`${ae.sub}||${ae.unit}||${ye}`,sub:ae.sub,unit:ae.unit,month:"",qty:"",dist:new Array(12).fill(0)}));$t({open:!0,rows:k})}function Et(){$t({open:!1,rows:[]})}function ts(k,ae,ye){$t(Ae=>{const $e=Ae.rows.slice(),we={...$e[k]},Ie=Number(ae??we.month),Pe=Number(ye??we.qty),st=new Array(12).fill(0);if(Number.isFinite(Ie)&&Ie>=1&&Ie<=12&&Number.isFinite(Pe)&&Pe>0){const yt=12-Ie+1,bt=Pe/yt;for(let He=Ie-1;He<12;He++)st[He]=bt}return we.month=ae??we.month,we.qty=ye??we.qty,we.dist=st,$e[k]=we,{...Ae,rows:$e}})}function Bt(k){try{const ae=k.getBoundingClientRect(),ye=(ae==null?void 0:ae.width)||k.offsetWidth||600,Ae=(ae==null?void 0:ae.height)||k.offsetHeight||400,$e=Math.max(0,Math.round((window.innerWidth-ye)/2)),Ie=Math.max(0,Math.round(window.innerHeight-Ae-40));return{x:$e,y:Ie}}catch{const ae=Math.max(0,Math.round((window.innerWidth-600)/2)),Ae=Math.max(0,Math.round(window.innerHeight-400-40));return{x:ae,y:Ae}}}function gs(k){try{const ae=k.getBoundingClientRect(),ye=(ae==null?void 0:ae.width)||k.offsetWidth||460,Ae=Math.max(0,Math.round(window.innerWidth-ye)),$e=Math.max(0,Math.round(window.innerHeight*.17));return{x:Ae,y:$e}}catch{const ye=Math.max(0,Math.round(window.innerWidth-460)),Ae=Math.max(0,Math.round(window.innerHeight*.17));return{x:ye,y:Ae}}}const Ht=At("sales-plan-target-input",!!it.open,Bt,{persist:!1,resetOnOpen:!0}),ss=At("sales-plan-bulk-input",!!Ct.open,Bt,{persist:!1,resetOnOpen:!0}),[Ot,ns]=t.useState({open:!1,rows:[]}),[Ge,ht]=t.useState("");function B(){const k=(_t||[]).map((ae,ye)=>({key:`${ae.sub}||${ae.unit}||${ye}`,sub:ae.sub,unit:ae.unit,month:"",qty:"",dist:new Array(12).fill(0)}));ns({open:!0,rows:k})}function ge(){ns({open:!1,rows:[]})}function he(k,ae,ye){ns(Ae=>{const $e=Ae.rows.slice(),we={...$e[k]},Ie=Number(ae??we.month),Pe=Number(ye??we.qty),st=new Array(12).fill(0);if(Number.isFinite(Ie)&&Ie>=1&&Ie<=12&&Number.isFinite(Pe)&&Pe>0){const yt=12-Ie+1,bt=Pe/yt;for(let He=Ie-1;He<12;He++)st[He]=bt}return we.month=ae??we.month,we.qty=ye??we.qty,we.dist=st,$e[k]=we,{...Ae,rows:$e}})}const De=At("sales-plan-bulk-ratio",!!Ot.open,Bt,{persist:!1,resetOnOpen:!0}),[ie,Ee]=t.useState({open:!1,loading:!1,error:null,opts:[],dist:new Array(12).fill(0),rows:[]}),be=At("sales-plan-new-item",!!ie.open,Bt,{persist:!1,resetOnOpen:!0});async function Re(){Ee(k=>({...k,open:!0,loading:!0,error:null,unit:"",sub:"",month:"",qty:"",dist:new Array(12).fill(0),rows:[]}));try{const k=await fetch("/api/v1/items/dim"),ae=k.ok?await k.json():[],ye=Array.isArray(ae)?ae.map(we=>({itemSubcategory:String(we.itemSubcategory||we.item_subcategory||""),salesMgmtUnit:String(we.salesMgmtUnit||we.sales_mgmt_unit||"")})):[],Ae={};ye.forEach(we=>{const Ie=we.salesMgmtUnit.trim();Ie&&!Ae[Ie]&&(Ae[Ie]=we)});const $e=Object.values(Ae).sort((we,Ie)=>we.salesMgmtUnit.localeCompare(Ie.salesMgmtUnit));Ee(we=>({...we,loading:!1,opts:$e}))}catch(k){Ee(ae=>({...ae,loading:!1,error:(k==null?void 0:k.message)||"조회 오류",opts:[]}))}}function We(){Ee({open:!1,loading:!1,error:null,opts:[],dist:new Array(12).fill(0),rows:[]})}function Be(k){const ae=ie.opts.find(ye=>ye.salesMgmtUnit===k);Ee(ye=>({...ye,unit:k,sub:(ae==null?void 0:ae.itemSubcategory)||ye.sub}))}function Oe(k,ae){const ye=Number(k??ie.month),Ae=Number(ae??ie.qty),$e=new Array(12).fill(0);if(Number.isFinite(ye)&&ye>=1&&ye<=12&&Number.isFinite(Ae)&&Ae>0){const we=12-ye+1,Ie=Ae/we;for(let Pe=ye-1;Pe<12;Pe++)$e[Pe]=Ie}Ee(we=>({...we,month:k??we.month,qty:ae??we.qty,dist:$e}))}function lt(){const k=(ie.unit||"").trim(),ae=(ie.sub||"").trim(),ye=ie.month,Ae=ie.qty;if(!k||!ye||!Ae){alert("영업관리단위, 매출월, 매출 수량을 입력하세요.");return}const $e={sub:ae||"(신규)",unit:k,months:ie.dist.slice()};Ee(we=>({...we,rows:[...we.rows,$e],unit:"",sub:"",month:"",qty:"",dist:new Array(12).fill(0)}))}t.useEffect(()=>{if(!it.open&&!Ct.open&&!ie.open)return;const k=ae=>{ae.key==="Escape"&&(it.open&&qt(),Ct.open&&Et(),ie.open&&We())};return window.addEventListener("keydown",k,!0),()=>window.removeEventListener("keydown",k,!0)},[it.open,Ct.open,ie.open]);async function Ve(k=!0){se(null),k?(Q(!0),P(0),K(!0)):ne(!0);try{const ae=localStorage.getItem("tnt.sales.assigneeId");if(!ae){S([]),se(Ze.loginRequired);return}const ye=new URL("/api/v1/customers",window.location.origin);ye.searchParams.set("mineOnly","true"),ye.searchParams.set("assigneeId",ae),ye.searchParams.set("companyType",u),g.trim()&&ye.searchParams.set("name",g.trim()),ye.searchParams.set("limit",String(N)),ye.searchParams.set("offset",String(k?0:m));const Ae=await fetch(ye.toString());if(!Ae.ok){let Ie=`HTTP ${Ae.status}`;try{const Pe=await Ae.json();Pe!=null&&Pe.error&&(Ie=Pe.error)}catch{const Pe=await Ae.text();Pe&&(Ie=Pe)}throw new Error(Ie)}const $e=await Ae.json(),we=Array.isArray($e)?$e:[];S(k?we:Ie=>[...Ie,...we]),K(we.length>=N),P(Ie=>k?N:Ie+N);try{if(ae){const Ie=new URL("/api/v1/customers/count",window.location.origin);Ie.searchParams.set("mineOnly","true"),Ie.searchParams.set("assigneeId",ae);const Pe=await fetch(Ie.toString());if(Pe.ok){const st=await Pe.json().catch(()=>({})),yt=Number((st==null?void 0:st.total)??0);x(Number.isFinite(yt)?yt:0)}else x(0)}else x(0)}catch{x(0)}try{const Ie=we.map(Pe=>Number(Pe.customerSeq||0)).filter(Pe=>Number.isFinite(Pe)&&Pe>0);if(Ie.length>0){const Pe=new URL("/api/v1/customers/recent-invoice-flags",window.location.origin);Pe.searchParams.set("custSeq",Array.from(new Set(Ie)).join(",")),Pe.searchParams.set("years","2");const st=await fetch(Pe.toString());if(st.ok){const yt=await st.json(),bt={};Array.isArray(yt)&&yt.forEach(He=>{const rt=Number((He==null?void 0:He.customerSeq)||(He==null?void 0:He.customerSeqText)||0);Number.isFinite(rt)&&(bt[rt]=!!(He!=null&&He.hasRecent))}),r(He=>k?bt:{...He,...bt})}else k&&r({})}else k&&r({})}catch{r({})}}catch(ae){se(ae.message||"조회 중 오류가 발생했습니다")}finally{k?Q(!1):ne(!1)}}t.useEffect(()=>{Ve(!0)},[]),t.useEffect(()=>{Ve(!0)},[u]),t.useEffect(()=>{if(!c.open)return;const k=()=>f({open:!1,x:0,y:0});return window.addEventListener("click",k),()=>window.removeEventListener("click",k)},[c.open]),t.useEffect(()=>{if(!c.open)return;const k=ae=>{ae.key==="Escape"&&f({open:!1,x:0,y:0})};return window.addEventListener("keydown",k),()=>window.removeEventListener("keydown",k)},[c.open]),t.useEffect(()=>{const k=ae=>{((ae==null?void 0:ae.key)==="Escape"||(ae==null?void 0:ae.key)==="Esc"||(ae==null?void 0:ae.keyCode)===27)&&(f({open:!1,x:0,y:0}),b({open:!1,x:0,y:0}))};return document.addEventListener("keydown",k,!0),()=>document.removeEventListener("keydown",k,!0)},[]);async function Je(k,ae){k.preventDefault(),k.stopPropagation(),f({open:!1,x:0,y:0});const ye=k.clientX,Ae=k.clientY;b({open:!0,x:ye,y:Ae,row:ae,loading:!1,error:null,data:[]})}const Ut=t.useMemo(()=>{var ae,ye,Ae,$e,we,Ie,Pe,st,yt,bt,He,rt,as,ys,As;const k=[...ee].sort((St,Gt)=>{const zt=Number(St.customerSeq||0),fs=Number(Gt.customerSeq||0),Rs=!!de[zt],Ye=!!de[fs];if(Rs!==Ye)return Ye?1:-1;const It=(St.customerName||"").toString(),xs=(Gt.customerName||"").toString();return It.localeCompare(xs,"ko",{sensitivity:"base"})});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:8},children:[e.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:6,cursor:"pointer"},children:[e.jsx("input",{type:"radio",name:"companyType",checked:u==="TNT",onChange:()=>$("TNT")}),e.jsx("span",{children:"TNT"})]}),e.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:6,cursor:"pointer"},children:[e.jsx("input",{type:"radio",name:"companyType",checked:u==="DYS",onChange:()=>$("DYS")}),e.jsx("span",{children:"DYS"})]})]}),e.jsxs("div",{ref:l,className:"table-container",onClick:()=>f({open:!1,x:0,y:0}),style:{height:"100%",overflow:"auto"},children:[k.length===0?e.jsx("div",{className:"empty-state",children:Ze.empty}):e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsx("tr",{children:e.jsx("th",{style:{width:"auto"},children:"거래처명"})})}),e.jsx("tbody",{children:k.map((St,Gt)=>e.jsx("tr",{onClick:zt=>{zt.preventDefault(),zt.stopPropagation(),L(St),b({open:!1,x:0,y:0})},onContextMenu:zt=>Je(zt,St),"aria-selected":(p==null?void 0:p.customerId)===St.customerId?!0:void 0,style:(p==null?void 0:p.customerId)===St.customerId?{background:"var(--row-selected, rgba(0, 128, 255, 0.12))"}:void 0,children:e.jsx("td",{children:(()=>{const zt=Number(St.customerSeq||0);return de[zt]?e.jsxs("span",{children:[St.customerName," "," ","$"]}):St.customerName})()})},Gt))})]}),j&&e.jsx("div",{className:"muted",style:{padding:"6px 8px"},children:Ze.loading}),!q&&!j&&!te&&ee.length>0&&e.jsx("div",{className:"muted",style:{padding:"8px 10px",textAlign:"center"},children:"마지막 데이터입니다."}),w.open&&e.jsxs("div",{className:"context-menu",style:{left:w.x+6,top:w.y+6,maxWidth:420,padding:8},onClick:St=>St.stopPropagation(),children:[e.jsx("div",{style:{fontWeight:600,marginBottom:6},children:"거래처 상세"}),w.error?e.jsx("div",{className:"error",style:{maxWidth:380},children:w.error}):e.jsx("table",{className:"table",style:{width:"100%"},children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{style:{width:110,textAlign:"left"},children:"거래처번호"}),e.jsx("td",{children:((ae=w.row)==null?void 0:ae.customerId)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"사업자번호"}),e.jsx("td",{children:((ye=w.row)==null?void 0:ye.bizNo)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"대표자명"}),e.jsx("td",{children:((Ae=w.row)==null?void 0:Ae.ownerName)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"업태"}),e.jsx("td",{children:(($e=w.row)==null?void 0:$e.bizKind)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"종목"}),e.jsx("td",{children:((we=w.row)==null?void 0:we.bizType)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"전화번호"}),e.jsx("td",{children:((Ie=w.row)==null?void 0:Ie.telNo)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"담당자명"}),e.jsx("td",{children:((Pe=w.row)==null?void 0:Pe.empName)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"부서명"}),e.jsx("td",{children:((st=w.row)==null?void 0:st.deptName)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"시/도"}),e.jsx("td",{children:((yt=w.row)==null?void 0:yt.addrProvinceName)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"시/군/구"}),e.jsx("td",{children:((bt=w.row)==null?void 0:bt.addrCityName)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"고객유형"}),e.jsx("td",{children:((He=w.row)==null?void 0:He.customerTypeName)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"비고"}),e.jsx("td",{children:((rt=w.row)==null?void 0:rt.customerRemark)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"생성자"}),e.jsx("td",{children:((as=w.row)==null?void 0:as.createdBy)??""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"수정자"}),e.jsx("td",{children:((ys=w.row)==null?void 0:ys.updatedBy)??""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"생성일시"}),e.jsx("td",{children:ta((As=w.row)==null?void 0:As.createdAt)})]})]})})]})]})]})},[ee,c,a,w,p,de,q,j,te]);t.useEffect(()=>{const k=l.current;if(!k)return;function ae(){k.scrollTop+k.clientHeight>=k.scrollHeight-48&&te&&!j&&!q&&Ve(!1)}return k.addEventListener("scroll",ae),()=>k.removeEventListener("scroll",ae)},[te,j,q,m]);const[ft,Qt]=t.useState({open:!1,loading:!1,error:null,rows:[]}),Xt=At("unit-amounts-by-emp",ft.open,gs,{persist:!1,resetOnOpen:!0});function ks(){Qt({open:!0,loading:!0,error:null,rows:[]});const k=(localStorage.getItem("tnt.sales.empName")||"").trim();if(!k){Qt({open:!0,loading:!1,error:"로그인이 필요합니다",rows:[]});return}const ae=new URL("/api/v1/dashboard/unit-amounts-by-emp",window.location.origin);ae.searchParams.set("empName",k),fetch(ae.toString()).then(async ye=>{if(!ye.ok){let we=`HTTP ${ye.status}`;try{const Ie=await ye.json();Ie!=null&&Ie.error&&(we=Ie.error)}catch{const Ie=await ye.text();Ie&&(we=Ie)}throw new Error(we)}const Ae=await ye.json(),$e=(Array.isArray(Ae)?Ae:[]).map(we=>({unit:String((we==null?void 0:we.sales_mgmt_unit)??(we==null?void 0:we.salesMgmtUnit)??""),amount:Number((we==null?void 0:we.amount)??0)}));Qt({open:!0,loading:!1,error:null,rows:$e})}).catch(ye=>Qt({open:!0,loading:!1,error:(ye==null?void 0:ye.message)||"조회 오류",rows:[]}))}function Cs(){Qt(k=>({...k,open:!1}))}return t.useEffect(()=>{if(!ft.open)return;const k=ae=>{ae.key==="Escape"&&Cs()};return window.addEventListener("keydown",k,!0),()=>window.removeEventListener("keydown",k,!0)},[ft.open]),t.useEffect(()=>{if(!it.open)return;const k=ae=>{ae.key==="Escape"&&qt()};return window.addEventListener("keydown",k,!0),()=>window.removeEventListener("keydown",k,!0)},[it.open]),t.useEffect(()=>{if(!Ct.open)return;const k=ae=>{ae.key==="Escape"&&Et()};return window.addEventListener("keydown",k,!0),()=>window.removeEventListener("keydown",k,!0)},[Ct.open]),t.useEffect(()=>{if(!Ot.open)return;const k=ae=>{ae.key==="Escape"&&ge()};return window.addEventListener("keydown",k,!0),()=>window.removeEventListener("keydown",k,!0)},[Ot.open]),t.useEffect(()=>{if(!ie.open)return;const k=ae=>{ae.key==="Escape"&&We()};return window.addEventListener("keydown",k,!0),()=>window.removeEventListener("keydown",k,!0)},[ie.open]),e.jsxs("section",{children:[e.jsxs("div",{className:"page-title",style:{alignItems:"center"},children:[e.jsxs("h2",{style:{margin:0,fontSize:18,display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"},children:["목표 Simulation",e.jsxs("select",{className:"search-input",value:xe,onChange:k=>_(k.target.value),"aria-label":"목표년도",children:[e.jsx("option",{value:"",disabled:!0,children:"선택"}),G().map(k=>e.jsxs("option",{value:String(k),children:[k,"년"]},k))]}),e.jsxs("span",{className:"badge",title:"내 목표 배정(TNT)",children:["TNT(배정): ",Ue.format(I.tnt)," 억"]}),e.jsxs("span",{className:"badge",title:"내 목표 배정(DYS)",children:["DYS(배정): ",Ue.format(I.dys)," 억"]}),e.jsx("span",{"aria-hidden":"true",style:{opacity:.4},children:"|"}),e.jsxs("span",{className:"badge",title:"내 목표 계획(TNT)",children:["TNT(계획): ",Ue.format(V.tnt)," 억"]}),e.jsxs("span",{className:"badge",title:"내 목표 계획(DYS)",children:["DYS(계획): ",Ue.format(V.dys)," 억"]}),e.jsx("span",{"aria-hidden":"true",style:{opacity:.4},children:"|"}),e.jsxs("span",{className:"badge",title:"내 목표 차액(TNT)",children:["TNT(차액): ",Ue.format(qe.tnt)," 억"]}),e.jsxs("span",{className:"badge",title:"내 목표 차액(DYS)",children:["DYS(차액): ",Ue.format(qe.dys)," 억"]})]}),e.jsxs("div",{className:"muted count-text",style:{display:"flex",alignItems:"center",gap:12},children:[e.jsx("button",{className:"btn-plain",title:"내 평균거래 단가",onClick:ks,"aria-label":"평균거래 단가 팝업 열기",children:e.jsx("img",{src:bn,className:"icon",alt:"단가"})}),i.toLocaleString(),"개 거래처"]})]}),W&&e.jsx("div",{className:"error",children:W||Ze.errorGeneric}),e.jsxs("div",{style:{marginTop:12,display:"flex",gap:12,alignItems:"stretch",height:"calc(100vh - 140px)"},children:[e.jsxs("div",{style:{flex:"0 0 17%",maxWidth:"17%",minWidth:240,height:"100%",overflow:"auto"},children:[e.jsx("div",{className:"card",style:{padding:8,marginBottom:8},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("input",{className:"search-input",placeholder:"거래처명",value:g,onChange:k=>M(k.target.value),onKeyDown:k=>{k.key==="Enter"&&Ve(!0)},style:{flex:1}}),e.jsx("button",{className:"btn",onClick:()=>Ve(!0),disabled:q,style:{flex:"0 0 auto"},children:"조회"})]})}),Ut]}),e.jsxs("aside",{className:"card",style:{flex:"1 1 83%",maxWidth:"83%",height:"100%",padding:12,overflow:"auto"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12,gap:16},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,flex:1,minWidth:0},children:O.map((k,ae)=>{const ye=ae<E,Ae=ae===E;return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,minWidth:0,flex:ae===O.length-1?"0 0 auto":"1 1 0"},children:[e.jsx("div",{title:k.label,onClick:()=>ue(k.key),style:{width:22,height:22,borderRadius:999,display:"inline-flex",alignItems:"center",justifyContent:"center",background:ye||Ae?"var(--accent)":"transparent",border:`2px solid ${ye||Ae?"var(--accent)":"var(--border)"}`,color:ye||Ae?"var(--on-accent)":"var(--muted)",cursor:"pointer",flex:"0 0 auto"},"aria-current":Ae?"step":void 0,children:ye?"✓":ae+1}),e.jsx("div",{style:{fontSize:12,color:Ae||ye?"var(--text)":"var(--muted)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:k.label}),ae<O.length-1&&e.jsx("div",{style:{height:2,background:ae<E?"var(--accent)":"var(--border)",flex:1,borderRadius:2}})]},k.key)})}),e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[e.jsx("button",{className:"btn btn-icon",onClick:pe,disabled:E===0,"aria-label":"이전 단계",title:"이전 단계",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",focusable:"false",children:e.jsx("path",{d:"M15 18l-6-6 6-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),e.jsx("button",{className:"btn btn-icon",onClick:re,disabled:E===O.length-1,"aria-label":"다음 단계",title:"다음 단계",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",focusable:"false",children:e.jsx("path",{d:"M9 6l6 6-6 6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]})]}),X==="init"&&e.jsxs("section",{style:{marginTop:12},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12},children:[e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:10},children:[e.jsx("b",{children:"기준매출"}),e.jsxs("select",{value:Xe,onChange:k=>Tt(k.target.value),style:{height:28,padding:"4px 8px",borderRadius:8,border:"1px solid var(--border)",background:"transparent",color:"var(--text)",fontSize:12},"aria-label":"기준 기간 선택",children:[e.jsx("option",{value:"prev1",children:"전년"}),e.jsx("option",{value:"last2",children:"최근2년"}),e.jsx("option",{value:"last3",children:"최근3년"})]})]}),e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:8},children:[tt&&e.jsx("span",{className:"error",children:tt}),e.jsx("button",{className:"btn btn-card btn-3d",onClick:B,children:"일괄비율"}),e.jsx("button",{className:"btn btn-card btn-3d",onClick:Ke,children:"일괄입력"}),e.jsx("button",{className:"btn btn-card btn-3d",onClick:Re,children:"신규품목"})]})]}),ls]})]})]}),it.open&&e.jsx("div",{role:"dialog","aria-modal":"true",className:"card",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.35)",zIndex:50},children:e.jsxs("div",{ref:Ht.ref,className:"card",style:{...Ht.style,width:720,maxWidth:"92vw",background:"var(--panel)",padding:12},children:[e.jsx("div",{...Ht.bindHeader,style:{position:"absolute",top:0,left:0,right:36,height:32,cursor:"move"},"aria-hidden":"true"}),e.jsx("button",{"aria-label":"닫기",onClick:qt,className:"btn-plain",style:{position:"absolute",top:8,right:8},children:e.jsx("img",{src:ct,className:"icon",alt:"닫기"})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"120px 1fr 120px 1fr",gap:8,alignItems:"center"},children:[e.jsx("div",{className:"muted",children:"중분류"}),e.jsx("div",{children:it.sub||""}),e.jsx("div",{className:"muted",children:"영업관리단위"}),e.jsx("div",{children:it.unit||""}),e.jsx("div",{className:"muted",children:"매출월"}),e.jsx("div",{children:e.jsxs("select",{className:"search-input",value:it.month||"",onChange:k=>Wt(k.target.value,it.qty),children:[e.jsx("option",{value:"",disabled:!0,children:"선택"}),Array.from({length:12},(k,ae)=>ae+1).map(k=>e.jsxs("option",{value:String(k),children:[k,"월"]},k))]})}),e.jsx("div",{className:"muted",children:"매출 수량"}),e.jsx("div",{children:e.jsx("input",{className:"assign-input",type:"number",min:0,step:1,placeholder:"0",value:it.qty||"",onChange:k=>Wt(it.month,k.target.value)})})]}),e.jsx("div",{style:{marginTop:12},children:e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{children:Array.from({length:12},(k,ae)=>ae+1).map(k=>e.jsxs("th",{style:{textAlign:"right"},children:[String(k).padStart(2,"0"),"월"]},k))})}),e.jsx("tbody",{children:e.jsx("tr",{children:it.dist.map((k,ae)=>e.jsx("td",{children:dt(k)},ae))})})]})})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:8,gap:8},children:e.jsx("button",{className:"btn btn-card btn-3d",onClick:()=>alert("목표등록(단건) — 추후 구현 예정"),children:"목표등록"})})]})}),Ct.open&&e.jsx("div",{role:"dialog","aria-modal":"true",className:"card",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.35)",zIndex:50},children:e.jsxs("div",{ref:ss.ref,className:"card",style:{...ss.style,width:"92vw",maxWidth:1100,background:"var(--panel)",padding:12},children:[e.jsx("div",{...ss.bindHeader,style:{position:"absolute",top:0,left:0,right:36,height:32,cursor:"move"},"aria-hidden":"true"}),e.jsx("button",{"aria-label":"닫기",onClick:Et,className:"btn-plain",style:{position:"absolute",top:8,right:8},children:e.jsx("img",{src:ct,className:"icon",alt:"닫기"})}),e.jsx("div",{className:"page-title",style:{marginBottom:8},children:e.jsx("h2",{style:{margin:0},children:"목표 일괄입력"})}),e.jsx("div",{className:"table-container",style:{maxHeight:"70vh",overflow:"auto"},children:e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:200,textAlign:"left"},children:"중분류"}),e.jsx("th",{style:{width:220,textAlign:"left"},children:"영업관리단위"}),e.jsx("th",{style:{width:120,textAlign:"left"},children:"매출월"}),e.jsx("th",{style:{width:120,textAlign:"left"},children:"매출 수량"}),Array.from({length:12},(k,ae)=>ae+1).map(k=>e.jsxs("th",{style:{textAlign:"right"},children:[String(k).padStart(2,"0"),"월"]},k))]})}),e.jsx("tbody",{children:Ct.rows.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:16,className:"muted",style:{padding:"12px 10px"},children:"데이터가 없습니다"})}):Ct.rows.map((k,ae)=>e.jsxs("tr",{children:[e.jsx("td",{children:k.sub}),e.jsx("td",{children:k.unit}),e.jsx("td",{children:e.jsxs("select",{className:"search-input",value:k.month||"",onChange:ye=>ts(ae,ye.target.value,void 0),children:[e.jsx("option",{value:"",disabled:!0,children:"선택"}),Array.from({length:12},(ye,Ae)=>Ae+1).map(ye=>e.jsxs("option",{value:String(ye),children:[ye,"월"]},ye))]})}),e.jsx("td",{children:e.jsx("input",{className:"assign-input",type:"number",min:0,step:1,placeholder:"0",value:k.qty||"",onChange:ye=>ts(ae,void 0,ye.target.value)})}),k.dist.map((ye,Ae)=>e.jsx("td",{children:dt(ye)},Ae))]},k.key))})]})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:8,gap:8},children:e.jsx("button",{className:"btn btn-card btn-3d",onClick:()=>alert("목표등록(일괄) — 추후 구현 예정"),children:"목표등록"})})]})}),Ot.open&&e.jsx("div",{role:"dialog","aria-modal":"true",className:"card",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.35)",zIndex:50},children:e.jsxs("div",{ref:De.ref,className:"card",style:{...De.style,width:"92vw",maxWidth:1100,background:"var(--panel)",padding:12},children:[e.jsx("div",{...De.bindHeader,style:{position:"absolute",top:0,left:0,right:36,height:32,cursor:"move"},"aria-hidden":"true"}),e.jsx("button",{"aria-label":"닫기",onClick:ge,className:"btn-plain",style:{position:"absolute",top:8,right:8},children:e.jsx("img",{src:ct,className:"icon",alt:"닫기"})}),e.jsxs("div",{className:"page-title",style:{marginBottom:8,alignItems:"center"},children:[e.jsx("h2",{style:{margin:0},children:"목표 일괄비율"}),e.jsxs("div",{className:"controls",style:{gap:8},children:[e.jsx("span",{className:"muted",children:"적용 비율(%)"}),e.jsx("input",{className:"assign-input",type:"number",min:0,max:100,step:1,placeholder:"0",value:Ge,onChange:k=>ht(k.target.value),style:{width:100},"aria-label":"일괄 비율 입력"}),e.jsx("button",{className:"btn btn-card btn-3d",onClick:()=>alert("일괄비율 적용 — 추후 개발 예정"),children:"적용"})]})]}),e.jsx("div",{className:"table-container",style:{maxHeight:"70vh",overflow:"auto"},children:e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:200,textAlign:"left"},children:"중분류"}),e.jsx("th",{style:{width:220,textAlign:"left"},children:"영업관리단위"}),e.jsx("th",{style:{width:120,textAlign:"left"},children:"매출월"}),e.jsx("th",{style:{width:120,textAlign:"left"},children:"매출 수량"}),Array.from({length:12},(k,ae)=>ae+1).map(k=>e.jsxs("th",{style:{textAlign:"right"},children:[String(k).padStart(2,"0"),"월"]},k))]})}),e.jsx("tbody",{children:Ot.rows.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:16,className:"muted",style:{padding:"12px 10px"},children:"데이터가 없습니다"})}):Ot.rows.map((k,ae)=>e.jsxs("tr",{children:[e.jsx("td",{children:k.sub}),e.jsx("td",{children:k.unit}),e.jsx("td",{children:e.jsxs("select",{className:"search-input",value:k.month||"",onChange:ye=>he(ae,ye.target.value,void 0),children:[e.jsx("option",{value:"",disabled:!0,children:"선택"}),Array.from({length:12},(ye,Ae)=>Ae+1).map(ye=>e.jsxs("option",{value:String(ye),children:[ye,"월"]},ye))]})}),e.jsx("td",{children:e.jsx("input",{className:"assign-input",type:"number",min:0,step:1,placeholder:"0",value:k.qty||"",onChange:ye=>he(ae,void 0,ye.target.value)})}),k.dist.map((ye,Ae)=>e.jsx("td",{children:dt(ye)},Ae))]},k.key))})]})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:8,gap:8},children:e.jsx("button",{className:"btn btn-card btn-3d",onClick:()=>alert("목표등록(일괄비율) — 추후 구현 예정"),children:"목표등록"})})]})}),ie.open&&e.jsx("div",{role:"dialog","aria-modal":"true",className:"card",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.35)",zIndex:50},children:e.jsxs("div",{ref:be.ref,className:"card",style:{...be.style,width:820,maxWidth:"92vw",background:"var(--panel)",padding:12},children:[e.jsx("div",{...be.bindHeader,style:{position:"absolute",top:0,left:0,right:36,height:32,cursor:"move"},"aria-hidden":"true"}),e.jsx("button",{"aria-label":"닫기",onClick:We,className:"btn-plain",style:{position:"absolute",top:8,right:8},children:e.jsx("img",{src:ct,className:"icon",alt:"닫기"})}),e.jsx("div",{className:"page-title",style:{marginBottom:8},children:e.jsx("h2",{style:{margin:0},children:"신규품목"})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"120px 1fr 120px 1fr",gap:8,alignItems:"center"},children:[e.jsx("div",{className:"muted",children:"영업관리단위"}),e.jsx("div",{children:e.jsxs("select",{className:"search-input",value:ie.unit||"",onChange:k=>Be(k.target.value),children:[e.jsx("option",{value:"",disabled:!0,children:"선택"}),ie.opts.map((k,ae)=>e.jsx("option",{value:k.salesMgmtUnit,children:k.salesMgmtUnit},ae))]})}),e.jsx("div",{className:"muted",children:"중분류"}),e.jsx("div",{children:e.jsx("input",{className:"assign-input",value:ie.sub||"",readOnly:!0,placeholder:"자동"})}),e.jsx("div",{className:"muted",children:"매출월"}),e.jsx("div",{children:e.jsxs("select",{className:"search-input",value:ie.month||"",onChange:k=>Oe(k.target.value,void 0),children:[e.jsx("option",{value:"",disabled:!0,children:"선택"}),Array.from({length:12},(k,ae)=>ae+1).map(k=>e.jsxs("option",{value:String(k),children:[k,"월"]},k))]})}),e.jsx("div",{className:"muted",children:"매출 수량"}),e.jsx("div",{children:e.jsx("input",{className:"assign-input",type:"number",min:0,step:1,placeholder:"0",value:ie.qty||"",onChange:k=>Oe(void 0,k.target.value)})})]}),e.jsx("div",{style:{marginTop:12},children:e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{children:Array.from({length:12},(k,ae)=>ae+1).map(k=>e.jsxs("th",{style:{textAlign:"right"},children:[String(k).padStart(2,"0"),"월"]},k))})}),e.jsx("tbody",{children:e.jsx("tr",{children:ie.dist.map((k,ae)=>e.jsx("td",{children:dt(k)},ae))})})]})})}),e.jsxs("div",{style:{marginTop:12},children:[e.jsx("div",{className:"pane-header",style:{margin:0},children:"추가된 항목"}),e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:200,textAlign:"left"},children:"중분류"}),e.jsx("th",{style:{width:220,textAlign:"left"},children:"영업관리단위"}),Array.from({length:12},(k,ae)=>ae+1).map(k=>e.jsxs("th",{style:{textAlign:"right"},children:[String(k).padStart(2,"0"),"월"]},k))]})}),e.jsx("tbody",{children:ie.rows.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:14,className:"muted",style:{padding:"12px 10px"},children:"추가된 항목이 없습니다"})}):ie.rows.map((k,ae)=>e.jsxs("tr",{children:[e.jsx("td",{children:k.sub}),e.jsx("td",{children:k.unit}),k.months.map((ye,Ae)=>e.jsx("td",{children:dt(ye)},Ae))]},ae))})]})})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:8,gap:8},children:[e.jsx("button",{className:"btn btn-card btn-3d",onClick:lt,children:"추가"}),e.jsx("button",{className:"btn btn-card btn-3d",onClick:()=>alert("목표등록(신규품목) — 추후 구현 예정"),children:"목표등록"})]})]})}),ft.open&&e.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:60},children:e.jsxs("div",{ref:Xt.ref,className:"card",style:{...Xt.style,height:"66vh",width:460,maxWidth:"92vw",background:"var(--panel)",padding:12,borderLeft:"1px solid var(--border)",boxShadow:"-8px 0 24px rgba(0,0,0,0.18)",overflow:"auto"},children:[e.jsx("div",{...Xt.bindHeader,style:{position:"absolute",top:0,left:0,right:36,height:32,cursor:"move"},"aria-hidden":"true"}),e.jsx("button",{"aria-label":"닫기",onClick:Cs,className:"btn-plain",style:{position:"absolute",top:8,right:8},children:e.jsx("img",{src:ct,className:"icon",alt:"닫기"})}),e.jsx("div",{className:"page-title",style:{marginBottom:8},children:e.jsx("h2",{style:{margin:0},children:"내 평균거래 단가"})}),ft.error?e.jsx("div",{className:"error",style:{maxWidth:420},children:ft.error}):e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:280,textAlign:"left"},children:"영업관리단위"}),e.jsx("th",{style:{width:180,textAlign:"right"},children:"합계(원)"})]})}),e.jsx("tbody",{children:ft.loading?e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"muted",style:{padding:"12px 10px"},children:"불러오는 중…"})}):ft.rows.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"muted",style:{padding:"12px 10px"},children:"데이터가 없습니다"})}):ft.rows.map((k,ae)=>e.jsxs("tr",{children:[e.jsx("td",{children:k.unit||"na"}),e.jsxs("td",{style:{textAlign:"right"},children:[Ue.format(Math.round(k.amount))," 원"]})]},ae))})]})})]})})]})}function sa(s){if(!s)return"";const o=s instanceof Date?s:new Date(s);if(isNaN(o.getTime()))return"";const d=String(o.getFullYear()%100).padStart(2,"0"),D=String(o.getMonth()+1).padStart(2,"0"),H=String(o.getDate()).padStart(2,"0"),U=String(o.getHours()).padStart(2,"0"),q=String(o.getMinutes()).padStart(2,"0");return`${d}-${D}-${H} ${U}:${q}`}function na(){const[s,o]=t.useState(""),[d,D]=t.useState(""),[H,U]=t.useState(""),[q,Q]=t.useState(!1),[W,se]=t.useState(null),[ee,S]=t.useState([]),[g,M]=t.useState(""),[Y,v]=t.useState(!1),[c,f]=t.useState({open:!1,x:0,y:0}),[a,C]=t.useState(()=>new Set),[w,b]=t.useState({open:!1,x:0,y:0}),[p,L]=t.useState(void 0),[X,ue]=t.useState("init"),[de,r]=t.useState({}),[u,$]=t.useState("TNT"),[N,m]=t.useState({}),P=100,[te,K]=t.useState(0),[j,ne]=t.useState(!0),[l,i]=t.useState(!1),x=Ne.useRef(null),[h,O]=t.useState(0),[E,pe]=t.useState({show:!1,name:"",tnt:0,dys:0,year:0}),[re,G]=t.useState(!1),[xe,_]=t.useState({tnt:0,dys:0}),me=["init","sim","confirm"],fe=[{key:"init",label:"초기설정"},{key:"sim",label:"계획 수립 중"},{key:"confirm",label:"확정"}],Se=me.indexOf(X);function Ce(){const n=[];for(let y=2030;y>=2026;y--)n.push(y);return n}const[I,je]=t.useState(""),[V,_e]=t.useState(!1),[qe,Te]=t.useState(null),[Ue,at]=t.useState({tnt:0,dys:0}),[dt,xt]=t.useState({tnt:0,dys:0}),[ze,et]=t.useState({tnt:0,dys:0}),[nt,jt]=t.useState({tnt:0,dys:0}),[tt,ut]=t.useState({open:!1,company:"TNT",group:"customer",loading:!1,error:null,rows:[]}),[Xe,Tt]=t.useState({x:0,y:0}),pt=new Intl.NumberFormat("ko-KR"),Zt=new Intl.NumberFormat("ko-KR",{minimumFractionDigits:2,maximumFractionDigits:2}),[es,kt]=t.useState(null),[Nt,vt]=t.useState({val:"",loading:!1,saving:!1,error:null,success:null});async function _t(){try{const n=Number(I),y=Number((p==null?void 0:p.customerSeq)||0),T=(localStorage.getItem("tnt.sales.assigneeId")||"").trim();if(!T||!Number.isFinite(n)||n<=0||!y){vt(J=>({...J,val:"",loading:!1,error:null}));return}vt(J=>({...J,loading:!0,error:null}));const z=new URL("/api/v1/sales/plan/plan-remark",window.location.origin);z.searchParams.set("year",String(n)),z.searchParams.set("customerSeq",String(y));const R=await fetch(z.toString(),{headers:{"X-ASSIGNEE-ID":T}});if(!R.ok)throw new Error(`HTTP ${R.status}`);const A=await R.json().catch(()=>({})),Z=String((A==null?void 0:A.remark)??"");vt({val:Z,loading:!1,saving:!1,error:null,success:null})}catch(n){vt(y=>({...y,loading:!1,error:(n==null?void 0:n.message)||"조회 오류"}))}}async function is(){try{const n=Number(I),y=Number((p==null?void 0:p.customerSeq)||0),T=(localStorage.getItem("tnt.sales.assigneeId")||"").trim();if(!T){alert("로그인이 필요합니다.");return}if(!Number.isFinite(n)||n<=0){alert("연도를 선택하세요.");return}if(!y){alert("거래처를 선택하세요.");return}vt(Z=>({...Z,saving:!0,error:null,success:null}));const z={"Content-Type":"application/json","X-ASSIGNEE-ID":T},R=JSON.stringify({year:n,customerSeq:y,remark:Nt.val}),A=await fetch("/api/v1/sales/plan/plan-remark",{method:"POST",headers:z,body:R});if(!A.ok){let Z=await A.text().catch(()=>"");throw new Error(Z||"HTTP "+A.status)}vt(Z=>({...Z,saving:!1,success:"저장되었습니다."})),setTimeout(()=>vt(Z=>({...Z,success:null})),1200)}catch(n){vt(y=>({...y,saving:!1,error:(n==null?void 0:n.message)||"저장 오류"}))}}t.useEffect(()=>{p!=null&&p.customerSeq&&I&&_t()},[p==null?void 0:p.customerSeq,I]);async function ls(){try{const n=Number(I),y=(localStorage.getItem("tnt.sales.assigneeId")||"").trim(),T=Number((p==null?void 0:p.customerSeq)||0);if(!y){alert("로그인이 필요합니다.");return}if(!Number.isFinite(n)||n<=0){alert("연도를 선택하세요.");return}if(!T){alert("거래처를 선택하세요.");return}const z={year:n,companyType:u,assigneeId:y,customerSeq:T},R={"Content-Type":"application/json","X-ASSIGNEE-ID":y},A=(localStorage.getItem("tnt.sales.empId")||"").trim();A&&(R["X-EMP-ID"]=A);const Z=await fetch("/api/v1/sales/plan/confirm-customer",{method:"POST",headers:R,body:JSON.stringify(z)});if(!Z.ok){let J=await Z.text().catch(()=>"");throw new Error(J||"HTTP "+Z.status)}await Z.json().catch(()=>({})),ue("confirm"),ns(J=>J+1);try{const J=String((p==null?void 0:p.customerName)||""),F=String(I||"");kt(J&&F?`${J} ${F}년 목표 수립이 완료되었습니다.`:"목표 수립이 완료되었습니다.")}catch{kt("목표 수립이 완료되었습니다.")}}catch(n){alert((n==null?void 0:n.message)||"확정 처리 중 오류가 발생했습니다")}}const[it,Rt]=t.useState(!1),[ps,qt]=t.useState(""),[Wt,Ct]=t.useState("TNT");function $t(n,y){return Number.isFinite(n)?n:0}function Ke(n,y,T,z,R){const A=Number.isFinite(n)&&n>0,Z=A&&Number.isFinite(T),J=Z?Number(T):A?$t(n):0,F=A?Zt.format(Number(n)):"-",le=A?Z?`${Zt.format(Number(J))} 원`:"-":"";return e.jsxs("div",{style:{textAlign:"right",lineHeight:1.15,color:z||void 0},children:[e.jsx("div",{style:{fontWeight:R?700:void 0},children:F}),e.jsx("div",{className:R?void 0:"muted",style:{fontSize:11,color:z||void 0,fontWeight:R?700:void 0},children:le})]})}async function Et(n,y){try{const T=Number(I),z=(localStorage.getItem("tnt.sales.assigneeId")||"").trim();if(!z||!Number.isFinite(T)||T<=0){ut(F=>({...F,rows:[],error:null,loading:!1}));return}ut(F=>({...F,loading:!0,error:null}));const R=new URL("/api/v1/sales/plan/totals-breakdown",window.location.origin);R.searchParams.set("year",String(T)),R.searchParams.set("assigneeId",z),R.searchParams.set("companyType",n),R.searchParams.set("groupBy",y);const A=await fetch(R.toString());if(!A.ok){let F=await A.text().catch(()=>"");throw new Error(F||"HTTP "+A.status)}const Z=await A.json().catch(()=>[]),J=(Array.isArray(Z)?Z:[]).map(F=>({key:String((F==null?void 0:F.key)??""),label:F!=null&&F.label?String(F.label):void 0,amount:Number((F==null?void 0:F.amount)??0)}));ut(F=>({...F,rows:J,loading:!1,error:null}))}catch(T){ut(z=>({...z,loading:!1,error:(T==null?void 0:T.message)||"조회 오류",rows:[]}))}}function ts(n,y){if(y)try{Tt({x:y.clientX||0,y:y.clientY||0})}catch{}ut({open:!0,company:n,group:"customer",loading:!1,error:null,rows:[]}),Et(n,"customer")}function Bt(){ut(n=>({...n,open:!1}))}async function gs(){_e(!0),Te(null);try{const n=(localStorage.getItem("tnt.sales.empName")||"").trim();if(!n){at({tnt:0,dys:0}),Te("로그인이 필요합니다");return}if(!I||isNaN(Number(I))){at({tnt:0,dys:0});return}const y=new URL("/api/v1/targets/assigned",window.location.origin);y.searchParams.set("year",String(I)),y.searchParams.set("empNames",n);try{const Z=(localStorage.getItem("tnt.sales.assign.mode")||"").toLowerCase(),J=Z==="moderate"?"2":Z==="best"?"1":"";J&&y.searchParams.set("versionNo",J)}catch{}const T=await fetch(y.toString());if(!T.ok)throw new Error(`HTTP ${T.status}`);const z=await T.json().catch(()=>[]),R=Array.isArray(z)?z.find(Z=>String(Z.company_name||"").toUpperCase()==="TNT"):null,A=Array.isArray(z)?z.find(Z=>String(Z.company_name||"").toUpperCase()==="DYS"):null;at({tnt:Math.round(Number((R==null?void 0:R.assigned_amount)||0)),dys:Math.round(Number((A==null?void 0:A.assigned_amount)||0)),tntStage:String((R==null?void 0:R.target_stage)||"").trim()||void 0,dysStage:String((A==null?void 0:A.target_stage)||"").trim()||void 0})}catch(n){Te((n==null?void 0:n.message)||"조회 오류"),at({tnt:0,dys:0})}finally{_e(!1)}}const[Ht,ss]=t.useState(0);t.useEffect(()=>{const n=()=>ss(y=>y+1);return window.addEventListener("tnt.sales.assign.mode.changed",n),()=>window.removeEventListener("tnt.sales.assign.mode.changed",n)},[]),t.useEffect(()=>{gs()},[I,Ht]),t.useEffect(()=>{(async()=>{try{const n=Number(I),y=(localStorage.getItem("tnt.sales.assigneeId")||"").trim();if(!y||!Number.isFinite(n)||n<=0){et({tnt:0,dys:0});return}const T=new URL("/api/v1/sales/plan/totals-by-assignee",window.location.origin);T.searchParams.set("year",String(n)),T.searchParams.set("assigneeId",y);const z=await fetch(T.toString());if(!z.ok)throw new Error(`HTTP ${z.status}`);const R=await z.json().catch(()=>[]);let A=0,Z=0;Array.isArray(R)&&R.forEach(J=>{const F=String((J==null?void 0:J.company_type)||(J==null?void 0:J.companyType)||"").toUpperCase(),le=Number((J==null?void 0:J.amount)||0);F==="TNT"?A+=le:F==="DYS"&&(Z+=le)}),et({tnt:Math.round(A),dys:Math.round(Z)})}catch{et({tnt:0,dys:0})}})()},[I]),t.useEffect(()=>{async function n(){try{G(!1);const y=Number(I);if(!Number.isFinite(y)||y<=0){pe(Le=>({...Le,show:!1})),G(!0);return}const T=localStorage.getItem("tnt.sales.assigneeId")||"",z=localStorage.getItem("tnt.sales.empId")||"",R=new URL("/api/v1/sales/plan/status",window.location.origin);R.searchParams.set("year",String(y)),T?R.searchParams.set("assigneeId",T):z&&R.searchParams.set("empId",z);const A=await fetch(R.toString());if(!A.ok){pe(Le=>({...Le,show:!1})),G(!0);return}const Z=await A.json().catch(()=>({})),J=(localStorage.getItem("tnt.sales.empName")||"").trim()||"사용자",F=Number((Z==null?void 0:Z.tnt)||0),le=Number((Z==null?void 0:Z.dys)||0),ce=!!(Z!=null&&Z.hasP),oe=!!(Z!=null&&Z.hasC),ke=!!(Z!=null&&Z.hasI);let ve="";oe&&!ce&&!ke?ve="목표수립완료":ke&&!ce&&!oe?ve="초기설정완료":(ce||oe&&ke)&&(ve="계획수립 중"),pe({show:!!ve,name:J,tnt:F,dys:le,year:y,label:ve,hasP:ce,hasC:oe,hasI:ke}),ue(oe&&!ce&&!ke?"confirm":ce?"sim":"init"),G(!0)}catch{pe(T=>({...T,show:!1})),G(!0)}}n()},[I]);const[Ot,ns]=t.useState(0),[Ge,ht]=t.useState({loading:!1,error:null,rows:[]});t.useEffect(()=>{const n=Number((p==null?void 0:p.customerSeq)||0),y=Number(I);if(!n||!Number.isFinite(y)||y<=0){ht({loading:!1,error:null,rows:[]});return}let T=!1;return(async()=>{try{ht(F=>({...F,loading:!0,error:null}));const z=localStorage.getItem("tnt.sales.assigneeId")||"",R=new URL("/api/v1/sales/plan/customer-monthly-rows",window.location.origin);R.searchParams.set("year",String(y)),R.searchParams.set("customerSeq",String(n)),u&&R.searchParams.set("companyType",u),z&&R.searchParams.set("assigneeId",z);const A=await fetch(R.toString());if(!A.ok){let F=`HTTP ${A.status}`;try{const le=await A.json();le!=null&&le.error&&(F=le.error)}catch{}throw new Error(F)}const Z=await A.json().catch(()=>[]),J=(Array.isArray(Z)?Z:[]).map(F=>({sub:String((F==null?void 0:F.item_subcategory)??(F==null?void 0:F.itemSubcategory)??""),unit:String((F==null?void 0:F.sales_mgmt_unit)??(F==null?void 0:F.salesMgmtUnit)??""),months:Array.from({length:12},(le,ce)=>Number((F==null?void 0:F[`qty_${String(ce+1).padStart(2,"0")}`])??0)),amounts:Array.from({length:12},(le,ce)=>Number((F==null?void 0:F[`amount_${String(ce+1).padStart(2,"0")}`])??0)),type:String((F==null?void 0:F.plan_type)||(F==null?void 0:F.planType)||"").toUpperCase()==="P"?"P":"B",stage:String((F==null?void 0:F.target_stage)||(F==null?void 0:F.targetStage)||"").toUpperCase()||void 0}));T||ht({loading:!1,error:null,rows:J})}catch(z){T||ht({loading:!1,error:(z==null?void 0:z.message)||"오류",rows:[]})}})(),()=>{T=!0}},[p==null?void 0:p.customerSeq,I,u,Ot]),t.useEffect(()=>{try{if(!Number((p==null?void 0:p.customerSeq)||0))return;const y=Array.isArray(Ge.rows)?Ge.rows:[];if(!y.length){ue("init");return}const T=y.some(A=>String((A==null?void 0:A.type)||"").toUpperCase()==="P"),z=y.map(A=>String((A==null?void 0:A.stage)||"").toUpperCase()).filter(Boolean),R=z.length>0&&z.every(A=>A==="C");ue(R?"confirm":T?"sim":"init")}catch{}},[p==null?void 0:p.customerSeq,Ge.rows]);const[B,ge]=t.useState({open:!1,dist:new Array(12).fill(0),curMonths:new Array(12).fill(0),curAmounts:new Array(12).fill(0),success:null}),[he,De]=t.useState({}),[ie,Ee]=t.useState({}),[be,Re]=t.useState({});function We(n){return String(n||"").trim().toUpperCase()}function Be(n){try{const y=Oe(),z=(he[y]||{})[We(n)];if(Number.isFinite(z)&&Number(z)>0)return Number(z);const R=Ve(),Z=((ie==null?void 0:ie[R])||{})[We(n)];return Number.isFinite(Z)&&Number(Z)>0?Number(Z):void 0}catch{return}}function Oe(){const n=(localStorage.getItem("tnt.sales.assigneeId")||"").trim(),y=Number(I),T=new Date().getFullYear()-1,z=Number.isFinite(y)&&y>0?y-1:T;return`${n}|${u||""}|${z}`}async function lt(){try{const n=Oe();if(!n||he[n])return;const[y,T,z]=n.split("|"),R=Number(z);if(!y||!T||!Number.isFinite(R)||R<=0)return;const A=new URL("/api/v1/dashboard/avg-unit-price-by-emp",window.location.origin);A.searchParams.set("assigneeId",y),A.searchParams.set("companyType",T),A.searchParams.set("year",String(R));const Z=await fetch(A.toString());if(!Z.ok)return;const J=await Z.json().catch(()=>[]),F={},le={};Array.isArray(J)&&J.forEach(ce=>{const oe=We((ce==null?void 0:ce.sales_mgmt_unit)||(ce==null?void 0:ce.salesMgmtUnit)),ke=Number((ce==null?void 0:ce.avg_unit_price)||(ce==null?void 0:ce.avgUnitPrice)||0);oe&&(F[oe]=ke),oe&&(le[oe]={itemUnit:String((ce==null?void 0:ce.item_unit)||(ce==null?void 0:ce.itemUnit)||""),itemStdUnit:String((ce==null?void 0:ce.item_std_unit)||(ce==null?void 0:ce.itemStdUnit)||"")})}),De(ce=>({...ce,[n]:F})),Re(ce=>({...ce,[n]:le}))}catch{}}function Ve(){const n=Number(I),y=new Date().getFullYear()-1,T=Number.isFinite(n)&&n>0?n-1:y;return`${u||""}|${T}`}async function Je(){try{const n=Ve();if(!n||ie[n])return;const[y,T]=n.split("|"),z=Number(T);if(!y||!Number.isFinite(z)||z<=0)return;const R=new URL("/api/v1/dashboard/avg-unit-price",window.location.origin);R.searchParams.set("companyType",y),R.searchParams.set("year",String(z));const A=await fetch(R.toString());if(!A.ok)return;const Z=await A.json().catch(()=>[]),J={};Array.isArray(Z)&&Z.forEach(F=>{const le=We((F==null?void 0:F.sales_mgmt_unit)||(F==null?void 0:F.salesMgmtUnit)),ce=Number((F==null?void 0:F.avg_unit_price)||(F==null?void 0:F.avgUnitPrice)||0);le&&(J[le]=ce)}),Ee(F=>({...F,[n]:J}))}catch{}}async function Ut(n){try{await Je()}catch{}}async function ft(n){try{const y=Oe();if(!y)return;const[T,z,R]=y.split("|"),A=Number(R);if(!T||!z||!Number.isFinite(A)||A<=0)return;const Z=new URL("/api/v1/dashboard/avg-unit-price-by-emp",window.location.origin);Z.searchParams.set("assigneeId",T),Z.searchParams.set("companyType",z),Z.searchParams.set("year",String(A));const J=await fetch(Z.toString());if(!J.ok)return;const F=await J.json().catch(()=>[]);let le=null;if(Array.isArray(F)){const ce=We(n);le=F.find(oe=>We((oe==null?void 0:oe.sales_mgmt_unit)||(oe==null?void 0:oe.salesMgmtUnit))===ce)}if(le){const ce=We((le==null?void 0:le.sales_mgmt_unit)||(le==null?void 0:le.salesMgmtUnit)),oe=Number((le==null?void 0:le.avg_unit_price)||(le==null?void 0:le.avgUnitPrice)||0),ke={itemUnit:String((le==null?void 0:le.item_unit)||(le==null?void 0:le.itemUnit)||""),itemStdUnit:String((le==null?void 0:le.item_std_unit)||(le==null?void 0:le.itemStdUnit)||"")};De(ve=>({...ve,[y]:{...ve[y]||{},[ce]:oe}})),Re(ve=>({...ve,[y]:{...ve[y]||{},[ce]:ke}}))}}catch{}}function Qt(n,y){const T=(Ge.rows||[]).find(A=>A.sub===n&&A.unit===y),z=T!=null&&T.months?T.months.slice():new Array(12).fill(0),R=T!=null&&T.amounts?T.amounts.slice():new Array(12).fill(0);ge({open:!0,sub:n,unit:y,stage:T==null?void 0:T.stage,month:"",qty:"",dist:new Array(12).fill(0),curMonths:z,curAmounts:R,success:null});try{lt()}catch{}try{Je()}catch{}}function Xt(){ge({open:!1,dist:new Array(12).fill(0),curMonths:new Array(12).fill(0),curAmounts:new Array(12).fill(0),success:null})}function ks(n,y){const T=Number(n),z=Number(y),R=new Array(12).fill(0);if(Number.isFinite(T)&&T>=1&&T<=12&&Number.isFinite(z)&&z>0){const A=12-T+1,Z=z/A;for(let J=T-1;J<12;J++)R[J]=Z}ge(A=>({...A,month:n,qty:y,dist:R}))}async function Cs(){try{const n=Number(I),y=u,T=(localStorage.getItem("tnt.sales.assigneeId")||"").trim(),z=Number((p==null?void 0:p.customerSeq)||0),R=(B.sub||"").trim(),A=(B.unit||"").trim();if(!Number.isFinite(n)||n<=0){alert("연도를 선택하세요.");return}if(!T){alert("로그인이 필요합니다.");return}if(!z||!R||!A){alert("거래처/중분류/영업관리단위가 필요합니다.");return}const Z=(B.dist||[]).map(oe=>{const ke=Number(oe);return!Number.isFinite(ke)||ke<=0?0:Math.round(ke*100)/100});if(!Z.some(oe=>oe>0)&&!(B.month&&Number(B.month)>0)){alert("매출월을 선택하세요.");return}const J={year:n,companyType:y,assigneeId:T,customerSeq:z,itemSubcategory:R,salesMgmtUnit:A,qty:Z},F={"Content-Type":"application/json","X-ASSIGNEE-ID":T},le=(localStorage.getItem("tnt.sales.empId")||"").trim();le&&(F["X-EMP-ID"]=le);const ce=await fetch("/api/v1/sales/plan/upsert-row",{method:"POST",headers:F,body:JSON.stringify(J)});if(!ce.ok){let oe=await ce.text().catch(()=>"");throw new Error(oe||"HTTP "+ce.status)}ge(oe=>({...oe,success:"목표가 변경되었습니다"}))}catch(n){alert((n==null?void 0:n.message)||"저장 중 오류가 발생했습니다")}}async function k(){try{const n=Number(I),y=(localStorage.getItem("tnt.sales.assigneeId")||"").trim(),T=Number((p==null?void 0:p.customerSeq)||0);if(Number.isFinite(n)&&n>0&&y&&T){const z=new URL("/api/v1/sales/plan/customer-monthly-rows",window.location.origin);z.searchParams.set("year",String(n)),z.searchParams.set("customerSeq",String(T)),u&&z.searchParams.set("companyType",u),z.searchParams.set("assigneeId",y);const R=await fetch(z.toString());if(R.ok){const A=await R.json().catch(()=>[]),Z=(Array.isArray(A)?A:[]).map(J=>({sub:String((J==null?void 0:J.item_subcategory)??(J==null?void 0:J.itemSubcategory)??""),unit:String((J==null?void 0:J.sales_mgmt_unit)??(J==null?void 0:J.salesMgmtUnit)??""),months:Array.from({length:12},(F,le)=>Number((J==null?void 0:J[`qty_${String(le+1).padStart(2,"0")}`])??0)),amounts:Array.from({length:12},(F,le)=>Number((J==null?void 0:J[`amount_${String(le+1).padStart(2,"0")}`])??0)),type:String((J==null?void 0:J.plan_type)||(J==null?void 0:J.planType)||"").toUpperCase()==="P"?"P":"B",stage:String((J==null?void 0:J.target_stage)||(J==null?void 0:J.targetStage)||"").toUpperCase()||void 0}));ht({loading:!1,error:null,rows:Z})}}}catch{}Xt();try{$e()}catch{}try{Gt()}catch{}try{Is()}catch{}}const[ae,ye]=t.useState({open:!1,rows:[],success:null});function Ae(){const n=(Ge.rows||[]).map((y,T)=>({key:`${y.sub}||${y.unit}||${T}`,sub:y.sub,unit:y.unit,stage:y.stage,type:y.type,month:"",qty:"",dist:new Array(12).fill(0),curMonths:y.months?y.months.slice():new Array(12).fill(0),curAmounts:y.amounts?y.amounts.slice():new Array(12).fill(0)}));ye({open:!0,rows:n,success:null});try{lt()}catch{}try{Je()}catch{}}function $e(){ye({open:!1,rows:[],success:null})}function we(n,y,T){ye(z=>{const R=z.rows.slice(),A={...R[n]},Z=Number(y??A.month),J=Number(T??A.qty),F=new Array(12).fill(0);if(Number.isFinite(Z)&&Z>=1&&Z<=12&&Number.isFinite(J)&&J>0){const le=12-Z+1,ce=J/le;for(let oe=Z-1;oe<12;oe++)F[oe]=ce}return A.month=y??A.month,A.qty=T??A.qty,A.dist=F,R[n]=A,{...z,rows:R}})}async function Ie(){try{const n=Number(I),y=u,T=(localStorage.getItem("tnt.sales.assigneeId")||"").trim(),z=Number((p==null?void 0:p.customerSeq)||0);if(!Number.isFinite(n)||n<=0){alert("연도를 선택하세요.");return}if(!T){alert("로그인이 필요합니다.");return}if(!z){alert("거래처를 선택하세요.");return}const R={"Content-Type":"application/json","X-ASSIGNEE-ID":T},A=(localStorage.getItem("tnt.sales.empId")||"").trim();A&&(R["X-EMP-ID"]=A);const Z=(ae.rows||[]).filter(J=>!!J.month&&Number(J.month)>0);if(Z.length===0){alert("매출월을 선택한 행이 없습니다.");return}for(const J of Z){const F=Number(J.month),le=Number(J.qty||0),ce=new Array(12).fill(0);if(Number.isFinite(F)&&F>=1&&F<=12){const Le=12-F+1,Me=Number.isFinite(le)&&le>0?le/Le:0;for(let Fe=F-1;Fe<12;Fe++)ce[Fe]=Me}const oe=ce.map(Le=>{const Me=Number(Le);return!Number.isFinite(Me)||Me<=0?0:Math.round(Me*100)/100}),ke={year:n,companyType:y,assigneeId:T,customerSeq:z,itemSubcategory:J.sub,salesMgmtUnit:J.unit,qty:oe},ve=await fetch("/api/v1/sales/plan/upsert-row",{method:"POST",headers:R,body:JSON.stringify(ke)});if(!ve.ok){let Le=await ve.text().catch(()=>"");throw new Error(Le||"HTTP "+ve.status)}}ye(J=>({...J,success:"목표가 변경되었습니다"}))}catch(n){alert((n==null?void 0:n.message)||"저장 중 오류가 발생했습니다")}}function Pe(n){try{const y=n.getBoundingClientRect(),T=(y==null?void 0:y.width)||n.offsetWidth||600,z=(y==null?void 0:y.height)||n.offsetHeight||400,R=Math.max(0,Math.round((window.innerWidth-T)/2)),Z=Math.max(0,Math.round(window.innerHeight-z-40));return{x:R,y:Z}}catch{const y=Math.max(0,Math.round((window.innerWidth-600)/2)),z=Math.max(0,Math.round(window.innerHeight-400-40));return{x:y,y:z}}}function st(n){try{const y=n.getBoundingClientRect(),T=(y==null?void 0:y.width)||n.offsetWidth||600,z=(y==null?void 0:y.height)||n.offsetHeight||400,R=Math.max(0,Math.round((window.innerWidth-T)/2)),A=Math.max(0,Math.round((window.innerHeight-z)/2));return{x:R,y:A}}catch{const z=Math.max(0,Math.round((window.innerWidth-600)/2)),R=Math.max(0,Math.round((window.innerHeight-400)/2));return{x:z,y:R}}}function yt(n){try{const y=n.getBoundingClientRect(),T=(y==null?void 0:y.width)||n.offsetWidth||460,z=Math.max(0,Math.round(window.innerWidth-T)),R=Math.max(0,Math.round(window.innerHeight*.17));return{x:z,y:R}}catch{const T=Math.max(0,Math.round(window.innerWidth-460)),z=Math.max(0,Math.round(window.innerHeight*.17));return{x:T,y:z}}}const bt=At("sales-plan-target-input",!!B.open,Pe,{persist:!1,resetOnOpen:!0}),He=At("sales-plan-bulk-input",!!ae.open,st,{persist:!1,resetOnOpen:!0}),[rt,as]=t.useState({open:!1,rows:[],success:null}),[ys,As]=t.useState("");function St(){const n=(Ge.rows||[]).map((y,T)=>({key:`${y.sub}||${y.unit}||${T}`,sub:y.sub,unit:y.unit,stage:y.stage,type:y.type,month:"",qty:"",dist:new Array(12).fill(0),curMonths:y.months?y.months.slice():new Array(12).fill(0),curAmounts:y.amounts?y.amounts.slice():new Array(12).fill(0)}));as({open:!0,rows:n,success:null});try{lt()}catch{}try{Je()}catch{}}function Gt(){as({open:!1,rows:[],success:null})}function zt(){const n=Number(ys);if(!Number.isFinite(n)){alert("적용 비율(%)을 입력하세요.");return}let y=1+n/100;(!Number.isFinite(y)||y<0)&&(y=0),as(T=>{const z=(T.rows||[]).map(R=>{const A=R.curMonths||[],Z=Array.from({length:12},(J,F)=>{const le=Number(A[F]||0);return Number.isFinite(le)?le*y:0});return{...R,dist:Z}});return{...T,rows:z}})}const fs=At("sales-plan-bulk-ratio",!!rt.open,st,{persist:!1,resetOnOpen:!0});async function Rs(){try{const n=Number(I),y=u,T=(localStorage.getItem("tnt.sales.assigneeId")||"").trim(),z=Number((p==null?void 0:p.customerSeq)||0);if(!Number.isFinite(n)||n<=0){alert("연도를 선택하세요.");return}if(!T){alert("로그인이 필요합니다.");return}if(!z){alert("거래처를 선택하세요.");return}const R={"Content-Type":"application/json","X-ASSIGNEE-ID":T},A=(localStorage.getItem("tnt.sales.empId")||"").trim();A&&(R["X-EMP-ID"]=A);const Z=(rt.rows||[]).filter(J=>(J.dist||[]).some(F=>Number(F)>0));if(Z.length===0){alert("적용 비율을 먼저 적용하세요.");return}for(const J of Z){const F=(J.dist||[]).map(oe=>{const ke=Number(oe);return!Number.isFinite(ke)||ke<=0?0:Math.round(ke*100)/100}),le={year:n,companyType:y,assigneeId:T,customerSeq:z,itemSubcategory:J.sub,salesMgmtUnit:J.unit,qty:F},ce=await fetch("/api/v1/sales/plan/upsert-row",{method:"POST",headers:R,body:JSON.stringify(le)});if(!ce.ok){let oe=await ce.text().catch(()=>"");throw new Error(oe||"HTTP "+ce.status)}}as(J=>({...J,success:"목표가 변경되었습니다"}))}catch(n){alert((n==null?void 0:n.message)||"저장 중 오류가 발생했습니다")}}const[Ye,It]=t.useState({open:!1,loading:!1,error:null,success:null,opts:[],dist:new Array(12).fill(0),rows:[]}),xs=At("sales-plan-new-item",!!Ye.open,st,{persist:!1,resetOnOpen:!0});function En(n){try{const y=n.getBoundingClientRect(),T=(y==null?void 0:y.width)||n.offsetWidth||480,z=(y==null?void 0:y.height)||n.offsetHeight||300,R=12;let A=Math.round(Xe.x-Math.min(T/2,240)),Z=Math.round(Xe.y+R);return A=Math.max(8,Math.min(A,window.innerWidth-T-8)),Z=Math.max(8,Math.min(Z,window.innerHeight-z-8)),{x:A,y:Z}}catch{const y=Math.max(8,Math.min(Xe.x,window.innerWidth-500)),T=Math.max(8,Math.min(Xe.y,window.innerHeight-320));return{x:y,y:T}}}const qs=At("plan-totals-breakdown",tt.open,En,{persist:!1,resetOnOpen:!0});async function Gs(){It(n=>({...n,open:!0,loading:!0,error:null,unit:"",sub:"",month:"",qty:"",dist:new Array(12).fill(0),rows:[]}));try{const n=await fetch("/api/v1/items/dim"),y=n.ok?await n.json():[],T=Array.isArray(y)?y.map(A=>({itemSubcategory:String(A.itemSubcategory||A.item_subcategory||""),salesMgmtUnit:String(A.salesMgmtUnit||A.sales_mgmt_unit||"")})):[],z={};T.forEach(A=>{const Z=A.salesMgmtUnit.trim();Z&&!z[Z]&&(z[Z]=A)});const R=Object.values(z).sort((A,Z)=>A.salesMgmtUnit.localeCompare(Z.salesMgmtUnit));It(A=>({...A,loading:!1,opts:R}));try{lt()}catch{}}catch(n){It(y=>({...y,loading:!1,error:(n==null?void 0:n.message)||"조회 오류",opts:[]}))}}t.useEffect(()=>{if(Ye.open){try{lt()}catch{}try{Je()}catch{}}},[Ye.open,I,u]);function Is(){It({open:!1,loading:!1,error:null,success:null,opts:[],dist:new Array(12).fill(0),rows:[]})}function Dn(n){const y=Ye.opts.find(T=>T.salesMgmtUnit===n);It(T=>({...T,unit:n,sub:(y==null?void 0:y.itemSubcategory)||T.sub}));try{lt()}catch{}try{ft(n)}catch{}try{Ut(n)}catch{}}function Vs(n,y){const T=Number(n??Ye.month),z=Number(y??Ye.qty),R=new Array(12).fill(0);if(Number.isFinite(T)&&T>=1&&T<=12&&Number.isFinite(z)&&z>0){const A=12-T+1,Z=z/A;for(let J=T-1;J<12;J++)R[J]=Z}It(A=>({...A,month:n??A.month,qty:y??A.qty,dist:R}))}function Mn(){const n=(Ye.unit||"").trim(),y=(Ye.sub||"").trim(),T=Ye.month,z=Ye.qty;if(!n||!T||!z){alert("영업관리단위, 매출월, 매출 수량을 입력하세요.");return}const R={sub:y||"(신규)",unit:n,months:Ye.dist.slice()};It(A=>{const Z=A.rows.slice(),J=Z.findIndex(F=>(F.unit||"").trim()===n&&(F.sub||"").trim()===(R.sub||"").trim());return J>=0?Z[J]={...Z[J],sub:R.sub,unit:R.unit,months:R.months.slice()}:Z.push(R),{...A,rows:Z,unit:"",sub:"",month:"",qty:"",dist:new Array(12).fill(0)}})}async function _n(){try{const n=Number(I),y=u,T=(localStorage.getItem("tnt.sales.assigneeId")||"").trim(),z=Number((p==null?void 0:p.customerSeq)||0);if(!Number.isFinite(n)||n<=0){alert("연도를 선택하세요.");return}if(!T){alert("로그인이 필요합니다.");return}if(!z){alert("거래처를 선택하세요.");return}const R=Ye.rows||[];if(!R.length){alert("추가된 영업관리단위가 없습니다.");return}const A=new Set((Ge.rows||[]).map(le=>`${String(le.sub||"").trim()}||${String(le.unit||"").trim()}`).filter(le=>!!le&&le!=="||")),Z=R.map(le=>({sub:String(le.sub||"").trim(),unit:String(le.unit||"").trim()})).filter(le=>le.sub&&le.unit&&A.has(`${le.sub}||${le.unit}`)).map(le=>le.unit);if(Z.length>0){It(le=>({...le,error:`${Z.join(", ")} 이미 목표에 등록되어 있습니다. 목표 수정을 통해 작업 하세요.`}));return}const J={"Content-Type":"application/json","X-ASSIGNEE-ID":T},F=(localStorage.getItem("tnt.sales.empId")||"").trim();F&&(J["X-EMP-ID"]=F);for(const le of R){const ce=(le.months||[]).map(ot=>{const Qe=Number(ot);return!Number.isFinite(Qe)||Qe<=0?0:Math.round(Qe*100)/100}),oe=String(le.unit||"").trim(),ke=Be(oe),ve=Number.isFinite(ke)?Math.round(Number(ke)):0,Le=ce.map(ot=>Number.isFinite(ot)&&ve>0?Math.round(Number(ot)*ve):0),Me={year:n,companyType:y,assigneeId:T,customerSeq:z,itemSubcategory:le.sub,salesMgmtUnit:le.unit,qty:ce,amount:Le},Fe=await fetch("/api/v1/sales/plan/upsert-row",{method:"POST",headers:J,body:JSON.stringify(Me)});if(!Fe.ok){let ot=await Fe.text().catch(()=>"");throw new Error(ot||"HTTP "+Fe.status)}}It(le=>({...le,success:"목표가 변경되었습니다"}))}catch(n){alert((n==null?void 0:n.message)||"저장 중 오류가 발생했습니다")}}t.useEffect(()=>{if(!B.open&&!ae.open&&!Ye.open)return;const n=y=>{y.key==="Escape"&&(B.open&&Xt(),ae.open&&$e(),Ye.open&&Is())};return window.addEventListener("keydown",n,!0),()=>window.removeEventListener("keydown",n,!0)},[B.open,ae.open,Ye.open]);async function rs(n=!0){se(null),n?(Q(!0),K(0),ne(!0)):i(!0);try{const y=Number(I);if(!Number.isFinite(y)||y<=0){n&&(S([]),ne(!0),K(0),r({}),m({}));return}const T=localStorage.getItem("tnt.sales.assigneeId");if(!T){S([]),se(Ze.loginRequired);return}const z=new URL("/api/v1/customers",window.location.origin);z.searchParams.set("mineOnly","true"),z.searchParams.set("assigneeId",T),z.searchParams.set("companyType",u),I&&z.searchParams.set("year",String(I)),g.trim()&&z.searchParams.set("name",g.trim()),z.searchParams.set("limit",String(P)),z.searchParams.set("offset",String(n?0:te));const R=await fetch(z.toString());if(!R.ok){let J=`HTTP ${R.status}`;try{const F=await R.json();F!=null&&F.error&&(J=F.error)}catch{const F=await R.text();F&&(J=F)}throw new Error(J)}const A=await R.json(),Z=Array.isArray(A)?A:[];S(n?Z:J=>[...J,...Z]),ne(Z.length>=P),K(J=>n?P:J+P);try{if(T){const J=new URL("/api/v1/customers/count",window.location.origin);J.searchParams.set("mineOnly","true"),J.searchParams.set("assigneeId",T);const F=await fetch(J.toString());if(F.ok){const le=await F.json().catch(()=>({})),ce=Number((le==null?void 0:le.total)??0);O(Number.isFinite(ce)?ce:0)}else O(0)}else O(0)}catch{O(0)}try{const J=Z.map(F=>Number(F.customerSeq||0)).filter(F=>Number.isFinite(F)&&F>0);if(J.length>0){const F=new URL("/api/v1/customers/recent-invoice-flags",window.location.origin);F.searchParams.set("custSeq",Array.from(new Set(J)).join(",")),F.searchParams.set("years","2");const le=await fetch(F.toString());if(le.ok){const ce=await le.json(),oe={};Array.isArray(ce)&&ce.forEach(ke=>{const ve=Number((ke==null?void 0:ke.customerSeq)||(ke==null?void 0:ke.customerSeqText)||0);Number.isFinite(ve)&&(oe[ve]=!!(ke!=null&&ke.hasRecent))}),r(ke=>n?oe:{...ke,...oe})}else n&&r({})}else n&&r({})}catch{r({})}try{const J=Number(I),F=Number.isFinite(J)&&J>0?J:new Date().getFullYear(),le=localStorage.getItem("tnt.sales.assigneeId")||"",ce=Z.map(oe=>Number(oe.customerSeq||0)).filter(oe=>Number.isFinite(oe)&&oe>0);if(le&&ce.length>0){const oe=new URL("/api/v1/sales/plan/stages",window.location.origin);oe.searchParams.set("year",String(F)),u&&oe.searchParams.set("companyType",u),oe.searchParams.set("assigneeId",le),oe.searchParams.set("customerSeqs",Array.from(new Set(ce)).join(","));const ke=await fetch(oe.toString());if(ke.ok){const ve=await ke.json(),Le={};Array.isArray(ve)&&ve.forEach(Me=>{const Fe=Number((Me==null?void 0:Me.customer_seq)??(Me==null?void 0:Me.customerSeq)??0),ot=String((Me==null?void 0:Me.target_stage)??(Me==null?void 0:Me.targetStage)??"").trim();Number.isFinite(Fe)&&ot&&(Le[Fe]=ot)}),m(Me=>n?Le:{...Me,...Le})}else n&&m({})}else n&&m({})}catch{n&&m({})}}catch(y){se(y.message||"조회 중 오류가 발생했습니다")}finally{n?Q(!1):i(!1)}}t.useEffect(()=>{I&&rs(!0)},[I,u]),t.useEffect(()=>{I||(S([]),ne(!0),K(0),r({}),m({}))},[I]),t.useEffect(()=>{async function n(){try{const y=localStorage.getItem("tnt.sales.assigneeId");if(!y){_({tnt:0,dys:0});return}const T=Number(I);if(!Number.isFinite(T)||T<=0){_({tnt:0,dys:0});return}const z=new URL("/api/v1/customers/with-invoice-count",window.location.origin);z.searchParams.set("assigneeId",y),z.searchParams.set("year",String(T));const R=await fetch(z.toString());if(!R.ok){_({tnt:0,dys:0});return}const A=await R.json().catch(()=>({})),Z=Number((A==null?void 0:A.tnt)??0),J=Number((A==null?void 0:A.dys)??0);_({tnt:Number.isFinite(Z)?Z:0,dys:Number.isFinite(J)?J:0})}catch{_({tnt:0,dys:0})}}n()},[I]);const $n=t.useMemo(()=>{const n=Number(I);return Number.isFinite(n)&&n>0?`${n-1}년`:"전년도"},[I]),Ln=t.useMemo(()=>(localStorage.getItem("tnt.sales.empName")||"").trim()||"사용자",[]),mt="#1e3a8a";t.useEffect(()=>{if(!c.open)return;const n=()=>f({open:!1,x:0,y:0});return window.addEventListener("click",n),()=>window.removeEventListener("click",n)},[c.open]),t.useEffect(()=>{if(!c.open)return;const n=y=>{y.key==="Escape"&&f({open:!1,x:0,y:0})};return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[c.open]),t.useEffect(()=>{const n=y=>{((y==null?void 0:y.key)==="Escape"||(y==null?void 0:y.key)==="Esc"||(y==null?void 0:y.keyCode)===27)&&(f({open:!1,x:0,y:0}),b({open:!1,x:0,y:0}))};return document.addEventListener("keydown",n,!0),()=>document.removeEventListener("keydown",n,!0)},[]);async function Pn(n,y){n.preventDefault(),n.stopPropagation(),f({open:!1,x:0,y:0});const T=n.clientX,z=n.clientY;b({open:!0,x:T,y:z,row:y,loading:!1,error:null,data:[]})}const Zs=t.useMemo(()=>{var y,T,z,R,A,Z,J,F,le,ce,oe,ke,ve,Le,Me;const n=[...ee].sort((Fe,ot)=>{const Qe=Number(Fe.customerSeq||0),Dt=Number(ot.customerSeq||0),Mt=!!N[Qe],Pt=!!N[Dt];if(Mt!==Pt)return Mt?-1:1;const Yt=(Fe.customerName||"").toString(),Fs=(ot.customerName||"").toString();return Yt.localeCompare(Fs,"ko",{sensitivity:"base"})});return e.jsx(e.Fragment,{children:e.jsxs("div",{ref:x,className:"table-container",onClick:()=>f({open:!1,x:0,y:0}),style:{height:"100%",overflow:"auto"},children:[n.length===0?e.jsx("div",{className:"empty-state",children:Ze.empty}):e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsx("tr",{children:e.jsx("th",{style:{width:"auto"},children:"거래처명"})})}),e.jsx("tbody",{children:n.map((Fe,ot)=>e.jsx("tr",{onClick:Qe=>{Qe.preventDefault(),Qe.stopPropagation(),L(Fe),b({open:!1,x:0,y:0})},onContextMenu:Qe=>Pn(Qe,Fe),"aria-selected":(p==null?void 0:p.customerId)===Fe.customerId?!0:void 0,style:(p==null?void 0:p.customerId)===Fe.customerId?{background:"var(--row-selected, rgba(0, 128, 255, 0.12))"}:void 0,children:e.jsx("td",{children:(()=>{const Qe=Number(Fe.customerSeq||0),Dt=N[Qe],Mt={};return Dt==="P"&&(Mt.color="#dc2626"),Dt==="C"&&(Mt.fontWeight=700),e.jsxs("span",{children:[e.jsx("span",{style:Mt,children:Fe.customerName}),Dt?e.jsx("span",{className:"badge stage-badge",style:{marginLeft:6},children:Dt}):null]})})()})},ot))})]}),l&&e.jsx("div",{className:"muted",style:{padding:"6px 8px"},children:Ze.loading}),!q&&!l&&!j&&ee.length>0&&e.jsx("div",{className:"muted",style:{padding:"8px 10px",textAlign:"center"},children:"마지막 데이터입니다."}),w.open&&e.jsxs("div",{className:"context-menu",style:{left:w.x+6,top:w.y+6,maxWidth:420,padding:8},onClick:Fe=>Fe.stopPropagation(),children:[e.jsx("div",{style:{fontWeight:600,marginBottom:6},children:"거래처 상세"}),w.error?e.jsx("div",{className:"error",style:{maxWidth:380},children:w.error}):e.jsx("table",{className:"table",style:{width:"100%"},children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{style:{width:110,textAlign:"left"},children:"거래처번호"}),e.jsx("td",{children:((y=w.row)==null?void 0:y.customerId)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"사업자번호"}),e.jsx("td",{children:((T=w.row)==null?void 0:T.bizNo)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"대표자명"}),e.jsx("td",{children:((z=w.row)==null?void 0:z.ownerName)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"업태"}),e.jsx("td",{children:((R=w.row)==null?void 0:R.bizKind)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"종목"}),e.jsx("td",{children:((A=w.row)==null?void 0:A.bizType)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"전화번호"}),e.jsx("td",{children:((Z=w.row)==null?void 0:Z.telNo)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"담당자명"}),e.jsx("td",{children:((J=w.row)==null?void 0:J.empName)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"부서명"}),e.jsx("td",{children:((F=w.row)==null?void 0:F.deptName)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"시/도"}),e.jsx("td",{children:((le=w.row)==null?void 0:le.addrProvinceName)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"시/군/구"}),e.jsx("td",{children:((ce=w.row)==null?void 0:ce.addrCityName)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"고객유형"}),e.jsx("td",{children:((oe=w.row)==null?void 0:oe.customerTypeName)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"비고"}),e.jsx("td",{children:((ke=w.row)==null?void 0:ke.customerRemark)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"생성자"}),e.jsx("td",{children:((ve=w.row)==null?void 0:ve.createdBy)??""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"수정자"}),e.jsx("td",{children:((Le=w.row)==null?void 0:Le.updatedBy)??""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"생성일시"}),e.jsx("td",{children:sa((Me=w.row)==null?void 0:Me.createdAt)})]})]})})]})]})})},[ee,c,a,w,p,N,q,l,j]);t.useEffect(()=>{const n=x.current;if(!n)return;function y(){n.scrollTop+n.clientHeight>=n.scrollHeight-48&&j&&!l&&!q&&rs(!1)}return n.addEventListener("scroll",y),()=>n.removeEventListener("scroll",y)},[j,l,q,te]);const[Lt,os]=t.useState({open:!1,loading:!1,error:null,rows:[]}),[Ws,Rn]=t.useState(10),[Vt,en]=t.useState(""),[js,Os]=t.useState("TNT"),zs=At("unit-amounts-by-emp",Lt.open,yt,{persist:!1,resetOnOpen:!0}),[cs,Ts]=t.useState({total:0,confirmed:0,inprogress:0,loading:!1,error:null}),[vs,Es]=t.useState({tnt:0,dys:0,loading:!1,error:null});t.useEffect(()=>{async function n(){const y=Number(I),T=(localStorage.getItem("tnt.sales.assigneeId")||"").trim(),z=(localStorage.getItem("tnt.sales.empId")||"").trim();if(!Number.isFinite(y)||y<=0||!T&&!z){Ts({total:0,confirmed:0,inprogress:0,loading:!1,error:null});return}Ts(R=>({...R,loading:!0,error:null}));try{const R=new URL("/api/v1/sales/plan/customer-counts-overall",window.location.origin);R.searchParams.set("year",String(y)),T?R.searchParams.set("assigneeId",T):z&&R.searchParams.set("empId",z);const A=await fetch(R.toString());if(!A.ok)throw new Error(`HTTP ${A.status}`);const Z=await A.json(),J=Number((Z==null?void 0:Z.total_customers)??0)||0,F=Number((Z==null?void 0:Z.confirmed_customers)??0)||0,le=Number((Z==null?void 0:Z.inprogress_customers)??0)||0;Ts({total:J,confirmed:F,inprogress:le,loading:!1,error:null})}catch(R){Ts({total:0,confirmed:0,inprogress:0,loading:!1,error:(R==null?void 0:R.message)||"요약 조회 오류"})}}n()},[I,Ht]);async function qn(){try{const n=localStorage.getItem("tnt.sales.assigneeId");if(!n||!Vt){os(oe=>({...oe,loading:!1}));return}const y=new URL("/api/v1/dashboard/avg-unit-price-by-emp",window.location.origin);y.searchParams.set("assigneeId",n),y.searchParams.set("companyType",js),y.searchParams.set("year",String(Vt));const T=await fetch(y.toString());if(!T.ok)throw new Error(`HTTP ${T.status}`);const z=await T.json(),R=new URL("/api/v1/dashboard/avg-unit-price",window.location.origin);R.searchParams.set("companyType",js),R.searchParams.set("year",String(Vt));const A=await fetch(R.toString()),Z=A.ok?await A.json():[],J={},F={};Array.isArray(z)&&z.forEach(oe=>{const ve=String((oe==null?void 0:oe.sales_mgmt_unit)??(oe==null?void 0:oe.salesMgmtUnit)??"").trim().toUpperCase();ve&&(J[ve]={amount:Number((oe==null?void 0:oe.avg_unit_price)??(oe==null?void 0:oe.avgUnitPrice)??0),itemUnit:String((oe==null?void 0:oe.item_unit)??(oe==null?void 0:oe.itemUnit)??""),itemStdUnit:String((oe==null?void 0:oe.item_std_unit)??(oe==null?void 0:oe.itemStdUnit)??"")})}),Array.isArray(Z)&&Z.forEach(oe=>{const ve=String((oe==null?void 0:oe.sales_mgmt_unit)??(oe==null?void 0:oe.salesMgmtUnit)??"").trim().toUpperCase();ve&&(F[ve]={amount:Number((oe==null?void 0:oe.avg_unit_price)??(oe==null?void 0:oe.avgUnitPrice)??0),itemUnit:String((oe==null?void 0:oe.item_unit)??(oe==null?void 0:oe.itemUnit)??""),itemStdUnit:String((oe==null?void 0:oe.item_std_unit)??(oe==null?void 0:oe.itemStdUnit)??"")})});const ce=Array.from(new Set([...Object.keys(J),...Object.keys(F)])).sort().map(oe=>{var ke,ve,Le,Me,Fe,ot;return{unit:oe,amountMy:Number(((ke=J[oe])==null?void 0:ke.amount)??0),amountGlobal:Number(((ve=F[oe])==null?void 0:ve.amount)??0),itemUnit:((Le=J[oe])==null?void 0:Le.itemUnit)||((Me=F[oe])==null?void 0:Me.itemUnit)||"",itemStdUnit:((Fe=J[oe])==null?void 0:Fe.itemStdUnit)||((ot=F[oe])==null?void 0:ot.itemStdUnit)||""}});os({open:!0,loading:!1,error:null,rows:ce})}catch(n){os({open:!0,loading:!1,error:(n==null?void 0:n.message)||"조회 오류",rows:[]})}}function Wn(){os({open:!0,loading:!0,error:null,rows:[]});const n=Number(I),y=Number.isFinite(n)&&n>0?n-1:new Date().getFullYear()-1,T=Math.max(2025,Math.min(2030,y));en(T),Os("TNT")}function On(n){const y=n.target.value;je(y)}function tn(){os(n=>({...n,open:!1}))}return t.useEffect(()=>{if(!Lt.open)return;const n=y=>{y.key==="Escape"&&tn()};return window.addEventListener("keydown",n,!0),()=>window.removeEventListener("keydown",n,!0)},[Lt.open]),t.useEffect(()=>{Lt.open&&Vt&&(os(n=>({...n,loading:!0})),qn())},[Lt.open,Vt,js]),t.useEffect(()=>{(async()=>{try{Es(F=>({...F,loading:!0,error:null}));const n=Number(I),y=(localStorage.getItem("tnt.sales.assigneeId")||"").trim(),T=(localStorage.getItem("tnt.sales.empId")||"").trim();if(!Number.isFinite(n)||n<=0||!y&&!T){Es({tnt:0,dys:0,loading:!1,error:null});return}const z=new URL("/api/v1/sales/plan/totals-confirmed-by-assignee",window.location.origin);z.searchParams.set("year",String(n)),y?z.searchParams.set("assigneeId",y):T&&z.searchParams.set("empId",T);const R=await fetch(z.toString());if(!R.ok)throw new Error(`HTTP ${R.status}`);const A=await R.json().catch(()=>[]);let Z=0,J=0;if(Array.isArray(A))for(const F of A){const le=String((F==null?void 0:F.company_type)||(F==null?void 0:F.companyType)||"").toUpperCase(),ce=Number((F==null?void 0:F.amount)||0);le==="TNT"?Z+=ce:le==="DYS"&&(J+=ce)}Es({tnt:Math.round(Z),dys:Math.round(J),loading:!1,error:null})}catch(n){Es({tnt:0,dys:0,loading:!1,error:(n==null?void 0:n.message)||"확정 합계 조회 오류"})}})()},[I]),t.useEffect(()=>{if(!B.open)return;const n=y=>{y.key==="Escape"&&Xt()};return window.addEventListener("keydown",n,!0),()=>window.removeEventListener("keydown",n,!0)},[B.open]),t.useEffect(()=>{if(!ae.open)return;const n=y=>{y.key==="Escape"&&$e()};return window.addEventListener("keydown",n,!0),()=>window.removeEventListener("keydown",n,!0)},[ae.open]),t.useEffect(()=>{if(!rt.open)return;const n=y=>{y.key==="Escape"&&Gt()};return window.addEventListener("keydown",n,!0),()=>window.removeEventListener("keydown",n,!0)},[rt.open]),t.useEffect(()=>{if(!Ye.open)return;const n=y=>{y.key==="Escape"&&Is()};return window.addEventListener("keydown",n,!0),()=>window.removeEventListener("keydown",n,!0)},[Ye.open]),t.useEffect(()=>{if(!tt.open)return;const n=y=>{y.key==="Escape"&&Bt()};return window.addEventListener("keydown",n,!0),()=>window.removeEventListener("keydown",n,!0)},[tt.open]),e.jsxs("section",{"aria-busy":it||void 0,children:[e.jsxs("div",{className:"page-title",style:{alignItems:"center"},children:[e.jsx("h2",{style:{margin:0,fontSize:18},children:"목표 Simulation"}),e.jsxs("div",{className:"muted count-text",style:{display:"flex",alignItems:"center",gap:12,flexWrap:"wrap"},children:[e.jsx("span",{style:{fontWeight:700},children:"현재목표"}),e.jsxs("span",{onClick:n=>ts("TNT",n),style:{display:"inline-flex",alignItems:"baseline",gap:8,padding:"6px 10px",border:"2px solid #3b82f6",borderRadius:999,fontWeight:800,fontSize:16,background:"transparent",cursor:"pointer"},title:"TNT 계획 합계 (클릭하여 상세)",children:[e.jsx("span",{style:{fontSize:12,color:"#3b82f6",fontWeight:700},children:"TNT"}),e.jsx("span",{style:{color:"#3b82f6"},children:pt.format(ze.tnt)}),e.jsx("span",{style:{fontSize:12,color:"#3b82f6"},children:"원"})]}),e.jsxs("span",{onClick:n=>ts("DYS",n),style:{display:"inline-flex",alignItems:"baseline",gap:8,padding:"6px 10px",border:"2px solid #10b981",borderRadius:999,fontWeight:800,fontSize:16,background:"transparent",cursor:"pointer"},title:"DYS 계획 합계 (클릭하여 상세)",children:[e.jsx("span",{style:{fontSize:12,color:"#10b981",fontWeight:700},children:"DYS"}),e.jsx("span",{style:{color:"#10b981"},children:pt.format(ze.dys)}),e.jsx("span",{style:{fontSize:12,color:"#10b981"},children:"원"})]}),e.jsx("span",{"aria-hidden":!0,style:{width:1,height:20,background:"var(--border)",display:"inline-block"}}),e.jsx("span",{style:{fontWeight:700},children:"목표확정"}),vs.loading?e.jsx("span",{className:"muted",style:{fontSize:12},children:"불러오는 중…"}):vs.error?e.jsx("span",{className:"error",style:{fontSize:12},children:vs.error}):e.jsxs(e.Fragment,{children:[e.jsxs("span",{title:"확정된 고객 합계 (TNT)",style:{display:"inline-flex",alignItems:"baseline",gap:8,padding:"6px 10px",border:"2px solid #3b82f6",borderRadius:999,fontWeight:800,fontSize:16,background:"transparent"},children:[e.jsx("span",{style:{fontSize:12,color:"#3b82f6",fontWeight:700},children:"TNT"}),e.jsx("span",{style:{color:"#3b82f6"},children:pt.format(vs.tnt)}),e.jsx("span",{style:{fontSize:12,color:"#3b82f6"},children:"원"})]}),e.jsxs("span",{title:"확정된 고객 합계 (DYS)",style:{display:"inline-flex",alignItems:"baseline",gap:8,padding:"6px 10px",border:"2px solid #10b981",borderRadius:999,fontWeight:800,fontSize:16,background:"transparent"},children:[e.jsx("span",{style:{fontSize:12,color:"#10b981",fontWeight:700},children:"DYS"}),e.jsx("span",{style:{color:"#10b981"},children:pt.format(vs.dys)}),e.jsx("span",{style:{fontSize:12,color:"#10b981"},children:"원"})]})]}),e.jsx("button",{className:"btn-plain",title:"내 평균거래 단가",onClick:Wn,"aria-label":"평균거래 단가 팝업 열기",children:e.jsx("img",{src:bn,className:"icon",alt:"단가"})}),h.toLocaleString(),"개 거래처"]})]}),e.jsxs("div",{className:"card",style:{padding:8,marginTop:8,display:"flex",alignItems:"center",gap:12,flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:8},children:[e.jsx("div",{className:"muted",children:"목표년도"}),e.jsxs("select",{className:"search-input",value:I,onChange:On,"aria-label":"목표년도",style:{height:28},children:[e.jsx("option",{value:"",disabled:!0,children:"선택"}),Ce().map(n=>e.jsxs("option",{value:String(n),children:[n,"년"]},n))]}),e.jsx("div",{className:"muted",style:{marginLeft:12},children:"가중치"}),e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[e.jsx("input",{className:"search-input",value:String(Ws),onChange:n=>{const y=Number((n.target.value||"").replace(/[^0-9]/g,""));Number.isFinite(y)&&Rn(Math.max(0,Math.min(999,y)))},inputMode:"numeric","aria-label":"가중치(%)",style:{width:72,height:28,textAlign:"right"}}),e.jsx("span",{className:"muted",children:"%"})]})]}),(()=>{const n=!!(E.hasC&&!E.hasP&&!E.hasI),y=!!(E.hasI&&!E.hasP&&!E.hasC),T=!!(E.hasP||E.hasC&&E.hasI),z=n?"목표수립완료":y?"초기설정완료":T?"계획수립 중":"초기설정",R=n||y||T,A=R||it?{opacity:.6,cursor:"not-allowed",background:"var(--border)",color:"var(--muted)"}:void 0;return e.jsx("button",{className:"btn btn-card btn-3d",onClick:zn,disabled:R||it,style:A,children:z})})(),I?E.show?e.jsxs("div",{className:"muted",style:{display:"inline-flex",alignItems:"center",gap:6,flexWrap:"wrap",fontSize:12},children:[e.jsxs("span",{style:{fontSize:12},children:[E.name,"님"]}),e.jsxs("span",{style:{color:mt,fontWeight:700,fontSize:14,whiteSpace:"pre"},children:[E.year,"년"]}),e.jsx("span",{style:{fontSize:12},children:" "}),e.jsxs("span",{style:{color:mt,fontWeight:700,fontSize:14},children:["TNT ",E.tnt.toLocaleString(),"개"]}),e.jsx("span",{style:{fontSize:12},children:","}),e.jsxs("span",{style:{color:mt,fontWeight:700,fontSize:14},children:[" DYS ",E.dys.toLocaleString(),"개"]}),e.jsx("span",{style:{fontSize:12},children:E.label||""})]}):re?e.jsxs("div",{className:"muted",style:{display:"inline-flex",alignItems:"center",gap:6,flexWrap:"wrap",fontSize:12},children:[e.jsxs("span",{style:{fontSize:12},children:[Ln,"님,"]}),e.jsx("span",{style:{color:mt,fontWeight:700,fontSize:14},children:$n}),e.jsx("span",{style:{fontSize:12},children:"매출 기준으로 담당 거래처"}),e.jsx("span",{style:{color:mt,fontWeight:700,fontSize:14},children:"TNT"}),e.jsx("span",{style:{color:mt,fontWeight:700,fontSize:14},children:xe.tnt.toLocaleString()}),e.jsx("span",{style:{fontSize:12},children:"개,"}),e.jsx("span",{style:{color:mt,fontWeight:700,fontSize:14},children:"DYS"}),e.jsx("span",{style:{color:mt,fontWeight:700,fontSize:14},children:xe.dys.toLocaleString()}),e.jsx("span",{style:{fontSize:12},children:"개에 대해"}),e.jsxs("span",{style:{color:mt,fontWeight:700,fontSize:14},children:[Ws,"%"]}),e.jsx("span",{style:{fontSize:12},children:"추가하여 목표 설정합니다."})]}):null:null,e.jsx("div",{className:"muted",style:{marginLeft:"auto"},children:cs.loading?"요약 불러오는 중…":cs.error?e.jsx("span",{className:"error",children:cs.error}):e.jsxs(e.Fragment,{children:["수립대상 ",cs.total.toLocaleString(),"개, 확정 ",cs.confirmed.toLocaleString(),"개, 진행 중 ",cs.inprogress.toLocaleString(),"개"]})})]}),tt.open&&e.jsx("div",{role:"dialog","aria-modal":"true",className:"card",style:{position:"fixed",inset:0,background:"transparent",zIndex:60},children:e.jsxs("div",{ref:qs.ref,className:"card",style:{...qs.style,width:720,maxWidth:"92vw",background:"var(--panel)",padding:12,fontSize:12},children:[e.jsx("div",{...qs.bindHeader,style:{position:"absolute",top:0,left:0,right:36,height:32,cursor:"move"},"aria-hidden":"true"}),e.jsx("button",{"aria-label":"닫기",onClick:Bt,className:"btn-plain",style:{position:"absolute",top:8,right:8},children:e.jsx("img",{src:ct,className:"icon",alt:"닫기"})}),e.jsxs("div",{className:"page-title",style:{marginBottom:8,alignItems:"center"},children:[e.jsxs("h2",{style:{margin:0},children:[tt.company," 계획 합계 상세"]}),e.jsxs("div",{className:"controls",style:{gap:8},children:[e.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[e.jsx("input",{type:"radio",name:"totals-group",checked:tt.group==="customer",onChange:()=>{ut(n=>({...n,group:"customer"})),Et(tt.company,"customer")}}),"거래처별"]}),e.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[e.jsx("input",{type:"radio",name:"totals-group",checked:tt.group==="unit",onChange:()=>{ut(n=>({...n,group:"unit"})),Et(tt.company,"unit")}}),"영업관리단위별"]})]})]}),tt.error?e.jsx("div",{className:"error",children:tt.error}):null,e.jsx("div",{className:"table-container",style:{maxHeight:"66vh",overflow:"auto"},children:e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left",width:380},children:tt.group==="customer"?"거래처":"영업관리단위"}),e.jsx("th",{style:{textAlign:"right",width:200},children:"금액(원)"})]})}),e.jsx("tbody",{children:tt.loading?e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"muted",style:{padding:"12px 10px"},children:"불러오는 중…"})}):tt.rows.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"muted",style:{padding:"12px 10px"},children:"데이터가 없습니다"})}):tt.rows.map((n,y)=>{const T=tt.group==="customer"&&n.label||n.key;return e.jsxs("tr",{children:[e.jsx("td",{children:T}),e.jsx("td",{className:"sum-cell",style:{textAlign:"right"},children:pt.format(Math.round(n.amount))})]},y)})})]})})]})}),es?e.jsx("div",{role:"dialog","aria-modal":"true",className:"card",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.35)",zIndex:80,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{className:"card",style:{background:"var(--panel)",padding:12,border:"1px solid var(--border)",borderRadius:10,minWidth:280,maxWidth:"86vw"},children:[e.jsx("div",{style:{marginBottom:8,fontWeight:700,textAlign:"center"},children:es}),e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx("button",{className:"btn btn-card btn-3d",onClick:()=>kt(null),children:"확인"})})]})}):null,e.jsx("div",{className:"c360-tabs",role:"tablist","aria-label":"회사 구분 탭",style:{marginTop:8},children:["TNT","DYS"].map(n=>e.jsx("button",{role:"tab","aria-selected":Wt===n,className:`tab ${Wt===n?"active":""}`,onClick:()=>{Ct(n);try{$(n)}catch{}},children:n},n))}),Wt==="TNT"?e.jsxs(e.Fragment,{children:[W&&e.jsx("div",{className:"error",children:W||Ze.errorGeneric}),e.jsxs("div",{style:{marginTop:12,display:"flex",gap:12,alignItems:"stretch",height:"calc(100vh - 140px)"},children:[e.jsxs("div",{style:{flex:"0 0 17%",maxWidth:"17%",minWidth:240,height:"100%",overflow:"auto"},children:[e.jsx("div",{className:"card",style:{padding:8,marginBottom:8},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("input",{className:"search-input",placeholder:"거래처명",value:g,onChange:n=>M(n.target.value),onKeyDown:n=>{n.key==="Enter"&&rs(!0)},style:{flex:1}}),e.jsx("button",{className:"btn",onClick:()=>rs(!0),disabled:q,style:{flex:"0 0 auto"},children:"조회"})]})}),I?Zs:e.jsx("div",{className:"muted",style:{padding:"12px 10px"},children:"연도를 먼저 선택하세요."})]}),e.jsxs("aside",{className:"card",style:{flex:"1 1 83%",maxWidth:"83%",height:"100%",padding:12,overflow:"auto"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12,gap:16},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,flex:1,minWidth:0},children:fe.map((n,y)=>{const T=y<Se,z=y===Se;return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,minWidth:0,flex:y===fe.length-1?"0 0 auto":"1 1 0"},children:[e.jsx("div",{title:n.label,onClick:()=>ue(n.key),style:{width:22,height:22,borderRadius:999,display:"inline-flex",alignItems:"center",justifyContent:"center",background:T||z?"var(--accent)":"transparent",border:`2px solid ${T||z?"var(--accent)":"var(--border)"}`,color:T||z?"var(--on-accent)":"var(--muted)",cursor:"pointer",flex:"0 0 auto"},"aria-current":z?"step":void 0,children:T?"✓":y+1}),e.jsx("div",{style:{fontSize:12,color:z||T?"var(--text)":"var(--muted)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:n.label}),y<fe.length-1&&e.jsx("div",{style:{height:2,background:y<Se?"var(--accent)":"var(--border)",flex:1,borderRadius:2}})]},n.key)})}),e.jsx("div",{children:e.jsx("button",{className:"btn btn-card btn-3d",onClick:ls,disabled:!(p!=null&&p.customerSeq)||!I,title:"해당 거래처 목표 확정",children:"확정"})})]}),p!=null&&p.customerSeq&&I?e.jsxs("div",{className:"card",style:{marginBottom:12,padding:8},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-end",marginBottom:8,gap:8,flexWrap:"wrap"},children:[e.jsx("button",{className:"btn btn-card btn-3d",style:{fontSize:12,padding:"4px 8px"},onClick:St,children:"일괄비율"}),e.jsx("button",{className:"btn btn-card btn-3d",style:{fontSize:12,padding:"4px 8px"},onClick:Ae,children:"일괄입력"}),e.jsx("button",{className:"btn btn-card btn-3d",style:{fontSize:12,padding:"4px 8px"},onClick:Gs,children:"신규 영업관리단위"})]}),Ge.error?e.jsx("div",{className:"error",children:Ge.error}):e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left",width:220},children:"중분류"}),e.jsx("th",{style:{textAlign:"left",width:220},children:"영업관리단위"}),e.jsx("th",{style:{textAlign:"center",width:120},children:"목표입력"}),e.jsx("th",{className:"sum-head",style:{textAlign:"right",width:140},children:"합계"}),Array.from({length:12},(n,y)=>y+1).map(n=>e.jsxs("th",{style:{textAlign:"right"},children:[String(n).padStart(2,"0"),"월"]},n))]})}),e.jsx("tbody",{children:Ge.rows.length===0?e.jsx("tr",{children:e.jsx("td",{className:"muted",colSpan:16,style:{padding:"12px 10px"},children:Ge.loading?"불러오는 중…":"데이터가 없습니다"})}):Ge.rows.map((n,y)=>{const T=(n.months||[]).reduce((R,A)=>R+(Number.isFinite(A)?Number(A):0),0),z=(n.amounts||[]).reduce((R,A)=>R+(Number.isFinite(A)?Number(A):0),0);return e.jsxs("tr",{children:[e.jsx("td",{children:n.sub}),e.jsxs("td",{children:[e.jsx("span",{children:n.unit}),n.stage?e.jsx("span",{className:"stage-badge",style:{marginLeft:6},title:String(n.stage),children:n.stage}):null]}),e.jsx("td",{style:{textAlign:"center"},children:e.jsx("button",{type:"button",className:"btn btn-card btn-3d",style:{fontSize:12,padding:"4px 8px"},onClick:R=>{R.preventDefault(),R.stopPropagation(),Qt(n.sub,n.unit)},children:"입력"})}),e.jsx("td",{className:"sum-cell",style:{textAlign:"right"},children:Ke(T,0,z)}),n.months.map((R,A)=>{var Z;return e.jsx("td",{style:{textAlign:"right"},children:Ke(R,A,(Z=n.amounts)==null?void 0:Z[A],n.stage==="P"?"#dc2626":void 0,n.stage==="C")},A)})]},y)})}),(()=>{if(!Ge.rows||Ge.rows.length===0)return null;const n=Array.from({length:12},(R,A)=>Ge.rows.reduce((Z,J)=>{var F;return Z+(Number((F=J.months)==null?void 0:F[A])||0)},0)),y=Array.from({length:12},(R,A)=>Ge.rows.reduce((Z,J)=>{var F;return Z+(Number((F=J.amounts)==null?void 0:F[A])||0)},0)),T=n.reduce((R,A)=>R+(Number(A)||0),0),z=y.reduce((R,A)=>R+(Number(A)||0),0);return e.jsx("tfoot",{children:e.jsxs("tr",{className:"sum-row",children:[e.jsx("td",{colSpan:3,style:{textAlign:"center",fontWeight:700},children:"합계"}),e.jsx("td",{className:"sum-cell",style:{textAlign:"right"},children:Ke(T,0,z)}),n.map((R,A)=>e.jsx("td",{className:"sum-cell",style:{textAlign:"right"},children:Ke(R,A,y[A])},A))]})})})()]})})]}):null]})]})]}):e.jsxs(e.Fragment,{children:[W&&e.jsx("div",{className:"error",children:W||Ze.errorGeneric}),e.jsxs("div",{style:{marginTop:12,display:"flex",gap:12,alignItems:"stretch",height:"calc(100vh - 140px)"},children:[e.jsxs("div",{style:{flex:"0 0 17%",maxWidth:"17%",minWidth:240,height:"100%",overflow:"auto"},children:[e.jsx("div",{className:"card",style:{padding:8,marginBottom:8},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("input",{className:"search-input",placeholder:"거래처명",value:g,onChange:n=>M(n.target.value),onKeyDown:n=>{n.key==="Enter"&&rs(!0)},style:{flex:1}}),e.jsx("button",{className:"btn",onClick:()=>rs(!0),disabled:q,style:{flex:"0 0 auto"},children:"조회"})]})}),I?Zs:e.jsx("div",{className:"muted",style:{padding:"12px 10px"},children:"연도를 먼저 선택하세요."})]}),e.jsxs("aside",{className:"card",style:{flex:"1 1 83%",maxWidth:"83%",height:"100%",padding:12,overflow:"auto"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12,gap:16},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,flex:1,minWidth:0},children:fe.map((n,y)=>{const T=y<Se,z=y===Se;return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,minWidth:0,flex:y===fe.length-1?"0 0 auto":"1 1 0"},children:[e.jsx("div",{title:n.label,onClick:()=>ue(n.key),style:{width:22,height:22,borderRadius:999,display:"inline-flex",alignItems:"center",justifyContent:"center",background:T||z?"var(--accent)":"transparent",border:`2px solid ${T||z?"var(--accent)":"var(--border)"}`,color:T||z?"var(--on-accent)":"var(--muted)",cursor:"pointer",flex:"0 0 auto"},"aria-current":z?"step":void 0,children:T?"✓":y+1}),e.jsx("div",{style:{fontSize:12,color:z||T?"var(--text)":"var(--muted)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:n.label}),y<fe.length-1&&e.jsx("div",{style:{height:2,background:y<Se?"var(--accent)":"var(--border)",flex:1,borderRadius:2}})]},n.key)})}),e.jsx("div",{children:e.jsx("button",{className:"btn btn-card btn-3d",onClick:ls,disabled:!(p!=null&&p.customerSeq)||!I,title:"해당 거래처 목표 확정",children:"확정"})})]}),p!=null&&p.customerSeq&&I?e.jsxs("div",{className:"card",style:{marginBottom:12,padding:8},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-end",marginBottom:8,gap:8,flexWrap:"wrap"},children:[e.jsx("button",{className:"btn btn-card btn-3d",style:{fontSize:12,padding:"4px 8px"},onClick:St,children:"일괄비율"}),e.jsx("button",{className:"btn btn-card btn-3d",style:{fontSize:12,padding:"4px 8px"},onClick:Ae,children:"일괄입력"}),e.jsx("button",{className:"btn btn-card btn-3d",style:{fontSize:12,padding:"4px 8px"},onClick:Gs,children:"신규 영업관리단위"})]}),Ge.error?e.jsx("div",{className:"error",children:Ge.error}):e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left",width:220},children:"중분류"}),e.jsx("th",{style:{textAlign:"left",width:220},children:"영업관리단위"}),e.jsx("th",{style:{textAlign:"center",width:120},children:"목표입력"}),e.jsx("th",{className:"sum-head",style:{textAlign:"right",width:140},children:"합계"}),Array.from({length:12},(n,y)=>y+1).map(n=>e.jsxs("th",{style:{textAlign:"right"},children:[String(n).padStart(2,"0"),"월"]},n))]})}),e.jsx("tbody",{children:Ge.rows.length===0?e.jsx("tr",{children:e.jsx("td",{className:"muted",colSpan:16,style:{padding:"12px 10px"},children:Ge.loading?"불러오는 중…":"데이터가 없습니다"})}):Ge.rows.map((n,y)=>{const T=(n.months||[]).reduce((R,A)=>R+(Number.isFinite(A)?Number(A):0),0),z=(n.amounts||[]).reduce((R,A)=>R+(Number.isFinite(A)?Number(A):0),0);return e.jsxs("tr",{children:[e.jsx("td",{children:n.sub}),e.jsxs("td",{children:[e.jsx("span",{children:n.unit}),n.stage?e.jsx("span",{className:"badge stage-badge",style:{marginLeft:6},children:n.stage}):null]}),e.jsx("td",{style:{textAlign:"center"},children:e.jsx("button",{type:"button",className:"btn btn-card btn-3d",style:{fontSize:12,padding:"4px 8px"},onClick:R=>{R.preventDefault(),R.stopPropagation(),Qt(n.sub,n.unit)},children:"입력"})}),e.jsx("td",{className:"sum-cell",style:{textAlign:"right"},children:Ke(T,0,z)}),n.months.map((R,A)=>{var Z;return e.jsx("td",{style:{textAlign:"right"},children:Ke(R,A,(Z=n.amounts)==null?void 0:Z[A],n.stage==="P"?"#dc2626":void 0,n.stage==="C")},A)})]},y)})}),(()=>{if(!Ge.rows||Ge.rows.length===0)return null;const n=Array.from({length:12},(R,A)=>Ge.rows.reduce((Z,J)=>{var F;return Z+(Number((F=J.months)==null?void 0:F[A])||0)},0)),y=Array.from({length:12},(R,A)=>Ge.rows.reduce((Z,J)=>{var F;return Z+(Number((F=J.amounts)==null?void 0:F[A])||0)},0)),T=n.reduce((R,A)=>R+(Number(A)||0),0),z=y.reduce((R,A)=>R+(Number(A)||0),0);return e.jsx("tfoot",{children:e.jsxs("tr",{className:"sum-row",children:[e.jsx("td",{colSpan:3,style:{textAlign:"center",fontWeight:700},children:"합계"}),e.jsx("td",{className:"sum-cell",style:{textAlign:"right"},children:Ke(T,0,z)}),n.map((R,A)=>e.jsx("td",{className:"sum-cell",style:{textAlign:"right"},children:Ke(R,A,y[A])},A))]})})})()]})})]}):null,p!=null&&p.customerSeq&&I?e.jsxs("div",{className:"card",style:{marginBottom:12,padding:8},children:[e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:8},children:[e.jsx("div",{className:"muted",style:{fontWeight:700,lineHeight:"28px",fontSize:14},children:"목표수립의견"}),e.jsx("textarea",{className:"search-input",value:Nt.val,onChange:n=>vt(y=>({...y,val:n.target.value})),placeholder:"목표수립에 대한 의견을 입력하세요",rows:6,style:{flex:1,resize:"vertical",height:80,minHeight:80,fontSize:12}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-end",gap:8,marginTop:8},children:[Nt.loading?e.jsx("span",{className:"muted",style:{fontSize:12},children:"(읽는 중…)"}):null,Nt.error?e.jsx("span",{className:"error",style:{fontSize:12},children:Nt.error}):null,Nt.success?e.jsx("span",{style:{fontSize:12,color:"var(--accent)",fontWeight:700},children:Nt.success}):null,e.jsx("button",{className:"btn btn-card btn-3d",onClick:is,disabled:Nt.saving,children:Nt.saving?"저장중…":"저장"})]})]}):null]})]})]}),B.open&&e.jsx("div",{role:"dialog","aria-modal":"true",className:"card",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.35)",zIndex:50},children:e.jsxs("div",{ref:bt.ref,className:"card compact",style:{...bt.style,position:"relative",width:900,maxWidth:"92vw",background:"var(--panel)",padding:12},children:[e.jsx("div",{...bt.bindHeader,style:{position:"absolute",top:0,left:0,right:36,height:32,cursor:"move"},"aria-hidden":"true"}),e.jsx("button",{"aria-label":"닫기",onClick:Xt,className:"btn-plain",style:{position:"absolute",top:8,right:8},children:e.jsx("img",{src:ct,className:"icon",alt:"닫기"})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"120px 1.6fr 120px 1fr",gap:8,alignItems:"center"},children:[e.jsx("div",{className:"muted form-label",children:"영업관리단위"}),e.jsx("div",{children:B.unit||""}),e.jsx("div",{className:"muted form-label",children:"중분류"}),e.jsx("div",{children:B.sub||""}),e.jsx("div",{className:"muted form-label",children:"매출 수량"}),e.jsx("div",{style:{gridColumn:"2 / 5"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,flexWrap:"nowrap",minWidth:0},children:[e.jsx("input",{className:"assign-input",type:"number",min:0,step:1,placeholder:"0",value:B.qty||"",onChange:n=>ks(B.month,n.target.value)}),(()=>{const n=Oe(),y=(B.unit||"").trim(),T=We(y),z=he[n]||{},R=Number(z[T]||0),A=Ve(),Z=(ie==null?void 0:ie[A])||{},J=Number(Z[T]||0),F=Number.isFinite(R)&&R>0?pt.format(Math.round(R)):"-",le=Number.isFinite(J)&&J>0?pt.format(Math.round(J)):"-",ce=Number.isFinite(R)&&Number.isFinite(J)?R>=J?mt:"#dc2626":mt;return e.jsxs("span",{className:"muted",style:{fontSize:12,whiteSpace:"nowrap"},children:[e.jsxs("span",{style:{color:ce,fontWeight:700},children:["내단가 ",F," 원"]})," | 전체단가 ",le," 원/단위"]})})()]})}),e.jsx("div",{className:"muted form-label",children:"매출월"}),e.jsx("div",{children:e.jsxs("select",{className:"search-input",value:B.month||"",onChange:n=>ks(n.target.value,B.qty),children:[e.jsx("option",{value:"",disabled:!0,children:"선택"}),Array.from({length:12},(n,y)=>y+1).map(n=>e.jsxs("option",{value:String(n),children:[n,"월"]},n))]})})]}),e.jsxs("div",{style:{marginTop:12},children:[e.jsx("div",{className:"pane-header",style:{margin:0},children:"현재 목표"}),e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"sum-head",style:{textAlign:"right",width:120},children:"합계"}),Array.from({length:12},(n,y)=>y+1).map(n=>e.jsxs("th",{style:{textAlign:"right"},children:[String(n).padStart(2,"0"),"월"]},n))]})}),e.jsx("tbody",{children:e.jsx("tr",{children:(()=>{const n=(B.curMonths||[]).reduce((T,z)=>T+(Number.isFinite(z)?Number(z):0),0),y=(B.curAmounts||[]).reduce((T,z)=>T+(Number.isFinite(z)?Number(z):0),0);return e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"sum-cell",style:{textAlign:"right"},children:Ke(n,0,y)}),B.curMonths.map((T,z)=>{var R;return e.jsx("td",{children:Ke(T,z,(R=B.curAmounts)==null?void 0:R[z],B.stage==="P"?"#dc2626":void 0,B.stage==="C")},z)})]})})()})})]})})]}),e.jsxs("div",{style:{marginTop:12},children:[e.jsx("div",{className:"pane-header",style:{margin:0},children:"분배 미리보기"}),e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"sum-head",style:{textAlign:"right",width:120},children:"합계"}),Array.from({length:12},(n,y)=>y+1).map(n=>e.jsxs("th",{style:{textAlign:"right"},children:[String(n).padStart(2,"0"),"월"]},n))]})}),e.jsx("tbody",{children:e.jsx("tr",{children:(()=>{const n=Oe();he[n];const y=(B.unit||"").trim(),T=Be(y),z=Number.isFinite(T)?Number(T):0,R=(B.dist||[]).reduce((J,F)=>J+(Number.isFinite(F)?Number(F):0),0),A=Number.isFinite(z)?Math.round(z):0,Z=(B.dist||[]).reduce((J,F)=>J+(Number.isFinite(F)&&A>0?Number(F)*A:0),0);return e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"sum-cell",style:{textAlign:"right"},children:Ke(R,0,Z)}),B.dist.map((J,F)=>{const le=Number.isFinite(z)?Math.round(z):0,ce=Number.isFinite(J)&&le>0?Number(J)*le:void 0;return e.jsx("td",{children:Ke(J,F,ce,B.stage==="P"?"#dc2626":void 0,B.stage==="C")},F)})]})})()})})]})})]}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:8,gap:8},children:e.jsx("button",{className:"btn btn-card btn-3d",onClick:Cs,children:"목표등록"})}),B.success?e.jsx("div",{role:"dialog","aria-modal":"true",className:"card",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.45)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:70},children:e.jsxs("div",{className:"card",style:{background:"var(--panel)",padding:12,border:"1px solid var(--border)",borderRadius:10,minWidth:260,maxWidth:"86vw"},children:[e.jsx("div",{style:{marginBottom:8,fontWeight:700,textAlign:"center"},children:B.success}),e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx("button",{className:"btn btn-card btn-3d",onClick:k,children:"확인"})})]})}):null]})}),ae.open&&e.jsx("div",{role:"dialog","aria-modal":"true",className:"card",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.35)",zIndex:50},children:e.jsxs("div",{ref:He.ref,className:"card compact",style:{...He.style,width:"92vw",maxWidth:1100,background:"var(--panel)",padding:12},children:[e.jsx("div",{...He.bindHeader,style:{position:"absolute",top:0,left:0,right:36,height:32,cursor:"move"},"aria-hidden":"true"}),e.jsx("button",{"aria-label":"닫기",onClick:$e,className:"btn-plain",style:{position:"absolute",top:8,right:8},children:e.jsx("img",{src:ct,className:"icon",alt:"닫기"})}),e.jsx("div",{className:"page-title",style:{marginBottom:8},children:e.jsx("h2",{style:{margin:0},children:"목표 일괄입력"})}),e.jsx("div",{className:"table-container",style:{maxHeight:"70vh",overflow:"auto",position:"relative"},children:e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:200,textAlign:"left"},children:"중분류"}),e.jsx("th",{style:{width:220,textAlign:"left"},children:"영업관리단위"}),e.jsx("th",{style:{width:68,textAlign:"center"},children:"구분"}),e.jsx("th",{style:{width:160,textAlign:"left"},children:"내 평균단가"}),e.jsx("th",{className:"sum-head",style:{textAlign:"right",width:120},children:"합계"}),Array.from({length:12},(n,y)=>y+1).map(n=>e.jsxs("th",{style:{textAlign:"right"},children:[String(n).padStart(2,"0"),"월"]},n))]})}),e.jsx("tbody",{children:ae.rows.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:19,className:"muted",style:{padding:"12px 10px"},children:"데이터가 없습니다"})}):ae.rows.map((n,y)=>{const T=Oe();he[T];const z=Be((n.unit||"").trim()),R=Number.isFinite(z)?Number(z):0,A=Number(n.month||0),Z=Number(n.qty||0),J=new Array(12).fill(0);if(Number.isFinite(A)&&A>=1&&A<=12&&Number.isFinite(Z)&&Z>0){const ve=12-A+1,Le=Z/ve;for(let Me=A-1;Me<12;Me++)J[Me]=Le}const F=J,le=(n.curMonths||[]).reduce((ve,Le)=>ve+(Number.isFinite(Le)?Number(Le):0),0),ce=(n.curAmounts||[]).reduce((ve,Le)=>ve+(Number.isFinite(Le)?Number(Le):0),0),oe=J.reduce((ve,Le)=>ve+(Number.isFinite(Le)?Number(Le):0),0),ke=J.reduce((ve,Le)=>ve+(Number.isFinite(Le)&&Number.isFinite(R)?Number(Le)*R:0),0);return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("span",{style:{fontSize:12},children:n.sub})}),e.jsxs("td",{children:[e.jsx("span",{style:{fontSize:12},children:n.unit}),n.stage?e.jsx("span",{className:"stage-badge",style:{marginLeft:6},title:String(n.stage),children:String(n.stage)}):null]}),e.jsx("td",{style:{textAlign:"center"},className:"muted",children:"현재"}),e.jsx("td",{className:"muted",children:"-"}),e.jsx("td",{className:"muted",children:"-"}),e.jsx("td",{className:"sum-cell",style:{textAlign:"right"},children:Ke(le,0,ce)}),n.curMonths.map((ve,Le)=>{var Me;return e.jsx("td",{children:Ke(ve,Le,(Me=n.curAmounts)==null?void 0:Me[Le],n.stage==="P"?"#dc2626":void 0,n.stage==="C")},Le)})]},n.key+":cur"),e.jsxs("tr",{style:{background:"var(--panel-2)"},children:[e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{style:{textAlign:"center"},className:"sum-head",children:"적용"}),e.jsx("td",{children:e.jsxs("select",{className:"search-input",value:n.month||"",onChange:ve=>we(y,ve.target.value,void 0),children:[e.jsx("option",{value:"",disabled:!0,children:"선택"}),Array.from({length:12},(ve,Le)=>Le+1).map(ve=>e.jsxs("option",{value:String(ve),children:[ve,"월"]},ve))]})}),e.jsx("td",{children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("input",{className:"assign-input",type:"number",min:0,step:1,placeholder:"0",value:n.qty||"",onChange:ve=>we(y,void 0,ve.target.value)}),(()=>{var sn;const ve=Oe(),Me=(((sn=(be[ve]||{})[(n.unit||"").trim()])==null?void 0:sn.itemStdUnit)||"").trim(),Fe=We(n.unit||""),ot=he[ve]||{},Qe=Number(ot[Fe]||0),Dt=Ve(),Mt=(ie==null?void 0:ie[Dt])||{},Pt=Number(Mt[Fe]||0),Yt=Number.isFinite(Qe)&&Qe>0?pt.format(Math.round(Qe)):"-",Fs=Number.isFinite(Pt)&&Pt>0?pt.format(Math.round(Pt)):"-",Fn=Number.isFinite(Qe)&&Number.isFinite(Pt)?Qe>=Pt?mt:"#dc2626":mt;return e.jsxs("span",{className:"muted",style:{fontSize:12},children:[e.jsxs("span",{style:{color:Fn,fontWeight:700},children:["내단가 ",Yt," 원"]})," | 전체단가 ",Fs," 원/",Me||"단위"]})})()]})}),e.jsx("td",{className:"sum-cell",style:{textAlign:"right"},children:Ke(oe,0,ke)}),F.map((ve,Le)=>{const Me=Number.isFinite(R)?Math.round(R):0,Fe=Number.isFinite(ve)&&Me>0?Number(ve)*Me:void 0;return e.jsx("td",{children:Ke(ve,Le,Fe,n.stage==="P"?"#dc2626":void 0,n.stage==="C")},Le)})]},n.key+":prev")]})})}),(()=>{if(!ae.rows||ae.rows.length===0)return null;const n=Oe();he[n];const y=Array.from({length:12},(le,ce)=>ae.rows.reduce((oe,ke)=>{var ve;return oe+(Number((ve=ke.curMonths)==null?void 0:ve[ce])||0)},0)),T=Array.from({length:12},(le,ce)=>ae.rows.reduce((oe,ke)=>{var ve;return oe+(Number((ve=ke.curAmounts)==null?void 0:ve[ce])||0)},0)),z=y.reduce((le,ce)=>le+(Number(ce)||0),0),R=T.reduce((le,ce)=>le+(Number(ce)||0),0),A=Array.from({length:12},(le,ce)=>ae.rows.reduce((oe,ke)=>{var ve;return oe+(Number((ve=ke.dist)==null?void 0:ve[ce])||0)},0)),Z=Array.from({length:12},(le,ce)=>ae.rows.reduce((oe,ke)=>{var Fe;const ve=Be((ke.unit||"").trim()),Le=Number.isFinite(ve)?Math.round(Number(ve)):0,Me=Number(((Fe=ke.dist)==null?void 0:Fe[ce])||0);return oe+(Number.isFinite(Me)&&Le>0?Me*Le:0)},0)),J=A.reduce((le,ce)=>le+(Number(ce)||0),0),F=Z.reduce((le,ce)=>le+(Number(ce)||0),0);return e.jsxs("tfoot",{children:[e.jsxs("tr",{className:"sum-row-current",children:[e.jsx("td",{colSpan:5,style:{textAlign:"center",fontWeight:700},children:"[현재] 합계"}),e.jsx("td",{className:"sum-cell",style:{textAlign:"right"},children:Ke(z,0,R)}),y.map((le,ce)=>e.jsx("td",{className:"sum-cell",style:{textAlign:"right"},children:Ke(le,ce,T[ce])},ce))]}),e.jsxs("tr",{className:"sum-row-apply",style:{background:"var(--panel-2)"},children:[e.jsx("td",{colSpan:5,style:{textAlign:"center",fontWeight:700},children:"[적용] 합계"}),e.jsx("td",{className:"sum-cell",style:{textAlign:"right"},children:Ke(J,0,F)}),A.map((le,ce)=>e.jsx("td",{className:"sum-cell",style:{textAlign:"right"},children:Ke(le,ce,Z[ce])},ce))]})]})})()]})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:8,gap:8},children:e.jsx("button",{className:"btn btn-card btn-3d",onClick:Ie,children:"목표등록"})}),ae.success?e.jsx("div",{role:"dialog","aria-modal":"true",className:"card",style:{position:"absolute",inset:0,background:"rgba(0,0,0,.45)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:80},children:e.jsxs("div",{className:"card",style:{background:"var(--panel)",padding:12,border:"1px solid var(--border)",borderRadius:10,minWidth:260,maxWidth:"86vw"},children:[e.jsx("div",{style:{marginBottom:8,fontWeight:700,textAlign:"center"},children:ae.success}),e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx("button",{className:"btn btn-card btn-3d",onClick:k,children:"확인"})})]})}):null]})}),rt.open&&e.jsx("div",{role:"dialog","aria-modal":"true",className:"card",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.35)",zIndex:50},children:e.jsxs("div",{ref:fs.ref,className:"card compact",style:{...fs.style,width:"92vw",maxWidth:1100,background:"var(--panel)",padding:12},children:[e.jsx("div",{...fs.bindHeader,style:{position:"absolute",top:0,left:0,right:36,height:32,cursor:"move"},"aria-hidden":"true"}),e.jsx("button",{"aria-label":"닫기",onClick:Gt,className:"btn-plain",style:{position:"absolute",top:8,right:8},children:e.jsx("img",{src:ct,className:"icon",alt:"닫기"})}),e.jsxs("div",{className:"page-title",style:{marginBottom:8,alignItems:"center"},children:[e.jsx("h2",{style:{margin:0},children:"목표 일괄비율"}),e.jsxs("div",{className:"controls",style:{gap:8},children:[e.jsx("span",{className:"muted",children:"적용 비율(%)"}),e.jsx("input",{className:"assign-input",type:"number",min:0,max:100,step:1,placeholder:"0",value:ys,onChange:n=>As(n.target.value),style:{width:100},"aria-label":"일괄 비율 입력"}),e.jsx("button",{className:"btn btn-card btn-3d",onClick:zt,children:"적용"})]})]}),e.jsx("div",{className:"table-container",style:{maxHeight:"70vh",overflow:"auto"},children:e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:200,textAlign:"left"},children:"중분류"}),e.jsx("th",{style:{width:220,textAlign:"left"},children:"영업관리단위"}),e.jsx("th",{style:{width:68,textAlign:"center"},children:"구분"}),e.jsx("th",{style:{width:160,textAlign:"left"},children:"내 평균단가"}),e.jsx("th",{className:"sum-head",style:{textAlign:"right",width:120},children:"합계"}),Array.from({length:12},(n,y)=>y+1).map(n=>e.jsxs("th",{style:{textAlign:"right"},children:[String(n).padStart(2,"0"),"월"]},n))]})}),e.jsx("tbody",{children:rt.rows.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:19,className:"muted",style:{padding:"12px 10px"},children:"데이터가 없습니다"})}):rt.rows.map((n,y)=>{const T=Oe();he[T];const z=Be((n.unit||"").trim()),R=Number.isFinite(z)?Number(z):0,A=Array.isArray(n.dist)?n.dist.slice():new Array(12).fill(0),Z=(n.curMonths||[]).reduce((ce,oe)=>ce+(Number.isFinite(oe)?Number(oe):0),0),J=(n.curAmounts||[]).reduce((ce,oe)=>ce+(Number.isFinite(oe)?Number(oe):0),0),F=A.reduce((ce,oe)=>ce+(Number.isFinite(oe)?Number(oe):0),0),le=A.reduce((ce,oe)=>ce+(Number.isFinite(oe)&&Number.isFinite(R)?Number(oe)*R:0),0);return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("span",{style:{fontSize:12},children:n.sub})}),e.jsxs("td",{children:[e.jsx("span",{style:{fontSize:12},children:n.unit}),n.stage?e.jsx("span",{className:"stage-badge",style:{marginLeft:6},title:String(n.stage),children:String(n.stage)}):null]}),e.jsx("td",{style:{textAlign:"center"},className:"muted",children:"현재"}),e.jsx("td",{className:"muted",style:{textAlign:"left"},children:(()=>{var Yt;const ce=Oe(),ke=(((Yt=(be[ce]||{})[(n.unit||"").trim()])==null?void 0:Yt.itemStdUnit)||"").trim(),ve=We(n.unit||""),Le=he[ce]||{},Me=Number(Le[ve]||0),Fe=Ve(),ot=(ie==null?void 0:ie[Fe])||{},Qe=Number(ot[ve]||0),Dt=Number.isFinite(Me)&&Me>0?pt.format(Math.round(Me)):"-",Mt=Number.isFinite(Qe)&&Qe>0?pt.format(Math.round(Qe)):"-",Pt=Number.isFinite(Me)&&Number.isFinite(Qe)?Me>=Qe?mt:"#dc2626":mt;return e.jsxs("span",{children:[e.jsxs("span",{style:{color:Pt,fontWeight:700},children:["내단가 ",Dt," 원"]})," | 전체단가 ",Mt," 원/",ke||"단위"]})})()}),e.jsx("td",{className:"sum-cell",style:{textAlign:"right"},children:Ke(Z,0,J)}),n.curMonths.map((ce,oe)=>{var ke;return e.jsx("td",{children:Ke(ce,oe,(ke=n.curAmounts)==null?void 0:ke[oe],n.stage==="P"?"#dc2626":void 0,n.stage==="C")},oe)})]},n.key+":cur"),e.jsxs("tr",{style:{background:"var(--panel-2)"},children:[e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{style:{textAlign:"center"},className:"sum-head",children:"적용"}),e.jsx("td",{className:"muted",style:{textAlign:"left"},children:(()=>{var Yt;const ce=Oe(),ke=(((Yt=(be[ce]||{})[(n.unit||"").trim()])==null?void 0:Yt.itemStdUnit)||"").trim(),ve=We(n.unit||""),Le=he[ce]||{},Me=Number(Le[ve]||0),Fe=Ve(),ot=(ie==null?void 0:ie[Fe])||{},Qe=Number(ot[ve]||0),Dt=Number.isFinite(Me)&&Me>0?pt.format(Math.round(Me)):"-",Mt=Number.isFinite(Qe)&&Qe>0?pt.format(Math.round(Qe)):"-",Pt=Number.isFinite(Me)&&Number.isFinite(Qe)?Me>=Qe?mt:"#dc2626":mt;return e.jsxs("span",{children:[e.jsxs("span",{style:{color:Pt,fontWeight:700},children:["내단가 ",Dt," 원"]})," | 전체단가 ",Mt," 원/",ke||"단위"]})})()}),e.jsx("td",{className:"sum-cell",style:{textAlign:"right"},children:Ke(F,0,le)}),A.map((ce,oe)=>{const ke=Number.isFinite(R)?Math.round(R):0,ve=Number.isFinite(ce)&&ke>0?Number(ce)*ke:void 0;return e.jsx("td",{children:Ke(ce,oe,ve,n.stage==="P"?"#dc2626":void 0,n.stage==="C")},oe)})]},n.key+":prev")]})})}),(()=>{if(!rt.rows||rt.rows.length===0)return null;const n=Oe();he[n];const y=Array.from({length:12},(le,ce)=>rt.rows.reduce((oe,ke)=>{var ve;return oe+(Number((ve=ke.curMonths)==null?void 0:ve[ce])||0)},0)),T=Array.from({length:12},(le,ce)=>rt.rows.reduce((oe,ke)=>{var ve;return oe+(Number((ve=ke.curAmounts)==null?void 0:ve[ce])||0)},0)),z=y.reduce((le,ce)=>le+(Number(ce)||0),0),R=T.reduce((le,ce)=>le+(Number(ce)||0),0),A=Array.from({length:12},(le,ce)=>rt.rows.reduce((oe,ke)=>{var ve;return oe+(Number((ve=ke.dist)==null?void 0:ve[ce])||0)},0)),Z=Array.from({length:12},(le,ce)=>rt.rows.reduce((oe,ke)=>{var Fe;const ve=Be((ke.unit||"").trim()),Le=Number.isFinite(ve)?Math.round(Number(ve)):0,Me=Number(((Fe=ke.dist)==null?void 0:Fe[ce])||0);return oe+(Number.isFinite(Me)&&Le>0?Me*Le:0)},0)),J=A.reduce((le,ce)=>le+(Number(ce)||0),0),F=Z.reduce((le,ce)=>le+(Number(ce)||0),0);return e.jsxs("tfoot",{children:[e.jsxs("tr",{className:"sum-row-current",children:[e.jsx("td",{colSpan:4,style:{textAlign:"center",fontWeight:700},children:"[현재] 합계"}),e.jsx("td",{className:"sum-cell",style:{textAlign:"right"},children:Ke(z,0,R)}),y.map((le,ce)=>e.jsx("td",{className:"sum-cell",style:{textAlign:"right"},children:Ke(le,ce,T[ce])},ce))]}),e.jsxs("tr",{className:"sum-row-apply",style:{background:"var(--panel-2)"},children:[e.jsx("td",{colSpan:4,style:{textAlign:"center",fontWeight:700},children:"[적용] 합계"}),e.jsx("td",{className:"sum-cell",style:{textAlign:"right"},children:Ke(J,0,F)}),A.map((le,ce)=>e.jsx("td",{className:"sum-cell",style:{textAlign:"right"},children:Ke(le,ce,Z[ce])},ce))]})]})})()]})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:8,gap:8},children:e.jsx("button",{className:"btn btn-card btn-3d",onClick:Rs,children:"목표등록"})}),rt.success?e.jsx("div",{role:"dialog","aria-modal":"true",className:"card",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.45)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:70},children:e.jsxs("div",{className:"card",style:{background:"var(--panel)",padding:12,border:"1px solid var(--border)",borderRadius:10,minWidth:260,maxWidth:"86vw"},children:[e.jsx("div",{style:{marginBottom:8,fontWeight:700,textAlign:"center"},children:rt.success}),e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx("button",{className:"btn btn-card btn-3d",onClick:k,children:"확인"})})]})}):null]})}),Ye.open&&e.jsx("div",{role:"dialog","aria-modal":"true",className:"card",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.35)",zIndex:50},children:e.jsxs("div",{ref:xs.ref,className:"card",style:{...xs.style,width:984,maxWidth:"92vw",background:"var(--panel)",padding:12},children:[e.jsx("div",{...xs.bindHeader,style:{position:"absolute",top:0,left:0,right:36,height:32,cursor:"move"},"aria-hidden":"true"}),e.jsx("button",{"aria-label":"닫기",onClick:Is,className:"btn-plain",style:{position:"absolute",top:8,right:8},children:e.jsx("img",{src:ct,className:"icon",alt:"닫기"})}),e.jsx("div",{className:"page-title",style:{marginBottom:8},children:e.jsx("h2",{style:{margin:0},children:"신규 영업관리단위"})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"120px 1fr 120px 1fr",gap:8,alignItems:"center",fontSize:12},children:[e.jsx("div",{className:"muted",children:"영업관리단위"}),e.jsx("div",{children:e.jsxs("select",{className:"search-input",value:Ye.unit||"",onChange:n=>Dn(n.target.value),children:[e.jsx("option",{value:"",disabled:!0,children:"선택"}),Ye.opts.map((n,y)=>e.jsx("option",{value:n.salesMgmtUnit,children:n.salesMgmtUnit},y))]})}),e.jsx("div",{className:"muted",children:"중분류"}),e.jsx("div",{children:e.jsx("input",{className:"assign-input",value:Ye.sub||"",readOnly:!0,placeholder:"자동"})}),e.jsx("div",{className:"muted",children:"매출월"}),e.jsx("div",{children:e.jsxs("select",{className:"search-input",value:Ye.month||"",onChange:n=>Vs(n.target.value,void 0),children:[e.jsx("option",{value:"",disabled:!0,children:"선택"}),Array.from({length:12},(n,y)=>y+1).map(n=>e.jsxs("option",{value:String(n),children:[n,"월"]},n))]})}),e.jsx("div",{className:"muted",children:"매출 수량"}),e.jsx("div",{children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("input",{className:"assign-input",type:"number",min:0,step:1,placeholder:"0",value:Ye.qty||"",onChange:n=>Vs(void 0,n.target.value)}),(()=>{var ve;const n=Oe(),y=he[n]||{},T=be[n]||{},z=(Ye.unit||"").trim(),R=We(z),A=Number((y==null?void 0:y[R])||0),Z=Ve(),J=(ie==null?void 0:ie[Z])||{},F=Number(J[R]||0),le=(((ve=T[z])==null?void 0:ve.itemStdUnit)||"").trim(),ce=Number.isFinite(A)&&A>0?pt.format(Math.round(A)):"-",oe=Number.isFinite(F)&&F>0?pt.format(Math.round(F)):"-",ke=Number.isFinite(A)&&Number.isFinite(F)?A>=F?mt:"#dc2626":mt;return e.jsxs("span",{className:"muted",style:{fontSize:12,whiteSpace:"nowrap"},children:[e.jsxs("span",{style:{color:ke,fontWeight:700},children:["내단가 ",ce," 원"]})," | 전체단가 ",oe," 원/",le||"단위"]})})()]})})]}),e.jsx("div",{style:{marginTop:12},children:e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{children:Array.from({length:12},(n,y)=>y+1).map(n=>e.jsxs("th",{style:{textAlign:"right"},children:[String(n).padStart(2,"0"),"월"]},n))})}),e.jsx("tbody",{children:e.jsx("tr",{children:Ye.dist.map((n,y)=>{const T=Oe();he[T];const z=Be((Ye.unit||"").trim()),R=Number.isFinite(z)?Number(z):0,A=Number.isFinite(R)?Math.round(R):0,Z=Number.isFinite(n)&&A>0?Number(n)*A:void 0;return e.jsx("td",{children:Ke(n,y,Z)},y)})})})]})})}),e.jsxs("div",{style:{marginTop:12},children:[e.jsx("div",{className:"pane-header",style:{margin:0},children:"추가된 영업관리단위"}),e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:200,textAlign:"left"},children:"중분류"}),e.jsx("th",{style:{width:220,textAlign:"left"},children:"영업관리단위"}),Array.from({length:12},(n,y)=>y+1).map(n=>e.jsxs("th",{style:{textAlign:"right"},children:[String(n).padStart(2,"0"),"월"]},n))]})}),e.jsx("tbody",{children:Ye.rows.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:14,className:"muted",style:{padding:"12px 10px"},children:"추가된 영업관리단위가 없습니다"})}):Ye.rows.map((n,y)=>e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("button",{className:"btn-plain","aria-label":"삭제",title:"삭제",onClick:()=>It(T=>({...T,rows:T.rows.filter((z,R)=>R!==y)})),style:{marginRight:6,verticalAlign:"middle"},children:e.jsx("img",{src:ct,className:"icon",alt:"삭제"})}),n.sub]}),e.jsx("td",{children:n.unit}),n.months.map((T,z)=>{const R=Oe();he[R];const A=Be((n.unit||"").trim()),Z=Number.isFinite(A)?Number(A):0,J=Number.isFinite(Z)?Math.round(Z):0,F=Number.isFinite(T)&&J>0?Number(T)*J:void 0;return e.jsx("td",{children:Ke(T,z,F)},z)})]},y))})]})})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:8,gap:8},children:[e.jsx("button",{className:"btn btn-card btn-3d",onClick:Mn,children:"추가"}),e.jsx("button",{className:"btn btn-card btn-3d",onClick:_n,children:"목표등록"})]}),Ye.error?e.jsx("div",{role:"dialog","aria-modal":"true",className:"card",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.45)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:70},children:e.jsxs("div",{className:"card",style:{background:"var(--panel)",padding:12,border:"1px solid var(--border)",borderRadius:10,minWidth:260,maxWidth:"86vw"},children:[e.jsx("div",{style:{marginBottom:8,fontWeight:700,textAlign:"center"},children:Ye.error}),e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx("button",{className:"btn btn-card btn-3d",onClick:()=>It(n=>({...n,error:null})),children:"확인"})})]})}):null,Ye.success?e.jsx("div",{role:"dialog","aria-modal":"true",className:"card",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.45)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:70},children:e.jsxs("div",{className:"card",style:{background:"var(--panel)",padding:12,border:"1px solid var(--border)",borderRadius:10,minWidth:260,maxWidth:"86vw"},children:[e.jsx("div",{style:{marginBottom:8,fontWeight:700,textAlign:"center"},children:Ye.success}),e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx("button",{className:"btn btn-card btn-3d",onClick:k,children:"확인"})})]})}):null]})}),Lt.open&&e.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:60},children:e.jsxs("div",{ref:zs.ref,className:"card",style:{...zs.style,height:"66vh",width:760,maxWidth:"96vw",background:"var(--panel)",padding:12,borderLeft:"1px solid var(--border)",boxShadow:"-8px 0 24px rgba(0,0,0,0.18)",overflow:"hidden"},children:[e.jsx("div",{...zs.bindHeader,style:{position:"absolute",top:0,left:0,right:36,height:32,cursor:"move"},"aria-hidden":"true"}),e.jsx("button",{"aria-label":"닫기",onClick:tn,className:"btn-plain",style:{position:"absolute",top:8,right:8},children:e.jsx("img",{src:ct,className:"icon",alt:"닫기"})}),e.jsxs("div",{className:"page-title",style:{marginBottom:8,display:"flex",alignItems:"center"},children:[e.jsx("h2",{style:{margin:0,display:"flex",alignItems:"center",gap:6,fontSize:14},children:Vt?e.jsxs(e.Fragment,{children:[e.jsxs("span",{style:{color:mt,fontWeight:700,fontSize:14},children:[Vt,"년"]}),e.jsx("span",{style:{fontSize:12},children:"내 평균거래 단가"})]}):e.jsx("span",{style:{fontSize:12},children:"내 평균거래 단가"})}),e.jsxs("div",{style:{marginLeft:"auto",display:"inline-flex",alignItems:"center",gap:8,flexWrap:"nowrap"},children:[e.jsx("select",{className:"search-input",value:Vt,onChange:n=>en(Number(n.target.value)),"aria-label":"평균단가 조회 연도",style:{height:28},children:[2025,2026,2027,2028,2029,2030].map(n=>e.jsxs("option",{value:n,children:[n,"년"]},n))}),e.jsxs("div",{role:"radiogroup","aria-label":"회사 구분",className:"segmented",style:{display:"inline-flex",alignItems:"center",gap:8,height:28,border:"1px solid var(--border)",borderRadius:6,padding:"0 6px"},children:[e.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:6,fontSize:12,height:"100%"},children:[e.jsx("input",{type:"radio",name:"unit-company",value:"TNT",checked:js==="TNT",onChange:()=>Os("TNT")}),e.jsx("span",{style:{fontSize:12},children:"TNT"})]}),e.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:6,fontSize:12,height:"100%"},children:[e.jsx("input",{type:"radio",name:"unit-company",value:"DYS",checked:js==="DYS",onChange:()=>Os("DYS")}),e.jsx("span",{style:{fontSize:12},children:"DYS"})]})]})]})]}),Lt.error?e.jsx("div",{className:"error",style:{maxWidth:420},children:Lt.error}):e.jsx("div",{className:"table-container",style:{height:"calc(66vh - 120px)",overflow:"auto"},children:e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:180,textAlign:"left"},children:"영업관리단위"}),e.jsx("th",{style:{width:120,textAlign:"left"},children:"판매단위"}),e.jsx("th",{style:{width:120,textAlign:"left"},children:"표준단위"}),e.jsx("th",{style:{width:120,textAlign:"right"},children:"내평균단가(원)"}),e.jsx("th",{style:{width:120,textAlign:"right"},children:"전체단가(원)"})]})}),e.jsx("tbody",{children:Lt.loading?e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"muted",style:{padding:"12px 10px"},children:"불러오는 중…"})}):Lt.rows.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"muted",style:{padding:"12px 10px"},children:"데이터가 없습니다"})}):Lt.rows.map((n,y)=>e.jsxs("tr",{children:[e.jsx("td",{children:n.unit||"na"}),e.jsx("td",{children:n.itemUnit||"-"}),e.jsx("td",{children:n.itemStdUnit||"-"}),(()=>{const T=Number(n.amountMy||0),z=Number(n.amountGlobal||0),R=Number.isFinite(T)&&Number.isFinite(z)?T>=z?mt:"#dc2626":mt;return e.jsx("td",{style:{textAlign:"right",color:R,fontWeight:700},children:Number.isFinite(T)&&T>0?`${pt.format(Math.round(T))} 원`:"-"})})(),e.jsx("td",{style:{textAlign:"right"},children:Number.isFinite(Number(n.amountGlobal))&&Number(n.amountGlobal)>0?`${pt.format(Math.round(Number(n.amountGlobal)))} 원`:"-"})]},y))})]})})]})}),it&&e.jsx("div",{role:"alert","aria-live":"assertive","aria-busy":"true",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.45)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:100},children:e.jsxs("div",{className:"card",style:{padding:16,background:"var(--panel)",minWidth:280,textAlign:"center",boxShadow:"0 4px 16px rgba(0,0,0,.3)"},children:[e.jsx("div",{style:{marginBottom:8,fontWeight:700},children:"초기설정 진행 중"}),e.jsx("div",{className:"muted",style:{marginBottom:12},children:ps||"작업을 준비 중입니다…"}),e.jsx("div",{className:"muted",style:{fontSize:12},children:"작업이 완료될 때까지 다른 동작을 할 수 없습니다."})]})})]});async function zn(){try{if(Rt(!0),qt("초기설정 요청 중입니다…"),!I||isNaN(Number(I))){alert("연도를 선택하세요.");return}const n=localStorage.getItem("tnt.sales.assigneeId")||"";if(!n){alert("로그인이 필요합니다.");return}const y={year:Number(I),companyType:u,upliftPercent:Math.max(0,Math.min(999,Number(Ws)||0)),versionNo:1,assigneeId:n},T=localStorage.getItem("tnt.sales.empSeq")||"",z=localStorage.getItem("tnt.sales.empId")||"",R={"Content-Type":"application/json"};T&&(R["X-EMP-SEQ"]=T),z&&(R["X-EMP-ID"]=z),R["X-ASSIGNEE-ID"]=n;const A=await fetch("/api/v1/sales/plan/init",{method:"POST",headers:R,body:JSON.stringify(y)});if(qt("초기 목표를 저장하고 있습니다…"),!A.ok){let F=`HTTP ${A.status}`;try{const le=await A.json();le!=null&&le.error&&(F=le.error)}catch{const le=await A.text();le&&(F=le)}throw new Error(F)}await A.json().catch(()=>({}));const Z=(localStorage.getItem("tnt.sales.empName")||"").trim()||"사용자",J=Number(I);pe({show:!0,name:Z,tnt:xe.tnt,dys:xe.dys,year:Number.isFinite(J)&&J>0?J:0,hasP:!1,hasC:!1,hasI:!0,label:"초기설정완료"});try{await rs(!0)}catch{}}catch(n){alert((n==null?void 0:n.message)||"초기설정 중 오류가 발생했습니다.")}finally{Rt(!1),qt("")}}}function aa(s){if(!s)return"";const o=s instanceof Date?s:new Date(s);if(isNaN(o.getTime()))return"";const d=String(o.getFullYear()%100).padStart(2,"0"),D=String(o.getMonth()+1).padStart(2,"0"),H=String(o.getDate()).padStart(2,"0"),U=String(o.getHours()).padStart(2,"0"),q=String(o.getMinutes()).padStart(2,"0");return`${d}-${D}-${H} ${U}:${q}`}function ra(){const[s,o]=t.useState(""),[d,D]=t.useState(""),[H,U]=t.useState(""),[q,Q]=t.useState(!1),[W,se]=t.useState(null),[ee,S]=t.useState([]),[g,M]=t.useState(!1),[Y,v]=t.useState({open:!1,x:0,y:0}),[c,f]=t.useState(()=>new Set),[a,C]=t.useState({open:!1,x:0,y:0}),[w,b]=t.useState(void 0),[p,L]=t.useState("init"),[X,ue]=t.useState({}),de=["init","sim","apply","confirm"],r=[{key:"init",label:"초기설정"},{key:"sim",label:"Simulation"},{key:"apply",label:"목표반영"},{key:"confirm",label:"확정"}],u=de.indexOf(p),$=()=>{const _=Math.max(0,u-1);L(de[_])},N=()=>{const _=Math.min(de.length-1,u+1);L(de[_])},[m,P]=t.useState(!1),[te,K]=t.useState(null);new Date().getFullYear();const[j,ne]=t.useState("prev1"),[l,i]=t.useState(()=>new Array(12).fill(0)),[x,h]=t.useState({loading:!1});async function O(){if(!(w!=null&&w.customerSeq)){i(new Array(12).fill(0));return}P(!0),K(null);try{const _=new Date().getFullYear(),me=j==="prev1"?[_-1]:j==="last2"?[_-1,_-2]:[_-1,_-2,_-3],fe=[];await Promise.all(me.map(async Ce=>{try{const I=await fetch(`/api/v1/customers/${w.customerSeq}/invoice-monthly?year=${Ce}`);if(!I.ok)return;const je=await I.json().catch(()=>[]),V=(Array.isArray(je)?je:[]).map(_e=>({month:Number(_e.month??0),amount:Number(_e.amount??0)}));fe.push(...V)}catch{}}));const Se=new Array(12).fill(0);for(const Ce of fe){const I=Math.min(12,Math.max(1,Number(Ce.month)||0))-1;Se[I]+=Number.isFinite(Ce.amount)?Number(Ce.amount):0}i(Se)}catch(_){K(_.message||"조회 중 오류가 발생했습니다"),i(new Array(12).fill(0))}finally{P(!1)}}t.useEffect(()=>{p==="init"&&O()},[p,w==null?void 0:w.customerSeq,j]);async function E(){if(!(w!=null&&w.customerSeq)){h({loading:!1,hasRecent:void 0,error:null});return}h({loading:!0,hasRecent:void 0,error:null});try{const _=new URL("/api/v1/customers/recent-invoice-flags",window.location.origin);_.searchParams.set("custSeq",String(w.customerSeq)),_.searchParams.set("years","2");const me=await fetch(_.toString());if(!me.ok){let Ce=`HTTP ${me.status}`;try{const I=await me.json();I!=null&&I.error&&(Ce=I.error)}catch{}throw new Error(Ce)}const fe=await me.json(),Se=Array.isArray(fe)&&fe.some(Ce=>Number((Ce==null?void 0:Ce.customerSeq)||(Ce==null?void 0:Ce.customerSeqText)||0)===Number(w.customerSeq)&&!!(Ce!=null&&Ce.hasRecent));h({loading:!1,hasRecent:Se,error:null})}catch(_){h({loading:!1,hasRecent:void 0,error:_.message||"오류"})}}t.useEffect(()=>{p==="init"&&E()},[p,w==null?void 0:w.customerSeq]);const pe=t.useMemo(()=>e.jsx("div",{className:"table-container",style:{border:"1px solid var(--border)",borderRadius:8,marginTop:8},children:e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{children:Array.from({length:12},(_,me)=>e.jsxs("th",{style:{width:100,textAlign:"right"},children:[String(me+1).padStart(2,"0"),"월"]},me))})}),e.jsx("tbody",{children:e.jsx("tr",{children:l.map((_,me)=>e.jsx("td",{style:{textAlign:"right"},children:Math.round(_).toLocaleString()},me))})})]})}),[l]);async function re(){se(null),Q(!0);try{const _=localStorage.getItem("tnt.sales.empId");if(!_){S([]),se(Ze.loginRequired);return}const me=new URL("/api/v1/customers",window.location.origin);me.searchParams.set("mineOnly","true"),me.searchParams.set("empId",_);const fe=await fetch(me.toString());if(!fe.ok){let I=`HTTP ${fe.status}`;try{const je=await fe.json();je!=null&&je.error&&(I=je.error)}catch{const je=await fe.text();je&&(I=je)}throw new Error(I)}const Se=await fe.json(),Ce=Array.isArray(Se)?Se:[];S(Ce);try{const I=Ce.map(je=>Number(je.customerSeq||0)).filter(je=>Number.isFinite(je)&&je>0);if(I.length>0){const je=new URL("/api/v1/customers/recent-invoice-flags",window.location.origin);je.searchParams.set("custSeq",Array.from(new Set(I)).join(",")),je.searchParams.set("years","2");const V=await fetch(je.toString());if(V.ok){const _e=await V.json(),qe={};Array.isArray(_e)&&_e.forEach(Te=>{const Ue=Number((Te==null?void 0:Te.customerSeq)||(Te==null?void 0:Te.customerSeqText)||0);Number.isFinite(Ue)&&(qe[Ue]=!!(Te!=null&&Te.hasRecent))}),ue(qe)}else ue({})}else ue({})}catch{ue({})}}catch(_){se(_.message||"조회 중 오류가 발생했습니다")}finally{Q(!1)}}t.useEffect(()=>{re()},[]),t.useEffect(()=>{if(!Y.open)return;const _=()=>v({open:!1,x:0,y:0});return window.addEventListener("click",_),()=>window.removeEventListener("click",_)},[Y.open]),t.useEffect(()=>{if(!Y.open)return;const _=me=>{me.key==="Escape"&&v({open:!1,x:0,y:0})};return window.addEventListener("keydown",_),()=>window.removeEventListener("keydown",_)},[Y.open]),t.useEffect(()=>{const _=me=>{((me==null?void 0:me.key)==="Escape"||(me==null?void 0:me.key)==="Esc"||(me==null?void 0:me.keyCode)===27)&&(v({open:!1,x:0,y:0}),C({open:!1,x:0,y:0}))};return document.addEventListener("keydown",_,!0),()=>document.removeEventListener("keydown",_,!0)},[]);async function G(_,me){_.preventDefault(),_.stopPropagation(),v({open:!1,x:0,y:0});const fe=_.clientX,Se=_.clientY;C({open:!0,x:fe,y:Se,row:me,loading:!1,error:null,data:[]})}const xe=t.useMemo(()=>{var _,me,fe,Se,Ce,I,je,V,_e,qe,Te,Ue,at,dt,xt;return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"table-container",onClick:()=>v({open:!1,x:0,y:0}),style:{height:"100%",overflow:"auto"},children:[ee.length===0?e.jsx("div",{className:"empty-state",children:Ze.empty}):e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsx("tr",{children:e.jsx("th",{style:{width:"auto"},children:"거래처명"})})}),e.jsx("tbody",{children:ee.map((ze,et)=>e.jsx("tr",{onClick:nt=>{nt.preventDefault(),nt.stopPropagation(),b(ze),C({open:!1,x:0,y:0})},onContextMenu:nt=>G(nt,ze),"aria-selected":(w==null?void 0:w.customerId)===ze.customerId?!0:void 0,style:(w==null?void 0:w.customerId)===ze.customerId?{background:"var(--row-selected, rgba(0, 128, 255, 0.12))"}:void 0,children:e.jsx("td",{children:(()=>{const nt=Number(ze.customerSeq||0);return X[nt]?e.jsxs("span",{children:[ze.customerName," "," ","$"]}):ze.customerName})()})},et))})]}),a.open&&e.jsxs("div",{className:"context-menu",style:{left:a.x+6,top:a.y+6,maxWidth:420,padding:8},onClick:ze=>ze.stopPropagation(),children:[e.jsx("div",{style:{fontWeight:600,marginBottom:6},children:"거래처 상세"}),a.error?e.jsx("div",{className:"error",style:{maxWidth:380},children:a.error}):e.jsx("table",{className:"table",style:{width:"100%"},children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{style:{width:110,textAlign:"left"},children:"거래처번호"}),e.jsx("td",{children:((_=a.row)==null?void 0:_.customerId)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"사업자번호"}),e.jsx("td",{children:((me=a.row)==null?void 0:me.bizNo)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"대표자명"}),e.jsx("td",{children:((fe=a.row)==null?void 0:fe.ownerName)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"업태"}),e.jsx("td",{children:((Se=a.row)==null?void 0:Se.bizKind)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"종목"}),e.jsx("td",{children:((Ce=a.row)==null?void 0:Ce.bizType)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"전화번호"}),e.jsx("td",{children:((I=a.row)==null?void 0:I.telNo)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"담당자명"}),e.jsx("td",{children:((je=a.row)==null?void 0:je.empName)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"부서명"}),e.jsx("td",{children:((V=a.row)==null?void 0:V.deptName)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"시/도"}),e.jsx("td",{children:((_e=a.row)==null?void 0:_e.addrProvinceName)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"시/군/구"}),e.jsx("td",{children:((qe=a.row)==null?void 0:qe.addrCityName)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"고객유형"}),e.jsx("td",{children:((Te=a.row)==null?void 0:Te.customerTypeName)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"비고"}),e.jsx("td",{children:((Ue=a.row)==null?void 0:Ue.customerRemark)||""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"생성자"}),e.jsx("td",{children:((at=a.row)==null?void 0:at.createdBy)??""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"수정자"}),e.jsx("td",{children:((dt=a.row)==null?void 0:dt.updatedBy)??""})]}),e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left"},children:"생성일시"}),e.jsx("td",{children:aa((xt=a.row)==null?void 0:xt.createdAt)})]})]})})]})]})})},[ee,Y,c,a,w,X]);return e.jsxs("section",{children:[e.jsxs("div",{className:"page-title",style:{alignItems:"center"},children:[e.jsx("h2",{style:{margin:0,fontSize:18},children:"목표 Simulation"}),e.jsxs("div",{className:"muted count-text",children:[ee.length.toLocaleString(),"개 거래처"]})]}),W&&e.jsx("div",{className:"error",children:W||Ze.errorGeneric}),e.jsxs("div",{style:{marginTop:12,display:"flex",gap:12,alignItems:"stretch",height:"calc(100vh - 140px)"},children:[e.jsx("div",{style:{flex:"0 0 17%",maxWidth:"17%",minWidth:240,height:"100%",overflow:"auto"},children:xe}),e.jsxs("aside",{className:"card",style:{flex:"1 1 83%",maxWidth:"83%",height:"100%",padding:12,overflow:"auto"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12,gap:16},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,flex:1,minWidth:0},children:(()=>{const _=[];for(let me=0;me<r.length;me++){const fe=r[me],Se=me<u,Ce=me===u;_.push(e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,minWidth:0,flex:me===r.length-1?"0 0 auto":"1 1 0"},children:[e.jsx("div",{title:fe.label,onClick:()=>L(fe.key),style:{width:22,height:22,borderRadius:999,display:"inline-flex",alignItems:"center",justifyContent:"center",background:Se||Ce?"var(--accent)":"transparent",border:`2px solid ${Se||Ce?"var(--accent)":"var(--border)"}`,color:Se||Ce?"var(--on-accent)":"var(--muted)",cursor:"pointer",flex:"0 0 auto"},"aria-current":Ce?"step":void 0,children:Se?"✓":me+1}),e.jsx("div",{style:{fontSize:12,color:Ce||Se?"var(--text)":"var(--muted)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:fe.label}),me<r.length-1&&e.jsx("div",{style:{height:2,background:me<u?"var(--accent)":"var(--border)",flex:1,borderRadius:2}})]},fe.key))}return _})()}),e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[e.jsx("button",{className:"btn btn-icon",onClick:$,disabled:u===0,"aria-label":"이전 단계",title:"이전 단계",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",focusable:"false",children:e.jsx("path",{d:"M15 18l-6-6 6-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),e.jsx("button",{className:"btn btn-icon",onClick:N,disabled:u===r.length-1,"aria-label":"다음 단계",title:"다음 단계",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",focusable:"false",children:e.jsx("path",{d:"M9 6l6 6-6 6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]})]}),p==="init"&&e.jsxs("section",{style:{marginTop:12},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12},children:[e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:10},children:[e.jsx("b",{children:"기준매출"}),e.jsxs("select",{value:j,onChange:_=>ne(_.target.value),style:{height:28,padding:"4px 8px",borderRadius:8,border:"1px solid var(--border)",background:"transparent",color:"var(--text)",fontSize:12},"aria-label":"기준 기간 선택",children:[e.jsx("option",{value:"prev1",children:"전년"}),e.jsx("option",{value:"last2",children:"최근2년"}),e.jsx("option",{value:"last3",children:"최근3년"})]})]}),te&&e.jsx("span",{className:"error",children:te})]}),m?e.jsx("div",{className:"empty-state",style:{marginTop:8},children:"불러오는 중…"}):pe]})]})]})]})}function Ms(s){if(!s)return"";const o=s instanceof Date?s:new Date(s);if(isNaN(o.getTime()))return"";const d=String(o.getFullYear()%100).padStart(2,"0"),D=String(o.getMonth()+1).padStart(2,"0"),H=String(o.getDate()).padStart(2,"0"),U=String(o.getHours()).padStart(2,"0"),q=String(o.getMinutes()).padStart(2,"0");return`${d}-${D}-${H} ${U}:${q}`}function wn({compact:s=!1,maxHeight:o,context:d="list"}){const[D,H]=t.useState(""),[U,q]=t.useState(""),[Q,W]=t.useState(""),[se,ee]=t.useState(!1),[S,g]=t.useState(null),[M,Y]=t.useState([]),[v,c]=t.useState("mine"),[f,a]=t.useState({open:!1,x:0,y:0}),[C,w]=t.useState(()=>new Set),[b,p]=t.useState({open:!1,x:0,y:0}),[L,X]=t.useState({}),[ue,de]=t.useState({}),[r,u]=t.useState(!1),[$,N]=t.useState(0),m=100,[P,te]=t.useState(0),[K,j]=t.useState(!0),[ne,l]=t.useState(!1),i=Ne.useRef(null),[x,h]=t.useState(()=>{try{const I=localStorage.getItem("tnt.sales.selectedCustomer");if(I){const je=JSON.parse(I),V=Number(je==null?void 0:je.customerSeq);return Number.isFinite(V)?V:null}}catch{}return null}),[O,E]=t.useState(()=>{try{const I=localStorage.getItem("tnt.sales.selectedCustomer");if(I){const je=JSON.parse(I);return String((je==null?void 0:je.customerId)||"")||null}}catch{}return null}),pe=t.useMemo(()=>{const I=typeof window<"u"?localStorage.getItem("tnt.sales.empName"):"",je=typeof window<"u"?localStorage.getItem("tnt.sales.assigneeId"):"";return I||je||""},[]);function re(I,je){w(V=>{const _e=new Set(V);return je?_e.add(I):_e.delete(I),_e})}function G(I){if(!I){w(new Set);return}const je=new Set;M.forEach(V=>{V.customerId&&je.add(V.customerId)}),w(je)}async function xe(I=!0){g(null),I?(ee(!0),te(0),j(!0)):l(!0);try{const je=localStorage.getItem("tnt.sales.assigneeId");if(!je){Y([]),g(Ze.loginRequired);return}const V=new URL("/api/v1/customers",window.location.origin);D.trim()&&V.searchParams.set("name",D.trim()),U.trim()&&V.searchParams.set("provinceName",U.trim()),Q.trim()&&V.searchParams.set("cityName",Q.trim());const _e=v==="mine";V.searchParams.set("mineOnly",_e?"true":"false"),_e&&je&&V.searchParams.set("assigneeId",je),V.searchParams.set("limit",String(m)),V.searchParams.set("offset",String(I?0:P));const qe=await fetch(V.toString());if(!qe.ok){let ze=`HTTP ${qe.status}`;try{const et=await qe.json();et!=null&&et.error&&(ze=et.error)}catch{const nt=await qe.text();nt&&(ze=nt)}throw new Error(ze)}const Te=await qe.json(),Ue=Array.isArray(Te)?Te:[],at=[...Ue].sort((ze,et)=>{const nt=(ze.customerName||"").toString(),jt=(et.customerName||"").toString();return nt.localeCompare(jt,"ko",{sensitivity:"base"})}),dt=(I?at:Ue).map(ze=>Number(ze.customerSeq||0)).filter(ze=>Number.isFinite(ze)&&ze>0),xt=Array.from(new Set(dt)).join(",");try{if(dt.length>0){const ze=new URL("/api/v1/customers/recent-invoice-flags",window.location.origin);ze.searchParams.set("custSeq",xt),ze.searchParams.set("years","2");const et=new URL("/api/v1/customers/demand-flags",window.location.origin);et.searchParams.set("custSeq",xt);const[nt,jt]=await Promise.all([fetch(ze.toString()),fetch(et.toString())]);if(nt.ok){const tt=await nt.json(),ut={};Array.isArray(tt)&&tt.forEach(Xe=>{const Tt=Number((Xe==null?void 0:Xe.customerSeq)||0);Number.isFinite(Tt)&&(ut[Tt]=!!(Xe!=null&&Xe.hasRecent))}),X(Xe=>I?ut:{...Xe,...ut})}else I&&X({});if(jt.ok){const tt=await jt.json(),ut={};Array.isArray(tt)&&tt.forEach(Xe=>{const Tt=Number((Xe==null?void 0:Xe.customerSeq)||0);Number.isFinite(Tt)&&(ut[Tt]=!!(Xe!=null&&Xe.hasDemand))}),de(Xe=>I?ut:{...Xe,...ut})}else I&&de({})}else I&&(X({}),de({}))}catch{I&&(X({}),de({}))}Y(I?at:ze=>[...ze,...at]),j(Ue.length>=m),te(I?m:ze=>ze+m),I&&!r&&at.length>0&&(_(at[0]),u(!0));try{if(je&&v==="mine"){const ze=new URL("/api/v1/customers/count",window.location.origin);ze.searchParams.set("mineOnly","true"),ze.searchParams.set("assigneeId",je);const et=await fetch(ze.toString());if(et.ok){const nt=await et.json().catch(()=>({})),jt=Number((nt==null?void 0:nt.total)??0);N(Number.isFinite(jt)?jt:0)}else N(0)}else N(0)}catch{N(0)}}catch(je){g(je.message||"조회 중 오류가 발생했습니다")}finally{I?ee(!1):l(!1)}}t.useEffect(()=>{xe(!0)},[]),t.useEffect(()=>{const I=()=>{try{const je=localStorage.getItem("tnt.sales.selectedCustomer");if(je){const V=JSON.parse(je),_e=Number(V==null?void 0:V.customerSeq);h(Number.isFinite(_e)?_e:null),E((V==null?void 0:V.customerId)||null)}}catch{}};return window.addEventListener("tnt.sales.customer.selected",I),()=>window.removeEventListener("tnt.sales.customer.selected",I)},[]),t.useEffect(()=>{xe(!0)},[v]),t.useEffect(()=>{const I=i.current;if(!I)return;function je(){I.scrollTop+I.clientHeight>=I.scrollHeight-48&&K&&!ne&&!se&&xe(!1)}return I.addEventListener("scroll",je),()=>I.removeEventListener("scroll",je)},[K,ne,se,P,D,U,Q,v]),t.useEffect(()=>{if(!f.open)return;const I=()=>a({open:!1,x:0,y:0});return window.addEventListener("click",I),()=>window.removeEventListener("click",I)},[f.open]),t.useEffect(()=>{if(!f.open)return;const I=je=>{je.key==="Escape"&&a({open:!1,x:0,y:0})};return window.addEventListener("keydown",I),()=>window.removeEventListener("keydown",I)},[f.open]),t.useEffect(()=>{if(!b.open)return;const I=()=>p({open:!1,x:0,y:0}),je=V=>{V.key==="Escape"&&p({open:!1,x:0,y:0})};return window.addEventListener("click",I),window.addEventListener("keydown",je),()=>{window.removeEventListener("click",I),window.removeEventListener("keydown",je)}},[b.open]),t.useEffect(()=>{const I=je=>{((je==null?void 0:je.key)==="Escape"||(je==null?void 0:je.key)==="Esc"||(je==null?void 0:je.keyCode)===27)&&(a({open:!1,x:0,y:0}),p({open:!1,x:0,y:0}))};return document.addEventListener("keydown",I,!0),()=>document.removeEventListener("keydown",I,!0)},[]);function _(I){try{localStorage.setItem("tnt.sales.selectedCustomer",JSON.stringify(I||{})),window.dispatchEvent(new CustomEvent("tnt.sales.customer.selected",{detail:{source:"customer-search",customer:I}}))}catch{}h((()=>{const je=Number(I.customerSeq);return Number.isFinite(je)?je:null})()),E(I.customerId||null),a({open:!1,x:0,y:0}),p({open:!1,x:0,y:0})}function me(I,je){const V=I.clientX,_e=I.clientY;p({open:!0,x:V,y:_e,row:je,loading:!1,error:null,data:[]})}function fe(I){b.open&&p(je=>({...je,x:I.clientX,y:I.clientY}))}function Se(){p({open:!1,x:0,y:0})}const Ce=t.useMemo(()=>e.jsx(e.Fragment,{children:e.jsxs("div",{ref:i,className:"table-container",onClick:()=>a({open:!1,x:0,y:0}),style:{maxHeight:o??(s?"32vh":void 0),overflow:"auto"},children:[M.length===0?e.jsx("div",{className:"empty-state",children:Ze.empty}):e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:36,textAlign:"center"},children:e.jsx("input",{type:"checkbox",checked:M.length>0&&C.size===M.length,indeterminate:void 0,onChange:I=>G(I.target.checked)})}),e.jsx("th",{style:{width:140},children:d==="c360"?"회사구분":"거래처번호"}),e.jsx("th",{style:{width:200},children:"거래처명"}),e.jsx("th",{style:{width:80},children:"추가정보"}),e.jsx("th",{style:{width:140},children:"사업자번호"}),e.jsx("th",{style:{width:120},children:"대표자명"}),e.jsx("th",{style:{width:120},children:"업태"}),e.jsx("th",{style:{width:120},children:"종목"}),e.jsx("th",{style:{width:130},children:"전화번호"}),e.jsx("th",{style:{width:120},children:"담당자명"}),e.jsx("th",{style:{width:140},children:"부서명"}),e.jsx("th",{style:{width:120},children:"시/도"}),e.jsx("th",{style:{width:120},children:"시/군/구"}),e.jsx("th",{style:{width:120},children:"고객유형"}),e.jsx("th",{children:"비고"}),e.jsx("th",{style:{width:120},children:"생성자"}),e.jsx("th",{style:{width:120},children:"수정자"}),e.jsx("th",{style:{width:180},children:"생성일시"}),e.jsx("th",{style:{width:180},children:"수정일시"})]})}),e.jsx("tbody",{children:M.map((I,je)=>e.jsxs("tr",{className:Number(I.customerSeq||0)===(x||-1)||O&&I.customerId===O?"selected":void 0,onClick:()=>_(I),onContextMenu:V=>{V.preventDefault(),V.stopPropagation(),Se(),a({open:!0,x:V.clientX,y:V.clientY,row:I})},children:[e.jsx("td",{style:{textAlign:"center"},onClick:V=>V.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:C.has(I.customerId),onChange:V=>re(I.customerId,V.target.checked)})}),e.jsx("td",{onMouseEnter:V=>me(V,I),onMouseMove:fe,onMouseLeave:Se,children:d==="c360"?I.companyType||"":I.customerId}),e.jsx("td",{children:I.customerName}),e.jsx("td",{children:(()=>{const V=Number(I.customerSeq||0),_e=!!L[V],qe=!!ue[V];return!_e&&!qe?"":e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[_e&&e.jsx("img",{src:Bn,className:"icon",alt:"",title:"최근2년 매출 있음",style:{width:14,height:14}}),qe&&e.jsx("img",{src:Hn,className:"icon",alt:"",title:"수요 있음",style:{width:14,height:14}})]})})()}),e.jsx("td",{children:I.bizNo||""}),e.jsx("td",{children:I.ownerName||""}),e.jsx("td",{children:I.bizKind||""}),e.jsx("td",{children:I.bizType||""}),e.jsx("td",{children:I.telNo||""}),e.jsx("td",{children:I.empName||""}),e.jsx("td",{children:I.deptName||""}),e.jsx("td",{children:I.addrProvinceName||""}),e.jsx("td",{children:I.addrCityName||""}),e.jsx("td",{children:I.customerTypeName||""}),e.jsx("td",{children:I.customerRemark||""}),e.jsx("td",{children:I.createdBy??""}),e.jsx("td",{children:I.updatedBy??""}),e.jsx("td",{children:Ms(I.createdAt)}),e.jsx("td",{children:Ms(I.updatedAt)})]},je))})]}),ne&&e.jsx("div",{className:"muted",style:{padding:"6px 8px"},children:Ze.loading}),!se&&!ne&&!K&&M.length>0&&e.jsx("div",{className:"muted",style:{padding:"8px 10px",textAlign:"center"},children:"마지막 데이터입니다."}),f.open&&e.jsxs("div",{className:"context-menu",style:{left:f.x+4,top:f.y+4},onClick:I=>I.stopPropagation(),children:[d!=="c360"?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"context-item",onClick:()=>{try{localStorage.setItem("tnt.sales.selectedCustomer",JSON.stringify(f.row||{})),window.dispatchEvent(new CustomEvent("tnt.sales.customer.selected",{detail:{source:"customer-search",customer:f.row}}))}catch{}const I=document.querySelector('button[data-key="customer:c360"]');I&&I.click(),a({open:!1,x:0,y:0})},children:"C360"}),e.jsx("button",{className:"context-item",onClick:()=>{try{localStorage.setItem("tnt.sales.selectedCustomer",JSON.stringify(f.row||{})),window.dispatchEvent(new CustomEvent("tnt.sales.customer.selected",{detail:{source:"customer-search",customer:f.row}}))}catch{}window.dispatchEvent(new CustomEvent("tnt.sales.navigate",{detail:{key:"sales-mgmt:receivables"}})),a({open:!1,x:0,y:0})},children:"미수현황"})]}):null,e.jsx("button",{className:"context-item",onClick:()=>{try{localStorage.setItem("tnt.sales.selectedCustomer",JSON.stringify(f.row||{})),window.dispatchEvent(new CustomEvent("tnt.sales.customer.selected",{detail:{source:"customer-search",customer:f.row}}))}catch{}const I=document.querySelector('button[data-key="customer:sales-activity-new"]');I&&I.click(),a({open:!1,x:0,y:0})},children:"활동등록"})]}),b.open&&b.row&&e.jsxs("div",{className:"context-menu",style:{left:b.x+6,top:b.y+6,maxWidth:500,padding:10},onClick:I=>I.stopPropagation(),onMouseLeave:Se,children:[e.jsx("div",{style:{fontWeight:600,marginBottom:6},children:"거래처 정보"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"120px 1fr",gap:6,maxWidth:480},children:[e.jsx("div",{className:"muted",children:"거래처번호"}),e.jsx("div",{children:b.row.customerId||""}),e.jsx("div",{className:"muted",children:"거래처명"}),e.jsx("div",{children:b.row.customerName||""}),b.row.customerFullName?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"muted",children:"정식명"}),e.jsx("div",{children:b.row.customerFullName})]}):null,b.row.bizNo?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"muted",children:"사업자번호"}),e.jsx("div",{children:b.row.bizNo})]}):null,b.row.ownerName?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"muted",children:"대표자명"}),e.jsx("div",{children:b.row.ownerName})]}):null,b.row.bizKind?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"muted",children:"업태"}),e.jsx("div",{children:b.row.bizKind})]}):null,b.row.bizType?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"muted",children:"종목"}),e.jsx("div",{children:b.row.bizType})]}):null,b.row.telNo?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"muted",children:"전화번호"}),e.jsx("div",{children:b.row.telNo})]}):null,b.row.empName?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"muted",children:"담당자명"}),e.jsx("div",{children:b.row.empName})]}):null,b.row.deptName?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"muted",children:"부서명"}),e.jsx("div",{children:b.row.deptName})]}):null,b.row.addrProvinceName?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"muted",children:"시/도"}),e.jsx("div",{children:b.row.addrProvinceName})]}):null,b.row.addrCityName?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"muted",children:"시/군/구"}),e.jsx("div",{children:b.row.addrCityName})]}):null,b.row.customerTypeName?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"muted",children:"고객유형"}),e.jsx("div",{children:b.row.customerTypeName})]}):null,b.row.customerRemark?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"muted",children:"비고"}),e.jsx("div",{children:b.row.customerRemark})]}):null,b.row.createdAt?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"muted",children:"생성일시"}),e.jsx("div",{children:Ms(b.row.createdAt)})]}):null,b.row.updatedAt?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"muted",children:"수정일시"}),e.jsx("div",{children:Ms(b.row.updatedAt)})]}):null]})]})]})}),[M,f,C,b]);return e.jsxs("section",{children:[e.jsxs("div",{className:"page-title",style:{alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:8,alignItems:"center",flex:"1 1 auto",minWidth:0},children:[e.jsxs("select",{value:v,onChange:I=>c(I.target.value),style:{height:30,padding:"2px 8px",fontSize:11,background:v==="mine"?"rgba(59,130,246,.15)":"#fff",borderRadius:8,border:v==="mine"?"1px solid var(--accent)":"1px solid var(--border)"},children:[e.jsx("option",{value:"mine",children:"내 거래처"}),e.jsx("option",{value:"hq",children:"본부 거래처"}),e.jsx("option",{value:"all",children:"전체"})]}),e.jsx("input",{className:"search-input",value:D,onChange:I=>H(I.target.value),onKeyDown:I=>{I.key==="Enter"&&xe()},placeholder:"거래처명",style:{background:"#fff",borderRadius:8,border:"1px solid var(--border)"}}),e.jsx("input",{className:"search-input",value:U,onChange:I=>q(I.target.value),onKeyDown:I=>{I.key==="Enter"&&xe()},placeholder:"시/도",style:{background:"#fff",borderRadius:8,border:"1px solid var(--border)",minWidth:100}}),e.jsx("input",{className:"search-input",value:Q,onChange:I=>W(I.target.value),onKeyDown:I=>{I.key==="Enter"&&xe()},placeholder:"시/군/구",style:{background:"#fff",borderRadius:8,border:"1px solid var(--border)",minWidth:120}}),e.jsx("button",{className:"btn",onClick:xe,disabled:se,style:{height:30,padding:"0 12px"},children:"조회"}),se&&e.jsx("span",{className:"muted",style:{lineHeight:"30px"},children:Ze.loading})]}),e.jsx("div",{className:"meta",style:{gap:0},children:e.jsxs("span",{className:"muted count-text",children:[v==="mine"&&pe?`${pe} · `:"",(v==="mine"?$:M.length).toLocaleString(),"개 거래처",C.size?` · 선택 ${C.size}건`:""]})})]}),S&&e.jsx("div",{className:"error",children:S||Ze.errorGeneric}),e.jsx("div",{style:{marginTop:12},children:Ce})]})}function Kt(s){if(!s)return"";const o=s instanceof Date?s:new Date(s);if(isNaN(o.getTime()))return"";const d=String(o.getFullYear()%100).padStart(2,"0"),D=String(o.getMonth()+1).padStart(2,"0"),H=String(o.getDate()).padStart(2,"0"),U=String(o.getHours()).padStart(2,"0"),q=String(o.getMinutes()).padStart(2,"0");return`${d}-${D}-${H} ${U}:${q}`}function Xs({customerSeq:s,customerId:o,hideHeader:d=!1,hideRefresh:D=!1,enableContextMenu:H=!1}){const[U,q]=t.useState([]),[Q,W]=t.useState(!1),[se,ee]=t.useState(null),[S,g]=t.useState({open:!1,x:0,y:0}),M=t.useRef(null),[Y,v]=t.useState(null);async function c(){ee(null),W(!0);try{const b=new URL("/api/v1/sales-activities",window.location.origin);b.searchParams.set("mineOnly","false");const p=o&&o.trim()||(()=>{try{const ue=localStorage.getItem("tnt.sales.selectedCustomer");if(ue){const de=JSON.parse(ue);return(de==null?void 0:de.customerId)||""}}catch{}return""})();b.searchParams.set("sfAccountId",p||"");const L=await fetch(b.toString());if(!L.ok){let ue=`HTTP ${L.status}`;try{const de=await L.json();de!=null&&de.error&&(ue=de.error)}catch{}throw new Error(ue)}const X=await L.json();q(Array.isArray(X)?X:[])}catch(b){ee(b.message||"조회 중 오류가 발생했습니다")}finally{W(!1)}}t.useEffect(()=>{s&&c()},[s,o]);async function f(b){try{const p=new URL("/api/v1/sales-activities",window.location.origin);p.searchParams.set("mineOnly","false");const L=o&&o.trim()||(()=>{try{const r=localStorage.getItem("tnt.sales.selectedCustomer");if(r){const u=JSON.parse(r);return(u==null?void 0:u.customerId)||""}}catch{}return""})();p.searchParams.set("sfAccountId",L||""),p.searchParams.set("parentSeq",String(b)),p.searchParams.set("includeParent","true");const X=await fetch(p.toString());if(!X.ok)return;const ue=await X.json(),de=Array.isArray(ue)?ue:[];de.sort((r,u)=>{const $=!r.parentSeq,N=!u.parentSeq;if($&&!N)return-1;if(!$&&N)return 1;const m=r.createdAt?new Date(r.createdAt).getTime():0;return(u.createdAt?new Date(u.createdAt).getTime():0)-m}),v(de)}catch{v([])}}t.useEffect(()=>{if(!S.open)return;const b=p=>{if(p.button!==0)return;const L=p.target;M.current&&L&&M.current.contains(L)||g({open:!1,x:0,y:0})};return window.addEventListener("mousedown",b,!0),()=>window.removeEventListener("mousedown",b,!0)},[S.open]),t.useEffect(()=>{if(!S.open)return;const b=p=>{((p==null?void 0:p.key)==="Escape"||(p==null?void 0:p.key)==="Esc"||(p==null?void 0:p.keyCode)===27)&&g({open:!1,x:0,y:0})};return document.addEventListener("keydown",b,!0),()=>document.removeEventListener("keydown",b,!0)},[S.open]),t.useEffect(()=>{if(!Y)return;const b=p=>{p.key==="Escape"&&(p.preventDefault(),p.stopPropagation(),v(null))};return window.addEventListener("keydown",b,!0),()=>window.removeEventListener("keydown",b,!0)},[Y]);const a=(b,p)=>b?p==="type"?{site_visit:"정기방문",opportunity:"영업기회",AR_mgmt:"채권관리",meeting:"미팅",call:"전화",email:"이메일",demo:"데모",task:"업무",other:"기타"}[b]||b:p==="status"?{scheduled:"계획",completed:"완료",canceled:"취소",postponed:"연기",no_show:"미방문"}[b]||b:p==="channel"&&{in_person:"방문",phone:"전화",email:"문자/메일/팩스",other:"기타",video:"영상",chat:"채팅",sms:"문자"}[b]||b:"",C=b=>[`제목: ${b.subject||""}`,`활동설명: ${b.description||""}`,`활동유형: ${a(b.activityType,"type")}`,`활동방법: ${a(b.channel,"channel")}`,`상태: ${a(b.activityStatus,"status")}`,`상위활동: ${b.parentSubject||""}`,`계획 일시: ${Kt(b.plannedStartAt)}`,`종료 일시: ${Kt(b.plannedEndAt)}`,`생성일시: ${Kt(b.createdAt)}`,b.customerName?`거래처명: ${b.customerName}`:""].filter(Boolean).join(`
`),w=t.useMemo(()=>e.jsxs(e.Fragment,{children:[!d&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:6},children:[e.jsx("div",{className:"muted"}),e.jsxs("div",{className:"muted count-text",children:["총 ",U.length,"건"]})]}),e.jsx("div",{className:"table-container",children:U.length===0?e.jsx("div",{className:"empty-state",children:"활동이 없습니다."}):e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:240},children:"제목"}),e.jsx("th",{style:{width:280},children:"활동설명"}),e.jsx("th",{style:{width:120},children:"활동유형"}),e.jsx("th",{style:{width:120},children:"활동방법"}),e.jsx("th",{style:{width:120},children:"상태"}),e.jsx("th",{style:{width:220},children:"상위활동"}),e.jsx("th",{style:{width:180},children:"계획 일시"}),e.jsx("th",{style:{width:180},children:"종료 일시"}),e.jsx("th",{style:{width:180},children:"생성일시"})]})}),e.jsx("tbody",{children:U.map((b,p)=>e.jsxs("tr",{title:C(b),onContextMenu:L=>{H&&b.parentSeq&&(L.preventDefault(),L.stopPropagation(),g({open:!0,x:L.clientX,y:L.clientY,row:b}))},children:[e.jsx("td",{children:b.subject||""}),e.jsx("td",{title:b.description||"",style:{maxWidth:600,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:b.description||""}),e.jsx("td",{children:a(b.activityType,"type")}),e.jsx("td",{children:a(b.channel,"channel")}),e.jsx("td",{children:a(b.activityStatus,"status")}),e.jsx("td",{children:b.parentSubject||""}),e.jsx("td",{children:Kt(b.plannedStartAt)}),e.jsx("td",{children:Kt(b.plannedEndAt)}),e.jsx("td",{children:Kt(b.createdAt)})]},p))})]})})]}),[U]);return e.jsxs("section",{children:[!D&&e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("button",{className:"btn",onClick:c,disabled:Q,children:Q?"새로고침…":"새로고침"}),se&&e.jsx("span",{className:"error",children:se})]}),D&&se&&e.jsx("div",{className:"error",children:se}),e.jsx("div",{style:{marginTop:12},children:w}),S.open&&e.jsx("div",{ref:M,className:"context-menu",style:{left:S.x+4,top:S.y+4},onClick:b=>b.stopPropagation(),children:e.jsx("button",{className:"context-item",onClick:()=>{var b,p;(b=S.row)!=null&&b.parentSeq?f(S.row.parentSeq):(p=S.row)!=null&&p.id&&f(S.row.id),g({open:!1,x:0,y:0})},children:"관련활동"})}),Y&&e.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,.4)"},onClick:()=>v(null),children:e.jsxs("div",{className:"card",style:{width:"min(1200px, 92vw)",maxHeight:"90vh",overflow:"auto",padding:16,background:"var(--panel)",border:"1px solid var(--border)",borderRadius:12,boxShadow:"0 8px 32px rgba(0,0,0,.2)"},onClick:b=>b.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[e.jsxs("div",{className:"list-title",style:{display:"flex",alignItems:"center",gap:6},children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",focusable:"false",style:{color:"#555"},children:[e.jsx("circle",{cx:"6",cy:"6",r:"3",stroke:"currentColor",strokeWidth:"1.8"}),e.jsx("circle",{cx:"18",cy:"6",r:"3",stroke:"currentColor",strokeWidth:"1.8"}),e.jsx("circle",{cx:"12",cy:"18",r:"3",stroke:"currentColor",strokeWidth:"1.8"}),e.jsx("line",{x1:"8.5",y1:"7.4",x2:"15.5",y2:"7.4",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round"}),e.jsx("line",{x1:"7.2",y1:"8.9",x2:"10.8",y2:"15.1",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round"}),e.jsx("line",{x1:"16.8",y1:"8.9",x2:"13.2",y2:"15.1",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round"})]}),e.jsx("span",{style:{fontWeight:600,fontSize:14},children:"관련활동"}),e.jsxs("span",{className:"muted count-text",style:{marginLeft:8},children:["총 ",Y.length,"건"]})]}),e.jsx("button",{onClick:()=>v(null),style:{width:32,height:32,display:"flex",alignItems:"center",justifyContent:"center",background:"transparent",border:"none",borderRadius:4,cursor:"pointer",color:"var(--muted)",fontSize:20,transition:"all 0.2s"},onMouseEnter:b=>{b.currentTarget.style.background="var(--panel-2)",b.currentTarget.style.color="var(--text)"},onMouseLeave:b=>{b.currentTarget.style.background="transparent",b.currentTarget.style.color="var(--muted)"},title:"닫기 (ESC)",children:"×"})]}),e.jsx("div",{className:"table-container",children:Y.length===0?e.jsx("div",{className:"empty-state",children:"관련활동이 없습니다."}):e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:200},children:"상위활동"}),e.jsx("th",{style:{width:240},children:"제목"}),e.jsx("th",{style:{width:280},children:"활동설명"}),e.jsx("th",{style:{width:120},children:"활동유형"}),e.jsx("th",{style:{width:120},children:"활동방법"}),e.jsx("th",{style:{width:120},children:"상태"}),e.jsx("th",{style:{width:180},children:"계획 일시"}),e.jsx("th",{style:{width:180},children:"종료 일시"}),e.jsx("th",{style:{width:180},children:"생성일시"})]})}),e.jsx("tbody",{children:Y.map((b,p)=>e.jsxs("tr",{title:C(b),className:b.parentSeq?void 0:"row-parent",children:[e.jsx("td",{children:b.parentSubject||""}),e.jsx("td",{children:b.subject||""}),e.jsx("td",{style:{maxWidth:600,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:b.description||""}),e.jsx("td",{children:a(b.activityType,"type")}),e.jsx("td",{children:a(b.channel,"channel")}),e.jsx("td",{children:a(b.activityStatus,"status")}),e.jsx("td",{children:Kt(b.plannedStartAt)}),e.jsx("td",{children:Kt(b.plannedEndAt)}),e.jsx("td",{children:Kt(b.createdAt)})]},`rel-${p}`))})]})})]})})]})}function ia(){const[s,o]=t.useState(null),[d,D]=t.useState("form");t.useEffect(()=>{try{const U=localStorage.getItem("tnt.sales.selectedCustomer");o(U?JSON.parse(U):null)}catch{o(null)}},[]);const H=t.useMemo(()=>s?e.jsx("section",{className:"card compact-form",children:e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"거래처번호"}),e.jsx(gt,{value:s.customerId||"",readOnly:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"거래처명"}),e.jsx(gt,{value:s.customerName||"",readOnly:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"정식명"}),e.jsx(gt,{value:s.customerFullName||"",readOnly:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"사업자번호"}),e.jsx(gt,{value:s.bizNo||"",readOnly:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"대표자명"}),e.jsx(gt,{value:s.ownerName||"",readOnly:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"고객유형"}),e.jsx(gt,{value:s.customerTypeName||"",readOnly:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"시/도"}),e.jsx(gt,{value:s.addrProvinceName||"",readOnly:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"시/군/구"}),e.jsx(gt,{value:s.addrCityName||"",readOnly:!0})]}),e.jsxs("div",{className:"field row-2",children:[e.jsx("label",{children:"비고"}),e.jsx(gt,{value:s.customerRemark||"",readOnly:!0})]})]})}):null,[s]);return e.jsxs("section",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[e.jsxs("div",{className:"page-title",style:{alignItems:"center"},children:[e.jsx("h2",{style:{margin:0,fontSize:18},children:"영업활동"}),e.jsx("div",{className:"muted count-text"})]}),H,e.jsxs("section",{className:"card sales-activity-panel",style:{marginTop:12},children:[e.jsxs("div",{className:"tabs c360-tabs",children:[e.jsx("button",{className:d==="form"?"tab active":"tab",onClick:()=>D("form"),children:"영업활동 등록"}),e.jsx("button",{className:d==="list"?"tab active":"tab",onClick:()=>D("list"),children:"영업활동"})]}),e.jsx("div",{className:"sales-activity-content",children:d==="form"?e.jsx(Ss,{bare:!0}):e.jsx(Xs,{customerSeq:(()=>{try{const U=localStorage.getItem("tnt.sales.selectedCustomer");if(U){const q=JSON.parse(U);return Number(q==null?void 0:q.customerSeq)||0}}catch{}return 0})(),customerId:(()=>{try{const U=localStorage.getItem("tnt.sales.selectedCustomer");if(U){const q=JSON.parse(U);return String((q==null?void 0:q.customerId)||"")}}catch{}return""})(),hideRefresh:!0,enableContextMenu:!0})})]})]})}function Nn({customerSeq:s}){const[o,d]=t.useState([]),[D,H]=t.useState(!1),[U,q]=t.useState(null),[Q,W]=t.useState([]);async function se(){q(null),H(!0);try{const Y=s??(()=>{try{const p=localStorage.getItem("tnt.sales.selectedCustomer");if(p){const L=JSON.parse(p);return Number(L==null?void 0:L.customerSeq)}}catch{}})();if(!Y||Number.isNaN(Y)){d([]),W([]),H(!1);return}const v=new URL(`/api/v1/customers/${Y}/transactions`,window.location.origin),c=await fetch(v.toString());if(!c.ok){let p=`HTTP ${c.status}`;try{const L=await c.json();L!=null&&L.error&&(p=L.error)}catch{}throw new Error(p)}const f=await c.json(),a=Array.isArray(f)?f:[];d(a);let C=[];if(a.length>0){const p=new Map;a.forEach(L=>{const X=L.minorName||"na",ue=p.get(X)||{qty:0,amt:0};ue.qty+=Number(L.qty??L.qty??0)||0,ue.amt+=Number(L.curAmt||0)||0,p.set(X,ue)}),C=Array.from(p.entries()).map(([L,X])=>({name:L,qty:X.qty,amt:X.amt})),C.sort((L,X)=>X.qty-L.qty||X.amt-L.amt),W(C)}else W([]);const w=await fetch(`/api/v1/customers/${Y}/transactions/summary`);let b=[];if(w.ok)try{const p=await w.json();b=(Array.isArray(p)?p:[]).map(L=>({name:L.minorName||"na",qty:Number(L.qty||0),amt:Number(L.amt||0)}))}catch{b=[]}b.sort((p,L)=>L.qty-p.qty||L.amt-p.amt),b.length>0&&W(b)}catch(Y){q(Y.message||"조회 중 오류가 발생했습니다")}finally{H(!1)}}t.useEffect(()=>{se()},[s]);const ee=t.useMemo(()=>{const Y=[...Q];return Y.sort((v,c)=>c.qty-v.qty||c.amt-v.amt),Y},[Q]),S=t.useMemo(()=>{const Y=[...Q];return Y.sort((v,c)=>c.amt-v.amt||c.qty-v.qty),Y},[Q]);function g({data:Y,type:v}){const f={top:10,right:10,bottom:60,left:10},a=Math.max(360,Y.length*80),C=a-f.left-f.right,w=180-f.top-f.bottom,b=Math.max(1,...Y.map(L=>L.value)),p=C/Math.max(1,Y.length);return e.jsx("div",{style:{overflowX:"auto"},children:e.jsx("svg",{width:a,height:180,children:e.jsx("g",{transform:`translate(${f.left},${f.top})`,children:Y.map((L,X)=>{const ue=X*p+p*.15,de=p*.7,r=Math.max(0,L.value/b*w),u=w-r;return e.jsxs("g",{transform:`translate(${ue},0)`,children:[e.jsx("rect",{x:0,y:u,width:de,height:r,fill:v==="amt"?"#4e79a7":"#f28e2b"}),e.jsx("text",{x:de/2,y:w+14,fontSize:11,textAnchor:"middle",fill:"var(--muted)",transform:`rotate(25 ${de/2},${w+14})`,children:L.name}),e.jsx("text",{x:de/2,y:u-4,fontSize:11,textAnchor:"middle",fill:"var(--text)",children:L.value.toLocaleString()})]},X)})})})})}const M=t.useMemo(()=>e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:6},children:e.jsxs("div",{className:"muted count-text",children:["총 ",o.length,"건"]})}),o.length>0&&e.jsxs("div",{className:"card",style:{padding:12,marginBottom:8},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"baseline"},children:[e.jsx("b",{children:"중분류별 금액/수량"}),e.jsx("span",{className:"muted",style:{fontSize:12},children:"가로축: 중분류"})]}),e.jsxs("div",{style:{marginTop:8},children:[e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{className:"muted",style:{marginBottom:4},children:"금액"}),e.jsx(g,{type:"amt",data:S.map(Y=>({name:Y.name,value:Y.amt}))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",style:{marginBottom:4},children:"수량"}),e.jsx(g,{type:"qty",data:ee.map(Y=>({name:Y.name,value:Y.qty}))})]})]})]}),e.jsx("div",{className:"table-container",children:o.length===0?e.jsx("div",{className:"empty-state",children:"거래 내역이 없습니다."}):e.jsxs("table",{className:"table transactions",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:160},children:"전표번호"}),e.jsx("th",{style:{width:160},children:"중분류"}),e.jsx("th",{children:"품목명"}),e.jsx("th",{style:{width:100,textAlign:"right"},children:"수량"}),e.jsx("th",{style:{width:160,textAlign:"right"},children:"금액"}),e.jsx("th",{style:{width:140},children:"전표일자"})]})}),e.jsx("tbody",{children:(()=>{let Y="",v="",c="";const f=[];return o.forEach((a,C)=>{const w=a.invoiceNo!==Y;let b="",p="",L="",X;w?(C>0&&f.push(e.jsx("tr",{className:"sep-row",children:e.jsx("td",{colSpan:6})},`sep-${C}`)),b=a.invoiceNo,p=a.invoiceDate,L=a.minorName||"na",X=void 0,Y=a.invoiceNo,v=a.invoiceDate,c=a.minorName):(a.invoiceDate!==v&&(p=a.invoiceDate,v=a.invoiceDate),a.minorName!==c&&(L=a.minorName||"na",c=a.minorName),X="same-invoice"),f.push(e.jsxs("tr",{className:X,children:[e.jsx("td",{className:"col-invno",children:b}),e.jsx("td",{children:L}),e.jsx("td",{children:a.itemName}),e.jsx("td",{style:{textAlign:"right"},children:Number(a.qty??a.qty??0).toLocaleString()}),e.jsx("td",{style:{textAlign:"right"},children:Number(a.curAmt||0).toLocaleString()}),e.jsx("td",{className:"col-invdate",children:p?(()=>{const ue=new Date(p);if(isNaN(ue.getTime()))return p;const de=String(ue.getFullYear()%100).padStart(2,"0"),r=String(ue.getMonth()+1).padStart(2,"0"),u=String(ue.getDate()).padStart(2,"0"),$=String(ue.getHours()).padStart(2,"0"),N=String(ue.getMinutes()).padStart(2,"0");return`${de}-${r}-${u} ${$}:${N}`})():""})]},`row-${C}`))}),f})()})]})})]}),[o]);return e.jsxs("div",{children:[e.jsx("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:8},children:U&&e.jsx("span",{className:"error",children:U})}),M]})}function la(s){if(s==null)return"";const o=Number(s);return isFinite(o)?`${(o<=1?o*100:o).toLocaleString(void 0,{maximumFractionDigits:2})}%`:""}function Sn({customerName:s,refreshTick:o=0}){const[d,D]=t.useState([]),[H,U]=t.useState(!1),[q,Q]=t.useState(null);async function W(){if(s!=null&&s.trim()){U(!0),Q(null);try{const ee=new URLSearchParams({customer:s,limit:"1000"}),S=await fetch(`/api/v1/demand?${ee.toString()}`);if(!S.ok){const Y=await S.json().catch(()=>({}));throw new Error((Y==null?void 0:Y.error)||`HTTP ${S.status}`)}const M=(await S.json()||[]).map(Y=>({itemSubcategory:Y.itemSubcategory??null,supplierName:Y.supplierName??null,salesMgmtUnit:Y.salesMgmtUnit??null,shareRate:Y.shareRate??null}));D(M)}catch(ee){Q(ee.message||"로드 중 오류가 발생했습니다")}finally{U(!1)}}}t.useEffect(()=>{W()},[s,o]);const se=t.useMemo(()=>{const ee=new Set,S=new Set,g=new Map;for(const v of d){const c=v.itemSubcategory||"-",f=`${v.supplierName||"-"}|${v.salesMgmtUnit||"-"}`;ee.add(c),S.add(f);const a=`${c}::${f}`;g.set(a,v.shareRate)}const M=Array.from(ee).sort((v,c)=>v.localeCompare(c)),Y=Array.from(S).sort((v,c)=>v.localeCompare(c));return{rows:M,cols:Y,cell:g}},[d]);return e.jsxs("section",{children:[H&&e.jsx("div",{className:"muted",style:{marginBottom:8},children:"불러오는 중…"}),q&&e.jsx("div",{className:"error",style:{marginTop:8},children:q}),e.jsx("div",{className:"table-container",style:{marginTop:8,border:"1px solid var(--border)",borderRadius:8},children:e.jsxs("table",{className:"table",style:{width:"100%",borderCollapse:"separate",borderSpacing:0},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{position:"sticky",left:0,background:"var(--bg)",textAlign:"left",padding:"8px 10px",zIndex:1},children:"중분류"}),se.cols.map(ee=>{const[S,g]=ee.split("|");return e.jsxs("th",{style:{textAlign:"center",padding:"8px 10px",whiteSpace:"nowrap"},children:[e.jsx("div",{children:S}),e.jsx("div",{className:"muted",style:{fontSize:12},children:g})]},ee)})]})}),e.jsx("tbody",{children:se.rows.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:Math.max(1,se.cols.length+1),className:"muted",style:{padding:"12px 10px"},children:H?"불러오는 중…":"데이터가 없습니다"})}):se.rows.map(ee=>e.jsxs("tr",{children:[e.jsx("td",{style:{position:"sticky",left:0,background:"var(--bg)",padding:"8px 10px"},children:ee}),se.cols.map(S=>{const g=`${ee}::${S}`,M=se.cell.get(g)??null;return e.jsx("td",{style:{textAlign:"right",padding:"8px 10px"},children:la(M)},S)})]},ee))})]})})]})}function oa(s){if(s==null)return 0;const o=Number(s);return isFinite(o)?o<=1?o*100:o:0}const ws=["#4e79a7","#f28e2b","#e15759","#76b7b2","#59a14f","#edc949","#af7aa1","#ff9da7","#9c755f","#bab0ab","#1f77b4","#ff7f0e"];function ca({data:s,size:o=140}){const d=o/2,D=d,H=d,U=s.filter(se=>(se.value||0)>0),q=U.reduce((se,ee)=>se+Math.max(0,ee.value),0)||1;if(U.length===1)return e.jsx("svg",{width:o,height:o,viewBox:`0 0 ${o} ${o}`,children:e.jsx("circle",{cx:D,cy:H,r:d,fill:ws[0],stroke:"#0b1324",strokeWidth:1})});let Q=-Math.PI/2;const W=U.map((se,ee)=>{const M=Math.max(0,se.value)/q*Math.PI*2,Y=D+d*Math.cos(Q),v=H+d*Math.sin(Q),c=D+d*Math.cos(Q+M),f=H+d*Math.sin(Q+M),a=M>Math.PI?1:0,C=`M ${D} ${H} L ${Y} ${v} A ${d} ${d} 0 ${a} 1 ${c} ${f} Z`;return Q+=M,{path:C,color:ws[ee%ws.length],label:se.label,value:se.value}});return e.jsx("svg",{width:o,height:o,viewBox:`0 0 ${o} ${o}`,children:W.map((se,ee)=>e.jsx("path",{d:se.path,fill:se.color,stroke:"#0b1324",strokeWidth:1},ee))})}function kn({customerName:s,refreshTick:o=0}){const[d,D]=t.useState([]),[H,U]=t.useState(!1),[q,Q]=t.useState(null);async function W(){U(!0),Q(null);try{const ee=new URLSearchParams({customer:s,limit:"1000"}),S=await fetch(`/api/v1/demand?${ee.toString()}`);if(!S.ok){const Y=await S.json().catch(()=>({}));throw new Error((Y==null?void 0:Y.error)||`HTTP ${S.status}`)}const M=(await S.json()||[]).map(Y=>({itemSubcategory:Y.itemSubcategory??null,supplierName:Y.supplierName??null,salesMgmtUnit:Y.salesMgmtUnit??null,shareRate:Y.shareRate??null}));D(M)}catch(ee){Q(ee.message||"로드 중 오류가 발생했습니다")}finally{U(!1)}}t.useEffect(()=>{s&&W()},[s,o]);const se=t.useMemo(()=>{const ee=new Map;for(const S of d){const g=S.itemSubcategory||"-",M=`${S.supplierName||"-"} / ${S.salesMgmtUnit||"-"}`,Y=oa(S.shareRate);ee.has(g)||ee.set(g,[]);const v=ee.get(g),c=v.find(f=>f.label===M);c?c.value+=Y:v.push({label:M,value:Y})}for(const[S,g]of ee)g.sort((M,Y)=>Y.value-M.value);return ee},[d]);return s?e.jsxs("section",{className:"card",style:{marginTop:12},children:[H&&e.jsx("div",{className:"muted",children:Ze.loading}),q&&e.jsx("div",{className:"error",children:q||Ze.errorGeneric}),!H&&!q&&e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:16},children:[Array.from(se.entries()).map(([ee,S])=>e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",border:"1px solid var(--border)",borderRadius:12,padding:12,width:"calc((100% - 16px) / 2)"},children:[e.jsx("div",{style:{flex:"0 0 auto"},children:e.jsx(ca,{data:S})}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontWeight:600,marginBottom:6,fontSize:13},children:ee}),e.jsxs("div",{style:{fontSize:12},children:[S.slice(0,8).map((g,M)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[e.jsx("span",{style:{width:10,height:10,borderRadius:2,background:ws[M%ws.length],display:"inline-block"}}),e.jsx("span",{style:{minWidth:160},children:g.label}),e.jsxs("span",{style:{color:"var(--muted)"},children:[g.value.toLocaleString(void 0,{maximumFractionDigits:2}),"%"]})]},M)),S.length>8&&e.jsxs("div",{className:"muted",children:["외 ",S.length-8,"개…"]})]})]})]},ee)),se.size===0&&e.jsx("div",{className:"empty-state",children:"데이터가 없습니다"})]})]}):null}function Cn({customerName:s,customerSeq:o,empSeq:d,empName:D,onSuccess:H}){const[U,q]=t.useState([]),[Q,W]=t.useState([]),[se,ee]=t.useState([]),[S,g]=t.useState(""),[M,Y]=t.useState(""),[v,c]=t.useState(""),[f,a]=t.useState(""),[C,w]=t.useState({subcats:!1,suppliers:!1,units:!1,submit:!1}),[b,p]=t.useState(null),[L,X]=t.useState(null);t.useEffect(()=>{async function r(){w(u=>({...u,subcats:!0})),p(null);try{const u=await fetch("/api/v1/supplier/subcategories");if(!u.ok)throw new Error(`HTTP ${u.status}`);const $=await u.json();q($||[])}catch(u){p(u.message||"중분류 목록을 불러오지 못했습니다")}finally{w(u=>({...u,subcats:!1}))}}r()},[]),t.useEffect(()=>{if(Y(""),W([]),c(""),ee([]),!S)return;async function r(){w(u=>({...u,suppliers:!0})),p(null);try{const u=new URLSearchParams({subcategory:S}),$=await fetch(`/api/v1/supplier/names?${u.toString()}`);if(!$.ok)throw new Error(`HTTP ${$.status}`);const N=await $.json();W(N||[])}catch(u){p(u.message||"공급사 목록을 불러오지 못했습니다")}finally{w(u=>({...u,suppliers:!1}))}}r()},[S]),t.useEffect(()=>{if(c(""),ee([]),!S||!M)return;async function r(){w(u=>({...u,units:!0})),p(null);try{const u=new URLSearchParams({subcategory:S,supplier:M}),$=await fetch(`/api/v1/supplier/units?${u.toString()}`);if(!$.ok)throw new Error(`HTTP ${$.status}`);const N=await $.json();ee(N||[])}catch(u){p(u.message||"영업관리단위를 불러오지 못했습니다")}finally{w(u=>({...u,units:!1}))}}r()},[S,M]);const ue=t.useMemo(()=>{if(!f)return"";const r=Number(f);if(!isFinite(r))return"숫자를 입력하세요";const u=r<=1?r*100:r;return Ze.hint.sharePreview(u)},[f]);async function de(){if(X(null),p(null),!S||!M||!v){p("중분류/공급사/영업관리단위를 선택하세요");return}const r=Number(f);if(!isFinite(r)||r<=0){p("점유율을 올바르게 입력하세요");return}w(u=>({...u,submit:!0}));try{const u={customerSeq:o,customerName:s||void 0,empSeq:d&&d>0?d:void 0,empName:D||void 0,itemSubcategory:S,supplierName:M,salesMgmtUnit:v,share:r},$=await fetch("/api/v1/demand/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)}),N=await $.json().catch(()=>({}));if(!$.ok)throw new Error((N==null?void 0:N.error)||`HTTP ${$.status}`);X("등록되었습니다"),H&&H()}catch(u){p(u.message||"등록 중 오류가 발생했습니다")}finally{w(u=>({...u,submit:!1}))}}return e.jsxs("section",{style:{marginTop:16},children:[e.jsx("h3",{style:{marginTop:0},children:"수요등록"}),e.jsxs("div",{className:"card",style:{padding:12},children:[e.jsxs("div",{className:"form-grid",style:{gridTemplateColumns:"1fr 1fr 1fr 1fr"},children:[e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"중분류"}),e.jsxs("select",{value:S,onChange:r=>g(r.target.value),children:[e.jsx("option",{value:"",children:"선택하세요"}),U.map(r=>e.jsx("option",{value:r,children:r},r))]}),C.subcats&&e.jsx("div",{className:"muted",style:{marginTop:4},children:"불러오는 중…"})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"공급사"}),e.jsxs("select",{value:M,onChange:r=>Y(r.target.value),disabled:!S||C.suppliers,children:[e.jsx("option",{value:"",children:"선택하세요"}),Q.map(r=>e.jsx("option",{value:r,children:r},r))]})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"영업관리단위"}),e.jsxs("select",{value:v,onChange:r=>c(r.target.value),disabled:!S||!M||C.units,children:[e.jsx("option",{value:"",children:"선택하세요"}),se.map(r=>e.jsx("option",{value:r,children:r},r))]})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"점유율(%)"}),e.jsx(gt,{value:f,onChange:r=>a(r),placeholder:"예: 0.25 또는 25"}),ue&&e.jsx("div",{className:"muted",style:{marginTop:4},children:ue})]})]}),b&&e.jsx("div",{className:"error",style:{marginTop:8},children:b||Ze.errorGeneric}),L&&e.jsx("div",{className:"muted",style:{marginTop:8},children:L}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:12},children:e.jsx("button",{className:"btn",onClick:de,disabled:C.submit,children:C.submit?Ze.fetching:s?`${s}에 ${Ze.action.register}`:Ze.action.register})})]})]})}const An=[{value:"Credit / Receivable",label:"신용·채권"},{value:"Pricing / Terms",label:"가격·조건"},{value:"Quality / Claim",label:"품질·클레임"},{value:"Logistics / Delivery",label:"물류·납기"},{value:"Contract / Legal",label:"계약·법무"},{value:"Relationship / Strategic",label:"관계·전략"},{value:"Operational",label:"운영 이슈"},{value:"기타",label:"기타"}],da=s=>{if(!s)return"미정";const o=An.find(d=>d.value===s);return(o==null?void 0:o.label)??s},dn={noteTitle:"",noteContent:"",noteType:"",importanceLevel:1},ua=s=>{try{const o=new Date(s),d=String(o.getFullYear()).slice(-2),D=String(o.getMonth()+1).padStart(2,"0"),H=String(o.getDate()).padStart(2,"0"),U=String(o.getHours()).padStart(2,"0"),q=String(o.getMinutes()).padStart(2,"0");return`${d}-${D}-${H} ${U}:${q}`}catch{return s}},un=s=>s==null?"중요도 미정":["하","중","상"][Math.min(Math.max(s,0),2)];function ma({customerSeq:s,customerId:o,empName:d}){const[D,H]=t.useState([]),[U,q]=t.useState(!1),[Q,W]=t.useState(null),[se,ee]=t.useState(0),[S,g]=t.useState(!1),[M,Y]=t.useState(!1),[v,c]=t.useState(null),[f,a]=t.useState(()=>({...dn})),[C,w]=t.useState(null),b=t.useMemo(()=>typeof window>"u"?"":localStorage.getItem("tnt.sales.assigneeId")??"",[]),[p,L]=t.useState(null),[X,ue]=t.useState(null),[de,r]=t.useState(!1);t.useEffect(()=>{if(!o){W("고객 ID가 없어 특이사항을 불러올 수 없습니다."),H([]);return}let j=!1;async function ne(){q(!0),W(null);try{const l=await fetch(`/api/v1/customers/${o}/special-notes`);if(!l.ok)throw new Error(`HTTP ${l.status}`);const i=await l.json();if(j)return;const x=Array.isArray(i)?i:[];x.sort((h,O)=>new Date(O.updatedAt??O.createdAt).getTime()-new Date(h.updatedAt??h.createdAt).getTime()),H(x)}catch(l){if(j)return;W(l.message||"특이사항을 불러오지 못했습니다."),H([])}finally{j||q(!1)}}return ne(),()=>{j=!0}},[o,se]);const u=async j=>{if(j.preventDefault(),!o)return;Y(!0),c(null);const ne=C!=null,l=b||"system";try{const i={customerId:o,customerSeq:s,noteTitle:f.noteTitle.trim()||"특이사항",noteContent:f.noteContent.trim(),noteType:f.noteType||void 0,importanceLevel:f.importanceLevel},x=ne?`/api/v1/customers/${o}/special-notes/${C.id}`:`/api/v1/customers/${o}/special-notes`,h=ne?"PUT":"POST";ne||(i.createdBy=l),i.updatedBy=l;const O=await fetch(x,{method:h,headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!O.ok){const E=await O.json().catch(()=>null);throw new Error((E==null?void 0:E.error)||`HTTP ${O.status}`)}N(),ee(E=>E+1)}catch(i){c(i.message||(ne?"수정 중 오류가 발생했습니다.":"등록 중 오류가 발생했습니다."))}finally{Y(!1)}};t.useEffect(()=>{if(!S)return;const j=ne=>{ne.key==="Escape"&&N()};return window.addEventListener("keydown",j),()=>window.removeEventListener("keydown",j)},[S]);const $=()=>a({...dn}),N=()=>{g(!1),w(null),$(),c(null)},m=j=>{w(j??null),a({noteTitle:(j==null?void 0:j.noteTitle)??"",noteContent:(j==null?void 0:j.noteContent)??"",noteType:(j==null?void 0:j.noteType)??"",importanceLevel:(j==null?void 0:j.importanceLevel)??1}),c(null),g(!0)},P=j=>{L(j)},te=async()=>{if(!o||!p)return;const j=p;c(null),r(!0);try{const ne=b||"system",l=await fetch(`/api/v1/customers/${o}/special-notes/${j.id}`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({updatedBy:ne})});if(!l.ok){const i=await l.json().catch(()=>null);throw new Error((i==null?void 0:i.error)||`HTTP ${l.status}`)}ue("특이사항을 삭제했습니다."),H(i=>i.filter(x=>x.id!==j.id)),ee(i=>i+1)}catch(ne){c(ne.message||"삭제 중 오류가 발생했습니다.")}finally{r(!1),L(null)}};t.useEffect(()=>{if(!X)return;const j=window.setTimeout(()=>ue(null),4e3);return()=>window.clearTimeout(j)},[X]);const K=j=>j==null?"unknown":j>=2?"high":j===1?"medium":"low";return e.jsxs("div",{className:"special-notes",children:[e.jsx("header",{className:"special-notes-header",children:e.jsx("button",{className:"btn btn-card btn-3d",type:"button",onClick:()=>m(),children:"신규"})}),Q?e.jsx("div",{className:"empty-state",children:Q}):U?e.jsx("div",{className:"empty-state",children:"특이사항을 불러오는 중입니다…"}):D.length===0?e.jsx("div",{className:"empty-state",children:"등록된 특이사항이 없습니다."}):e.jsx("div",{className:"special-notes-list",children:D.map(j=>e.jsxs("article",{className:"special-note-card",children:[e.jsxs("div",{className:"note-actions",children:[e.jsx("button",{type:"button",className:"note-edit-button","aria-label":"특이사항 수정",onClick:()=>m(j),children:"✎"}),e.jsx("button",{type:"button",className:"note-delete-button","aria-label":"특이사항 삭제",onClick:()=>P(j),children:"🗑"})]}),e.jsxs("div",{className:"note-top",children:[e.jsx("span",{className:`importance-dot level-${K(j.importanceLevel)}`,"aria-label":`중요도 ${un(j.importanceLevel)}`,children:un(j.importanceLevel)}),e.jsxs("div",{className:"note-meta-info",children:[e.jsx("span",{className:"note-type",children:da(j.noteType)}),e.jsx("strong",{className:"note-date",children:ua(j.updatedAt??j.createdAt)})]})]}),e.jsx("strong",{className:"note-title",children:j.noteTitle||"특이사항"}),e.jsx("p",{className:"note-content",children:j.noteContent}),e.jsxs("div",{className:"special-note-meta",children:[e.jsxs("span",{className:"meta-pill",children:[e.jsx("span",{className:"meta-icon edit-icon","aria-hidden":"true",children:"✎"}),e.jsx("span",{children:"수정자"}),e.jsx("strong",{children:j.updatedByName||j.updatedBy||"-"})]}),e.jsxs("span",{className:"meta-pill",children:[e.jsx("span",{className:"meta-icon user-icon","aria-hidden":"true",children:"👤"}),e.jsx("span",{children:"등록자"}),e.jsx("strong",{children:j.createdByName||j.createdBy})]})]})]},j.id))}),S&&e.jsx("div",{className:"overlay-modal",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"overlay-card",children:[e.jsx("button",{type:"button",className:"modal-close","aria-label":"닫기",onClick:N,children:"×"}),e.jsx("h4",{children:"특이사항 등록"}),e.jsxs("form",{className:"special-note-form",onSubmit:u,children:[e.jsxs("label",{children:[e.jsx("span",{children:"제목"}),e.jsx("input",{type:"text",value:f.noteTitle,onChange:j=>a(ne=>({...ne,noteTitle:j.target.value})),placeholder:"예: 신용이슈",required:!0})]}),e.jsxs("label",{children:[e.jsx("span",{children:"유형"}),e.jsxs("select",{value:f.noteType,onChange:j=>a(ne=>({...ne,noteType:j.target.value})),children:[e.jsx("option",{value:"",children:"선택 안 함"}),An.map(j=>e.jsx("option",{value:j.value,children:j.label},j.value))]})]}),e.jsxs("label",{children:[e.jsx("span",{children:"중요도"}),e.jsxs("select",{value:f.importanceLevel,onChange:j=>a(ne=>({...ne,importanceLevel:Number(j.target.value)})),children:[e.jsx("option",{value:2,children:"상"}),e.jsx("option",{value:1,children:"중"}),e.jsx("option",{value:0,children:"하"})]})]}),e.jsxs("label",{children:[e.jsx("span",{children:"내용"}),e.jsx("textarea",{value:f.noteContent,onChange:j=>a(ne=>({...ne,noteContent:j.target.value})),rows:4,required:!0})]}),v?e.jsx("div",{className:"empty-state",children:v}):null,e.jsxs("footer",{children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:()=>g(!1),disabled:M,children:"취소"}),e.jsx("button",{type:"submit",className:"btn btn-card btn-3d",disabled:M,children:M?"등록 중…":"등록"})]})]})]})}),X&&e.jsxs("div",{className:"toast-message",children:[e.jsx("span",{children:X}),e.jsx("button",{type:"button",onClick:()=>ue(null),children:"×"})]}),p&&e.jsx("div",{className:"confirm-overlay",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"confirm-card",children:[e.jsxs("p",{children:[e.jsx("strong",{children:p.noteTitle||"특이사항"}),"을(를) 삭제하시겠습니까?",e.jsx("br",{}),"삭제하면 되돌릴 수 없습니다."]}),e.jsxs("div",{className:"confirm-actions",children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:()=>L(null),disabled:de,children:"취소"}),e.jsx("button",{type:"button",className:"btn btn-card btn-3d",onClick:te,disabled:de,children:de?"삭제 중…":"삭제"})]})]})})]})}function ha(){const[s,o]=t.useState(()=>{try{const W=localStorage.getItem("tnt.sales.selectedCustomer");return W?JSON.parse(W):null}catch{return null}}),[d,D]=t.useState("transactions"),[H,U]=t.useState(0);t.useEffect(()=>{try{const W=localStorage.getItem("tnt.sales.selectedCustomer");o(W?JSON.parse(W):null)}catch{o(null)}},[]),t.useEffect(()=>{const W=()=>{try{const se=localStorage.getItem("tnt.sales.selectedCustomer");o(se?JSON.parse(se):null)}catch{o(null)}};return window.addEventListener("tnt.sales.customer.selected",W),()=>window.removeEventListener("tnt.sales.customer.selected",W)},[]);const q=t.useMemo(()=>e.jsx(wn,{compact:!0,maxHeight:"32vh",context:"c360"}),[]),Q=()=>!s||s.customerSeq==null?e.jsx("div",{className:"empty-state",children:"거래처를 선택하세요."}):d==="transactions"?e.jsx(Nn,{customerSeq:s.customerSeq}):d==="activities"?e.jsx(Xs,{customerSeq:s.customerSeq,customerId:s.customerId||"",hideRefresh:!0,enableContextMenu:!0}):d==="demand"?s.customerName?e.jsxs("div",{className:"c360-demand-stack",children:[e.jsx(Sn,{customerName:s.customerName,refreshTick:H}),e.jsx(kn,{customerName:s.customerName,refreshTick:H}),e.jsx(Cn,{customerName:s.customerName,customerSeq:s.customerSeq,empSeq:s.empSeq,empName:s.empName||void 0,onSuccess:()=>U(W=>W+1)})]}):e.jsx("div",{className:"empty-state",children:"수요정보를 보려면 거래처명을 확인하세요."}):d==="special-notes"?e.jsx(ma,{customerSeq:s.customerSeq,customerId:s.customerId,empName:s.empName}):d==="complaint"?e.jsx("div",{className:"card",style:{padding:12},children:e.jsx("div",{className:"muted",children:"Complaint 기능은 추후 제공될 예정입니다."})}):null;return e.jsxs("section",{className:"c360",children:[q,e.jsxs("section",{className:"card c360-panel",style:{marginTop:12,minHeight:240},children:[e.jsxs("div",{className:"tabs c360-tabs",children:[e.jsx("button",{className:d==="transactions"?"tab active":"tab",onClick:()=>D("transactions"),children:"거래 내역"}),e.jsx("button",{className:d==="activities"?"tab active":"tab",onClick:()=>D("activities"),children:"영업활동"}),e.jsx("button",{className:d==="demand"?"tab active":"tab",onClick:()=>D("demand"),children:"수요정보"}),e.jsx("button",{className:d==="special-notes"?"tab active":"tab",onClick:()=>D("special-notes"),children:"특이사항"}),e.jsx("button",{className:d==="complaint"?"tab active":"tab",onClick:()=>D("complaint"),children:"Complaint"})]}),e.jsx("div",{className:`c360-tab-panel-wrapper ${d==="demand"?"c360-demand-scroll":""}`,children:e.jsx("div",{className:"c360-tab-panel",children:Q()})})]})]})}function In({open:s,onClose:o,leadId:d,leadName:D,targetKind:H,targetCompanyType:U,editId:q,initial:Q,onSaved:W}){const{ref:se,style:ee,bindHeader:S,bindContainer:g}=At("lead.activity",s,b=>{const p=document.querySelector(".pane.center"),L=p?p.getBoundingClientRect():null,X=b.getBoundingClientRect(),ue=X.width,de=X.height,r=L?L.left+(L.width-ue)/2:(window.innerWidth-ue)/2,u=L?L.top+Math.max(24,(L.height-de)*.2):Math.max(24,(window.innerHeight-de)*.2);return{x:r,y:u}},{persist:!1,resetOnOpen:!0});t.useEffect(()=>{if(!s)return;const b=p=>{p.key==="Escape"&&o()};return window.addEventListener("keydown",b,!0),()=>window.removeEventListener("keydown",b,!0)},[s,o]);const M=t.useCallback(()=>{q||o()},[q,o]),Y=H||(d?"lead":void 0),v=(()=>{const b=(D??"").toString().trim();return b||((Q==null?void 0:Q.customerName)??"").toString().trim()})(),c=(U??"").toString().trim().toUpperCase(),f=Y==="lead"?"잠":c.includes("TNT")?"T":c.includes("DYS")?"D":c?c.slice(0,1):"거",a=Y==="lead"?"잠재고객":c||"거래처",C=Y?e.jsx("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:22,height:22,borderRadius:"50%",fontSize:12,fontWeight:700,background:Y==="lead"?"rgba(236,72,153,.2)":"rgba(59,130,246,.2)",color:Y==="lead"?"#be185d":"#1d4ed8"},title:a,children:f}):null,w=q?"영업활동":"영업활동 등록";return s?e.jsxs("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:11e3,pointerEvents:"none"},children:[e.jsx("div",{style:{position:"absolute",inset:0,background:"rgba(0,0,0,.25)",pointerEvents:"none"}}),e.jsxs("div",{ref:se,className:"card",style:{...ee,width:"min(880px, 96vw)",maxHeight:"86vh",overflow:"auto",padding:16,pointerEvents:"auto"},...g,children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:6,cursor:"move"},...S,children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[e.jsx("h3",{style:{margin:0},children:w}),v||C?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,fontSize:13,fontWeight:600,color:"var(--text)"},children:[v?e.jsx("span",{children:v}):null,C]}):null]}),e.jsx("span",{role:"button",tabIndex:0,className:"icon-button","aria-label":"닫기",title:"닫기",onClick:o,children:e.jsx("img",{src:ct,className:"icon",alt:"닫기"})})]}),e.jsx(Ss,{bare:!0,editId:q??void 0,leadId:d??void 0,initial:Q,onNoticeClose:M,onSaved:b=>{W?W():o()}})]})]}):null}function bs(s){if(!s)return"";const o=new Date(s);if(isNaN(o.getTime()))return"";const d=o.getFullYear(),D=String(o.getMonth()+1).padStart(2,"0"),H=String(o.getDate()).padStart(2,"0");return`${d}-${D}-${H}`}function _s(s,o=0){if(!s)return;const d=s.trim();if(!d)return;const[D,H,U]=d.split("-").map(Q=>Number(Q));if(!D||!H||!U)return;const q=new Date(D,H-1,U,o,0,0,0);if(!isNaN(q.getTime()))return q.toISOString()}function mn(s){if(s.type==="customer"){const o=(s.companyType??"").toString().trim(),d=o||"거래처",D=o.toUpperCase(),H=D.includes("TNT")?"T":D.includes("DYS")?"D":(D||"거")[0];return{label:d,bg:"rgba(59,130,246,.12)",color:"#1d4ed8",icon:H,iconBg:"#1d4ed8"}}return{label:"잠재",bg:"rgba(236,72,153,.12)",color:"#be185d",icon:"잠",iconBg:"#be185d"}}function pa({onClose:s,prefillAt:o}){const[d,D]=Ne.useState(""),[H,U]=Ne.useState([]),[q,Q]=Ne.useState(!1),[W,se]=Ne.useState(null),[ee,S]=Ne.useState([]),[g,M]=Ne.useState(null);async function Y(){Q(!0),se(null);try{const a=new URL("/api/v1/customers",window.location.origin);a.searchParams.set("mineOnly","false"),d.trim()&&a.searchParams.set("name",d.trim()),a.searchParams.set("limit","100");try{console.debug("[customer search]",a.toString())}catch{}const C=await fetch(a.toString());if(!C.ok)throw new Error(`HTTP ${C.status}`);const w=await C.json(),b=Array.isArray(w)?w.map(p=>({customerSeq:(p==null?void 0:p.customerSeq)??(p==null?void 0:p.customer_seq)??null,customerId:(p==null?void 0:p.customerId)??(p==null?void 0:p.customer_id)??null,customerName:(p==null?void 0:p.customerName)??(p==null?void 0:p.customer_name)??null,ownerName:(p==null?void 0:p.ownerName)??(p==null?void 0:p.owner_name)??null,companyType:(p==null?void 0:p.companyType)??(p==null?void 0:p.company_type)??null})).sort((p,L)=>String(p.customerName||"").localeCompare(String(L.customerName||""),"ko-KR")):[];U(b)}catch(a){se((a==null?void 0:a.message)||"조회 실패"),U([])}finally{Q(!1)}}function v(a){S(C=>{const b=C.some(p=>(p.customerId||"")===(a.customerId||""))?C:[a,...C];return!g&&b.length>0&&f(b[0]),b})}function c(a){if(S(C=>C.filter(w=>(w.customerId||"")!==(a.customerId||""))),g&&(g.customerId||"")===(a.customerId||"")){const C=ee.filter(w=>(w.customerId||"")!==(a.customerId||""));f(C[0]||null)}}function f(a){M(a||null);try{a&&localStorage.setItem("tnt.sales.selectedCustomer",JSON.stringify({customerId:a.customerId||"",customerName:a.customerName||""}))}catch{}}return Ne.useEffect(()=>{const a=C=>{C.key==="Escape"&&s()};return window.addEventListener("keydown",a,!0),()=>window.removeEventListener("keydown",a,!0)},[s]),e.jsxs("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:12e3},children:[e.jsx("div",{style:{position:"absolute",inset:0,background:"rgba(0,0,0,.35)"}}),e.jsxs("div",{className:"card",style:{position:"absolute",top:"6%",left:"50%",transform:"translateX(-50%)",width:"min(1200px,96vw)",maxHeight:"88vh",overflow:"auto",padding:12},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[e.jsx("h3",{style:{margin:0},children:"거래처 활동계획수립"}),e.jsx("button",{className:"btn-plain","aria-label":"닫기",title:"닫기",onClick:s,style:{width:32,height:32,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr",gap:12,minHeight:520,alignItems:"start"},children:[e.jsxs("div",{className:"card",style:{padding:12,overflow:"auto"},children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:8},children:[e.jsx("input",{className:"subject-input",placeholder:"거래처명",value:d,onChange:a=>D(a.target.value),onKeyDown:a=>{a.key==="Enter"&&Y()},style:{flex:"0 0 220px",height:28,fontSize:12}}),e.jsx("span",{role:"button",tabIndex:0,className:"icon-button",title:"조회","aria-label":"조회",onClick:Y,children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"icon",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("path",{d:"m21 21-4.35-4.35"})]})})]}),e.jsx("div",{className:"table-container",style:{maxHeight:240,overflowY:"auto",overflowX:"hidden",fontSize:12},children:H.length===0?e.jsx("div",{className:"empty-state",children:q?"불러오는 중…":W||"검색 결과가 없습니다"}):e.jsxs("table",{className:"table",style:{tableLayout:"fixed",width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:100},children:"회사구분"}),e.jsx("th",{style:{width:180},children:"거래처명"}),e.jsx("th",{style:{width:120},children:"대표자명"}),e.jsx("th",{style:{width:48}})]})}),e.jsx("tbody",{children:H.map((a,C)=>e.jsxs("tr",{children:[e.jsx("td",{title:a.companyType||"",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:a.companyType||""}),e.jsx("td",{title:a.customerName||"",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:a.customerName||""}),e.jsx("td",{title:a.ownerName||"",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:a.ownerName||""}),e.jsx("td",{style:{textAlign:"center"},children:e.jsx("span",{role:"button",tabIndex:0,className:"icon-button",title:"계획수립대상 담기","aria-label":"계획수립대상 담기",onClick:()=>v(a),children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"icon",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})})})]},C))})]})}),e.jsxs("div",{style:{marginTop:12,fontWeight:700},children:["계획수립대상(",ee.length,")"]}),e.jsx("div",{className:"table-container",style:{maxHeight:220,overflowY:"auto",overflowX:"hidden",fontSize:12},children:ee.length===0?e.jsx("div",{className:"empty-state",children:"담긴 거래처가 없습니다."}):e.jsxs("table",{className:"table",style:{tableLayout:"fixed",width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:100},children:"회사구분"}),e.jsx("th",{style:{width:180},children:"거래처명"}),e.jsx("th",{style:{width:120},children:"대표자명"}),e.jsx("th",{style:{width:60},children:"작업"})]})}),e.jsx("tbody",{children:ee.map((a,C)=>e.jsxs("tr",{className:g&&(g.customerId||"")===(a.customerId||"")?"selected":"",onClick:()=>f(a),children:[e.jsx("td",{title:a.companyType||"",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:a.companyType||""}),e.jsx("td",{title:a.customerName||"",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:a.customerName||""}),e.jsx("td",{title:a.ownerName||"",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:a.ownerName||""}),e.jsx("td",{style:{textAlign:"center"},children:e.jsx("span",{role:"button",tabIndex:0,className:"icon-button",title:"삭제","aria-label":"삭제",onClick:w=>{w.stopPropagation(),c(a)},children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"icon",children:e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})})})})]},C))})]})})]}),e.jsxs("div",{className:"card plan-compact-card",style:{overflow:"auto"},children:[!g&&e.jsx("div",{className:"empty-state",children:"좌측에서 거래처를 선택해 주세요."}),e.jsx(Ss,{bare:!0,initial:{plannedStartAt:o||void 0,...g?{sfAccountId:g.customerId||"",customerName:g.customerName||"",subject:g!=null&&g.customerName?`${g.customerName} (활동계획) 으로 저장됩니다.`:""}:{}},lockSubject:!0,planMode:!0,multiTargets:ee})]})]})]})]})}function ga(s){const o=new Date(s.getFullYear(),s.getMonth(),s.getDate()),d=o.getDay()||7;return d!==1&&o.setDate(o.getDate()-(d-1)),o.setHours(0,0,0,0),o}function ya(s){const o=new Date(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate())),d=o.getUTCDay()||7;o.setUTCDate(o.getUTCDate()+4-d);const D=new Date(Date.UTC(o.getUTCFullYear(),0,1)),H=Math.ceil(((o.getTime()-D.getTime())/864e5+1)/7);return{year:o.getUTCFullYear(),week:H}}function fa(s){const o=s.getFullYear(),d=s.getMonth()+1;return`${o}년 ${d}월`}function xa(s){return String(s.getDate())}const ja=Array.from({length:24},(s,o)=>o),us=60,hn=18,Us=18;function va(){const[s,o]=Ne.useState(()=>new Date),d=Ne.useMemo(()=>ya(s),[s]),D=Ne.useMemo(()=>ga(s),[s]),H=Ne.useMemo(()=>{const B=new Date(D);return B.setDate(D.getDate()+6),B.setHours(23,59,59,999),B},[D]),U=Ne.useMemo(()=>Array.from({length:7}).map((B,ge)=>{const he=new Date(D);return he.setDate(D.getDate()+ge),he}),[D]),q=Ne.useRef(null),[Q,W]=Ne.useState(()=>({open:!1,x:0,y:0})),se=Ne.useRef(null),[ee,S]=Ne.useState(!1),[g,M]=Ne.useState(!1),[Y,v]=Ne.useState([]),[c,f]=Ne.useState(""),[a,C]=Ne.useState([]),[w,b]=Ne.useState(""),[p,L]=Ne.useState(""),[X,ue]=Ne.useState(""),[de,r]=Ne.useState(""),[u,$]=Ne.useState(""),[N,m]=Ne.useState(""),[P,te]=Ne.useState(""),[K,j]=Ne.useState(!1),[ne,l]=Ne.useState(null),[i,x]=Ne.useState(null),[h,O]=Ne.useState(null),[E,pe]=Ne.useState(""),[re,G]=Ne.useState([]),[xe,_]=Ne.useState(!1),[me,fe]=Ne.useState(null),[Se,Ce]=Ne.useState([]),[I,je]=Ne.useState(null),[V,_e]=Ne.useState([]),[qe,Te]=Ne.useState([]),[Ue,at]=Ne.useState(null),[dt,xt]=Ne.useState(null),[ze,et]=Ne.useState(""),[nt,jt]=Ne.useState(null),[tt,ut]=Ne.useState(""),[Xe,Tt]=Ne.useState(void 0),[pt,Zt]=Ne.useState(!1),es=Ne.useRef(null),kt=Ne.useMemo(()=>{const B=new Array(24).fill(0).map(()=>us);if(!V||V.length===0)return B;const ge=new Array(24).fill(0),he=new Date(D.getFullYear(),D.getMonth(),D.getDate());for(let De=0;De<24;De++){let ie=0;for(let Ee=0;Ee<7;Ee++){const be=new Date(he);be.setDate(be.getDate()+Ee);const Re=be.getFullYear(),We=be.getMonth(),Be=be.getDate(),Oe=V.reduce((lt,Ve)=>{if(!Ve.plannedStartAt)return lt;const Je=new Date(Ve.plannedStartAt);return Je.getFullYear()===Re&&Je.getMonth()===We&&Je.getDate()===Be&&Je.getHours()===De?lt+1:lt},0);Oe>ie&&(ie=Oe)}ge[De]=ie}for(let De=0;De<24;De++){const ie=Math.max(0,ge[De]-1);B[De]=Math.min(us+ie*Us,us+64)}return B},[V,D]),Nt=Ne.useMemo(()=>{const B=[0];for(let ge=0;ge<24;ge++)B[ge+1]=B[ge]+(kt[ge]||us);return B},[kt]),vt=Ne.useCallback(async()=>{try{const B=localStorage.getItem("tnt.sales.assigneeId")||"",ge=localStorage.getItem("tnt.sales.empId")||"",he=new URL("/api/v1/sales-activities",window.location.origin);B?he.searchParams.set("assigneeId",B):ge&&he.searchParams.set("empId",ge),he.searchParams.set("mineOnly","true"),he.searchParams.set("start",D.toISOString()),he.searchParams.set("end",H.toISOString()),he.searchParams.set("onlyRoot","true"),he.searchParams.set("_t",Date.now().toString());const De=await fetch(he.toString(),{cache:"no-cache"});if(!De.ok)throw new Error(`HTTP ${De.status}`);const ie=await De.json(),Ee=Array.isArray(ie)?ie:[];_e(Ee.map(be=>{const Re=be.plannedStartAt||be.planned_start_at,We=(be.activityStatus||be.activity_status||"").toString().toLowerCase(),Be=We==="completed"||We==="완료";return{id:Number(be.id),subject:be.subject,description:be.description,activityType:be.activityType||be.activity_type,activityStatus:be.activityStatus||be.activity_status,channel:be.channel,plannedStartAt:Re?new Date(Re).toISOString():void 0,plannedEndAt:be.plannedEndAt||be.planned_end_at||null,actualStartAt:be.actualStartAt||be.actual_start_at||void 0,sfAccountId:be.sfAccountId||be.sf_account_id||void 0,customerName:be.customerName||be.customer_name||"",leadId:be.sfLeadId||be.sf_lead_id||null,companyType:be.companyType||be.company_type||be.companyTypeName||be.company_type_name||null,isCompleted:Be}}))}catch{_e([])}},[D,H]),_t=Ne.useCallback(async()=>{try{const B=localStorage.getItem("tnt.sales.assigneeId")||localStorage.getItem("tnt.sales.empId")||"";if(!B){Te([]);return}const ge=new URL("/api/v1/region-activity-plans",window.location.origin);ge.searchParams.set("assigneeId",B),ge.searchParams.set("start",D.toISOString()),ge.searchParams.set("end",H.toISOString());const he=await fetch(ge.toString());if(!he.ok)throw new Error(`HTTP ${he.status}`);const De=await he.json(),ie=Array.isArray(De)?De:[];Te(ie.map(Ee=>({id:Number(Ee.id),subject:Ee.subject,plannedStartAt:Ee.planned_start_at||Ee.plannedStartAt||null,plannedEndAt:Ee.planned_end_at||Ee.plannedEndAt||null,actualStartAt:Ee.actual_start_at||Ee.actualStartAt||null,actualEndAt:Ee.actual_end_at||Ee.actualEndAt||null,isCompleted:!!(Ee.actual_start_at||Ee.actualStartAt||Ee.actual_end_at||Ee.actualEndAt)})))}catch{Te([])}},[D,H]);Ne.useEffect(()=>{vt()},[vt]),Ne.useEffect(()=>{_t()},[_t]),Ne.useEffect(()=>{const B=()=>{try{vt()}catch{}};return window.addEventListener("tnt.sales.activity.updated",B),()=>window.removeEventListener("tnt.sales.activity.updated",B)},[vt]);const is=`${d.week}주차`,ls=fa(s),it=Ne.useCallback(()=>{o(B=>{const ge=new Date(B);return ge.setDate(ge.getDate()-7),ge})},[]),Rt=Ne.useCallback(()=>{o(B=>{const ge=new Date(B);return ge.setDate(ge.getDate()+7),ge})},[]),ps=Ne.useCallback(()=>{o(new Date)},[]);Ne.useEffect(()=>{function B(he){let De=he;for(;De;){const ie=(De.tagName||"").toLowerCase();if(["input","textarea","select","button","label","a"].includes(ie)||De!=null&&De.isContentEditable)return!0;De=De.parentElement}return!1}function ge(he){const De=he.target;B(De)||B(document.activeElement)||(he.key==="ArrowLeft"?(he.preventDefault(),it()):he.key==="ArrowRight"&&(he.preventDefault(),Rt()))}return window.addEventListener("keydown",ge,!0),()=>window.removeEventListener("keydown",ge,!0)},[it,Rt]);const qt=Ne.useRef(!1);Ne.useEffect(()=>{if(qt.current)return;const B=q.current;if(!B)return;const ge=Nt[7]||7*us;let he=0;const De=30,ie=()=>{if(B){if(B.scrollTop=ge,he+=1,Math.abs(B.scrollTop-ge)<2||he>=De){qt.current=!0;return}setTimeout(()=>requestAnimationFrame(ie),50)}};requestAnimationFrame(ie)},[Nt]),Ne.useEffect(()=>{if(!Q.open)return;const B=he=>{const De=(he==null?void 0:he.target)||null;se.current&&De&&se.current.contains(De)||W({open:!1,x:0,y:0})},ge=he=>{he.key==="Escape"&&B()};return window.addEventListener("click",B,!0),window.addEventListener("contextmenu",B,!0),window.addEventListener("keydown",ge,!0),()=>{window.removeEventListener("click",B,!0),window.removeEventListener("contextmenu",B,!0),window.removeEventListener("keydown",ge,!0)}},[Q.open]);const Wt=Ne.useCallback(async()=>{try{const B=await fetch("/api/v1/address/provinces"),ge=B.ok?await B.json():[],he=Array.isArray(ge)?ge.filter(Boolean):[];v(he)}catch{v([])}},[]),Ct=Ne.useCallback(async B=>{try{if(!B){C([]);return}const ge=new URL("/api/v1/address/districts",window.location.origin);ge.searchParams.set("province",B);const he=await fetch(ge.toString()),De=he.ok?await he.json():[],ie=Array.isArray(De)?De.filter(Boolean):[];C(ie)}catch{C([])}},[]),$t=Ne.useCallback(()=>{L(""),ue(""),r(""),$(""),m(""),te(""),l(null),Ce([]),O(null)},[]),Ke=Ne.useCallback(()=>{$t();const B=I?bs(I):"";r(B),f(""),b(""),C([]),M(!0),Wt()},[I,Wt,$t]),Et=Ne.useCallback(()=>{$t(),x(null),M(!1)},[$t]);Ne.useEffect(()=>{if(!g)return;const B=ge=>{ge.key==="Escape"&&(ge.preventDefault(),Et())};return window.addEventListener("keydown",B,!0),()=>window.removeEventListener("keydown",B,!0)},[g,Et]);const ts=Ne.useCallback(()=>{try{return localStorage.getItem("tnt.sales.assigneeId")||localStorage.getItem("tnt.sales.empId")||""}catch{return""}},[]);Ne.useEffect(()=>{if(!g||p&&p.trim().length>0||!c)return;const B=w?`${c} ${w}`:c;L(`${B} 지역활동`)},[g,p,c,w]);async function Bt(B){try{const ge=await fetch(`/api/v1/region-activity-plans/${B}`);if(!ge.ok)throw new Error(`HTTP ${ge.status}`);const he=await ge.json();$t(),O(B),L((he==null?void 0:he.subject)||""),ue((he==null?void 0:he.description)||"");const De=(he==null?void 0:he.addrProvinceName)||(he==null?void 0:he.addr_province_name)||"",ie=(he==null?void 0:he.addrDistrictName)||(he==null?void 0:he.addr_district_name)||"";await Wt(),f(De),De?await Ct(De):C([]),b(ie),r(he!=null&&he.planned_start_at?bs(he.planned_start_at):""),$(he!=null&&he.planned_end_at?bs(he.planned_end_at):""),m(he!=null&&he.actual_start_at?bs(he.actual_start_at):""),te(he!=null&&he.actual_end_at?bs(he.actual_end_at):"");const Ee=Array.isArray(he==null?void 0:he.targets)?he.targets:[];Ce(Ee.map((be,Re)=>{const We=(be==null?void 0:be.customerId)||(be==null?void 0:be.customer_id)||"",Be=(be==null?void 0:be.leadId)||(be==null?void 0:be.lead_id)||"",Oe=We?"customer":"lead";return{key:We?`customer-${We}`:Be?`lead-${Be}`:`target-${Re}-${B}`,type:Oe,name:(be==null?void 0:be.displayName)||(be==null?void 0:be.display_name)||We||Be||"(대상)",companyType:(be==null?void 0:be.companyType)||(be==null?void 0:be.company_type)||null,customerId:We||void 0,leadId:Be||void 0}})),M(!0)}catch(ge){window.alert((ge==null?void 0:ge.message)||"지역활동 계획을 불러오지 못했습니다.")}}async function gs(){const B=p.trim();if(!B){l("제목을 입력해 주세요."),x(null);return}if(!c){l("방문 도(Province)를 선택해 주세요."),x(null);return}if(!w){l("방문 시/군/구(District)를 선택해 주세요."),x(null);return}const ge=ts().trim();if(!ge){l("담당자 정보를 확인할 수 없습니다. 다시 로그인해 주세요."),x(null);return}const he={subject:B,addrProvinceName:c,addrDistrictName:w,assigneeId:ge},De=X==null?void 0:X.trim();De&&(he.description=De);const ie=_s(de,8),Ee=_s(u);ie&&(he.plannedStartAt=ie),Ee&&(he.plannedEndAt=Ee);const be=_s(N),Re=_s(P);be&&(he.actualStartAt=be),Re&&(he.actualEndAt=Re);const We=Se.map(Oe=>Oe.type==="customer"&&Oe.customerId?{customerId:Oe.customerId}:Oe.type==="lead"&&Oe.leadId?{leadId:Oe.leadId}:null).filter(Boolean);We.length>0&&(he.targets=We);const Be=Number(ge);Number.isNaN(Be)||(h||(he.createdBy=Be),he.updatedBy=Be),j(!0),l(null),x(null);try{const Oe=h?`/api/v1/region-activity-plans/${h}`:"/api/v1/region-activity-plans",Ve=await fetch(Oe,{method:h?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(he)});let Je=null;try{Je=await Ve.json()}catch{Je=null}if(!Ve.ok){const ft=(Je==null?void 0:Je.message)||(Je==null?void 0:Je.error)||`HTTP ${Ve.status}`;throw new Error(ft)}x(h?"지역활동 계획이 수정되었습니다.":"지역활동 계획이 등록되었습니다."),l(null),await _t()}catch(Oe){l((Oe==null?void 0:Oe.message)||"등록에 실패했습니다."),x(null)}finally{j(!1)}}async function Ht(){const B=E.trim();if(!B){fe("검색어를 입력해 주세요."),G([]);return}_(!0),fe(null);try{const[ge,he]=await Promise.all([(async()=>{const ie=new URL("/api/v1/customers",window.location.origin);ie.searchParams.set("mineOnly","false"),ie.searchParams.set("limit","50"),ie.searchParams.set("name",B);const Ee=await fetch(ie.toString());if(!Ee.ok)throw new Error(`거래처 조회 실패 (HTTP ${Ee.status})`);const be=await Ee.json();return Array.isArray(be)?be:[]})(),(async()=>{const ie=new URL("/api/v1/leads",window.location.origin);ie.searchParams.set("limit","50"),ie.searchParams.set("company_name",B);const Ee=await fetch(ie.toString());if(!Ee.ok)throw new Error(`잠재고객 조회 실패 (HTTP ${Ee.status})`);const be=await Ee.json();return Array.isArray(be)?be:[]})()]),De=[...ge.map((ie,Ee)=>{const be=(ie==null?void 0:ie.customerId)??(ie==null?void 0:ie.customer_id)??(ie==null?void 0:ie.customerSeq)??(ie==null?void 0:ie.customer_seq)??"",Re=be!=null?String(be).trim():"",We=Re?`customer-${Re}`:`customer-${Ee}-${Math.random().toString(36).slice(2)}`,Be=(ie==null?void 0:ie.companyType)??(ie==null?void 0:ie.company_type)??(ie==null?void 0:ie.companyTypeName)??(ie==null?void 0:ie.company_type_name)??(ie==null?void 0:ie.companyClass)??(ie==null?void 0:ie.company_class)??(ie==null?void 0:ie.companyGroup)??(ie==null?void 0:ie.company_group)??null;return{key:We,type:"customer",name:(ie==null?void 0:ie.customerName)??(ie==null?void 0:ie.customer_name)??"(이름 없음)",companyType:Be!=null?String(Be):null,customerId:Re||void 0}}),...he.map((ie,Ee)=>{const be=(ie==null?void 0:ie.id)??(ie==null?void 0:ie.lead_id)??"",Re=be!=null?String(be).trim():"";return{key:Re?`lead-${Re}`:`lead-${Ee}-${Math.random().toString(36).slice(2)}`,type:"lead",name:(ie==null?void 0:ie.company_name)??(ie==null?void 0:ie.companyName)??(ie==null?void 0:ie.contact_name)??"(이름 없음)",leadId:Re||void 0}})];G(De),De.length===0&&fe("조회 결과가 없습니다.")}catch(ge){fe((ge==null?void 0:ge.message)||"조회에 실패했습니다."),G([])}finally{_(!1)}}function ss(B){Ce(ge=>ge.some(he=>he.key===B.key)?ge:[...ge,B])}function Ot(B){Ce(ge=>ge.filter(he=>he.key!==B))}const ns=Ne.useCallback(B=>{at(B.id);const ge=B.leadId?"lead":"customer";es.current!==B.id?(xt(B.leadId??null),et(B.customerName||""),jt(ge),ut(ge==="customer"&&B.companyType||""),Tt({id:B.id,subject:B.subject,description:B.description,activityType:B.activityType,activityStatus:B.activityStatus,channel:B.channel,plannedStartAt:B.plannedStartAt,actualStartAt:B.actualStartAt,sfAccountId:B.sfAccountId,customerName:B.customerName}),es.current=B.id):jt(ge),Zt(!0)},[]),Ge=Ne.useCallback(()=>{Zt(!1),at(null),xt(null),et(""),jt(null),ut(""),Tt(void 0),es.current=null},[]),ht=Ne.useMemo(()=>{const B=V.length,ge=V.filter(Re=>Re.isCompleted).length,he=qe.length,De=qe.filter(Re=>Re.isCompleted).length,ie=B+he,Ee=ge+De,be=ie>0?Math.round(Ee/ie*100):0;return{customerTotal:B,customerCompleted:ge,regionTotal:he,regionCompleted:De,totalPlanned:ie,totalCompleted:Ee,achievementRate:be}},[V,qe]);return e.jsxs("section",{className:"activity-plan-page",children:[e.jsx("div",{className:"card",style:{padding:"12px 16px",marginBottom:12,flexShrink:0},children:e.jsxs("div",{style:{display:"flex",gap:4,alignItems:"center"},children:[e.jsx("button",{onClick:it,title:"이전 주",style:{width:32,height:32,padding:0,display:"flex",alignItems:"center",justifyContent:"center",background:"transparent",border:"none",borderRadius:"4px",cursor:"pointer",color:"var(--text)",transition:"background-color 0.2s"},onMouseEnter:B=>B.currentTarget.style.backgroundColor="var(--hover)",onMouseLeave:B=>B.currentTarget.style.backgroundColor="transparent",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"15 18 9 12 15 6"})})}),e.jsx("button",{onClick:Rt,title:"다음 주",style:{width:32,height:32,padding:0,display:"flex",alignItems:"center",justifyContent:"center",background:"transparent",border:"none",borderRadius:"4px",cursor:"pointer",color:"var(--text)",transition:"background-color 0.2s"},onMouseEnter:B=>B.currentTarget.style.backgroundColor="var(--hover)",onMouseLeave:B=>B.currentTarget.style.backgroundColor="transparent",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"9 18 15 12 9 6"})})}),e.jsx("button",{className:"btn",onClick:ps,style:{marginLeft:4},children:"오늘"}),e.jsxs("span",{className:"badge",style:{marginLeft:"auto"},children:[ls," ",is]})]})}),e.jsxs("div",{className:"activity-kpi-grid",children:[e.jsxs("div",{className:"card kpi-card",style:{background:"linear-gradient(135deg, rgba(59,130,246,0.1) 0%, rgba(147,51,234,0.1) 100%)"},children:[e.jsx("div",{className:"kpi-label",children:"주간 달성률"}),e.jsxs("div",{className:"kpi-value",children:[e.jsx("span",{className:"kpi-number",children:ht.achievementRate}),e.jsx("span",{className:"kpi-unit",children:"%"})]}),e.jsxs("div",{className:"kpi-desc",children:["목표 ",ht.totalPlanned,"건 / 완료 ",ht.totalCompleted,"건"]})]}),e.jsxs("div",{className:"card kpi-card",children:[e.jsx("div",{className:"kpi-label",children:"거래처 활동"}),e.jsxs("div",{className:"kpi-stats",children:[e.jsxs("div",{children:[e.jsx("div",{className:"kpi-stat-label",style:{color:"#dc2626"},children:"목표"}),e.jsx("div",{className:"kpi-stat-value",style:{color:"#dc2626"},children:ht.customerTotal})]}),e.jsx("div",{className:"kpi-arrow",children:"→"}),e.jsxs("div",{children:[e.jsx("div",{className:"kpi-stat-label",style:{color:"#2563eb"},children:"완료"}),e.jsx("div",{className:"kpi-stat-value",style:{color:"#2563eb"},children:ht.customerCompleted})]})]}),e.jsx("div",{className:"kpi-progress",children:e.jsx("div",{style:{width:`${ht.customerTotal>0?ht.customerCompleted/ht.customerTotal*100:0}%`,background:"linear-gradient(90deg, #dc2626 0%, #2563eb 100%)"}})})]}),e.jsxs("div",{className:"card kpi-card",children:[e.jsx("div",{className:"kpi-label",children:"지역 활동"}),e.jsxs("div",{className:"kpi-stats",children:[e.jsxs("div",{children:[e.jsx("div",{className:"kpi-stat-label",style:{color:"#dc2626"},children:"목표"}),e.jsx("div",{className:"kpi-stat-value",style:{color:"#dc2626"},children:ht.regionTotal})]}),e.jsx("div",{className:"kpi-arrow",children:"→"}),e.jsxs("div",{children:[e.jsx("div",{className:"kpi-stat-label",style:{color:"#10b981"},children:"완료"}),e.jsx("div",{className:"kpi-stat-value",style:{color:"#10b981"},children:ht.regionCompleted})]})]}),e.jsx("div",{className:"kpi-progress",children:e.jsx("div",{style:{width:`${ht.regionTotal>0?ht.regionCompleted/ht.regionTotal*100:0}%`,background:"linear-gradient(90deg, #dc2626 0%, #10b981 100%)"}})})]})]}),e.jsxs("div",{className:"card",style:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column",minHeight:0},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"60px repeat(7, 1fr)",background:"var(--panel)",borderBottom:"1px solid var(--border)",flex:"0 0 auto"},children:[e.jsx("div",{style:{padding:8,fontSize:12,color:"var(--text-muted)"},children:"시간"}),U.map((B,ge)=>e.jsx("div",{style:{padding:8,textAlign:"center",borderLeft:ge>0?"1px solid var(--border)":"none"},children:e.jsxs("div",{style:{fontSize:12,color:"var(--text-muted)"},children:[["월","화","수","목","금","토","일"][ge]," ",xa(B)]})},ge))]}),e.jsx("div",{ref:q,className:"calendar-scroll",onContextMenu:B=>{B.preventDefault();const ge=B.target;let he=null,De=null;const ie=Re=>{var Ve,Je;if(!Re)return!1;const We=Re.getAttribute("data-day")||((Ve=Re.dataset)==null?void 0:Ve.day),Be=Re.getAttribute("data-hour")||((Je=Re.dataset)==null?void 0:Je.hour),Oe=We?parseInt(We,10):NaN,lt=Be?parseInt(Be,10):NaN;return!Number.isNaN(Oe)&&!Number.isNaN(lt)?(he=Oe,De=lt,!0):!1},Ee=ge?ge.closest(".week-event"):null,be=ge?ge.closest(".week-cell"):null;if(!(ie(Ee)||ie(be))){const Re=q.current;if(Re){const We=Re.getBoundingClientRect(),Be=B.clientX-We.left,Oe=B.clientY-We.top+Re.scrollTop,lt=Be-60,Ve=Math.max(1,(We.width-60)/7),Je=Math.floor(lt/Ve);let Ut=0;for(let ft=0;ft<24&&Oe>=Nt[ft];ft++)Ut=ft;Je>=0&&Je<=6&&Ut>=0&&Ut<=23&&(he=Je,De=Ut)}}if(he!=null&&De!=null){const Re=new Date(D);Re.setDate(Re.getDate()+he),Re.setHours(De,0,0,0),je(new Date(Re).toISOString())}W({open:!0,x:B.clientX,y:B.clientY})},style:{flex:1,overflowY:"scroll",overflowX:"hidden",minHeight:0},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"60px repeat(7, 1fr)",gridTemplateRows:kt.map(B=>`${B}px`).join(" "),position:"relative"},children:[ja.map(B=>e.jsxs(Ne.Fragment,{children:[e.jsxs("div",{style:{gridColumn:"1",gridRow:`${B+1}`,height:kt[B]||us,padding:"4px 8px",fontSize:11,color:"var(--text-muted)",borderTop:"1px solid var(--border)"},children:[String(B).padStart(2,"0"),":00"]}),U.map((ge,he)=>e.jsx("div",{className:"week-cell","data-day":he,"data-hour":B,style:{gridColumn:`${he+2}`,gridRow:`${B+1}`,borderTop:"1px solid var(--border)",borderLeft:"1px solid var(--border)"}},`${B}-${he}`))]},B)),(()=>{const B=new Map,ge=V.map(ie=>{if(!ie.plannedStartAt)return null;const Ee=new Date(ie.plannedStartAt),be=Math.floor((new Date(Ee.getFullYear(),Ee.getMonth(),Ee.getDate()).getTime()-new Date(D.getFullYear(),D.getMonth(),D.getDate()).getTime())/864e5);if(be<0||be>6)return null;const Re=Ee.getHours(),We=`${be}-${Re}`,Be=B.get(We)||0;B.set(We,Be+1);const Oe=ie.isCompleted?"(완)":"(계)",lt=ie.isCompleted?"#2563eb":"#dc2626";return e.jsxs("div",{className:"week-event","data-day":be,"data-hour":Re,onDoubleClick:Ve=>{Ve.stopPropagation(),ns(ie)},style:{gridColumn:`${be+2}`,gridRow:`${Re+1}`,height:hn,padding:"0 6px",fontSize:10,background:"rgba(59,130,246,.12)",border:"1px solid var(--accent)",borderRadius:6,margin:1,marginTop:Be*Us,display:"flex",alignItems:"center",justifyContent:"flex-start",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",textAlign:"left"},title:ie.subject||"",children:[e.jsx("span",{style:{color:lt,fontWeight:700,marginRight:4},children:Oe}),e.jsx("span",{children:ie.subject||"(제목 없음)"})]},`ev-${ie.id}-${Be}`)}),he=new Date(D.getFullYear(),D.getMonth(),D.getDate()),De=qe.map(ie=>{if(!ie.plannedStartAt)return null;const Ee=new Date(ie.plannedStartAt);if(isNaN(Ee.getTime()))return null;const be=Math.floor((new Date(Ee.getFullYear(),Ee.getMonth(),Ee.getDate()).getTime()-he.getTime())/864e5);if(be<0||be>6)return null;const Re=Ee.getHours(),We=`${be}-${Re}`,Be=B.get(We)||0;B.set(We,Be+1);const Oe=ie.isCompleted||!!ie.actualEndAt,lt=Oe?"(완)":"(계)",Ve=Oe?"#2563eb":"#dc2626";return e.jsxs("div",{className:"week-event","data-day":be,"data-hour":Re,onDoubleClick:Je=>{Je.stopPropagation(),Bt(ie.id)},style:{gridColumn:`${be+2}`,gridRow:`${Re+1}`,height:hn,padding:"0 6px",fontSize:10,background:"rgba(16,185,129,.18)",border:"1px solid rgba(16,185,129,.6)",borderRadius:6,margin:1,marginTop:Be*Us,display:"flex",alignItems:"center",justifyContent:"flex-start",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",textAlign:"left"},title:ie.subject||"",children:[e.jsx("span",{style:{color:Ve,fontWeight:700,marginRight:4},children:lt}),e.jsx("span",{children:ie.subject||"(지역활동)"})]},`region-${ie.id}-${be}-${Re}-${Be}`)}).filter(Boolean);return[...ge,...De]})()]})})]}),Q.open&&e.jsxs("div",{className:"context-menu",role:"menu",ref:se,style:{position:"fixed",left:Q.x+6,top:Q.y+6,zIndex:20050},children:[e.jsx("button",{className:"context-item",role:"menuitem",onClick:()=>{W({open:!1,x:0,y:0}),S(!0)},children:"거래처활동"}),e.jsx("button",{className:"context-item",role:"menuitem",onClick:()=>{W({open:!1,x:0,y:0}),Ke()},children:"지역활동"})]}),ee&&e.jsx(pa,{onClose:()=>S(!1),prefillAt:I}),g&&e.jsxs("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:13e3},children:[e.jsx("div",{style:{position:"absolute",inset:0,background:"rgba(0,0,0,.35)"}}),e.jsx("div",{style:{position:"absolute",top:"8%",left:"50%",transform:"translateX(-50%)",width:"min(920px,96vw)",maxHeight:"84vh"},children:e.jsxs("div",{className:"card plan-compact-card",style:{height:"100%",overflow:"auto",padding:12,position:"relative"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[e.jsx("h3",{style:{margin:0},children:"지역활동 계획"}),e.jsx("span",{role:"button",tabIndex:0,className:"icon-button","aria-label":"닫기",title:"닫기",onClick:Et,children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"icon",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"minmax(0,1fr) minmax(0,380px)",gap:12},children:[e.jsxs("div",{className:"plan-compact",style:{display:"flex",flexDirection:"column",gap:8},children:[e.jsxs("div",{className:"field",style:{display:"grid",gridTemplateColumns:"90px 1fr",gap:6,alignItems:"center"},children:[e.jsx("label",{children:"제목"}),e.jsx("input",{className:"subject-input",value:p,onChange:B=>L(B.target.value),placeholder:"예: 서울 강남구 지역활동"})]}),e.jsxs("div",{className:"field",style:{display:"grid",gridTemplateColumns:"90px 1fr",gap:6,alignItems:"center"},children:[e.jsx("label",{children:"도 선택"}),e.jsxs("select",{value:c,onChange:B=>{const ge=B.target.value;f(ge),b(""),Ct(ge)},style:{height:32},children:[e.jsx("option",{value:"",children:"— 선택 —"}),Y.map((B,ge)=>e.jsx("option",{value:B,children:B},`${B}-${ge}`))]})]}),e.jsxs("div",{className:"field",style:{display:"grid",gridTemplateColumns:"90px 1fr",gap:6,alignItems:"center"},children:[e.jsx("label",{children:"시군 선택"}),e.jsxs("select",{value:w,onChange:B=>b(B.target.value),disabled:!c,style:{height:32},children:[e.jsx("option",{value:"",children:"— 선택 —"}),a.map((B,ge)=>e.jsx("option",{value:B,children:B},`${B}-${ge}`))]})]}),e.jsxs("div",{className:"field",style:{display:"grid",gridTemplateColumns:"90px 1fr",gap:6,alignItems:"center"},children:[e.jsx("label",{children:"계획 일정"}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:6},children:e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",flexWrap:"wrap"},children:[e.jsx("div",{style:{flex:1,minWidth:160,display:"flex",gap:4},children:e.jsx("input",{className:"subject-input",type:"date",value:de,onChange:B=>r(B.target.value),style:{flex:1}})}),e.jsx("span",{style:{fontSize:12,color:"var(--text-muted)"},children:"~"}),e.jsx("div",{style:{flex:1,minWidth:160,display:"flex",gap:4},children:e.jsx("input",{className:"subject-input",type:"date",value:u,onChange:B=>$(B.target.value),style:{flex:1}})})]})})]}),e.jsxs("div",{className:"field",style:{display:"grid",gridTemplateColumns:"90px 1fr",gap:6,alignItems:"center"},children:[e.jsx("label",{children:"완료일"}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:6},children:e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",flexWrap:"wrap"},children:[e.jsx("div",{style:{flex:1,minWidth:160,display:"flex",gap:4},children:e.jsx("input",{className:"subject-input",type:"date",value:N,onChange:B=>m(B.target.value),style:{flex:1}})}),e.jsx("span",{style:{fontSize:12,color:"var(--text-muted)"},children:"~"}),e.jsx("div",{style:{flex:1,minWidth:160,display:"flex",gap:4},children:e.jsx("input",{className:"subject-input",type:"date",value:P,onChange:B=>te(B.target.value),style:{flex:1}})})]})})]}),e.jsxs("div",{className:"field",style:{display:"flex",flexDirection:"column",gap:4},children:[e.jsx("label",{children:"활동계획/설명"}),e.jsx("textarea",{value:X,onChange:B=>ue(B.target.value),placeholder:"방문 목적, 세부 활동계획, 비고 등을 입력해 주세요.",rows:4,style:{resize:"vertical",padding:8}})]})]}),e.jsxs("div",{className:"card",style:{padding:10,background:"var(--panel-2)",borderRadius:12,display:"flex",flexDirection:"column",gap:8,minHeight:0},children:[e.jsx("div",{style:{fontWeight:600,fontSize:13},children:"영업대상 조회/등록"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[e.jsx("input",{className:"subject-input",placeholder:"거래처 또는 잠재고객명으로 검색",value:E,onChange:B=>pe(B.target.value),onKeyDown:B=>{B.key==="Enter"&&(B.preventDefault(),Ht())}}),e.jsx("button",{className:"btn",type:"button",onClick:Ht,disabled:xe,children:"조회"})]}),e.jsx("div",{className:"table-container",style:{maxHeight:220,overflowY:"auto",overflowX:"hidden",background:"var(--panel)",borderRadius:8,padding:6},children:xe?e.jsx("div",{className:"empty-state",children:"조회 중…"}):re.length===0?e.jsx("div",{className:"empty-state",children:me||"조회 결과가 없습니다."}):re.map(B=>{const ge=mn(B);return e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"6px 4px",borderBottom:"1px solid var(--border)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,minWidth:0},children:[e.jsx("span",{title:B.name,style:{fontSize:13,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",flex:1},children:B.name}),e.jsx("span",{title:ge.label,style:{width:22,height:22,borderRadius:"50%",background:ge.bg,color:ge.color,fontWeight:700,display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:12},children:e.jsx("span",{style:{width:18,height:18,borderRadius:"50%",background:ge.iconBg,color:"#fff",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:11},children:ge.icon})})]}),e.jsx("button",{className:"btn-ghost",type:"button",onClick:()=>ss(B),style:{width:28,height:28,display:"inline-flex",alignItems:"center",justifyContent:"center",border:"none"},"aria-label":"등록",children:e.jsx("span",{style:{fontSize:18,lineHeight:1},children:"+"})})]},B.key)})}),e.jsxs("div",{style:{fontWeight:600,fontSize:12},children:["등록된 대상 (",Se.length,")"]}),e.jsx("div",{className:"table-container",style:{maxHeight:140,overflowY:"auto",background:"var(--panel)",borderRadius:8,padding:6},children:Se.length===0?e.jsx("div",{className:"empty-state",children:"등록된 대상이 없습니다."}):Se.map(B=>{const ge=mn(B);return e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"4px 2px",borderBottom:"1px dashed var(--border)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,minWidth:0},children:[e.jsx("span",{title:B.name,style:{fontSize:13,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",flex:1},children:B.name}),e.jsx("span",{title:ge.label,style:{width:22,height:22,borderRadius:"50%",background:ge.bg,color:ge.color,fontWeight:700,display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:12},children:e.jsx("span",{style:{width:18,height:18,borderRadius:"50%",background:ge.iconBg,color:"#fff",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:11},children:ge.icon})})]}),e.jsx("button",{className:"btn-ghost",type:"button",onClick:()=>Ot(B.key),style:{width:28,height:28,display:"inline-flex",alignItems:"center",justifyContent:"center",border:"none"},"aria-label":"삭제",children:e.jsx("span",{style:{fontSize:22,lineHeight:1},children:"−"})})]},`selected-${B.key}`)})})]})]}),ne&&e.jsx("div",{style:{color:"#dc2626",fontSize:12,marginTop:8},children:ne}),i&&e.jsxs("div",{style:{marginTop:8,display:"flex",alignItems:"center",gap:8,border:"1px solid #10b981",background:"#ecfdf5",padding:"6px 10px",borderRadius:6},children:[e.jsx("span",{style:{color:"#047857",fontWeight:600},children:i}),e.jsx("button",{className:"btn btn-plain",type:"button",onClick:()=>x(null),style:{padding:"2px 8px",fontSize:12},children:"확인"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:12},children:[e.jsx("button",{className:"btn",type:"button",onClick:Et,children:"취소"}),e.jsx("button",{className:"btn btn-accent",type:"button",onClick:gs,disabled:K,children:K?"저장 중…":"저장"})]})]})})]}),e.jsx(In,{open:pt&&Ue!=null,onClose:Ge,editId:Ue??void 0,leadId:dt&&/^\d+$/.test(dt)?Number(dt):void 0,leadName:ze,targetKind:nt??void 0,targetCompanyType:tt||void 0,initial:Xe,onSaved:()=>{setTimeout(()=>vt(),50)}})]})}function ba(){const[s,o]=t.useState(()=>{try{const Q=localStorage.getItem("tnt.sales.selectedCustomer");return Q?JSON.parse(Q):null}catch{return null}}),[d,D]=t.useState("transactions"),[H,U]=t.useState(0);t.useEffect(()=>{try{const Q=localStorage.getItem("tnt.sales.selectedCustomer");o(Q?JSON.parse(Q):null)}catch{o(null)}},[]);const q=t.useMemo(()=>s?e.jsx("section",{className:"card compact-form",children:e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"거래처번호"}),e.jsx(gt,{value:s.customerId||"",readOnly:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"거래처명"}),e.jsx(gt,{value:s.customerName||"",readOnly:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"정식명"}),e.jsx(gt,{value:s.customerFullName||"",readOnly:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"사업자번호"}),e.jsx(gt,{value:s.bizNo||"",readOnly:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"대표자명"}),e.jsx(gt,{value:s.ownerName||"",readOnly:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"전화번호"}),e.jsx(gt,{value:s.telNo||"",readOnly:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"고객유형"}),e.jsx(gt,{value:s.customerTypeName||"",readOnly:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"시/도"}),e.jsx(gt,{value:s.addrProvinceName||"",readOnly:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"시/군/구"}),e.jsx(gt,{value:s.addrCityName||"",readOnly:!0})]}),e.jsxs("div",{className:"field row-2",children:[e.jsx("label",{children:"비고"}),e.jsx(gt,{value:s.customerRemark||"",readOnly:!0})]})]})}):e.jsx("div",{className:"empty-state",children:"선택된 거래처가 없습니다."}),[s]);return e.jsxs("section",{className:"c360",children:[e.jsx("div",{className:"page-title"}),q,e.jsxs("section",{className:"card",style:{marginTop:12,minHeight:240},children:[e.jsxs("div",{className:"tabs c360-tabs",children:[e.jsx("button",{className:d==="transactions"?"tab active":"tab",onClick:()=>D("transactions"),children:"거래 내역"}),e.jsx("button",{className:d==="activities"?"tab active":"tab",onClick:()=>D("activities"),children:"영업활동"}),e.jsx("button",{className:d==="demand"?"tab active":"tab",onClick:()=>D("demand"),children:"수요정보"})]}),e.jsxs("div",{style:{marginTop:12},children:[d==="transactions"&&(s==null?void 0:s.customerSeq)!=null&&e.jsx(Nn,{customerSeq:s.customerSeq}),d==="activities"&&(s==null?void 0:s.customerSeq)!=null&&e.jsx(Xs,{customerSeq:s.customerSeq,customerId:s.customerId||"",hideRefresh:!0,enableContextMenu:!0}),d==="demand"&&(s==null?void 0:s.customerName)&&e.jsxs(e.Fragment,{children:[e.jsx(Sn,{customerName:s.customerName,refreshTick:H}),e.jsx(kn,{customerName:s.customerName,refreshTick:H}),e.jsx(Cn,{customerName:s.customerName,customerSeq:s.customerSeq,empSeq:s.empSeq,empName:s.empName||void 0,onSuccess:()=>U(Q=>Q+1)})]}),(!s||s.customerSeq==null)&&e.jsx("div",{className:"empty-state",children:"탭을 선택하세요"})]})]})]})}function $s(s){const o=new Date(s);return o.setDate(1),o.setHours(0,0,0,0),o}function pn(s,o){const d=new Date(s);return d.setMonth(d.getMonth()+o),d}function ms(s,o){const d=new Date(s);return d.setDate(d.getDate()+o),d}function Ys(s,o){return s.getFullYear()===o.getFullYear()&&s.getMonth()===o.getMonth()&&s.getDate()===o.getDate()}function wa(){const[s,o]=t.useState(()=>$s(new Date)),d=new Date,[D,H]=t.useState([]),[U,q]=t.useState(!1),[Q,W]=t.useState(null),[se,ee]=t.useState("month"),[S,g]=t.useState({open:!1,x:0,y:0}),[M,Y]=t.useState(0),[v,c]=t.useState(null),[f,a]=t.useState({open:!1}),C=t.useMemo(()=>{const m=[];if(se==="month"){const P=$s(s),te=P.getDay(),K=new Date(P);K.setDate(P.getDate()-te);for(let j=0;j<42;j++){const ne=new Date(K);ne.setDate(K.getDate()+j),m.push({date:ne,inMonth:ne.getMonth()===s.getMonth(),isToday:Ys(ne,d)})}}else if(se==="week"){const P=new Date(s),te=P.getDay(),K=new Date(P);K.setDate(P.getDate()-te);for(let j=0;j<7;j++){const ne=new Date(K);ne.setDate(K.getDate()+j),m.push({date:ne,inMonth:!0,isToday:Ys(ne,d)})}}else{const P=new Date(s);m.push({date:P,inMonth:!0,isToday:Ys(P,d)})}return m},[s,se]),w=t.useMemo(()=>{const m=s.getFullYear(),P=String(s.getMonth()+1).padStart(2,"0"),te=String(s.getDate()).padStart(2,"0");if(se==="month")return`${m}.${P}`;if(se==="week"){const K=s.getDay(),j=ms(new Date(s),-K),ne=ms(new Date(j),6),l=String(j.getMonth()+1).padStart(2,"0"),i=String(j.getDate()).padStart(2,"0"),x=String(ne.getMonth()+1).padStart(2,"0"),h=String(ne.getDate()).padStart(2,"0");return`${m}.${l}.${i} ~ ${ne.getFullYear()}.${x}.${h}`}return`${m}.${P}.${te}`},[s,se]);t.useEffect(()=>{const m=localStorage.getItem("tnt.sales.assigneeId");if(!m){W("로그인이 필요합니다"),H([]);return}W(null),q(!0),(async()=>{try{const P=new URL("/api/v1/sales-activities",window.location.origin);P.searchParams.set("mineOnly","true"),P.searchParams.set("assigneeId",String(m));const te=new Date(C[0].date);te.setHours(0,0,0,0);const K=new Date(C[C.length-1].date);K.setHours(23,59,59,999),P.searchParams.set("start",te.toISOString()),P.searchParams.set("end",K.toISOString());const j=await fetch(P.toString());if(!j.ok){let i=`HTTP ${j.status}`;try{const x=await j.json();x!=null&&x.error&&(i=x.error)}catch{}throw new Error(i)}const ne=await j.json(),l=Array.isArray(ne)?ne.map(i=>({id:Number(i==null?void 0:i.id),subject:(i==null?void 0:i.subject)??void 0,plannedStartAt:(i==null?void 0:i.plannedStartAt)??(i==null?void 0:i.planned_start_at)??void 0,plannedEndAt:(i==null?void 0:i.plannedEndAt)??(i==null?void 0:i.planned_end_at)??null,activityStatus:(i==null?void 0:i.activityStatus)??(i==null?void 0:i.activity_status)??void 0,leadId:(i==null?void 0:i.sfLeadId)??(i==null?void 0:i.sf_lead_id)??(i==null?void 0:i.leadId)??(i==null?void 0:i.lead_id)??null})):[];H(l)}catch(P){W(P.message||"활동 조회 중 오류가 발생했습니다")}finally{q(!1)}})()},[s,se,C,M]);const b=t.useMemo(()=>{const m=new Map;if(!D||D.length===0)return m;const P=new Date(C[0].date),te=new Date(C[C.length-1].date);te.setHours(23,59,59,999);for(const K of D){if(!K.plannedStartAt&&!K.plannedEndAt)continue;const j=K.plannedStartAt?new Date(K.plannedStartAt):null,ne=K.plannedEndAt?new Date(K.plannedEndAt):j;if(!j)continue;const l=j,i=ne||j;if(i<P||l>te)continue;const x=`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}-${String(l.getDate()).padStart(2,"0")}`,h=l.toTimeString().slice(0,5),O=i.toTimeString().slice(0,5),E=m.get(x)||[];E.push({id:K.id,subject:K.subject,time:h,endTime:O,status:K.activityStatus,start:l,end:i,leadId:K.leadId??null}),m.set(x,E)}return m},[D,C]);function p(m){return m.getHours()*60+m.getMinutes()}function L(m){const P=Math.floor(m/60).toString().padStart(2,"0"),te=(m%60).toString().padStart(2,"0");return`${P}:${te}`}const X=Ne.useCallback(m=>{const P=new Date(m);P.setHours(0,0,0,0);const te=new Date(m);te.setHours(23,59,59,999);const K=[];for(const j of D){const ne=j.plannedStartAt?new Date(j.plannedStartAt):null,l=j.plannedEndAt?new Date(j.plannedEndAt):ne;if(!ne)continue;const i=l||ne;if(i<P||ne>te)continue;const x=ne<P?P:ne,h=i>te?te:i;K.push({id:j.id,subject:j.subject,status:j.activityStatus,start:x,end:h,leadId:j.leadId??null})}return K.sort((j,ne)=>j.start.getTime()-ne.start.getTime()),K},[D]),ue=t.useCallback(()=>{g({open:!1,x:0,y:0,event:void 0})},[]);t.useEffect(()=>{if(!S.open)return;const m=te=>{te.target.closest(".context-menu")||ue()},P=te=>{te.key==="Escape"&&ue()};return window.addEventListener("click",m,!0),window.addEventListener("contextmenu",m,!1),window.addEventListener("keydown",P,!0),()=>{window.removeEventListener("click",m,!0),window.removeEventListener("contextmenu",m,!0),window.removeEventListener("keydown",P,!0)}},[S.open,ue]);function de(m,P){m.preventDefault(),m.stopPropagation(),g({open:!0,x:m.clientX,y:m.clientY,event:P})}async function r(m){const P=m==null?void 0:m.id;if(P)try{const te=await fetch(`/api/v1/sales-activities/${P}`);if(!te.ok)throw new Error(`HTTP ${te.status}`);const K=await te.json(),j=(K==null?void 0:K.customerName)||(K==null?void 0:K.customer_name)||"";a({open:!0,event:m,customerName:j})}catch(te){console.error("활동 상세 조회 실패:",te),a({open:!0,event:m,customerName:""})}}async function u(){var P;const m=(P=f.event)==null?void 0:P.id;if(!m){a({open:!1});return}try{const te=await fetch(`/api/v1/sales-activities/${m}`,{method:"DELETE"});if(!te.ok)throw new Error(`HTTP ${te.status}`);H(K=>K.filter(j=>j.id!==m));try{window.dispatchEvent(new CustomEvent("tnt.sales.activity.updated",{detail:{id:m}}))}catch{}a({open:!1}),ue()}catch(te){window.alert((te==null?void 0:te.message)||"삭제 중 오류가 발생했습니다"),a({open:!1})}}function $(){a({open:!1})}t.useEffect(()=>{(se==="week"||se==="day")&&setTimeout(()=>{document.querySelectorAll(".day-timeline").forEach(m=>{m.scrollTop=7*40})},0)},[se,C]);async function N(m){m!=null&&m.id&&c(m.id)}return t.useEffect(()=>{if(se!=="week")return;const m=Array.from(document.querySelectorAll(".day-timeline"));if(m.length===0)return;const P=te=>{const K=te.target,j=K.scrollTop;m.forEach(ne=>{ne!==K&&(ne.scrollTop=j)})};return m.forEach(te=>te.addEventListener("scroll",P)),()=>m.forEach(te=>te.removeEventListener("scroll",P))},[se,C]),t.useEffect(()=>{if(!v)return;const m=P=>{P.key==="Escape"&&(P.preventDefault(),P.stopPropagation(),c(null))};return window.addEventListener("keydown",m,!0),()=>window.removeEventListener("keydown",m,!0)},[v]),e.jsxs(e.Fragment,{children:[e.jsxs("section",{children:[e.jsxs("div",{className:"page-title",children:[e.jsx("h2",{children:"일정"}),e.jsx("div",{className:"meta",children:e.jsx("button",{className:"btn",onClick:()=>o($s(new Date)),children:"오늘"})})]}),e.jsxs("div",{className:"card",style:{padding:12},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("button",{className:"btn",onClick:()=>o(m=>se==="month"?pn(m,-1):se==="week"?ms(m,-7):ms(m,-1)),children:"〈"}),e.jsx("div",{style:{fontWeight:700},children:w}),e.jsx("button",{className:"btn",onClick:()=>o(m=>se==="month"?pn(m,1):se==="week"?ms(m,7):ms(m,1)),children:"〉"})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("button",{className:"btn",onClick:()=>{ee("month"),o($s(new Date))},disabled:se==="month",children:"월"}),e.jsx("button",{className:"btn",onClick:()=>{ee("week"),o(new Date)},disabled:se==="week",children:"주"}),e.jsx("button",{className:"btn",onClick:()=>{ee("day"),o(new Date)},disabled:se==="day",children:"일"})]})]}),Q&&e.jsx("div",{className:"error",style:{marginBottom:8},children:Q}),U&&e.jsx("div",{className:"muted",style:{marginBottom:8},children:"활동 불러오는 중…"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:`repeat(${se==="day"?1:7}, 1fr)`,gap:4},children:[(se==="day"?[""]:["일","월","화","수","목","금","토"]).map((m,P)=>e.jsx("div",{style:{textAlign:"center",color:"var(--muted)",padding:"6px 0"},children:m},P)),se==="month"&&C.map((m,P)=>e.jsxs("div",{style:{border:"1px solid var(--border)",borderRadius:8,padding:8,height:120,overflow:"hidden",display:"flex",flexDirection:"column",background:m.inMonth?"transparent":"var(--panel-2)",outline:m.isToday?"2px solid var(--accent)":"none"},children:[e.jsx("div",{style:{fontWeight:600,marginBottom:6,opacity:m.inMonth?1:.6},children:m.date.getDate()}),(()=>{const te=`${m.date.getFullYear()}-${String(m.date.getMonth()+1).padStart(2,"0")}-${String(m.date.getDate()).padStart(2,"0")}`,K=b.get(te)||[];return K.length?e.jsxs("div",{className:"cal-events",style:{overflow:"hidden"},children:[K.slice(0,3).map((j,ne)=>e.jsxs("div",{className:`cal-pill status-${(j.status||"scheduled").replaceAll(" ","_")}`,title:j.subject||"",onClick:()=>{N(j)},onContextMenu:l=>de(l,j),children:[e.jsx("span",{className:"time",children:j.time}),e.jsx("span",{className:"subj",children:j.subject||"활동"})]},ne)),K.length>3&&e.jsxs("div",{className:"muted",style:{fontSize:12,marginTop:4},children:["+",K.length-3," 더보기"]})]}):null})()]},P)),(se==="week"||se==="day")&&(()=>{const P=.6666666666666666;return C.map((te,K)=>{const j=`${te.date.getFullYear()}-${String(te.date.getMonth()+1).padStart(2,"0")}-${String(te.date.getDate()).padStart(2,"0")}`,ne=(b.get(j)||[]).sort((i,x)=>i.start.getTime()-x.start.getTime()),l=se==="day"?X(te.date):ne;return e.jsxs("div",{style:{border:"1px solid var(--border)",borderRadius:8,padding:8},children:[e.jsx("div",{style:{fontWeight:600,marginBottom:6},children:te.date.getDate()}),e.jsxs("div",{className:"day-timeline",style:{position:"relative",height:960,borderTop:"1px solid var(--border)",overflowY:"auto",maxHeight:480},children:[[...Array(24)].map((i,x)=>e.jsx("div",{style:{position:"absolute",top:x*40,left:0,right:0,borderTop:"1px dashed var(--border)",fontSize:10,color:"var(--muted)"},children:e.jsxs("span",{style:{position:"absolute",left:0,transform:"translateY(-50%)",paddingLeft:4},children:[x,":00"]})},x)),l.map((i,x)=>{const h=p(i.start),O=p(i.end),E=h*P,pe=Math.max(20,(O-h)*P);return e.jsxs("div",{className:`cal-pill status-${(i.status||"scheduled").replaceAll(" ","_")}`,style:{position:"absolute",top:E,left:60,right:4,height:pe},title:`${L(h)}~${L(O)} ${i.subject||""}`,onClick:()=>{N(i)},onContextMenu:re=>de(re,i),children:[e.jsx("span",{className:"time",children:L(h)}),e.jsx("span",{className:"subj",children:i.subject||"활동"})]},x)})]})]},K)})})()]}),S.open&&S.event&&e.jsxs("div",{className:"context-menu",style:{left:S.x+4,top:S.y+4},onClick:m=>m.stopPropagation(),children:[e.jsx("button",{className:"context-item",onClick:()=>{c(S.event.id),ue()},children:"활동 수정"}),e.jsx("button",{className:"context-item",onClick:()=>{ue(),r(S.event)},children:"활동 삭제"})]})]})]}),v&&e.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,.4)"},onClick:()=>c(null),children:e.jsxs("div",{className:"card",style:{width:"min(920px, 92vw)",maxHeight:"90vh",overflow:"auto",padding:16,background:"var(--panel)",border:"1px solid var(--border)",borderRadius:12,boxShadow:"0 8px 32px rgba(0,0,0,.2)"},onClick:m=>m.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:12},children:[e.jsx("h3",{style:{margin:0,fontSize:16,fontWeight:700},children:"영업활동 수정"}),e.jsx("button",{onClick:()=>c(null),style:{width:32,height:32,display:"flex",alignItems:"center",justifyContent:"center",background:"transparent",border:"none",borderRadius:4,cursor:"pointer",color:"var(--muted)",fontSize:20,transition:"all 0.2s"},onMouseEnter:m=>{m.currentTarget.style.background="var(--panel-2)",m.currentTarget.style.color="var(--text)"},onMouseLeave:m=>{m.currentTarget.style.background="transparent",m.currentTarget.style.color="var(--muted)"},title:"닫기 (ESC)",children:"×"})]}),e.jsx(Ss,{bare:!0,editId:v,onSaved:()=>{c(null),Y(m=>m+1)},onNoticeClose:()=>c(null)})]})}),f.open&&e.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:1e4,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,.5)"},onClick:$,children:e.jsxs("div",{className:"card",style:{background:"var(--panel)",padding:20,border:"1px solid var(--border)",borderRadius:12,minWidth:320,maxWidth:"86vw",boxShadow:"0 8px 32px rgba(0,0,0,.3)"},onClick:m=>m.stopPropagation(),children:[e.jsx("div",{style:{marginBottom:16,fontSize:16,fontWeight:700,color:"var(--text)",textAlign:"center"},children:"활동 삭제"}),e.jsxs("div",{style:{marginBottom:20,fontSize:14,color:"var(--text)",textAlign:"center",lineHeight:1.6},children:[f.customerName&&e.jsx("div",{style:{marginBottom:8,fontWeight:600,color:"var(--primary)"},children:f.customerName}),e.jsx("div",{children:"정말로 삭제하시겠습니까?"})]}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"center"},children:[e.jsx("button",{className:"btn",onClick:$,style:{minWidth:80,background:"var(--panel-2)",border:"1px solid var(--border)",color:"var(--text)",display:"flex",alignItems:"center",justifyContent:"center"},children:"취소"}),e.jsx("button",{className:"btn",onClick:u,style:{minWidth:80,background:"#dc2626",border:"1px solid #b91c1c",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center"},children:"삭제"})]})]})})]})}function Na(){const[s,o]=t.useState(()=>{const u=new Date;return u.setMinutes(u.getMinutes()-u.getTimezoneOffset()),u.toISOString().slice(0,10)}),[d,D]=t.useState(null),[H,U]=t.useState(new Array(12).fill(0)),[q,Q]=t.useState(new Array(12).fill(0)),[W,se]=t.useState([]),[ee,S]=t.useState([]),[g,M]=t.useState(!1),[Y,v]=t.useState(null),[c,f]=t.useState("compare");async function a(u){M(!0),v(null);try{const $=await fetch(`/api/v1/dashboard/sales-summary?date=${encodeURIComponent(u)}`),N=await $.json().catch(()=>({}));if(!$.ok||N&&N.error)throw new Error(N.error||`HTTP ${$.status}`);D(N);const m=new Date(u),P=m.getFullYear(),te=P-1,K=u,[j,ne]=await Promise.all([fetch(`/api/v1/dashboard/monthly?year=${te}`),fetch(`/api/v1/dashboard/monthly?year=${P}&until=${encodeURIComponent(K)}`)]),l=await j.json().catch(()=>[]),i=await ne.json().catch(()=>[]),x=xe=>{const _=new Array(12).fill(0);return Array.isArray(xe)&&xe.forEach(me=>{const fe=Number(me==null?void 0:me.month),Se=Number((me==null?void 0:me.amount)||0);fe>=1&&fe<=12&&(_[fe-1]=Se)}),_};U(x(l)),Q(x(i));const h=m.getMonth()+1,[O,E]=await Promise.all([fetch(`/api/v1/dashboard/daily?year=${te}&month=${h}`),fetch(`/api/v1/dashboard/daily?year=${P}&month=${h}&until=${encodeURIComponent(K)}`)]),pe=await O.json().catch(()=>[]),re=await E.json().catch(()=>[]),G=(xe,_,me)=>{let fe=31;try{fe=new Date(_,me,0).getDate()}catch{}const Se=new Array(fe).fill(0);return Array.isArray(xe)&&xe.forEach(Ce=>{const I=Number(Ce==null?void 0:Ce.day),je=Number((Ce==null?void 0:Ce.amount)||0);I>=1&&I<=fe&&(Se[I-1]=je)}),Se};se(G(pe,te,h)),S(G(re,P,h))}catch($){v(($==null?void 0:$.message)||"조회 중 오류가 발생했습니다"),D(null)}finally{M(!1)}}t.useEffect(()=>{a(s)},[]);const C=u=>{if(u==null)return"-";try{return new Intl.NumberFormat("ko-KR").format(u)}catch{return String(u)}},w=new Date(s),b=w.getFullYear(),p=w.getMonth()+1,L=w.getDate(),X=u=>String(u).padStart(2,"0"),ue=b-1,de=new Date(ue,p,0).getDate(),r=Math.min(L,de);return e.jsxs("section",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[e.jsxs("div",{className:"tabs",style:{display:"flex",gap:8,padding:"6px 8px",marginBottom:8},children:[e.jsx("button",{className:c==="compare"?"tab active":"tab",onClick:()=>f("compare"),children:"전년동기 매출비교"}),e.jsx("button",{className:c==="arrears"?"tab active":"tab",onClick:()=>f("arrears"),children:"미수 분석"})]}),c==="compare"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"page-title",children:[e.jsx("h2",{children:"전년동기 매출비교"}),e.jsx("div",{className:"controls",style:{gap:8},children:e.jsx("input",{type:"date",className:"subject-input",value:s,onChange:u=>{o(u.target.value),a(u.target.value)}})})]}),Y&&e.jsx("div",{className:"error",style:{marginBottom:8},children:Y}),e.jsx("div",{className:"card",style:{padding:12},children:g?e.jsx("div",{className:"empty-state",children:"불러오는 중…"}):d?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(6, 1fr)",gap:12},children:[e.jsx(hs,{label:`${ue} 전체`,value:C(d.prevYearTotal)}),e.jsx(hs,{label:`${ue}-01-01 ~ ${ue}-${X(p)}-${X(L)}`,value:C(d.prevYearToDate)}),e.jsx(hs,{label:`${b}-01-01 ~ ${b}-${X(p)}-${X(L)}`,value:C(d.currentYearToDate)}),e.jsx(hs,{label:`${ue}-${X(p)} 전체`,value:C(d.prevYearMonthTotal)}),e.jsx(hs,{label:`${ue}-${X(p)}-01 ~ ${ue}-${X(p)}-${X(r)}`,value:C(d.prevYearMonthToDate)}),e.jsx(hs,{label:`${b}-${X(p)}-01 ~ ${b}-${X(p)}-${X(L)}`,value:C(d.currentYearMonthToDate)})]}):e.jsx("div",{className:"empty-state",children:"데이터가 없습니다"})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginTop:12},children:[e.jsxs("div",{className:"card",style:{padding:12},children:[e.jsx("div",{className:"muted",style:{marginBottom:8},children:"월별 매출 (올해 vs 전년)"}),e.jsx(Sa,{prev:H,cur:q,upToMonth:new Date(s).getMonth()+1})]}),e.jsxs("div",{className:"card",style:{padding:12},children:[e.jsx("div",{className:"muted",style:{marginBottom:8},children:"일별 매출 (해당 월: 올해 vs 전년)"}),e.jsx(ka,{prev:W,cur:ee,upToDay:new Date(s).getDate()})]})]}),e.jsxs("div",{className:"controls",style:{justifyContent:"flex-start",marginTop:12},children:[e.jsx("button",{className:"btn btn-card btn-3d",style:{fontSize:12,padding:"8px 12px",borderRadius:10},onClick:async()=>{try{const u=await fetch(`/api/v1/dashboard/churn?date=${encodeURIComponent(s)}`),$=await u.json().catch(()=>[]);if(!u.ok||$&&$.error)throw new Error($.error||`HTTP ${u.status}`);try{window.dispatchEvent(new CustomEvent("tnt.sales.dashboard.churn",{detail:{items:$}}))}catch{}}catch{alert("이탈거래처 조회 실패")}},children:"이탈거래처"}),e.jsx("button",{className:"btn btn-card btn-3d",style:{fontSize:12,padding:"8px 12px",borderRadius:10,marginLeft:12},onClick:async()=>{try{const u=await fetch(`/api/v1/dashboard/newcustomers?date=${encodeURIComponent(s)}`),$=await u.json().catch(()=>[]);if(!u.ok||$&&$.error)throw new Error($.error||`HTTP ${u.status}`);try{window.dispatchEvent(new CustomEvent("tnt.sales.dashboard.newcustomers",{detail:{items:$}}))}catch{}}catch{alert("신규 거래처 조회 실패")}},children:"신규 거래처"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"page-title",children:e.jsx("h2",{children:"미수 분석"})}),e.jsx("div",{className:"card",style:{padding:12},children:e.jsx("div",{className:"empty-state",children:"미수 분석 콘텐츠가 준비 중입니다."})})]})]})}function hs({label:s,value:o}){return e.jsxs("div",{className:"card",style:{padding:12},children:[e.jsx("div",{className:"muted",style:{fontSize:10,marginBottom:8},children:s}),e.jsx("div",{style:{fontSize:16,fontWeight:700},children:o})]})}function Sa({prev:s,cur:o,upToMonth:d}){const q=Array.from({length:12},(c,f)=>f+1),Q=Math.max(1,...s,...o),W=c=>36+c*(320-2*36)/11,se=c=>204-c/Q*(240-2*36),ee=(c,f)=>q.filter(C=>!f||C<=f).map((C,w)=>`${w===0?"M":"L"} ${W(C-1)} ${se(c[C-1]||0)}`).join(" "),S=4,g=Array.from({length:S},(c,f)=>Math.round((f+1)*Q/S)),M=c=>`${Math.round((c||0)/1e6)}`,Y=c=>new Intl.NumberFormat("ko-KR",{maximumFractionDigits:0}).format((c||0)/1e6),v={prev:"#64748b",cur:"#2563eb"};return e.jsxs("svg",{width:"100%",viewBox:"0 0 320 240",children:[e.jsx("rect",{x:0,y:0,width:320,height:240,fill:"transparent"}),g.map((c,f)=>{const a=se(c);return e.jsxs("g",{children:[e.jsx("line",{x1:36,y1:a,x2:284,y2:a,stroke:"var(--border)"}),e.jsx("text",{x:30,y:a+2,textAnchor:"end",fontSize:4,fill:"var(--muted)",children:M(c)})]},f)}),e.jsx("text",{x:4,y:10,fontSize:4,fill:"var(--muted)",children:"단위: 백만원"}),e.jsx("path",{d:ee(s),fill:"none",stroke:v.prev,strokeWidth:2}),e.jsx("path",{d:ee(o,d),fill:"none",stroke:v.cur,strokeWidth:2}),q.map(c=>{const f=s[c-1]||0,a=se(f)-4;return e.jsx("text",{x:W(c-1),y:a,textAnchor:"middle",fontSize:4,fill:v.prev,children:Y(f)},`p-${c}`)}),q.filter(c=>c<=d).map(c=>{const f=o[c-1]||0,a=se(f)-4;return e.jsx("text",{x:W(c-1),y:a-6,textAnchor:"middle",fontSize:4,fill:v.cur,children:Y(f)},`c-${c}`)}),q.map(c=>e.jsxs("text",{x:W(c-1),y:234,textAnchor:"middle",fontSize:4,fill:"var(--muted)",children:[c,"월"]},c)),e.jsxs("g",{children:[e.jsx("circle",{cx:196,cy:14,r:4,fill:v.prev}),e.jsx("text",{x:206,y:18,fontSize:4,fill:"var(--muted)",children:"전년"}),e.jsx("circle",{cx:250,cy:14,r:4,fill:v.cur}),e.jsx("text",{x:260,y:18,fontSize:4,fill:"var(--muted)",children:"올해"})]})]})}function ka({prev:s,cur:o,upToDay:d}){const Q=Math.max(1,...s,...o),W=(320-2*36)/31,se=Math.max(1,Math.floor(W*.35)),ee=C=>36+C*W,S=C=>204-C/Q*(240-2*36),g=C=>`${Math.round((C||0)/1e6)}`,M=Array.from({length:31},(C,w)=>w+1),Y=Array.from({length:4},(C,w)=>Math.round((w+1)*Q/4)),[v,c]=Ne.useState(null),f=C=>{const b=C.currentTarget.getBoundingClientRect(),p=C.clientX-b.left,L=Math.max(0,Math.min(320-2*36,p-36)),X=Math.max(0,Math.min(30,Math.floor(L/W)));c(X)},a={prev:"#94a3b8",cur:"#3b82f6"};return e.jsxs("svg",{width:"100%",viewBox:"0 0 320 240",onMouseMove:f,onMouseLeave:()=>c(null),children:[e.jsx("rect",{x:0,y:0,width:320,height:240,fill:"transparent"}),Y.map((C,w)=>{const b=S(C);return e.jsxs("g",{children:[e.jsx("line",{x1:36,y1:b,x2:284,y2:b,stroke:"var(--border)"}),e.jsx("text",{x:30,y:b+2,textAnchor:"end",fontSize:4,fill:"var(--muted)",children:g(C)})]},w)}),e.jsx("text",{x:4,y:10,fontSize:4,fill:"var(--muted)",children:"단위: 백만원"}),Array.from({length:31},(C,w)=>w).map(C=>{const w=ee(C),b=204-S(s[C]||0),p=204-S(o[C]||0);return e.jsxs("g",{children:[e.jsx("rect",{x:w-se-1,y:S(s[C]||0),width:se,height:b,fill:a.prev}),e.jsx("rect",{x:w+1,y:S(o[C]||0),width:se,height:p,fill:a.cur})]},C)}),M.map(C=>e.jsx("text",{x:ee(C-1),y:232,textAnchor:"middle",fontSize:3,fill:"var(--muted)",children:C},C)),e.jsxs("g",{children:[e.jsx("rect",{x:194,y:8,width:8,height:8,fill:a.prev}),e.jsx("text",{x:208,y:16,fontSize:4,fill:"var(--muted)",children:"전년"}),e.jsx("rect",{x:244,y:8,width:8,height:8,fill:a.cur}),e.jsx("text",{x:258,y:16,fontSize:4,fill:"var(--muted)",children:"올해"})]}),v!=null&&v<31&&e.jsxs("g",{children:[e.jsx("line",{x1:ee(v),y1:32,x2:ee(v),y2:208,stroke:"var(--border)"}),e.jsxs("g",{transform:`translate(${Math.min(174,Math.max(36,ee(v)-55))}, 36)`,children:[e.jsx("rect",{x:0,y:0,width:110,height:38,rx:6,fill:"var(--panel)",stroke:"var(--border)"}),e.jsxs("text",{x:6,y:12,fontSize:4,fill:"var(--muted)",children:[v+1,"일"]}),e.jsxs("text",{x:6,y:22,fontSize:4,fill:a.prev,children:["전년 ",g(s[v]||0)]}),e.jsxs("text",{x:6,y:32,fontSize:4,fill:a.cur,children:["올해 ",v+1<=d?g(o[v]||0):"-"]})]})]})]})}function Ca({activity:s}){return e.jsxs("section",{className:"card activity-edit-panel",style:{marginTop:12,minHeight:240},children:[e.jsx("div",{className:"tabs c360-tabs",children:e.jsx("button",{className:"tab active",children:"영업활동 변경"})}),e.jsx("div",{className:"activity-form-wrapper",children:e.jsx(Ss,{bare:!0,editId:s==null?void 0:s.id,initial:{id:s==null?void 0:s.id,subject:(s==null?void 0:s.subject)||"",description:(s==null?void 0:s.description)||"",channel:(s==null?void 0:s.channel)||"in_person",activityType:(s==null?void 0:s.activityType)||"site_visit",activityStatus:(s==null?void 0:s.activityStatus)||"scheduled",plannedStartAt:(s==null?void 0:s.plannedStartAt)||"",plannedEndAt:(s==null?void 0:s.plannedEndAt)||"",sfAccountId:(s==null?void 0:s.sfAccountId)||"",customerName:(s==null?void 0:s.customerName)||"",parentActivitySeq:s==null?void 0:s.parentSeq,parentSubject:s==null?void 0:s.parentSubject}},`edit-${(s==null?void 0:s.id)??"new"}`)})]})}function Ft(s){if(!s)return"";const o=s instanceof Date?s:new Date(s);if(isNaN(o.getTime()))return"";const d=String(o.getFullYear()%100).padStart(2,"0"),D=String(o.getMonth()+1).padStart(2,"0"),H=String(o.getDate()).padStart(2,"0"),U=String(o.getHours()).padStart(2,"0"),q=String(o.getMinutes()).padStart(2,"0");return`${d}-${D}-${H} ${U}:${q}`}function Aa(){const[s,o]=t.useState([]),[d,D]=t.useState(!1),[H,U]=t.useState(null),[q,Q]=t.useState(()=>new Set),[W,se]=t.useState(null),[ee,S]=t.useState(""),[g,M]=t.useState([]),[Y,v]=t.useState(""),[c,f]=t.useState(void 0),[a,C]=t.useState({open:!1,x:0,y:0});function w(){try{const de=localStorage.getItem("tnt.sales.visitPlanActivities"),r=de?JSON.parse(de):[],u=new Set;return Array.isArray(r)&&r.forEach($=>{($==null?void 0:$.id)!=null&&u.add(Number($.id))}),u}catch{return new Set}}async function b(){U(null),D(!0);try{const de=localStorage.getItem("tnt.sales.assigneeId");if(!de)throw new Error(Ze.loginRequired);const r=new URL("/api/v1/sales-activities",window.location.origin);r.searchParams.set("mineOnly","true"),r.searchParams.set("assigneeId",String(de)),ee&&ee.trim()&&r.searchParams.set("customerName",ee.trim()),Y&&Y.trim()&&r.searchParams.append("status",Y.trim());const u=await fetch(r.toString());if(!u.ok){let te=`HTTP ${u.status}`;try{const K=await u.json();K!=null&&K.error&&(te=K.error)}catch{}throw new Error(te)}const $=await u.json(),N=Array.isArray($)?$:[],m=w(),P=N.filter(te=>!m.has(te.id));o(P),f(te=>{if(!(!P||P.length===0))return te&&P.some(K=>K.id===te.id)?te:P[0]})}catch(de){U(de.message||"조회 중 오류가 발생했습니다")}finally{D(!1)}}t.useEffect(()=>{b(),(async()=>{try{const u=await fetch("/api/v1/sales-activities/statuses");if(u.ok){const $=await u.json(),N=["scheduled","completed","canceled","postponed"];Array.isArray($)&&$.length>0?M($):M(N)}else M(["scheduled","completed","canceled","postponed"])}catch{}})();const de=()=>{try{const u=localStorage.getItem("tnt.sales.availableActivities");if(u){const $=JSON.parse(u);if(Array.isArray($)){const N=$;o(N),f(m=>{if(!(!N||N.length===0))return m&&N.some(P=>P.id===m.id)?m:N[0]})}}}catch{}};window.addEventListener("tnt.sales.availableActivitiesUpdated",de);const r=()=>{b()};return window.addEventListener("tnt.sales.activity.updated",r),()=>window.removeEventListener("tnt.sales.availableActivitiesUpdated",de)},[]),t.useEffect(()=>{if(!a.open)return;const de=()=>C({open:!1,x:0,y:0}),r=u=>{u.key==="Escape"&&C({open:!1,x:0,y:0})};return window.addEventListener("click",de),window.addEventListener("keydown",r),()=>{window.removeEventListener("click",de),window.removeEventListener("keydown",r)}},[a.open]);function p(de,r){de.preventDefault(),de.stopPropagation();const u=(r.parentSubject||"").trim();if(!u){C({open:!1,x:0,y:0});return}const $=s.find(m=>(m.subject||"").trim()===u)||null,N=s.filter(m=>(m.parentSubject||"").trim()===u);C({open:!0,x:de.clientX,y:de.clientY,parent:$,siblings:N})}function L(){if(se(null),q.size===0){se("선택된 활동이 없습니다");return}const de=s.filter(u=>q.has(u.id)),r=s.filter(u=>!q.has(u.id));try{let u=[];try{const K=localStorage.getItem("tnt.sales.visitPlanActivities");if(K){const j=JSON.parse(K);Array.isArray(j)&&(u=j)}}catch{}const $=new Map;u.forEach(K=>$.set(K.id,K)),de.forEach(K=>$.set(K.id,K));const N=Array.from($.values());localStorage.setItem("tnt.sales.visitPlanActivities",JSON.stringify(N));let m=[];try{const K=localStorage.getItem("tnt.sales.availableActivities");if(K){const j=JSON.parse(K);Array.isArray(j)&&(m=j)}}catch{}const P=new Map;m.forEach(K=>P.set(K.id,K)),r.forEach(K=>P.set(K.id,K)),de.forEach(K=>P.delete(K.id));const te=Array.from(P.values());localStorage.setItem("tnt.sales.availableActivities",JSON.stringify(te)),window.dispatchEvent(new CustomEvent("tnt.sales.visitPlanUpdated")),window.dispatchEvent(new CustomEvent("tnt.sales.availableActivitiesUpdated")),se(`방문 일정 대상 ${de.length}건을 우측 패널에 추가했습니다`),o(te),Q(new Set)}catch{se("저장 중 오류가 발생했습니다")}}const X=(de,r)=>de?r==="type"?{site_visit:"정기방문",opportunity:"영업기회",AR_mgmt:"채권관리",meeting:"미팅",call:"전화",email:"이메일",demo:"데모",task:"업무",other:"기타"}[de]||de:r==="status"?{scheduled:"계획",completed:"완료",canceled:"취소",postponed:"연기",no_show:"미방문"}[de]||de:r==="channel"&&{in_person:"방문",phone:"전화",email:"문자/메일/팩스",other:"기타",video:"영상",chat:"채팅",sms:"문자"}[de]||de:"",ue=t.useMemo(()=>{const de=r=>[`제목: ${r.subject||""}`,`활동설명: ${r.description||""}`,`활동유형: ${X(r.activityType,"type")}`,`활동방법: ${X(r.channel,"channel")}`,`상태: ${X(r.activityStatus,"status")}`,`상위활동: ${r.parentSubject||""}`,`계획 일시: ${Ft(r.plannedStartAt)}`,`종료 일시: ${Ft(r.plannedEndAt)}`,`거래처명: ${r.customerName||""}`,`생성일시: ${Ft(r.createdAt)}`].join(`
`);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-container",style:{maxHeight:"32vh"},children:s.length===0?e.jsx("div",{className:"empty-state",children:Ze.empty}):e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:36,textAlign:"center"},children:e.jsx("input",{type:"checkbox",checked:s.length>0&&q.size===s.length,onChange:r=>{if(r.target.checked){const u=new Set;s.forEach($=>u.add($.id)),Q(u)}else Q(new Set)}})}),e.jsx("th",{style:{width:240},children:"제목"}),e.jsx("th",{style:{width:120},children:"활동방법"}),e.jsx("th",{style:{width:200},children:"거래처명"}),e.jsx("th",{style:{width:280},children:"활동설명"}),e.jsx("th",{style:{width:220},children:"상위활동"}),e.jsx("th",{style:{width:120},children:"활동유형"}),e.jsx("th",{style:{width:120},children:"상태"}),e.jsx("th",{style:{width:180},children:"계획 일시"}),e.jsx("th",{style:{width:180},children:"종료 일시"}),e.jsx("th",{style:{width:180},children:"생성일시"})]})}),e.jsx("tbody",{children:s.map((r,u)=>e.jsxs("tr",{title:de(r),onClick:()=>f(r),onContextMenu:$=>p($,r),"aria-selected":(c==null?void 0:c.id)===r.id?!0:void 0,style:(c==null?void 0:c.id)===r.id?{background:"var(--row-selected, rgba(0, 128, 255, 0.12))"}:void 0,children:[e.jsx("td",{style:{textAlign:"center"},children:e.jsx("input",{type:"checkbox",checked:q.has(r.id),onChange:$=>{Q(N=>{const m=new Set(N);return $.target.checked?m.add(r.id):m.delete(r.id),m})}})}),e.jsx("td",{children:r.subject||""}),e.jsx("td",{children:X(r.channel,"channel")}),e.jsx("td",{children:r.customerName||""}),e.jsx("td",{title:r.description||"",style:{maxWidth:600,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:r.description||""}),e.jsx("td",{children:r.parentSubject||""}),e.jsx("td",{children:X(r.activityType,"type")}),e.jsx("td",{children:X(r.activityStatus,"status")}),e.jsx("td",{children:Ft(r.plannedStartAt)}),e.jsx("td",{children:Ft(r.plannedEndAt)}),e.jsx("td",{children:Ft(r.createdAt)})]},u))})]})}),a.open&&e.jsxs("div",{className:"context-menu",style:{left:a.x+6,top:a.y+6,maxWidth:720,padding:10,fontSize:10},onClick:r=>r.stopPropagation(),children:[e.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"상위활동"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:8},children:[a.parent&&e.jsx("div",{className:"card",style:{padding:8},children:e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{className:"table",style:{width:"100%",fontSize:10},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"제목"}),e.jsx("th",{children:"활동설명"}),e.jsx("th",{children:"활동유형"}),e.jsx("th",{children:"활동방법"}),e.jsx("th",{children:"상태"}),e.jsx("th",{children:"거래처명"}),e.jsx("th",{children:"계획 일시"}),e.jsx("th",{children:"종료 일시"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:a.parent.subject||""}),e.jsx("td",{style:{whiteSpace:"pre-wrap",maxWidth:360},children:a.parent.description||""}),e.jsx("td",{children:X(a.parent.activityType,"type")}),e.jsx("td",{children:X(a.parent.channel,"channel")}),e.jsx("td",{children:X(a.parent.activityStatus,"status")}),e.jsx("td",{children:a.parent.customerName||""}),e.jsx("td",{children:Ft(a.parent.plannedStartAt)}),e.jsx("td",{children:Ft(a.parent.plannedEndAt)})]})})]})})}),e.jsxs("div",{className:"card",style:{padding:8},children:[e.jsx("div",{style:{fontWeight:600,marginBottom:6},children:"관련활동"}),a.siblings&&a.siblings.length>0?e.jsxs("table",{className:"table",style:{width:"100%",fontSize:10},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:240},children:"제목"}),e.jsx("th",{style:{width:120},children:"활동유형"}),e.jsx("th",{style:{width:120},children:"활동방법"}),e.jsx("th",{style:{width:120},children:"상태"}),e.jsx("th",{style:{width:180},children:"계획 일시"}),e.jsx("th",{style:{width:180},children:"종료 일시"})]})}),e.jsx("tbody",{children:a.siblings.map((r,u)=>e.jsxs("tr",{onClick:()=>{f(r),C({open:!1,x:0,y:0})},children:[e.jsx("td",{children:r.subject||""}),e.jsx("td",{children:X(r.activityType,"type")}),e.jsx("td",{children:X(r.channel,"channel")}),e.jsx("td",{children:X(r.activityStatus,"status")}),e.jsx("td",{children:Ft(r.plannedStartAt)}),e.jsx("td",{children:Ft(r.plannedEndAt)})]},u))})]}):e.jsx("div",{className:"muted",children:"하위 활동이 없습니다"})]})]})]})]})},[s,q,c,a]);return e.jsxs("section",{children:[e.jsxs("div",{className:"page-title",style:{alignItems:"center"},children:[e.jsx("input",{value:ee,onChange:de=>S(de.target.value),onKeyDown:de=>{de.key==="Enter"&&!d&&b()},placeholder:"거래처명 입력",style:{width:220,height:28,padding:"6px 8px",borderRadius:6,border:"1px solid var(--border)",background:"transparent",color:"var(--text)",fontSize:12}}),e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:8,marginLeft:8},children:[e.jsx("label",{className:"muted",style:{fontSize:12},children:"상태"}),e.jsxs("select",{value:Y,onChange:de=>v(de.target.value),style:{minWidth:140,height:28,padding:"4px 8px",borderRadius:8,border:"1px solid var(--border)",background:"transparent",color:"var(--text)",fontSize:12},children:[e.jsx("option",{value:"",children:"전체"}),g.map(de=>e.jsx("option",{value:de,children:X(de,"status")},de))]})]}),e.jsx("button",{className:"btn",onClick:b,disabled:d,children:d?"조회중…":"조회"}),e.jsx("button",{className:"btn",onClick:L,disabled:!0,title:"준비중 기능",style:{marginLeft:8,opacity:.6,cursor:"not-allowed"},children:Ze.action.addToPlan}),H&&e.jsx("span",{className:"error",children:H||Ze.errorGeneric}),W&&e.jsx("span",{className:"muted",children:W}),e.jsx("div",{style:{flex:1}}),e.jsxs("div",{className:"muted count-text",children:["총 ",s.length,"건",q.size?` · 선택 ${q.size}건`:""]})]}),e.jsx("div",{style:{marginTop:12},children:ue}),e.jsx(Ca,{activity:c})]})}function Ia(){return e.jsxs("section",{children:[e.jsxs("div",{className:"page-title",children:[e.jsx("h2",{children:"Complaint"}),e.jsx("div",{className:"meta",children:"준비 중"})]}),e.jsx("div",{className:"empty-state",children:"Complaint 기능은 추후 제공될 예정입니다."})]})}function Ta({compact:s=!1,maxHeight:o}){const[d,D]=t.useState([]),[H,U]=t.useState(!1),[q,Q]=t.useState(null),[W,se]=t.useState({open:!1,x:0,y:0}),[ee,S]=t.useState(()=>{try{const v=localStorage.getItem("tnt.sales.selectedInquiry");if(v){const c=JSON.parse(v),f=Number(c==null?void 0:c.id);return Number.isFinite(f)?f:null}}catch{}return null});async function g(v){Q(null),U(!0);try{let c=null;try{const a=await fetch("/api/v1/inquiries");a.ok&&(c=await a.json())}catch{}let f=[];if(Array.isArray(c)?f=c.map((a,C)=>({id:Number((a==null?void 0:a.id)??C+1),title:(a==null?void 0:a.title)!=null?String(a.title):"",customerSeq:(a==null?void 0:a.customerSeq)!=null?Number(a.customerSeq):(a==null?void 0:a.customer_seq)!=null?Number(a.customer_seq):null,customerName:(a==null?void 0:a.customerName)??(a==null?void 0:a.customer_name)??null,inquiryStatus:(a==null?void 0:a.inquiryStatus)??(a==null?void 0:a.inquiry_status)??(a==null?void 0:a.status)??"",assigneeSeq:(a==null?void 0:a.assigneeSeq)!=null?Number(a.assigneeSeq):(a==null?void 0:a.assignee_seq)!=null?Number(a.assignee_seq):null,assigneeName:(a==null?void 0:a.assigneeName)??(a==null?void 0:a.assignee_name)??null,assigneeId:(a==null?void 0:a.assigneeId)??(a==null?void 0:a.assignee_id)??null,openedAt:(a==null?void 0:a.openedAt)??(a==null?void 0:a.opened_at)??"",updatedAt:(a==null?void 0:a.updatedAt)??(a==null?void 0:a.updated_at)??"",inquiryCategory:(a==null?void 0:a.inquiryCategory)??(a==null?void 0:a.inquiry_category)??"",ownerSeq:(a==null?void 0:a.ownerSeq)!=null?Number(a.ownerSeq):(a==null?void 0:a.owner_seq)!=null?Number(a.owner_seq):null,ownerName:(a==null?void 0:a.ownerName)??(a==null?void 0:a.owner_name)??null,channel:(a==null?void 0:a.channel)??"",contactSeq:(a==null?void 0:a.contactSeq)!=null?Number(a.contactSeq):(a==null?void 0:a.contact_seq)!=null?Number(a.contact_seq):null,contactName:(a==null?void 0:a.contactName)??(a==null?void 0:a.contact_name)??null,leadId:(a==null?void 0:a.leadId)??"",severity:(a==null?void 0:a.severity)??"",closedAt:(a==null?void 0:a.closedAt)??(a==null?void 0:a.closed_at)??"",inquiryContent:(a==null?void 0:a.inquiryContent)??(a==null?void 0:a.inquiry_content)??"",answerContent:(a==null?void 0:a.answerContent)??(a==null?void 0:a.answer_content)??""})):f=[],f.sort((a,C)=>{const w=a.updatedAt?Date.parse(a.updatedAt):0,b=C.updatedAt?Date.parse(C.updatedAt):0;return b!==w?b-w:(a.title||"").localeCompare(C.title||"","ko",{sensitivity:"base"})}),D(f),v!=null){const a=f.find(C=>C.id===v);if(a){M(a);return}}f.length>0&&ee==null&&M(f[0])}catch(c){Q((c==null?void 0:c.message)||"조회 중 오류가 발생했습니다")}finally{U(!1)}}t.useEffect(()=>{g()},[]),t.useEffect(()=>{const v=c=>{var a;const f=((a=c==null?void 0:c.detail)==null?void 0:a.focusId)!=null?Number(c.detail.focusId):null;g(f)};return window.addEventListener("tnt.sales.inquiry.reload",v),()=>window.removeEventListener("tnt.sales.inquiry.reload",v)},[]);function M(v){S(v.id);try{localStorage.setItem("tnt.sales.selectedInquiry",JSON.stringify(v)),window.dispatchEvent(new CustomEvent("tnt.sales.inquiry.selected",{detail:{inquiry:v}}))}catch{}}return t.useMemo(()=>e.jsxs("div",{className:"table-container",style:{height:o??(s?"32vh":void 0),maxHeight:o??(s?"32vh":void 0)},children:[d.length===0?e.jsx("div",{className:"empty-state",children:H?"불러오는 중…":q||"데이터가 없습니다"}):e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"제목"}),e.jsx("th",{style:{width:200},children:"거래처명"}),e.jsx("th",{style:{width:120},children:"문의유형"}),e.jsx("th",{style:{width:120},children:"접수자"}),e.jsx("th",{style:{width:120},children:"당사담당자"}),e.jsx("th",{style:{width:160},children:"접수시간"})]})}),e.jsx("tbody",{children:d.map((v,c)=>{const f=(()=>{if(String(v.inquiryStatus||"").trim()==="완료")return!1;const C=v.openedAt?Date.parse(v.openedAt):NaN;return Number.isFinite(C)?C<=Date.now()-864e5:!1})();return e.jsxs("tr",{className:ee===v.id?"selected":void 0,onClick:()=>M(v),onMouseEnter:a=>se({open:!0,x:a.clientX+8,y:a.clientY+8,row:v}),onMouseMove:a=>se(C=>({...C,x:a.clientX+8,y:a.clientY+8})),onMouseLeave:()=>se({open:!1,x:0,y:0}),style:f?{color:"#ef4444"}:void 0,children:[e.jsx("td",{children:v.title||""}),e.jsx("td",{children:v.customerName||(v.customerSeq!=null?String(v.customerSeq):"")}),e.jsx("td",{children:v.inquiryCategory||""}),e.jsx("td",{children:v.ownerName||(v.ownerSeq!=null?String(v.ownerSeq):"")}),e.jsx("td",{children:v.assigneeName||(v.assigneeSeq!=null?String(v.assigneeSeq):"")}),e.jsx("td",{children:v.openedAt?(()=>{const a=new Date(v.openedAt);if(isNaN(a.getTime()))return v.openedAt;const C=String(a.getFullYear()%100).padStart(2,"0"),w=String(a.getMonth()+1).padStart(2,"0"),b=String(a.getDate()).padStart(2,"0"),p=String(a.getHours()).padStart(2,"0"),L=String(a.getMinutes()).padStart(2,"0");return`${C}-${w}-${b} ${p}:${L}`})():""})]},c)})})]}),W.open&&W.row&&e.jsxs("div",{role:"dialog","aria-label":"문의 상세",style:{position:"fixed",left:Math.min(W.x,(typeof window<"u"?window.innerWidth:1200)-420),top:Math.min(W.y,(typeof window<"u"?window.innerHeight:800)-320),zIndex:9999,maxWidth:400,background:"var(--panel)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:10,boxShadow:"0 12px 28px rgba(0,0,0,.25)",padding:10,fontSize:12,lineHeight:1.4,pointerEvents:"none"},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:6},children:W.row.title||"(문의)"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"120px 1fr",columnGap:8,rowGap:4},children:[e.jsx("span",{className:"muted",children:"거래처"}),e.jsx("span",{children:W.row.customerName||(W.row.customerSeq!=null?String(W.row.customerSeq):"")}),e.jsx("span",{className:"muted",children:"문의유형"}),e.jsx("span",{children:W.row.inquiryCategory||""}),e.jsx("span",{className:"muted",children:"상태"}),e.jsx("span",{children:W.row.inquiryStatus||""}),e.jsx("span",{className:"muted",children:"난이도"}),e.jsx("span",{children:W.row.severity||""}),e.jsx("span",{className:"muted",children:"접수자"}),e.jsx("span",{children:W.row.ownerName||(W.row.ownerSeq!=null?String(W.row.ownerSeq):"")}),e.jsx("span",{className:"muted",children:"당사담당자"}),e.jsx("span",{children:W.row.assigneeName||(W.row.assigneeSeq!=null?String(W.row.assigneeSeq):"")}),e.jsx("span",{className:"muted",children:"리드ID"}),e.jsx("span",{children:W.row.leadId||""}),e.jsx("span",{className:"muted",children:"채널"}),e.jsx("span",{children:W.row.channel||""}),e.jsx("span",{className:"muted",children:"접수시각"}),e.jsx("span",{children:W.row.openedAt?(()=>{const v=new Date(W.row.openedAt);if(isNaN(v.getTime()))return String(W.row.openedAt);const c=String(v.getFullYear()%100).padStart(2,"0"),f=String(v.getMonth()+1).padStart(2,"0"),a=String(v.getDate()).padStart(2,"0"),C=String(v.getHours()).padStart(2,"0"),w=String(v.getMinutes()).padStart(2,"0");return`${c}-${f}-${a} ${C}:${w}`})():""}),e.jsx("span",{className:"muted",children:"종료시각"}),e.jsx("span",{children:W.row.closedAt?(()=>{const v=new Date(W.row.closedAt);if(isNaN(v.getTime()))return String(W.row.closedAt);const c=String(v.getFullYear()%100).padStart(2,"0"),f=String(v.getMonth()+1).padStart(2,"0"),a=String(v.getDate()).padStart(2,"0"),C=String(v.getHours()).padStart(2,"0"),w=String(v.getMinutes()).padStart(2,"0");return`${c}-${f}-${a} ${C}:${w}`})():""}),e.jsx("span",{className:"muted",children:"문의내용"}),e.jsx("span",{style:{whiteSpace:"pre-wrap"},children:W.row.inquiryContent||""}),e.jsx("span",{className:"muted",children:"답변내용"}),e.jsx("span",{style:{whiteSpace:"pre-wrap"},children:W.row.answerContent||""}),e.jsx("span",{className:"muted",children:"수정시각"}),e.jsx("span",{children:W.row.updatedAt?(()=>{const v=new Date(W.row.updatedAt);if(isNaN(v.getTime()))return String(W.row.updatedAt);const c=String(v.getFullYear()%100).padStart(2,"0"),f=String(v.getMonth()+1).padStart(2,"0"),a=String(v.getDate()).padStart(2,"0"),C=String(v.getHours()).padStart(2,"0"),w=String(v.getMinutes()).padStart(2,"0");return`${c}-${f}-${a} ${C}:${w}`})():""}),e.jsx("span",{className:"muted",children:"ID"}),e.jsx("span",{children:W.row.id})]})]})]}),[d,ee,H,q,s,o,W])}const Ns="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%20width='16'%20height='16'%20fill='none'%20stroke='currentColor'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'%20aria-hidden='true'%3e%3ccircle%20cx='11'%20cy='11'%20r='7'%20/%3e%3cline%20x1='21'%20y1='21'%20x2='16.65'%20y2='16.65'%20/%3e%3c/svg%3e";function Tn({open:s,onClose:o,title:d,children:D,footer:H,width:U=380}){return t.useEffect(()=>{if(!s)return;const q=Q=>{Q.key==="Escape"&&o()};return window.addEventListener("keydown",q,!0),()=>window.removeEventListener("keydown",q,!0)},[s,o]),s?Un.createPortal(e.jsxs("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:2e3},children:[e.jsx("div",{onClick:o,style:{position:"absolute",inset:0,background:"rgba(0,0,0,.35)"}}),e.jsxs("div",{className:"card",style:{position:"absolute",top:"22%",left:"50%",transform:"translateX(-50%)",width:U,maxWidth:"92vw",padding:12},children:[d?e.jsx("div",{className:"page-title",style:{marginBottom:8},children:e.jsx("h3",{style:{margin:0,fontSize:14},children:d})}):null,e.jsx("div",{style:{padding:"4px 2px",fontSize:13},children:D}),e.jsx("div",{className:"controls",style:{justifyContent:"flex-end",gap:8,marginTop:8},children:H})]})]}),document.body):null}function Ea({open:s,onClose:o,onSubmit:d}){const[D,H]=t.useState(""),[U,q]=t.useState(""),[Q,W]=t.useState(""),[se,ee]=t.useState(""),[S,g]=t.useState(""),[M,Y]=t.useState(""),[v,c]=t.useState(""),[f,a]=t.useState(!1),[C,w]=t.useState(""),[b,p]=t.useState(""),[L,X]=t.useState(""),[ue,de]=t.useState(""),[r,u]=t.useState(""),[$,N]=t.useState(!1),[m,P]=t.useState(""),[te,K]=t.useState(""),[j,ne]=t.useState(!1),[l,i]=t.useState(""),[x,h]=t.useState(""),[O,E]=t.useState(""),[pe,re]=t.useState(""),[G,xe]=t.useState(null),_=t.useRef(null),[me,fe]=t.useState(!1),[Se,Ce]=t.useState({left:0,top:0});t.useEffect(()=>{if(s){const V=new Date;V.setMinutes(V.getMinutes()-V.getTimezoneOffset()),i(V.toISOString().slice(0,16)),h(""),H(""),q(""),W(""),ee(""),g(""),Y(""),c(""),w("");try{const _e=localStorage.getItem("tnt.sales.empName")||"",qe=localStorage.getItem("tnt.sales.assigneeId")||"";p(_e),X(qe)}catch{p(""),X("")}de(""),u(""),P(""),K(""),E(""),re(""),fe(!1)}},[s]),t.useEffect(()=>{if(!s)return;const V=_e=>{if(_e.key==="Escape"){if(f||j||$)return;o()}};return window.addEventListener("keydown",V,!0),()=>window.removeEventListener("keydown",V,!0)},[s,o,f,j,$]),t.useEffect(()=>{if(!G)return;const V=_e=>{_e.key==="Escape"&&xe(null)};return window.addEventListener("keydown",V,!0),()=>window.removeEventListener("keydown",V,!0)},[G]);function I(V){var ze;V.preventDefault();const _e=(ze=_.current)==null?void 0:ze.getBoundingClientRect(),qe=V.clientX,Te=V.clientY,Ue=_e?_e.left:Se.left,at=_e?_e.top:Se.top,dt=et=>{const nt=et.clientX-qe,jt=et.clientY-Te;Ce({left:Ue+nt,top:at+jt}),fe(!0)},xt=()=>{window.removeEventListener("mousemove",dt),window.removeEventListener("mouseup",xt)};window.addEventListener("mousemove",dt),window.addEventListener("mouseup",xt)}if(!s)return null;function je(){const V=(D||"").trim().length>0,_e=(U||"").trim().length>0,qe=!!(M&&Number(M)),Te=!!(m&&String(m).trim());if(!V){xe("제목을 입력해 주세요.");return}if(!_e){xe("상태를 선택해 주세요.");return}if(!(qe||Te)){xe("거래처 또는 잠재고객 중 하나를 선택해 주세요.");return}const Ue={title:D,inquiryStatus:U,severity:Q,inquiryCategory:se,channel:S,customerSeq:M?Number(M):null,contactName:C||null,ownerId:L||null,assigneeId:r||null,createdBy:L||null,updatedBy:L||null,leadId:m,openedAt:l||null,closedAt:x||null,inquiryContent:O,answerContent:pe};d==null||d(Ue)}return e.jsxs("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:1e3},children:[e.jsx("div",{onClick:o,style:{position:"absolute",inset:0,background:"rgba(0,0,0,.35)"}}),e.jsxs("div",{ref:_,className:"card",style:{position:"absolute",zIndex:1001,width:"90%",maxWidth:900,maxHeight:"90%",overflow:"auto",padding:12,left:me?Se.left:"50%",top:me?Se.top:"50%",transform:me?"none":"translate(-50%, -50%)"},children:[e.jsx("button",{"aria-label":"닫기",onClick:o,className:"btn-plain",style:{position:"absolute",top:8,right:8},children:e.jsx("img",{src:ct,className:"icon",alt:"닫기"})}),e.jsxs("div",{onMouseDown:I,style:{display:"flex",alignItems:"center",gap:8,marginBottom:12,cursor:"move"},children:[e.jsx("span",{className:"muted",style:{fontWeight:700},children:"새 문의"}),e.jsx("div",{style:{flex:1,height:1,background:"var(--border)"}})]}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"inline-field",children:[e.jsxs("label",{children:["제목",e.jsx("span",{className:"req-dot","aria-hidden":"true"})]}),e.jsx("input",{className:"subject-input",value:D,onChange:V=>H(V.target.value),placeholder:"제목"})]}),e.jsxs("div",{className:"inline-field",children:[e.jsx("label",{children:"문의유형"}),e.jsxs("select",{className:"subject-input",value:se,onChange:V=>ee(V.target.value),children:[e.jsx("option",{value:"",children:"선택"}),e.jsx("option",{value:"제품문의",children:"제품문의"}),e.jsx("option",{value:"재고/배송문의",children:"재고/배송문의"}),e.jsx("option",{value:"가격문의",children:"가격문의"}),e.jsx("option",{value:"기타문의",children:"기타문의"})]})]}),e.jsxs("div",{className:"inline-field",style:{gridColumn:"1 / -1"},children:[e.jsx("label",{children:"문의내용"}),e.jsx("textarea",{className:"subject-input",value:O,onChange:V=>E(V.target.value),placeholder:"상세 설명",style:{minHeight:120}})]}),e.jsxs("div",{className:"inline-field",style:{gridColumn:"1 / -1"},children:[e.jsx("label",{children:"답변내용"}),e.jsx("textarea",{className:"subject-input",value:pe,onChange:V=>re(V.target.value),placeholder:"답변/조치",style:{minHeight:120}})]}),e.jsxs("div",{className:"inline-field",children:[e.jsxs("label",{children:["상태",e.jsx("span",{className:"req-dot","aria-hidden":"true"})]}),e.jsxs("select",{className:"subject-input",value:U,onChange:V=>q(V.target.value),children:[e.jsx("option",{value:"",children:"선택"}),e.jsx("option",{value:"신규접수",children:"신규접수"}),e.jsx("option",{value:"확인 중",children:"확인 중"}),e.jsx("option",{value:"완료",children:"완료"}),e.jsx("option",{value:"보류",children:"보류"})]})]}),e.jsxs("div",{className:"inline-field",children:[e.jsx("label",{children:"난이도"}),e.jsxs("select",{className:"subject-input",value:Q,onChange:V=>W(V.target.value),children:[e.jsx("option",{value:"",children:"선택"}),e.jsx("option",{value:"상",children:"상"}),e.jsx("option",{value:"중",children:"중"}),e.jsx("option",{value:"하",children:"하"})]})]}),e.jsxs("div",{className:"inline-field",children:[e.jsx("label",{children:"접수경로"}),e.jsxs("select",{className:"subject-input",value:S,onChange:V=>g(V.target.value),children:[e.jsx("option",{value:"",children:"선택"}),e.jsx("option",{value:"전화",children:"전화"}),e.jsx("option",{value:"이메일",children:"이메일"}),e.jsx("option",{value:"고객채널",children:"고객채널"}),e.jsx("option",{value:"직접입력",children:"직접입력"})]})]}),e.jsxs("div",{className:"inline-field",children:[e.jsx("label",{children:"잠재고객"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{className:"subject-input",type:"text",value:te,onChange:V=>{K(V.target.value),P("")},placeholder:"잠재고객명",style:{paddingRight:28}}),e.jsx("button",{type:"button","aria-label":"잠재고객 검색",title:"잠재고객 검색",onClick:()=>ne(!0),className:"btn-plain no-focus-ring",style:{position:"absolute",right:4,top:"50%",transform:"translateY(-50%)",padding:4,cursor:"pointer"},children:e.jsx("img",{src:Ns,className:"icon",alt:"검색"})})]}),m&&e.jsxs("div",{className:"muted",style:{fontSize:11,marginTop:4},children:["선택됨: id ",m]})]}),e.jsxs("div",{className:"inline-field",children:[e.jsx("label",{children:"거래처"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{className:"subject-input",type:"text",value:v,onChange:V=>{c(V.target.value),Y("")},placeholder:"거래처명",style:{paddingRight:28}}),e.jsx("button",{type:"button","aria-label":"거래처 검색",title:"거래처 검색",onClick:()=>a(!0),className:"btn-plain no-focus-ring",style:{position:"absolute",right:4,top:"50%",transform:"translateY(-50%)",padding:4,cursor:"pointer"},children:e.jsx("img",{src:Ns,className:"icon",alt:"검색"})})]}),M&&e.jsxs("div",{className:"muted",style:{fontSize:11,marginTop:4},children:["선택됨: seq ",M]})]}),e.jsxs("div",{className:"inline-field",children:[e.jsx("label",{children:"거래처 담당자"}),e.jsx("input",{className:"subject-input",type:"text",value:C,onChange:V=>w(V.target.value),placeholder:"이름"})]}),e.jsxs("div",{className:"inline-field",children:[e.jsx("label",{children:"접수자"}),e.jsx("input",{className:"subject-input",value:b,readOnly:!0,title:"로그인 사용자"})]}),e.jsxs("div",{className:"inline-field",children:[e.jsx("label",{children:"당사 담당자"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{className:"subject-input",type:"text",value:ue,onChange:V=>{de(V.target.value),u("")},placeholder:"이름",style:{paddingRight:28}}),e.jsx("button",{type:"button","aria-label":"직원 검색",title:"직원 검색",onClick:()=>N(!0),className:"btn-plain no-focus-ring",style:{position:"absolute",right:4,top:"50%",transform:"translateY(-50%)",padding:4,cursor:"pointer"},children:e.jsx("img",{src:Ns,className:"icon",alt:"검색"})})]})]}),e.jsxs("div",{className:"inline-field",children:[e.jsx("label",{children:"접수시각"}),e.jsx("input",{className:"subject-input",type:"datetime-local",value:l,onChange:V=>i(V.target.value)})]}),e.jsxs("div",{className:"inline-field",children:[e.jsx("label",{children:"종료시각"}),e.jsx("input",{className:"subject-input",type:"datetime-local",value:x,onChange:V=>h(V.target.value)})]})]}),e.jsxs("div",{className:"controls",style:{gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{className:"btn",onClick:je,children:"저장"}),e.jsx("button",{className:"btn",onClick:o,children:"취소"})]})]}),f&&e.jsx(Da,{defaultQuery:v,onClose:()=>a(!1),onSelect:V=>{Y(V.customerSeq?String(V.customerSeq):""),c(V.customerName||""),a(!1)}}),$&&e.jsx(_a,{defaultQuery:ue,onClose:()=>N(!1),onSelect:V=>{u(V.assigneeId||""),de(V.empName||""),N(!1)}}),j&&e.jsx(Ma,{defaultQuery:te,onClose:()=>ne(!1),onSelect:V=>{P(V.id!=null?String(V.id):""),K(V.companyName||""),ne(!1)}}),e.jsx(Tn,{open:!!G,onClose:()=>xe(null),width:360,footer:e.jsx("button",{className:"btn",onClick:()=>xe(null),children:"확인"}),children:G})]})}function Da({defaultQuery:s,onClose:o,onSelect:d}){const[D,H]=t.useState(s||""),[U,q]=t.useState([]),[Q,W]=t.useState(!1),[se,ee]=t.useState(null);async function S(g=!0){W(!0),ee(null);try{const M=new URL("/api/v1/customers",window.location.origin);D.trim()&&M.searchParams.set("name",D.trim()),M.searchParams.set("mineOnly","false"),M.searchParams.set("limit","100");const Y=await fetch(M.toString());if(!Y.ok)throw new Error(`HTTP ${Y.status}`);const v=await Y.json();if(Array.isArray(v)){const c=v.map(f=>({customerSeq:(f==null?void 0:f.customerSeq)??(f==null?void 0:f.customer_seq)??null,customerId:(f==null?void 0:f.customerId)??(f==null?void 0:f.customer_id)??null,customerName:(f==null?void 0:f.customerName)??(f==null?void 0:f.customer_name)??null,telNo:(f==null?void 0:f.telNo)??(f==null?void 0:f.tel_no)??null,addrProvinceName:(f==null?void 0:f.addrProvinceName)??(f==null?void 0:f.addr_province_name)??null,addrCityName:(f==null?void 0:f.addrCityName)??(f==null?void 0:f.addr_city_name)??null,companyType:(f==null?void 0:f.companyType)??(f==null?void 0:f.company_type)??null,ownerName:(f==null?void 0:f.ownerName)??(f==null?void 0:f.owner_name)??null}));q(c)}else q([])}catch(M){ee((M==null?void 0:M.message)||"조회 중 오류가 발생했습니다"),q([])}finally{W(!1)}}return t.useEffect(()=>{S(!0)},[]),t.useEffect(()=>{const g=M=>{M.key==="Escape"&&(M.preventDefault(),o())};return window.addEventListener("keydown",g,!0),()=>window.removeEventListener("keydown",g,!0)},[o]),e.jsxs("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:1100},children:[e.jsx("div",{onClick:o,style:{position:"absolute",inset:0,background:"rgba(0,0,0,.4)"}}),e.jsxs("div",{className:"card",style:{position:"absolute",top:"10%",left:"50%",transform:"translateX(-50%)",width:"90%",maxWidth:800,maxHeight:"80%",overflow:"auto",padding:12},children:[e.jsx("button",{"aria-label":"닫기",onClick:o,className:"btn-plain",style:{position:"absolute",top:8,right:8},children:e.jsx("img",{src:ct,className:"icon",alt:"닫기"})}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:8},children:[e.jsx("input",{className:"subject-input",placeholder:"거래처명",value:D,onChange:g=>H(g.target.value),onKeyDown:g=>{g.key==="Enter"&&S(!0)},style:{flex:1}}),e.jsx("button",{className:"btn",onClick:()=>S(!0),children:"조회"})]}),e.jsx("div",{className:"table-container",style:{height:360},children:U.length===0?e.jsx("div",{className:"empty-state",children:Q?"불러오는 중…":se||"결과가 없습니다"}):e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:220},children:"거래처명"}),e.jsx("th",{style:{width:140},children:"회사구분"}),e.jsx("th",{style:{width:140},children:"대표자명"}),e.jsx("th",{style:{width:180},children:"지역"})]})}),e.jsx("tbody",{children:U.map((g,M)=>e.jsxs("tr",{onDoubleClick:()=>d(g),onClick:()=>d(g),children:[e.jsx("td",{children:g.customerName||""}),e.jsx("td",{children:g.companyType||""}),e.jsx("td",{children:g.ownerName||""}),e.jsx("td",{children:[g.addrProvinceName,g.addrCityName].filter(Boolean).join(" ")})]},M))})]})})]})]})}function Ma({defaultQuery:s,onClose:o,onSelect:d}){const[D,H]=t.useState(s||""),[U,q]=t.useState([]),[Q,W]=t.useState(!1),[se,ee]=t.useState(null);async function S(g=!0){W(!0),ee(null);try{const M=new URL("/api/v1/leads",window.location.origin);D.trim()&&M.searchParams.set("company_name",D.trim()),M.searchParams.set("limit","100");const Y=await fetch(M.toString());if(!Y.ok)throw new Error(`HTTP ${Y.status}`);const v=await Y.json();if(Array.isArray(v)){const c=v.map(f=>({id:(f==null?void 0:f.id)!=null?Number(f.id):null,companyName:(f==null?void 0:f.company_name)??null,leadStatus:(f==null?void 0:f.lead_status)??null,ownerName:(f==null?void 0:f.owner_name)??null,addrProvinceName:(f==null?void 0:f.addr_province_name)??null}));q(c)}else q([])}catch(M){ee((M==null?void 0:M.message)||"조회 중 오류가 발생했습니다"),q([])}finally{W(!1)}}return t.useEffect(()=>{S(!0)},[]),t.useEffect(()=>{const g=M=>{M.key==="Escape"&&(M.preventDefault(),o())};return window.addEventListener("keydown",g,!0),()=>window.removeEventListener("keydown",g,!0)},[o]),e.jsxs("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:1100},children:[e.jsx("div",{onClick:o,style:{position:"absolute",inset:0,background:"rgba(0,0,0,.4)"}}),e.jsxs("div",{className:"card",style:{position:"absolute",top:"10%",left:"50%",transform:"translateX(-50%)",width:"90%",maxWidth:800,maxHeight:"80%",overflow:"auto",padding:12},children:[e.jsx("button",{"aria-label":"닫기",onClick:o,className:"btn-plain",style:{position:"absolute",top:8,right:8},children:e.jsx("img",{src:ct,className:"icon",alt:"닫기"})}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:8},children:[e.jsx("input",{className:"subject-input",placeholder:"잠재고객명",value:D,onChange:g=>H(g.target.value),onKeyDown:g=>{g.key==="Enter"&&S(!0)},style:{flex:1}}),e.jsx("button",{className:"btn",onClick:()=>S(!0),children:"조회"})]}),e.jsx("div",{className:"table-container",style:{height:360},children:U.length===0?e.jsx("div",{className:"empty-state",children:Q?"불러오는 중…":se||"결과가 없습니다"}):e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:220},children:"잠재고객명"}),e.jsx("th",{style:{width:120},children:"상태"}),e.jsx("th",{style:{width:140},children:"소유자"}),e.jsx("th",{style:{width:160},children:"지역"})]})}),e.jsx("tbody",{children:U.map((g,M)=>e.jsxs("tr",{onDoubleClick:()=>d(g),onClick:()=>d(g),children:[e.jsx("td",{children:g.companyName||""}),e.jsx("td",{children:g.leadStatus||""}),e.jsx("td",{children:g.ownerName||""}),e.jsx("td",{children:g.addrProvinceName||""})]},M))})]})})]})]})}function _a({defaultQuery:s,onClose:o,onSelect:d}){const[D,H]=t.useState(s||""),[U,q]=t.useState([]),[Q,W]=t.useState(!1),[se,ee]=t.useState(null);async function S(){W(!0),ee(null);try{const g=new URL("/api/v1/employees",window.location.origin);g.searchParams.set("depts","all");const M=await fetch(g.toString());if(!M.ok)throw new Error(`HTTP ${M.status}`);const Y=await M.json(),v=Array.isArray(Y)?Y.map(a=>({empId:(a==null?void 0:a.emp_id)??null,empName:(a==null?void 0:a.emp_name)??null,deptName:(a==null?void 0:a.dept_name)??null,assigneeId:(a==null?void 0:a.assignee_id)??null})):[],c=D.trim().toLowerCase(),f=(c?v.filter(a=>(a.empName||"").toLowerCase().includes(c)||(a.empId||"").toLowerCase().includes(c)||(a.deptName||"").toLowerCase().includes(c)):v).sort((a,C)=>(a.empName||"").localeCompare(C.empName||"","ko",{sensitivity:"base"}));q(f)}catch(g){ee((g==null?void 0:g.message)||"조회 실패"),q([])}finally{W(!1)}}return t.useEffect(()=>{S()},[]),t.useEffect(()=>{const g=M=>{M.key==="Escape"&&(M.preventDefault(),o())};return window.addEventListener("keydown",g,!0),()=>window.removeEventListener("keydown",g,!0)},[o]),e.jsxs("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:1100},children:[e.jsx("div",{onClick:o,style:{position:"absolute",inset:0,background:"rgba(0,0,0,.4)"}}),e.jsxs("div",{className:"card",style:{position:"absolute",top:"10%",left:"50%",transform:"translateX(-50%)",width:"90%",maxWidth:700,maxHeight:"80%",overflow:"auto",padding:12},children:[e.jsx("button",{"aria-label":"닫기",onClick:o,className:"btn-plain",style:{position:"absolute",top:8,right:8},children:e.jsx("img",{src:ct,className:"icon",alt:"닫기"})}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:8},children:[e.jsx("input",{className:"subject-input",placeholder:"이름/사번/부서",value:D,onChange:g=>H(g.target.value),onKeyDown:g=>{g.key==="Enter"&&S()},style:{flex:1}}),e.jsx("button",{className:"btn",onClick:S,children:"조회"})]}),e.jsx("div",{className:"table-container",style:{height:320},children:U.length===0?e.jsx("div",{className:"empty-state",children:Q?"불러오는 중…":se||"결과가 없습니다"}):e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:160},children:"이름"}),e.jsx("th",{style:{width:160},children:"부서"}),e.jsx("th",{style:{width:140},children:"사번"}),e.jsx("th",{style:{width:140},children:"assignee_id"})]})}),e.jsx("tbody",{children:U.map((g,M)=>e.jsxs("tr",{onDoubleClick:()=>d(g),onClick:()=>d(g),children:[e.jsx("td",{children:g.empName||""}),e.jsx("td",{children:g.deptName||""}),e.jsx("td",{children:g.empId||""}),e.jsx("td",{children:g.assigneeId||""})]},M))})]})})]})]})}function $a(){const[s,o]=t.useState(()=>{try{const r=localStorage.getItem("tnt.sales.selectedInquiry");return r?JSON.parse(r):null}catch{return null}});t.useEffect(()=>{const r=()=>{try{const u=localStorage.getItem("tnt.sales.selectedInquiry");o(u?JSON.parse(u):null)}catch{o(null)}};return window.addEventListener("tnt.sales.inquiry.selected",r),()=>window.removeEventListener("tnt.sales.inquiry.selected",r)},[]);const[d,D]=t.useState(null),[H,U]=t.useState(null),[q,Q]=t.useState(!1),[W,se]=t.useState(null);t.useEffect(()=>{if(!H)return;const r=u=>{u.key==="Escape"&&U(null)};return window.addEventListener("keydown",r,!0),()=>window.removeEventListener("keydown",r,!0)},[H]),t.useEffect(()=>{if(!q)return;const r=u=>{u.key==="Escape"&&Q(!1)};return window.addEventListener("keydown",r,!0),()=>window.removeEventListener("keydown",r,!0)},[q]),t.useEffect(()=>{if(!W)return;const r=u=>{u.key==="Escape"&&se(null)};return window.addEventListener("keydown",r,!0),()=>window.removeEventListener("keydown",r,!0)},[W]);const ee=r=>{if(!r)return"";try{const u=new Date(r);if(isNaN(u.getTime()))return"";const $=String(u.getFullYear()),N=String(u.getMonth()+1).padStart(2,"0"),m=String(u.getDate()).padStart(2,"0"),P=String(u.getHours()).padStart(2,"0"),te=String(u.getMinutes()).padStart(2,"0");return`${$}-${N}-${m}T${P}:${te}`}catch{return""}},[S,g]=t.useState({}),[M,Y]=t.useState(!1),[v,c]=t.useState(!1),[f,a]=t.useState(!1);t.useEffect(()=>{if(!s){g({});return}const r=typeof window<"u"&&localStorage.getItem("tnt.sales.empName")||"",u=typeof window<"u"&&localStorage.getItem("tnt.sales.assigneeId")||"";g({title:s.title||"",inquiryCategory:s.inquiryCategory||"",inquiryContent:s.inquiryContent||"",answerContent:s.answerContent||"",inquiryStatus:s.inquiryStatus||"",severity:s.severity||"",channel:s.channel||"",leadId:s.leadId||"",leadName:"",customerSeq:s.customerSeq!=null?String(s.customerSeq):"",customerName:s.customerName||"",contactName:s.contactName||"",ownerName:r,ownerId:u,assigneeName:s.assigneeName||"",assigneeId:s.assigneeId||"",openedAt:ee(s.openedAt),closedAt:ee(s.closedAt)})},[s]),t.useEffect(()=>{const r=S.leadId;if(!r||S.leadName)return;let u=!1;return(async()=>{try{const $=await fetch(`/api/v1/leads/${encodeURIComponent(String(r))}`);if(!$.ok)return;const N=await $.json().catch(()=>null);!u&&N&&g(m=>({...m,leadName:N.company_name||m.leadName||""}))}catch{}})(),()=>{u=!0}},[S.leadId,S.leadName]);function C(r,u){g($=>({...$,[r]:u}))}async function w(){if(!(s!=null&&s.id))return;const r=(()=>{try{return localStorage.getItem("tnt.sales.assigneeId")||""}catch{return""}})(),u=String(S.title||"").trim().length>0,$=String(S.inquiryStatus||"").trim().length>0,N=!!(S.customerSeq&&Number(S.customerSeq)),m=!!(S.leadId&&String(S.leadId).trim());if(!u){U("제목을 입력해 주세요.");return}if(!$){U("상태를 선택해 주세요.");return}if(!(N||m)){U("거래처 또는 잠재고객 중 하나를 선택해 주세요.");return}const P={title:S.title,inquiryCategory:S.inquiryCategory,inquiryContent:S.inquiryContent,answerContent:S.answerContent,inquiryStatus:S.inquiryStatus,severity:S.severity,channel:S.channel,leadId:S.leadId,customerSeq:S.customerSeq?Number(S.customerSeq):null,contactName:S.contactName||null,ownerId:S.ownerId||null,assigneeId:S.assigneeId||null,updatedBy:r||S.ownerId||null,openedAt:S.openedAt||null,closedAt:S.closedAt||null};try{const te=await fetch(`/api/v1/inquiries/${s.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(P)});if(!te.ok){const K=await te.text().catch(()=>"");U("수정 실패: "+(K||te.status));return}try{D("수정 되었습니다."),window.setTimeout(()=>D(null),3e3)}catch{}try{window.dispatchEvent(new CustomEvent("tnt.sales.inquiry.reload",{detail:{focusId:s.id}}))}catch{}}catch{alert("수정 중 오류가 발생했습니다")}}const b=t.useMemo(()=>e.jsx("div",{className:"card",style:{padding:12},children:s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"inline-field",children:[e.jsxs("label",{children:["제목",e.jsx("span",{className:"req-dot","aria-hidden":"true"})]}),e.jsx("input",{className:"subject-input",value:S.title||"",onChange:r=>C("title",r.target.value)})]}),e.jsxs("div",{className:"inline-field",children:[e.jsx("label",{children:"문의유형"}),e.jsxs("select",{className:"subject-input",value:S.inquiryCategory||"",onChange:r=>C("inquiryCategory",r.target.value),children:[e.jsx("option",{value:"",children:"선택"}),e.jsx("option",{value:"제품문의",children:"제품문의"}),e.jsx("option",{value:"재고/배송문의",children:"재고/배송문의"}),e.jsx("option",{value:"가격문의",children:"가격문의"}),e.jsx("option",{value:"기타문의",children:"기타문의"})]})]}),e.jsxs("div",{className:"inline-field",style:{gridColumn:"1 / -1"},children:[e.jsx("label",{children:"문의내용"}),e.jsx("textarea",{className:"subject-input",value:S.inquiryContent||"",onChange:r=>C("inquiryContent",r.target.value),style:{minHeight:80}})]}),e.jsxs("div",{className:"inline-field",style:{gridColumn:"1 / -1"},children:[e.jsx("label",{children:"답변내용"}),e.jsx("textarea",{className:"subject-input",value:S.answerContent||"",onChange:r=>C("answerContent",r.target.value),style:{minHeight:80}})]}),e.jsxs("div",{className:"inline-field",children:[e.jsxs("label",{children:["상태",e.jsx("span",{className:"req-dot","aria-hidden":"true"})]}),e.jsxs("select",{className:"subject-input",value:S.inquiryStatus||"",onChange:r=>C("inquiryStatus",r.target.value),children:[e.jsx("option",{value:"",children:"선택"}),e.jsx("option",{value:"신규접수",children:"신규접수"}),e.jsx("option",{value:"확인 중",children:"확인 중"}),e.jsx("option",{value:"완료",children:"완료"}),e.jsx("option",{value:"보류",children:"보류"})]})]}),e.jsxs("div",{className:"inline-field",children:[e.jsx("label",{children:"난이도"}),e.jsxs("select",{className:"subject-input",value:S.severity||"",onChange:r=>C("severity",r.target.value),children:[e.jsx("option",{value:"",children:"선택"}),e.jsx("option",{value:"상",children:"상"}),e.jsx("option",{value:"중",children:"중"}),e.jsx("option",{value:"하",children:"하"})]})]}),e.jsxs("div",{className:"inline-field",children:[e.jsx("label",{children:"접수경로"}),e.jsxs("select",{className:"subject-input",value:S.channel||"",onChange:r=>C("channel",r.target.value),children:[e.jsx("option",{value:"",children:"선택"}),e.jsx("option",{value:"전화",children:"전화"}),e.jsx("option",{value:"이메일",children:"이메일"}),e.jsx("option",{value:"고객채널",children:"고객채널"}),e.jsx("option",{value:"직접입력",children:"직접입력"})]})]}),e.jsxs("div",{className:"inline-field",children:[e.jsx("label",{children:"잠재고객"}),e.jsx("input",{className:"subject-input",value:S.leadName||"",readOnly:!0,placeholder:"-"})]}),e.jsxs("div",{className:"inline-field",children:[e.jsx("label",{children:"거래처"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{className:"subject-input",value:S.customerName||"",onChange:r=>{C("customerName",r.target.value),C("customerSeq","")},placeholder:"거래처명",style:{paddingRight:28}}),e.jsx("button",{type:"button","aria-label":"거래처 검색",title:"거래처 검색",onClick:()=>Y(!0),className:"btn-plain no-focus-ring",style:{position:"absolute",right:4,top:"50%",transform:"translateY(-50%)",padding:4,cursor:"pointer"},children:e.jsx("img",{src:Ns,className:"icon",alt:"검색"})})]})]}),e.jsxs("div",{className:"inline-field",children:[e.jsx("label",{children:"거래처 담당자"}),e.jsx("input",{className:"subject-input",value:S.contactName||"",onChange:r=>C("contactName",r.target.value),placeholder:"이름"})]}),e.jsxs("div",{className:"inline-field",children:[e.jsx("label",{children:"접수자"}),e.jsx("input",{className:"subject-input",value:S.ownerName||"",readOnly:!0,title:"로그인 사용자"})]}),e.jsxs("div",{className:"inline-field",children:[e.jsx("label",{children:"당사 담당자"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{className:"subject-input",value:S.assigneeName||"",onChange:r=>{C("assigneeName",r.target.value),C("assigneeId","")},placeholder:"이름",style:{paddingRight:28}}),e.jsx("button",{type:"button","aria-label":"직원 검색",title:"직원 검색",onClick:()=>a(!0),className:"btn-plain no-focus-ring",style:{position:"absolute",right:4,top:"50%",transform:"translateY(-50%)",padding:4,cursor:"pointer"},children:e.jsx("img",{src:Ns,className:"icon",alt:"검색"})})]})]}),e.jsxs("div",{className:"inline-field",children:[e.jsx("label",{children:"접수시각"}),e.jsx("input",{className:"subject-input",type:"datetime-local",value:S.openedAt||"",onChange:r=>C("openedAt",r.target.value)})]}),e.jsxs("div",{className:"inline-field",children:[e.jsx("label",{children:"종료시각"}),e.jsx("input",{className:"subject-input",type:"datetime-local",value:S.closedAt||"",onChange:r=>C("closedAt",r.target.value)})]})]}),e.jsxs("div",{className:"controls",style:{gap:8,justifyContent:"flex-end",alignItems:"center"},children:[d&&e.jsx("span",{className:"success",children:d}),e.jsx("button",{className:"btn",onClick:w,children:"저장"}),e.jsx("button",{className:"btn",onClick:de,children:"삭제"})]})]}):e.jsx("div",{className:"empty-state",children:"선택된 케이스가 없습니다."})}),[s,S,d]),[p,L]=t.useState(!1);async function X(r){try{const u=await fetch("/api/v1/inquiries",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!u.ok){const m=await u.text().catch(()=>"");alert("저장 실패: "+(m||u.status));return}const $=await u.json().catch(()=>null),N=$&&$.id!=null?Number($.id):null;L(!1);try{window.dispatchEvent(new CustomEvent("tnt.sales.inquiry.reload",{detail:{focusId:N}}))}catch{}}catch{alert("저장 중 오류가 발생했습니다")}}async function ue(){try{const r=await fetch(`/api/v1/inquiries/${s.id}`,{method:"DELETE"});if(!r.ok){const u=await r.text().catch(()=>"");U("삭제 실패: "+(u||r.status));return}try{localStorage.removeItem("tnt.sales.selectedInquiry")}catch{}o(null),se("삭제 되었습니다.");try{window.dispatchEvent(new CustomEvent("tnt.sales.inquiry.reload",{detail:{}}))}catch{}}catch{U("삭제 중 오류가 발생했습니다")}}async function de(){s!=null&&s.id&&Q(!0)}return e.jsxs(e.Fragment,{children:[e.jsxs("section",{children:[e.jsxs("div",{className:"page-title",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,minWidth:0,flex:"1 1 auto"},children:[e.jsx("h2",{style:{margin:0},children:"문의"}),(()=>{const r=["신규접수","확인 중","완료"],u=String(S.inquiryStatus||"").trim(),$=u==="보류";let N=r.indexOf(u);$&&(N=1),N<0&&(N=0);const m=Math.max(0,Math.min(100,Math.round(N/Math.max(1,r.length-1)*100)));return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4,flex:"0 1 520px"},children:[e.jsx("div",{className:"progress",style:{width:"min(520px, 48vw)"},children:e.jsx("div",{className:"progress-bar",style:{width:`${m}%`,background:$?"#ef4444":"var(--accent)"}})}),e.jsx("div",{style:{display:"flex",justifyContent:"space-between",width:"min(520px, 48vw)",fontSize:11,color:"var(--muted)"},children:r.map(P=>e.jsx("span",{style:{fontWeight:u===P?700:400},children:P},P))})]})})()]}),e.jsx("div",{className:"controls",style:{gap:8},children:e.jsx("button",{className:"btn",onClick:()=>L(!0),children:"신규 등록"})})]}),M&&e.jsx(La,{defaultQuery:S.customerName,onClose:()=>Y(!1),onSelect:r=>{C("customerSeq",r.customerSeq?String(r.customerSeq):""),C("customerName",r.customerName||""),Y(!1)}}),v&&e.jsx(Pa,{defaultQuery:S.leadName,onClose:()=>c(!1),onSelect:r=>{C("leadId",r.id!=null?String(r.id):""),C("leadName",r.companyName||""),c(!1)}}),f&&e.jsx(Ra,{defaultQuery:S.assigneeName,onClose:()=>a(!1),onSelect:r=>{C("assigneeId",r.assigneeId||""),C("assigneeName",r.empName||""),a(!1)}}),e.jsx(Ta,{compact:!0,maxHeight:"21vh"}),e.jsx("section",{className:"card",style:{marginTop:12,minHeight:240},children:b})]}),e.jsx(Ea,{open:p,onClose:()=>L(!1),onSubmit:X}),e.jsx(Tn,{open:!!H,onClose:()=>U(null),width:380,footer:e.jsx("button",{className:"btn",onClick:()=>U(null),children:"확인"}),children:H}),q&&e.jsxs("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:90},children:[e.jsx("div",{onClick:()=>Q(!1),style:{position:"absolute",inset:0,background:"rgba(0,0,0,.35)"}}),e.jsxs("div",{className:"card",style:{position:"absolute",top:"24%",left:"50%",transform:"translateX(-50%)",width:380,maxWidth:"92vw",padding:12},children:[e.jsx("div",{style:{padding:"4px 2px",fontSize:13},children:"선택한 문의를 삭제하시겠습니까?"}),e.jsxs("div",{className:"controls",style:{justifyContent:"flex-end",gap:8,marginTop:8},children:[e.jsx("button",{className:"btn",onClick:()=>Q(!1),children:"취소"}),e.jsx("button",{className:"btn",onClick:()=>{Q(!1),ue()},children:"삭제"})]})]})]}),W&&e.jsxs("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:90},children:[e.jsx("div",{onClick:()=>se(null),style:{position:"absolute",inset:0,background:"rgba(0,0,0,.35)"}}),e.jsxs("div",{className:"card",style:{position:"absolute",top:"20%",left:"50%",transform:"translateX(-50%)",width:360,maxWidth:"92vw",padding:12},children:[e.jsx("div",{className:"page-title",style:{marginBottom:8},children:e.jsx("h3",{style:{margin:0,fontSize:14},children:"알림"})}),e.jsx("div",{style:{padding:"4px 2px",fontSize:13},children:W}),e.jsx("div",{className:"controls",style:{justifyContent:"flex-end",gap:8,marginTop:8},children:e.jsx("button",{className:"btn",onClick:()=>se(null),children:"확인"})})]})]})]})}function La({defaultQuery:s,onClose:o,onSelect:d}){const[D,H]=t.useState(s||""),[U,q]=t.useState([]),[Q,W]=t.useState(!1),[se,ee]=t.useState(null);async function S(){W(!0),ee(null);try{const g=new URL("/api/v1/customers",window.location.origin);D.trim()&&g.searchParams.set("name",D.trim()),g.searchParams.set("mineOnly","false"),g.searchParams.set("limit","100");const M=await fetch(g.toString());if(!M.ok)throw new Error(`HTTP ${M.status}`);const Y=await M.json(),v=Array.isArray(Y)?Y.map(c=>({customerSeq:(c==null?void 0:c.customerSeq)??(c==null?void 0:c.customer_seq)??null,customerId:(c==null?void 0:c.customerId)??(c==null?void 0:c.customer_id)??null,customerName:(c==null?void 0:c.customerName)??(c==null?void 0:c.customer_name)??null,telNo:(c==null?void 0:c.telNo)??(c==null?void 0:c.tel_no)??null,addrProvinceName:(c==null?void 0:c.addrProvinceName)??(c==null?void 0:c.addr_province_name)??null,addrCityName:(c==null?void 0:c.addrCityName)??(c==null?void 0:c.addr_city_name)??null,companyType:(c==null?void 0:c.companyType)??(c==null?void 0:c.company_type)??null,ownerName:(c==null?void 0:c.ownerName)??(c==null?void 0:c.owner_name)??null})):[];q(v)}catch(g){ee((g==null?void 0:g.message)||"조회 실패"),q([])}finally{W(!1)}}return t.useEffect(()=>{S()},[]),t.useEffect(()=>{const g=M=>{M.key==="Escape"&&(M.preventDefault(),o())};return window.addEventListener("keydown",g,!0),()=>window.removeEventListener("keydown",g,!0)},[o]),e.jsxs("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:1100},children:[e.jsx("div",{onClick:o,style:{position:"absolute",inset:0,background:"rgba(0,0,0,.4)"}}),e.jsxs("div",{className:"card",style:{position:"absolute",top:"10%",left:"50%",transform:"translateX(-50%)",width:"90%",maxWidth:800,maxHeight:"80%",overflow:"auto",padding:12},children:[e.jsx("button",{"aria-label":"닫기",onClick:o,className:"btn-plain",style:{position:"absolute",top:8,right:8},children:e.jsx("img",{src:ct,className:"icon",alt:"닫기"})}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:8},children:[e.jsx("input",{className:"subject-input",placeholder:"거래처명",value:D,onChange:g=>H(g.target.value),onKeyDown:g=>{g.key==="Enter"&&S()},style:{flex:1}}),e.jsx("button",{className:"btn",onClick:S,children:"조회"})]}),e.jsx("div",{className:"table-container",style:{height:360},children:U.length===0?e.jsx("div",{className:"empty-state",children:Q?"불러오는 중…":se||"결과가 없습니다"}):e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:220},children:"거래처명"}),e.jsx("th",{style:{width:140},children:"회사구분"}),e.jsx("th",{style:{width:140},children:"대표자명"}),e.jsx("th",{style:{width:180},children:"지역"})]})}),e.jsx("tbody",{children:U.map((g,M)=>e.jsxs("tr",{onDoubleClick:()=>d(g),onClick:()=>d(g),children:[e.jsx("td",{children:g.customerName||""}),e.jsx("td",{children:g.companyType||""}),e.jsx("td",{children:g.ownerName||""}),e.jsx("td",{children:[g.addrProvinceName,g.addrCityName].filter(Boolean).join(" ")})]},M))})]})})]})]})}function Pa({defaultQuery:s,onClose:o,onSelect:d}){const[D,H]=t.useState(s||""),[U,q]=t.useState([]),[Q,W]=t.useState(!1),[se,ee]=t.useState(null);async function S(){W(!0),ee(null);try{const g=new URL("/api/v1/leads",window.location.origin);D.trim()&&g.searchParams.set("company_name",D.trim()),g.searchParams.set("limit","100");const M=await fetch(g.toString());if(!M.ok)throw new Error(`HTTP ${M.status}`);const Y=await M.json(),v=Array.isArray(Y)?Y.map(c=>({id:(c==null?void 0:c.id)!=null?Number(c.id):null,companyName:(c==null?void 0:c.company_name)??null,leadStatus:(c==null?void 0:c.lead_status)??null,ownerName:(c==null?void 0:c.owner_name)??null,addrProvinceName:(c==null?void 0:c.addr_province_name)??null})):[];q(v)}catch(g){ee((g==null?void 0:g.message)||"조회 실패"),q([])}finally{W(!1)}}return t.useEffect(()=>{S()},[]),t.useEffect(()=>{const g=M=>{M.key==="Escape"&&(M.preventDefault(),o())};return window.addEventListener("keydown",g,!0),()=>window.removeEventListener("keydown",g,!0)},[o]),e.jsxs("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:1100},children:[e.jsx("div",{onClick:o,style:{position:"absolute",inset:0,background:"rgba(0,0,0,.4)"}}),e.jsxs("div",{className:"card",style:{position:"absolute",top:"10%",left:"50%",transform:"translateX(-50%)",width:"90%",maxWidth:800,maxHeight:"80%",overflow:"auto",padding:12},children:[e.jsx("button",{"aria-label":"닫기",onClick:o,className:"btn-plain",style:{position:"absolute",top:8,right:8},children:e.jsx("img",{src:ct,className:"icon",alt:"닫기"})}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:8},children:[e.jsx("input",{className:"subject-input",placeholder:"잠재고객명",value:D,onChange:g=>H(g.target.value),onKeyDown:g=>{g.key==="Enter"&&S()},style:{flex:1}}),e.jsx("button",{className:"btn",onClick:S,children:"조회"})]}),e.jsx("div",{className:"table-container",style:{height:360},children:U.length===0?e.jsx("div",{className:"empty-state",children:Q?"불러오는 중…":se||"결과가 없습니다"}):e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:220},children:"잠재고객명"}),e.jsx("th",{style:{width:120},children:"상태"}),e.jsx("th",{style:{width:140},children:"소유자"}),e.jsx("th",{style:{width:160},children:"지역"})]})}),e.jsx("tbody",{children:U.map((g,M)=>e.jsxs("tr",{onDoubleClick:()=>d(g),onClick:()=>d(g),children:[e.jsx("td",{children:g.companyName||""}),e.jsx("td",{children:g.leadStatus||""}),e.jsx("td",{children:g.ownerName||""}),e.jsx("td",{children:g.addrProvinceName||""})]},M))})]})})]})]})}function Ra({defaultQuery:s,onClose:o,onSelect:d}){const[D,H]=t.useState(s||""),[U,q]=t.useState([]),[Q,W]=t.useState(!1),[se,ee]=t.useState(null);async function S(){W(!0),ee(null);try{const g=new URL("/api/v1/employees",window.location.origin);g.searchParams.set("depts","all");const M=await fetch(g.toString());if(!M.ok)throw new Error(`HTTP ${M.status}`);const Y=await M.json(),v=Array.isArray(Y)?Y.map(a=>({empId:(a==null?void 0:a.emp_id)??null,empName:(a==null?void 0:a.emp_name)??null,deptName:(a==null?void 0:a.dept_name)??null,assigneeId:(a==null?void 0:a.assignee_id)??null})):[],c=D.trim().toLowerCase(),f=(c?v.filter(a=>(a.empName||"").toLowerCase().includes(c)||(a.empId||"").toLowerCase().includes(c)||(a.deptName||"").toLowerCase().includes(c)):v).sort((a,C)=>(a.empName||"").localeCompare(C.empName||"","ko",{sensitivity:"base"}));q(f)}catch(g){ee((g==null?void 0:g.message)||"조회 실패"),q([])}finally{W(!1)}}return t.useEffect(()=>{S()},[]),t.useEffect(()=>{const g=M=>{M.key==="Escape"&&(M.preventDefault(),o())};return window.addEventListener("keydown",g,!0),()=>window.removeEventListener("keydown",g,!0)},[o]),e.jsxs("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:1100},children:[e.jsx("div",{onClick:o,style:{position:"absolute",inset:0,background:"rgba(0,0,0,.4)"}}),e.jsxs("div",{className:"card",style:{position:"absolute",top:"10%",left:"50%",transform:"translateX(-50%)",width:"90%",maxWidth:700,maxHeight:"80%",overflow:"auto",padding:12},children:[e.jsx("button",{"aria-label":"닫기",onClick:o,className:"btn-plain",style:{position:"absolute",top:8,right:8},children:e.jsx("img",{src:ct,className:"icon",alt:"닫기"})}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:8},children:[e.jsx("input",{className:"subject-input",placeholder:"이름/사번/부서",value:D,onChange:g=>H(g.target.value),onKeyDown:g=>{g.key==="Enter"&&S()},style:{flex:1}}),e.jsx("button",{className:"btn",onClick:S,children:"조회"})]}),e.jsx("div",{className:"table-container",style:{height:320},children:U.length===0?e.jsx("div",{className:"empty-state",children:Q?"불러오는 중…":se||"결과가 없습니다"}):e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:160},children:"이름"}),e.jsx("th",{style:{width:160},children:"부서"}),e.jsx("th",{style:{width:140},children:"사번"}),e.jsx("th",{style:{width:140},children:"assignee_id"})]})}),e.jsx("tbody",{children:U.map((g,M)=>e.jsxs("tr",{onDoubleClick:()=>d(g),onClick:()=>d(g),children:[e.jsx("td",{children:g.empName||""}),e.jsx("td",{children:g.deptName||""}),e.jsx("td",{children:g.empId||""}),e.jsx("td",{children:g.assigneeId||""})]},M))})]})})]})]})}function qa({compact:s=!1,maxHeight:o}){const[d,D]=t.useState([]),[H,U]=t.useState(!1),[q,Q]=t.useState(null),[W,se]=t.useState(()=>{try{const M=localStorage.getItem("tnt.sales.selectedEstimate");if(M){const Y=JSON.parse(M),v=Number(Y==null?void 0:Y.id);return Number.isFinite(v)?v:null}}catch{}return null});async function ee(){Q(null),U(!0);try{const M=["/api/v1/estimates","/api/v1/quotes"];let Y=null;for(const c of M)try{const f=await fetch(c);if(f.ok){Y=await f.json();break}}catch{}let v=[];Array.isArray(Y)?v=Y.map((c,f)=>({id:Number((c==null?void 0:c.id)??f+1),estimateNumber:String((c==null?void 0:c.estimateNumber)??(c==null?void 0:c.estimate_number)??""),title:String((c==null?void 0:c.title)??""),status:String((c==null?void 0:c.status)??""),owner:String((c==null?void 0:c.owner)??(c==null?void 0:c.ownerId)??(c==null?void 0:c.owner_id)??""),issuedAt:String((c==null?void 0:c.issuedAt)??(c==null?void 0:c.issued_at)??"")})):v=[{id:1,estimateNumber:"E-2025-0001",title:"제품 견적 A",status:"draft",owner:"kim",issuedAt:"2025-02-01T10:00:00Z"},{id:2,estimateNumber:"E-2025-0002",title:"서비스 견적 B",status:"sent",owner:"lee",issuedAt:"2025-02-03T11:00:00Z"}],v.sort((c,f)=>(c.title||"").localeCompare(f.title||"","ko",{sensitivity:"base"})),D(v),v.length>0&&W==null&&S(v[0])}catch(M){Q((M==null?void 0:M.message)||"조회 중 오류가 발생했습니다")}finally{U(!1)}}t.useEffect(()=>{ee()},[]);function S(M){se(M.id);try{localStorage.setItem("tnt.sales.selectedEstimate",JSON.stringify(M)),window.dispatchEvent(new CustomEvent("tnt.sales.estimate.selected",{detail:{estimate:M}}))}catch{}}return t.useMemo(()=>e.jsx("div",{className:"table-container",style:{maxHeight:o??(s?"32vh":void 0)},children:d.length===0?e.jsx("div",{className:"empty-state",children:H?"불러오는 중…":q||"데이터가 없습니다"}):e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:140},children:"견적번호"}),e.jsx("th",{children:"제목"}),e.jsx("th",{style:{width:120},children:"상태"}),e.jsx("th",{style:{width:140},children:"소유자"}),e.jsx("th",{style:{width:180},children:"발행시각"})]})}),e.jsx("tbody",{children:d.map((M,Y)=>e.jsxs("tr",{className:W===M.id?"selected":void 0,onClick:()=>S(M),children:[e.jsx("td",{children:M.estimateNumber||""}),e.jsx("td",{children:M.title||""}),e.jsx("td",{children:M.status||""}),e.jsx("td",{children:M.owner||""}),e.jsx("td",{children:M.issuedAt?(()=>{const v=new Date(M.issuedAt);if(isNaN(v.getTime()))return M.issuedAt;const c=String(v.getFullYear()%100).padStart(2,"0"),f=String(v.getMonth()+1).padStart(2,"0"),a=String(v.getDate()).padStart(2,"0"),C=String(v.getHours()).padStart(2,"0"),w=String(v.getMinutes()).padStart(2,"0");return`${c}-${f}-${a} ${C}:${w}`})():""})]},Y))})]})}),[d,W,H,q,s,o])}function Wa(){const[s,o]=t.useState(()=>{try{const U=localStorage.getItem("tnt.sales.selectedEstimate");return U?JSON.parse(U):null}catch{return null}});t.useEffect(()=>{const U=()=>{try{const q=localStorage.getItem("tnt.sales.selectedEstimate");o(q?JSON.parse(q):null)}catch{o(null)}};return window.addEventListener("tnt.sales.estimate.selected",U),()=>window.removeEventListener("tnt.sales.estimate.selected",U)},[]);const d=t.useMemo(()=>e.jsx("div",{className:"card",style:{padding:12},children:s?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"견적번호"}),e.jsx("div",{className:"subject-input",children:s.estimateNumber||""})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"상태"}),e.jsx("div",{className:"subject-input",children:s.status||""})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"제목"}),e.jsx("div",{className:"subject-input",children:s.title||""})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"소유자"}),e.jsx("div",{className:"subject-input",children:s.owner||""})]})]}):e.jsx("div",{className:"empty-state",children:"선택된 견적이 없습니다."})}),[s]),[D,H]=t.useState("details");return e.jsxs("section",{children:[e.jsx("div",{className:"page-title",children:e.jsx("h2",{children:"견적"})}),e.jsx(qa,{compact:!0,maxHeight:"32vh"}),e.jsxs("section",{className:"card",style:{marginTop:12,minHeight:240},children:[e.jsxs("div",{className:"tabs c360-tabs",children:[e.jsx("button",{className:D==="details"?"tab active":"tab",onClick:()=>H("details"),children:"상세"}),e.jsx("button",{className:D==="items"?"tab active":"tab",onClick:()=>H("items"),children:"품목"}),e.jsx("button",{className:D==="attachments"?"tab active":"tab",onClick:()=>H("attachments"),children:"첨부"})]}),e.jsxs("div",{style:{marginTop:12},children:[D==="details"&&d,D==="items"&&e.jsx("div",{className:"empty-state",children:"견적 품목(추후)"}),D==="attachments"&&e.jsx("div",{className:"empty-state",children:"첨부 파일(추후)"})]})]})]})}function Oa(){const[s,o]=t.useState(()=>an()),[d,D]=t.useState(Bs());t.useEffect(()=>Yn(()=>D(Bs())),[]);function H(U){const q=!Hs(U);Kn(U,q),D(Bs())}return e.jsxs("section",{children:[e.jsx("h1",{children:"설정"}),e.jsx("p",{className:"muted",children:"좌측 메뉴(1, 2 레벨)를 표시/숨김으로 제어합니다. 모든 사용자에게 동일하게 적용됩니다(임시: 로컬 저장소 기반)."}),e.jsx("div",{style:{display:"flex",gap:24,alignItems:"flex-start",marginTop:12},children:e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("h3",{style:{margin:"12px 0"},children:"메뉴 표시 설정"}),e.jsx("button",{className:"btn",onClick:()=>o(an()),children:"메뉴 다시 읽기"})]}),e.jsx("ul",{style:{listStyle:"none",padding:0,margin:0},children:s.map(U=>{var q;return e.jsxs("li",{style:{marginBottom:10},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("input",{type:"checkbox",checked:Hs(U.key),onChange:()=>H(U.key)}),e.jsx("strong",{children:U.label}),e.jsxs("span",{className:"muted",style:{fontSize:12},children:["(",U.key,")"]})]}),(q=U.children)!=null&&q.length?e.jsx("ul",{style:{listStyle:"none",padding:"6px 0 0 22px",margin:0},children:U.children.map(Q=>e.jsx("li",{style:{marginBottom:6},children:e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("input",{type:"checkbox",checked:Hs(Q.key),onChange:()=>H(Q.key)}),e.jsx("span",{children:Q.label}),e.jsxs("span",{className:"muted",style:{fontSize:12},children:["(",Q.key,")"]})]})},Q.key))}):null]},U.key)})})]})})]})}function za(){const[s,o]=t.useState(null),[d,D]=t.useState({}),[H,U]=t.useState(null),[q,Q]=t.useState({open:!1,text:""}),[W,se]=t.useState([]),ee=t.useMemo(()=>{try{return localStorage.getItem("tnt.sales.assigneeId")||""}catch{return""}},[]),S=t.useMemo(()=>{try{return localStorage.getItem("tnt.sales.empId")||""}catch{return""}},[]);t.useEffect(()=>{const l=()=>{try{const i=localStorage.getItem("tnt.sales.selectedLead"),x=i?JSON.parse(i):null;o(x),D({...x||{}}),U(null)}catch{o(null),D({}),U(null)}};return window.addEventListener("tnt.sales.lead.selected",l),()=>window.removeEventListener("tnt.sales.lead.selected",l)},[]);function g(l,i){D(x=>({...x,[l]:i})),H&&U(null)}async function M(){if(!(!d||d.id==null))try{const l={...d};delete l.created_by_name,delete l.updated_by_name,delete l.created_at,delete l.updated_at;try{(!d.assignee_id||String(d.assignee_id).trim()==="")&&(delete l.assignee_id,delete l.owner_name,delete l.owner_id)}catch{}try{const h=localStorage.getItem("tnt.sales.assigneeId")||"";h&&(l.updated_by=h)}catch{}const i=await fetch(`/api/v1/leads/${d.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!i.ok)throw new Error(`HTTP ${i.status}`);const x=await i.json().catch(()=>({}));if(x!=null&&x.ok){const h=d.company_name||"";Q({open:!0,text:`${h} 수정되었습니다.`});try{const O=await fetch(`/api/v1/leads/${d.id}`),E=O.ok?await O.json():d;D(pe=>({...pe,...E||{}})),o(pe=>({...pe||{},...E||{}})),localStorage.setItem("tnt.sales.selectedLead",JSON.stringify(E||d)),window.dispatchEvent(new CustomEvent("tnt.sales.lead.selected",{detail:{lead:E||d}})),window.dispatchEvent(new CustomEvent("tnt.sales.lead.updated",{detail:{lead:E||d}}))}catch{try{localStorage.setItem("tnt.sales.selectedLead",JSON.stringify(d)),window.dispatchEvent(new CustomEvent("tnt.sales.lead.selected",{detail:{lead:d}})),window.dispatchEvent(new CustomEvent("tnt.sales.lead.updated",{detail:{lead:d}}))}catch{}}}else throw new Error("저장 실패")}catch(l){U((l==null?void 0:l.message)||"저장 중 오류가 발생했습니다")}}t.useEffect(()=>{(async()=>{try{const l=await fetch("/api/v1/employees");if(!l.ok)return;const i=await l.json();if(Array.isArray(i)){let x=[...i];if(!x.some(O=>String((O==null?void 0:O.emp_name)||"")==="윤이랑"))try{const O=await fetch("/api/v1/employees?depts=all");if(O.ok){const E=await O.json();if(Array.isArray(E)){const pe=E.find(re=>String((re==null?void 0:re.emp_name)||"")==="윤이랑");pe&&(x=[...x,pe])}}}catch{}se(x)}}catch{}})()},[]);const Y=!d||d.id==null,[v,c]=t.useState(!1),[f,a]=t.useState(""),[C,w]=t.useState(""),[b,p]=t.useState(!1),[L,X]=t.useState({}),[ue,de]=t.useState(!1),{ref:r,style:u,bindHeader:$,bindContainer:N}=At("lead.tm",v,l=>{const i=document.querySelector(".pane.center"),x=i?i.getBoundingClientRect():null,h=l.getBoundingClientRect(),O=h.width,E=h.height,pe=x?x.left+(x.width-O)/2:(window.innerWidth-O)/2,re=Math.max(0,window.innerHeight-E-16),G=Math.min(Math.max(0,pe),window.innerWidth-O),xe=Math.min(Math.max(0,re),window.innerHeight-E);return{x:G,y:xe}},{persist:!1,resetOnOpen:!0}),{ref:m,style:P,bindHeader:te,bindContainer:K}=At("lead.new",b,l=>{const i=document.querySelector(".pane.center"),x=i?i.getBoundingClientRect():null,h=l.getBoundingClientRect(),O=h.width,E=h.height,pe=x?x.left+(x.width-O)/2:(window.innerWidth-O)/2,re=Math.max(0,window.innerHeight*.1),G=Math.min(Math.max(0,pe),window.innerWidth-O),xe=Math.min(Math.max(0,re),window.innerHeight-E);return{x:G,y:xe}},{persist:!1,resetOnOpen:!0});t.useEffect(()=>{if(!b)return;const l=i=>{i.key==="Escape"&&p(!1)};return window.addEventListener("keydown",l,!0),()=>window.removeEventListener("keydown",l,!0)},[b]),t.useEffect(()=>{if(!v)return;const l=i=>{i.key==="Escape"&&c(!1)};return window.addEventListener("keydown",l,!0),()=>window.removeEventListener("keydown",l,!0)},[v]);function j(l){if(!l)return"";const i=new Date(l);return isNaN(i.getTime())?String(l):new Intl.DateTimeFormat("ko-KR",{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}).format(i)}const ne=t.useMemo(()=>{const l=["신규등록","접촉 중","영업 접촉 중","전환성공"],i=((d==null?void 0:d.lead_status)||"").trim(),x=i==="자격미달"||i==="전환실패";let h=l.indexOf(i);i==="자격미달"&&(h=1),i==="전환실패"&&(h=l.length-1),h<0&&(h=0);const O=Math.max(0,Math.min(100,Math.round(h/Math.max(1,l.length-1)*100)));return e.jsxs("div",{className:"page-title",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,minWidth:0,flex:"1 1 auto"},children:[e.jsx("h2",{style:{margin:0},children:"잠재고객"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4,flex:"0 1 520px"},children:[e.jsx("div",{className:"progress",style:{width:"min(520px, 48vw)"},children:e.jsx("div",{className:"progress-bar",style:{width:`${O}%`,background:x?"#ef4444":"var(--accent)"}})}),e.jsx("div",{style:{display:"flex",justifyContent:"space-between",width:"min(520px, 48vw)",fontSize:11,color:"var(--muted)"},children:l.map(E=>e.jsx("span",{style:{fontWeight:i===E?700:400},children:E},E))})]})]}),e.jsxs("div",{className:"controls",style:{gap:8},children:[e.jsx("button",{className:"btn",onClick:()=>{X({}),p(!0)},children:"신규"}),e.jsx("button",{className:"btn",onClick:()=>de(!0),disabled:Y,children:"영업활동 등록"}),e.jsx("button",{className:"btn",onClick:()=>{c(!0),U(null)},disabled:Y,children:"TM활동 등록"})]})]})},[Y,d.lead_status]);return e.jsxs("section",{children:[ne,e.jsx("div",{className:"card",style:{padding:12},children:d&&d.id!=null?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-grid",style:{columnGap:10,rowGap:6},children:[e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"상태"}),e.jsxs("select",{className:"search-input",value:d.lead_status||"",onChange:l=>g("lead_status",l.target.value),children:[e.jsx("option",{value:"",children:"(선택)"}),e.jsx("option",{value:"신규등록",children:"신규등록"}),e.jsx("option",{value:"자격미달",children:"자격미달"}),e.jsx("option",{value:"접촉 중",children:"접촉 중"}),e.jsx("option",{value:"영업 접촉 중",children:"영업 접촉 중"}),e.jsx("option",{value:"전환성공",children:"전환성공"}),e.jsx("option",{value:"전환실패",children:"전환실패"})]})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"소스"}),e.jsxs("select",{className:"search-input",value:d.lead_source||"",onChange:l=>g("lead_source",l.target.value),children:[e.jsx("option",{value:"",children:"(선택)"}),e.jsx("option",{value:"목록구매",children:"목록구매"}),e.jsx("option",{value:"내부추천",children:"내부추천"}),e.jsx("option",{value:"외부추천",children:"외부추천"}),e.jsx("option",{value:"전시회/행사",children:"전시회/행사"})]})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"회사"}),e.jsx("input",{className:"search-input",type:"text",value:d.company_name||"",onChange:l=>g("company_name",l.target.value)})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"거래처 담당자"}),e.jsx("input",{className:"search-input",type:"text",value:d.contact_name||"",onChange:l=>g("contact_name",l.target.value)})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"이메일"}),e.jsx("input",{className:"search-input",type:"text",value:d.email||"",onChange:l=>g("email",l.target.value)})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"연락처"}),e.jsx("input",{className:"search-input",type:"text",value:d.contact_phone||"",onChange:l=>g("contact_phone",l.target.value)})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"대표번호"}),e.jsx("input",{className:"search-input",type:"text",value:d.office_phone||"",onChange:l=>g("office_phone",l.target.value)})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"업종"}),e.jsxs("select",{className:"search-input",value:d.biz_type||"",onChange:l=>g("biz_type",l.target.value),children:[e.jsx("option",{value:"",children:"(선택)"}),e.jsx("option",{value:"가공",children:"가공"}),e.jsx("option",{value:"시공",children:"시공"}),e.jsx("option",{value:"가시공",children:"가시공"}),e.jsx("option",{value:"유통",children:"유통"}),e.jsx("option",{value:"알수없음",children:"알수없음"})]})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"사업자번호"}),e.jsx("input",{className:"search-input",type:"text",value:d.biz_no||"",onChange:l=>g("biz_no",l.target.value)})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"지역(도/광역)"}),e.jsx("input",{className:"search-input",type:"text",value:d.addr_province_name||"",onChange:l=>g("addr_province_name",l.target.value)})]}),e.jsxs("div",{className:"field inline-field row-2",children:[e.jsx("label",{children:"주소"}),e.jsx("input",{className:"search-input",type:"text",value:d.address||"",onChange:l=>g("address",l.target.value)})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"팩스"}),e.jsx("input",{className:"search-input",type:"text",value:d.fax_no||"",onChange:l=>g("fax_no",l.target.value)})]}),e.jsxs("div",{className:"field inline-field row-2",children:[e.jsx("label",{children:"비고"}),e.jsx("textarea",{className:"search-input",value:d.note||"",onChange:l=>g("note",l.target.value),style:{minHeight:80}})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"소유자"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8,alignItems:"center"},children:[e.jsxs("select",{className:"search-input",value:d.assignee_id||"",onChange:l=>g("assignee_id",l.target.value||null),children:[e.jsx("option",{value:"",children:"(선택)"}),W.map(l=>e.jsxs("option",{value:l.assignee_id,children:[l.dept_name," · ",l.emp_name]},l.assignee_id))]}),e.jsx("div",{style:{whiteSpace:"nowrap",alignSelf:"center",fontSize:12},children:(()=>{const l=d.owner_name&&String(d.owner_name).trim()?String(d.owner_name):"",i=d.assignee_id||"",x=W.find(O=>O.assignee_id===i);return`현재소유자 : ${l||(x?x.emp_name:"")||"-"}`})()})]})]}),e.jsxs("div",{className:"field inline-four row-2",children:[e.jsx("label",{children:"작성자"}),e.jsxs("div",{className:"subject-input",style:{padding:"6px 8px"},children:[d.created_by_name||(d.created_by??"")||ee||S,d.created_at?`, ${j(d.created_at)}`:""]}),e.jsx("label",{children:"최종 수정자"}),e.jsxs("div",{className:"subject-input",style:{padding:"6px 8px"},children:[d.updated_by_name||(d.updated_by??"")||ee||S,d.updated_at?`, ${j(d.updated_at)}`:""]})]})]}),e.jsxs("div",{className:"controls",style:{justifyContent:"space-between",marginTop:10,gap:8},children:[e.jsx("div",{"aria-live":"polite",style:{fontSize:12,color:"var(--accent)"},children:H||""}),e.jsx("div",{children:e.jsxs("div",{style:{display:"inline-flex",gap:8},children:[e.jsx("button",{className:"btn",onClick:M,disabled:Y,children:"저장"}),Y?null:e.jsx("button",{className:"btn btn-danger",onClick:async()=>{if(d!=null&&d.id){`${d.id}`;try{const l=await fetch(`/api/v1/leads/${d.id}`,{method:"DELETE"});if(!l.ok){const i=await l.json().catch(()=>null);throw new Error((i==null?void 0:i.message)||`HTTP ${l.status}`)}Q({open:!0,text:"삭제되었습니다."}),D({}),o(null),localStorage.removeItem("tnt.sales.selectedLead"),window.dispatchEvent(new CustomEvent("tnt.sales.lead.selected",{detail:{lead:null}})),window.dispatchEvent(new CustomEvent("tnt.sales.lead.updated",{detail:{lead:null}}))}catch(l){U((l==null?void 0:l.message)||"삭제 중 오류가 발생했습니다")}}},children:"삭제"})]})})]})]}):e.jsx("div",{className:"empty-state",children:"우측에서 잠재고객을 선택하세요."})}),v&&e.jsxs("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:1e4,pointerEvents:"none"},children:[e.jsx("div",{style:{position:"absolute",inset:0,background:"rgba(0,0,0,.25)",pointerEvents:"none"}}),e.jsxs("div",{ref:r,className:"card",style:{...u,width:"min(720px, 92vw)",maxHeight:"80vh",overflow:"auto",padding:16,pointerEvents:"auto"},...N,children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:10,cursor:"move"},...$,children:[e.jsx("h3",{style:{margin:0},children:"TM 활동 등록"}),e.jsx("span",{role:"button",tabIndex:0,className:"icon-button","aria-label":"닫기",title:"닫기",onClick:()=>c(!1),onKeyDown:l=>{(l.key==="Enter"||l.key===" ")&&(l.preventDefault(),c(!1))},children:e.jsx("img",{src:ct,className:"icon",alt:"닫기"})})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"제목"}),e.jsx("input",{className:"search-input",type:"text",value:f,onChange:l=>a(l.target.value),placeholder:"제목"})]}),e.jsxs("div",{className:"field inline-field row-2",children:[e.jsx("label",{children:"활동 설명"}),e.jsx("textarea",{className:"search-input",value:C,onChange:l=>w(l.target.value),placeholder:"활동 설명",style:{minHeight:100}})]}),e.jsxs("div",{className:"field inline-field row-2",children:[e.jsx("label",{children:"잠재고객"}),e.jsxs("div",{className:"subject-input",style:{padding:"6px 8px"},children:[d.company_name||"",d.contact_name?` / ${d.contact_name}`:"",d.contact_phone?` / ${d.contact_phone}`:""]})]}),e.jsxs("div",{className:"controls",style:{justifyContent:"flex-end",marginTop:10,gap:8},children:[e.jsx("button",{className:"btn",onClick:()=>c(!1),children:"취소"}),e.jsx("button",{className:"btn",onClick:async()=>{try{const l=localStorage.getItem("tnt.sales.assigneeId")||localStorage.getItem("tnt.sales.empId")||"";if(!l){U("로그인이 필요합니다");return}const i={sfOwnerId:l,subject:f||"",description:C||"",activityType:"전화",activityStatus:"계획",channel:"전화",sfLeadId:(d==null?void 0:d.id)!=null?String(d.id):void 0,createdBy:localStorage.getItem("tnt.sales.empId")||void 0,updatedBy:localStorage.getItem("tnt.sales.empId")||void 0},x=await fetch("/api/v1/sales-activities",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!x.ok){let h=`HTTP ${x.status}`;try{const O=await x.json();O!=null&&O.error&&(h=O.error)}catch{}throw new Error(h)}c(!1),a(""),w("");try{window.dispatchEvent(new CustomEvent("tnt.sales.activity.updated",{detail:{leadId:d==null?void 0:d.id}}))}catch{}Q({open:!0,text:"TM 활동이 등록되었습니다."})}catch(l){U((l==null?void 0:l.message)||"TM 활동 등록 실패")}},children:"저장"})]})]})]}),b&&e.jsxs("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:1e4,pointerEvents:"none"},children:[e.jsx("div",{style:{position:"absolute",inset:0,background:"rgba(0,0,0,.25)",pointerEvents:"none"}}),e.jsxs("div",{ref:m,className:"card",style:{...P,width:"min(880px, 96vw)",maxHeight:"86vh",overflow:"auto",padding:16,pointerEvents:"auto"},...K,children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:10,cursor:"move"},...te,children:[e.jsx("h3",{style:{margin:0},children:"잠재고객 신규"}),e.jsx("span",{role:"button",tabIndex:0,className:"icon-button","aria-label":"닫기",title:"닫기",onClick:()=>p(!1),children:e.jsx("img",{src:ct,className:"icon",alt:"닫기"})})]}),e.jsxs("div",{className:"form-grid",style:{columnGap:10,rowGap:6},children:[e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"상태"}),e.jsxs("select",{className:"search-input",value:L.lead_status||"",onChange:l=>X(i=>({...i,lead_status:l.target.value})),children:[e.jsx("option",{value:"",children:"(선택)"}),e.jsx("option",{value:"신규등록",children:"신규등록"}),e.jsx("option",{value:"자격미달",children:"자격미달"}),e.jsx("option",{value:"접촉 중",children:"접촉 중"}),e.jsx("option",{value:"영업 접촉 중",children:"영업 접촉 중"}),e.jsx("option",{value:"전환성공",children:"전환성공"}),e.jsx("option",{value:"전환실패",children:"전환실패"})]})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"소스"}),e.jsxs("select",{className:"search-input",value:L.lead_source||"",onChange:l=>X(i=>({...i,lead_source:l.target.value})),children:[e.jsx("option",{value:"",children:"(선택)"}),e.jsx("option",{value:"목록구매",children:"목록구매"}),e.jsx("option",{value:"내부추천",children:"내부추천"}),e.jsx("option",{value:"외부추천",children:"외부추천"}),e.jsx("option",{value:"전시회/행사",children:"전시회/행사"})]})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"회사"}),e.jsx("input",{className:"search-input",type:"text",value:L.company_name||"",onChange:l=>X(i=>({...i,company_name:l.target.value}))})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"거래처 담당자"}),e.jsx("input",{className:"search-input",type:"text",value:L.contact_name||"",onChange:l=>X(i=>({...i,contact_name:l.target.value}))})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"이메일"}),e.jsx("input",{className:"search-input",type:"text",value:L.email||"",onChange:l=>X(i=>({...i,email:l.target.value}))})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"연락처"}),e.jsx("input",{className:"search-input",type:"text",value:L.contact_phone||"",onChange:l=>X(i=>({...i,contact_phone:l.target.value}))})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"대표번호"}),e.jsx("input",{className:"search-input",type:"text",value:L.office_phone||"",onChange:l=>X(i=>({...i,office_phone:l.target.value}))})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"업종"}),e.jsxs("select",{className:"search-input",value:L.biz_type||"",onChange:l=>X(i=>({...i,biz_type:l.target.value})),children:[e.jsx("option",{value:"",children:"(선택)"}),e.jsx("option",{value:"가공",children:"가공"}),e.jsx("option",{value:"시공",children:"시공"}),e.jsx("option",{value:"가시공",children:"가시공"}),e.jsx("option",{value:"유통",children:"유통"}),e.jsx("option",{value:"알수없음",children:"알수없음"})]})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"사업자번호"}),e.jsx("input",{className:"search-input",type:"text",value:L.biz_no||"",onChange:l=>X(i=>({...i,biz_no:l.target.value}))})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"지역(도/광역)"}),e.jsx("input",{className:"search-input",type:"text",value:L.addr_province_name||"",onChange:l=>X(i=>({...i,addr_province_name:l.target.value}))})]}),e.jsxs("div",{className:"field inline-field row-2",children:[e.jsx("label",{children:"주소"}),e.jsx("input",{className:"search-input",type:"text",value:L.address||"",onChange:l=>X(i=>({...i,address:l.target.value}))})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"팩스"}),e.jsx("input",{className:"search-input",type:"text",value:L.fax_no||"",onChange:l=>X(i=>({...i,fax_no:l.target.value}))})]}),e.jsxs("div",{className:"field inline-field row-2",children:[e.jsx("label",{children:"비고"}),e.jsx("textarea",{className:"search-input",value:L.note||"",onChange:l=>X(i=>({...i,note:l.target.value})),style:{minHeight:80}})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"소유자"}),e.jsxs("select",{className:"search-input",value:L.assignee_id||"",onChange:l=>X(i=>({...i,assignee_id:l.target.value||null})),children:[e.jsx("option",{value:"",children:"(선택)"}),W.map(l=>e.jsxs("option",{value:l.assignee_id,children:[l.dept_name," · ",l.emp_name]},l.assignee_id))]})]})]}),e.jsxs("div",{className:"controls",style:{justifyContent:"flex-end",marginTop:10,gap:8},children:[e.jsx("button",{className:"btn",onClick:()=>p(!1),children:"취소"}),e.jsx("button",{className:"btn",onClick:async()=>{try{const l={...L},i=localStorage.getItem("tnt.sales.empId")||void 0;i&&(l.created_by=i,l.updated_by=i);const x=await fetch("/api/v1/leads",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}),h=await x.json().catch(()=>({}));if(!x.ok||h&&h.error)throw new Error((h==null?void 0:h.error)||`HTTP ${x.status}`);const O=h==null?void 0:h.id,E={...L||{},id:O};try{localStorage.setItem("tnt.sales.selectedLead",JSON.stringify(E)),window.dispatchEvent(new CustomEvent("tnt.sales.lead.selected",{detail:{lead:E}})),window.dispatchEvent(new CustomEvent("tnt.sales.lead.updated",{detail:{lead:E}}))}catch{}p(!1);const pe=L.company_name||"";Q({open:!0,text:`${pe} 신규 생성되었습니다.`})}catch{}},children:"저장"})]})]})]}),e.jsx(In,{open:ue,onClose:()=>de(!1),leadId:(d==null?void 0:d.id)??null,leadName:(d==null?void 0:d.company_name)||""}),q.open?e.jsx("div",{role:"dialog","aria-modal":"true",className:"card",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.45)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:70},children:e.jsxs("div",{className:"card",style:{background:"var(--panel)",padding:12,border:"1px solid var(--border)",borderRadius:10,minWidth:260,maxWidth:"86vw"},children:[e.jsx("div",{style:{marginBottom:8,fontWeight:700,textAlign:"center"},children:q.text}),e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx("button",{className:"btn btn-card btn-3d",onClick:()=>Q({open:!1,text:""}),children:"확인"})})]})}):null]})}function Ks(s){if(!s)return"";const o=s instanceof Date?s:new Date(s);if(isNaN(o.getTime()))return"";const d=String(o.getFullYear()%100).padStart(2,"0"),D=String(o.getMonth()+1).padStart(2,"0"),H=String(o.getDate()).padStart(2,"0"),U=String(o.getHours()).padStart(2,"0"),q=String(o.getMinutes()).padStart(2,"0");return`${d}-${D}-${H} ${U}:${q}`}function Fa({leadId:s}){const[o,d]=t.useState([]),[D,H]=t.useState(!1),[U,q]=t.useState(null),[Q,W]=t.useState(()=>({open:!1,x:0,y:0})),[se,ee]=t.useState(!1),[S,g]=t.useState(""),[M,Y]=t.useState(""),[v,c]=t.useState(null),[f,a]=t.useState({open:!1,text:""});async function C(){if(!s){d([]);return}H(!0),q(null);try{const L=new URL("/api/v1/sales-activities",window.location.origin);L.searchParams.set("mineOnly","false"),L.searchParams.set("sfLeadId",String(s));const X=await fetch(L.toString());if(!X.ok)throw new Error(`HTTP ${X.status}`);const ue=await X.json(),de=Array.isArray(ue)?ue.map(r=>({id:Number(r==null?void 0:r.id),subject:(r==null?void 0:r.subject)??"",description:(r==null?void 0:r.description)??"",activityType:(r==null?void 0:r.activityType)??"",activityStatus:(r==null?void 0:r.activityStatus)??"",channel:(r==null?void 0:r.channel)??"",plannedStartAt:(r==null?void 0:r.plannedStartAt)??null,plannedEndAt:(r==null?void 0:r.plannedEndAt)??null,createdAt:(r==null?void 0:r.createdAt)??null,lastUpdateAt:(r==null?void 0:r.lastUpdateAt)??null,ownerName:(r==null?void 0:r.ownerName)??(r==null?void 0:r.owner_name)??""})):[];d(de)}catch(L){q((L==null?void 0:L.message)||"조회 중 오류가 발생했습니다"),d([])}finally{H(!1)}}t.useEffect(()=>{C()},[s]),t.useEffect(()=>{const L=()=>{C()};return window.addEventListener("tnt.sales.activity.updated",L),()=>window.removeEventListener("tnt.sales.activity.updated",L)},[s]),t.useEffect(()=>{if(!se)return;const L=X=>{X.key==="Escape"&&ee(!1)};return window.addEventListener("keydown",L,!0),()=>window.removeEventListener("keydown",L,!0)},[se]),t.useEffect(()=>{se||(w.current=null)},[se]),t.useEffect(()=>{if(!Q.open)return;const L=()=>W({open:!1,x:0,y:0}),X=ue=>{ue.key==="Escape"&&W({open:!1,x:0,y:0})};return window.addEventListener("click",L,!1),window.addEventListener("keydown",X,!0),()=>{window.removeEventListener("click",L,!1),window.removeEventListener("keydown",X,!0)}},[Q.open]);const w=t.useRef(null);function b(L){c(L.id),w.current!==L.id&&(g(L.subject||""),Y(L.description||""),w.current=L.id),ee(!0)}const p=t.useMemo(()=>e.jsxs("div",{className:"table-container",style:{maxHeight:"50vh",overflow:"auto"},children:[o.length===0?e.jsx("div",{className:"empty-state",children:D?"불러오는 중…":U||"활동이 없습니다."}):e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:120},children:"담당자"}),e.jsx("th",{style:{width:260},children:"제목"}),e.jsx("th",{children:"활동내역"}),e.jsx("th",{style:{width:150},children:"계획일시"}),e.jsx("th",{style:{width:150},children:"종료 일시"}),e.jsx("th",{style:{width:120},children:"활동유형"}),e.jsx("th",{style:{width:120},children:"활동상태"}),e.jsx("th",{style:{width:180},children:"최종 수정일"})]})}),e.jsx("tbody",{children:o.map(L=>e.jsxs("tr",{onContextMenu:X=>{X.preventDefault(),X.stopPropagation(),W({open:!0,x:X.clientX,y:X.clientY,row:L})},children:[e.jsx("td",{title:L.ownerName||"",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:L.ownerName||""}),e.jsx("td",{title:L.subject||"",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:L.subject||""}),e.jsx("td",{title:L.description||"",style:{maxWidth:600,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:L.description||""}),e.jsx("td",{children:Ks(L.plannedStartAt)}),e.jsx("td",{children:Ks(L.plannedEndAt)}),e.jsx("td",{children:L.activityType||""}),e.jsx("td",{children:L.activityStatus||""}),e.jsx("td",{children:Ks(L.lastUpdateAt)})]},L.id))})]}),Q.open&&Q.row&&e.jsx("div",{className:"context-menu",style:{left:Q.x+4,top:Q.y+4},onClick:L=>L.stopPropagation(),children:e.jsx("button",{className:"context-item",style:{width:96,padding:"4px 6px"},onClick:L=>{L.preventDefault(),L.stopPropagation(),b(Q.row),W({open:!1,x:0,y:0})},children:"수정"})})]}),[o,D,U,Q]);return e.jsxs("section",{children:[p,se&&e.jsxs("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,zIndex:2e4},children:[e.jsx("div",{style:{position:"absolute",inset:0,background:"rgba(0,0,0,.25)"}}),e.jsxs("div",{className:"card",style:{position:"absolute",left:"50%",top:"20%",transform:"translateX(-50%)",width:"min(720px, 92vw)",maxHeight:"80vh",overflow:"auto",padding:16},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:10},children:[e.jsx("h3",{style:{margin:0},children:"TM 활동 수정"}),e.jsx("span",{role:"button",tabIndex:0,className:"icon-button","aria-label":"닫기",title:"닫기",onClick:()=>ee(!1),children:e.jsx("img",{src:ct,className:"icon",alt:"닫기"})})]}),e.jsxs("div",{className:"field inline-field",children:[e.jsx("label",{children:"제목"}),e.jsx("input",{className:"search-input",type:"text",value:S,onChange:L=>g(L.target.value),placeholder:"제목"})]}),e.jsxs("div",{className:"field inline-field row-2",children:[e.jsx("label",{children:"활동 설명"}),e.jsx("textarea",{className:"search-input",value:M,onChange:L=>Y(L.target.value),placeholder:"활동 설명",style:{minHeight:100}})]}),e.jsxs("div",{className:"controls",style:{justifyContent:"flex-end",marginTop:10,gap:8},children:[e.jsx("button",{className:"btn",onClick:()=>ee(!1),children:"취소"}),e.jsx("button",{className:"btn",onClick:async()=>{try{if(!v)return;const L={subject:S||"",description:M||""},X=await fetch(`/api/v1/sales-activities/${v}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(L)});if(!X.ok)throw new Error(`HTTP ${X.status}`);ee(!1),a({open:!0,text:`${(S||"").trim()||"(제목없음)"} 변경되었습니다.`});try{window.dispatchEvent(new CustomEvent("tnt.sales.activity.updated",{detail:{id:v}}))}catch{}}catch{}},children:"저장"})]})]})]}),f.open?e.jsx("div",{role:"dialog","aria-modal":"true",className:"card",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.45)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:70},children:e.jsxs("div",{className:"card",style:{background:"var(--panel)",padding:12,border:"1px solid var(--border)",borderRadius:10,minWidth:260,maxWidth:"86vw"},children:[e.jsx("div",{style:{marginBottom:8,fontWeight:700,textAlign:"center"},children:f.text}),e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx("button",{className:"btn btn-card btn-3d",onClick:()=>a({open:!1,text:""}),children:"확인"})})]})}):null]})}function Ba(){const[s,o]=t.useState(null);return t.useEffect(()=>{try{localStorage.removeItem("tnt.sales.selectedLead")}catch{}const d=()=>{try{const D=localStorage.getItem("tnt.sales.selectedLead");o(D?JSON.parse(D):null)}catch{o(null)}};return window.addEventListener("tnt.sales.lead.selected",d),()=>window.removeEventListener("tnt.sales.lead.selected",d)},[]),e.jsxs("section",{children:[e.jsx(za,{}),e.jsxs("section",{className:"card",style:{marginTop:12,minHeight:240},children:[e.jsx("div",{className:"tabs c360-tabs",children:e.jsx("button",{className:"tab active",children:"활동"})}),e.jsx("div",{style:{marginTop:12},children:s!=null&&s.id?e.jsx(Fa,{leadId:s.id}):e.jsx("div",{style:{minHeight:160}})})]})]})}function Ha(s){if(!s)return"-";const o=new Date(s);if(Number.isNaN(o.getTime()))return"-";const d=W=>String(W).padStart(2,"0"),D=d(o.getFullYear()%100),H=d(o.getMonth()+1),U=d(o.getDate()),q=d(o.getHours()),Q=d(o.getMinutes());return`${D}-${H}-${U} ${q}:${Q}`}function Ua(){const[s,o]=t.useState("weekly"),[d,D]=t.useState("owner"),[H,U]=t.useState(""),[q,Q]=t.useState(()=>new Date().toISOString().split("T")[0]),[W,se]=t.useState([]),[ee,S]=t.useState([]),[g,M]=t.useState(null),[Y,v]=t.useState([]),[c,f]=t.useState(null),[a,C]=t.useState(!1),[w,b]=t.useState([]);t.useEffect(()=>{(async()=>{try{const r=await fetch("/api/v1/employees");if(!r.ok)return;const u=await r.json();if(Array.isArray(u)){let $=[...u];if(!$.some(m=>String((m==null?void 0:m.emp_name)||"")==="윤이랑"))try{const m=await fetch("/api/v1/employees?depts=all");if(m.ok){const P=await m.json();if(Array.isArray(P)){const te=P.find(K=>String((K==null?void 0:K.emp_name)||"")==="윤이랑");te&&($=[...$,te])}}}catch{}b($)}}catch{}})()},[]);function p(){const r=new Date(q);if(s==="daily"){const u=new Date(r);u.setDate(u.getDate()-1);const $=new Date(r);return $.setDate($.getDate()+1),[{label:"전일",startDate:u.toISOString().split("T")[0],endDate:u.toISOString().split("T")[0],count:0},{label:"금일",startDate:q,endDate:q,count:0},{label:"익일",startDate:$.toISOString().split("T")[0],endDate:$.toISOString().split("T")[0],count:0}]}else if(s==="weekly"){const u=new Date(r),$=u.getDay(),N=u.getDate()-$+($===0?-6:1),m=new Date(u.setDate(N)),P=m.toISOString().split("T")[0],te=new Date(m);te.setDate(te.getDate()+6);const K=new Date(m);K.setDate(K.getDate()-7);const j=new Date(K);j.setDate(j.getDate()+6);const ne=new Date(m);ne.setDate(ne.getDate()+7);const l=new Date(ne);return l.setDate(l.getDate()+6),[{label:"전주",startDate:K.toISOString().split("T")[0],endDate:j.toISOString().split("T")[0],count:0},{label:"금주",startDate:P,endDate:te.toISOString().split("T")[0],count:0},{label:"차주",startDate:ne.toISOString().split("T")[0],endDate:l.toISOString().split("T")[0],count:0}]}else{const u=new Date(r),$=new Date(u.getFullYear(),u.getMonth(),1),N=new Date(u.getFullYear(),u.getMonth()+1,0),m=new Date(u.getFullYear(),u.getMonth()-1,1),P=new Date(u.getFullYear(),u.getMonth(),0),te=new Date(u.getFullYear(),u.getMonth()+1,1),K=new Date(u.getFullYear(),u.getMonth()+2,0);return[{label:"전월",startDate:m.toISOString().split("T")[0],endDate:P.toISOString().split("T")[0],count:0},{label:"금월",startDate:$.toISOString().split("T")[0],endDate:N.toISOString().split("T")[0],count:0},{label:"익월",startDate:te.toISOString().split("T")[0],endDate:K.toISOString().split("T")[0],count:0}]}}async function L(){C(!0),M(null),v([]),f(null);const r=p();try{const u={period:s,filterType:d,baseDate:q};H&&(u.empId=H);const $=new URLSearchParams(u),[N,m]=await Promise.all([fetch(`/api/v1/lead-stats/registration?${$.toString()}`),fetch(`/api/v1/lead-stats/activity?${$.toString()}`)]);if(N.ok&&m.ok){const P=await N.json(),te=await m.json(),K=(j,ne)=>!Array.isArray(j)||j.length===0?ne:j.map(l=>({label:l.label,count:Number(l.count)||0,startDate:l.startDate||q,endDate:l.endDate||q}));se(K(P,r)),S(K(te,r))}else{if(console.error("Failed to fetch stats. Reg:",N.status,"Act:",m.status),!N.ok){const P=await N.text();console.error("Registration error:",P)}if(!m.ok){const P=await m.text();console.error("Activity error:",P)}se(r),S(r)}}catch(u){console.error("Failed to load stats",u),se(r),S(r)}finally{C(!1)}}async function X(r){try{const u=d==="owner"&&H?`AND CAST(l.assignee_id AS TEXT) = '${H}'`:"",$=d==="creator"&&H?`AND CAST(l.created_by AS TEXT) = '${H}'`:"",N={filterType:d,startDate:r.startDate,endDate:r.endDate};H&&(N.empId=H);const m=new URLSearchParams(N),P=await fetch(`/api/v1/lead-stats/registration/details?${m.toString()}`);if(P.ok){const te=await P.json();v(te),M(r),f(null)}}catch(u){console.error("Failed to load registration details",u)}}function ue(r){const u=new Date(q);let $;s==="daily"?$=r==="prev"?new Date(u.setDate(u.getDate()-1)):new Date(u.setDate(u.getDate()+1)):s==="weekly"?$=r==="prev"?new Date(u.setDate(u.getDate()-7)):new Date(u.setDate(u.getDate()+7)):$=r==="prev"?new Date(u.setMonth(u.getMonth()-1)):new Date(u.setMonth(u.getMonth()+1));const N=$.toISOString().split("T")[0];Q(N),setTimeout(()=>{de(N)},0)}async function de(r){C(!0),M(null),v([]),f(null);const $=(()=>{const N=new Date(r);if(s==="daily"){const m=new Date(N);m.setDate(m.getDate()-1);const P=new Date(N);return P.setDate(P.getDate()+1),[{label:"전일",startDate:m.toISOString().split("T")[0],endDate:m.toISOString().split("T")[0],count:0},{label:"금일",startDate:r,endDate:r,count:0},{label:"익일",startDate:P.toISOString().split("T")[0],endDate:P.toISOString().split("T")[0],count:0}]}else if(s==="weekly"){const m=new Date(N),P=m.getDay(),te=m.getDate()-P+(P===0?-6:1),K=new Date(m.setDate(te)),j=K.toISOString().split("T")[0],ne=new Date(K);ne.setDate(ne.getDate()+6);const l=new Date(K);l.setDate(l.getDate()-7);const i=new Date(l);i.setDate(i.getDate()+6);const x=new Date(K);x.setDate(x.getDate()+7);const h=new Date(x);return h.setDate(h.getDate()+6),[{label:"전주",startDate:l.toISOString().split("T")[0],endDate:i.toISOString().split("T")[0],count:0},{label:"금주",startDate:j,endDate:ne.toISOString().split("T")[0],count:0},{label:"차주",startDate:x.toISOString().split("T")[0],endDate:h.toISOString().split("T")[0],count:0}]}else{const m=new Date(N),P=new Date(m.getFullYear(),m.getMonth(),1),te=new Date(m.getFullYear(),m.getMonth()+1,0),K=new Date(m.getFullYear(),m.getMonth()-1,1),j=new Date(m.getFullYear(),m.getMonth(),0),ne=new Date(m.getFullYear(),m.getMonth()+1,1),l=new Date(m.getFullYear(),m.getMonth()+2,0);return[{label:"전월",startDate:K.toISOString().split("T")[0],endDate:j.toISOString().split("T")[0],count:0},{label:"금월",startDate:P.toISOString().split("T")[0],endDate:te.toISOString().split("T")[0],count:0},{label:"익월",startDate:ne.toISOString().split("T")[0],endDate:l.toISOString().split("T")[0],count:0}]}})();try{const N={period:s,filterType:d,baseDate:r};H&&(N.empId=H);const m=new URLSearchParams(N),[P,te]=await Promise.all([fetch(`/api/v1/lead-stats/registration?${m.toString()}`),fetch(`/api/v1/lead-stats/activity?${m.toString()}`)]);if(P.ok&&te.ok){const K=await P.json(),j=await te.json(),ne=(l,i)=>!Array.isArray(l)||l.length===0?i:l.map(x=>({label:x.label,count:Number(x.count)||0,startDate:x.startDate||r,endDate:x.endDate||r}));se(ne(K,$)),S(ne(j,$))}else se($),S($)}catch(N){console.error("Failed to load stats",N),se($),S($)}finally{C(!1)}}return e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[e.jsx("div",{style:{padding:"16px 20px",borderBottom:"1px solid var(--border)",background:"var(--panel)"},children:e.jsx("h2",{style:{margin:0,fontSize:18,fontWeight:700,color:"var(--text)"},children:"TM현황"})}),e.jsxs("div",{style:{padding:"12px 20px",borderBottom:"1px solid var(--border)",background:"var(--panel)",display:"flex",gap:12,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("label",{style:{fontSize:13,color:"var(--muted)",whiteSpace:"nowrap"},children:"조회기간:"}),e.jsxs("select",{value:s,onChange:r=>o(r.target.value),style:{height:32,padding:"0 8px",borderRadius:6,border:"1px solid var(--border)",background:"var(--panel)",color:"var(--text)",fontSize:13},children:[e.jsx("option",{value:"daily",children:"일별"}),e.jsx("option",{value:"weekly",children:"주간"}),e.jsx("option",{value:"monthly",children:"월간"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("label",{style:{fontSize:13,color:"var(--muted)",whiteSpace:"nowrap"},children:"구분:"}),e.jsxs("select",{value:d,onChange:r=>D(r.target.value),style:{height:32,padding:"0 8px",borderRadius:6,border:"1px solid var(--border)",background:"var(--panel)",color:"var(--text)",fontSize:13},children:[e.jsx("option",{value:"owner",children:"소유자"}),e.jsx("option",{value:"creator",children:"등록자"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsxs("label",{style:{fontSize:13,color:"var(--muted)",whiteSpace:"nowrap"},children:[d==="owner"?"소유자":"등록자",":"]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8,alignItems:"center"},children:[e.jsxs("select",{className:"search-input",value:H||"",onChange:r=>U(r.target.value||""),style:{height:32,padding:"0 8px",borderRadius:6,border:"1px solid var(--border)",background:"var(--panel)",color:"var(--text)",fontSize:13,minWidth:160},children:[e.jsx("option",{value:"",children:"전체"}),w.map(r=>e.jsxs("option",{value:r.assignee_id,children:[r.dept_name," · ",r.emp_name]},r.assignee_id))]}),e.jsx("div",{style:{whiteSpace:"nowrap",alignSelf:"center",fontSize:12,color:"var(--muted)"},children:(()=>{const r=w.find($=>$.assignee_id===H);return`현재선택 : ${r?r.emp_name:"전체"}`})()})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("label",{style:{fontSize:13,color:"var(--muted)",whiteSpace:"nowrap"},children:"기준일자:"}),e.jsx("input",{type:"date",value:q,onChange:r=>Q(r.target.value),style:{height:32,padding:"0 8px",borderRadius:6,border:"1px solid var(--border)",background:"var(--panel)",color:"var(--text)",fontSize:13}})]}),e.jsx("button",{onClick:L,disabled:a,className:"btn btn-card btn-3d",style:{height:32,fontSize:13,padding:"0 20px",fontWeight:600},children:a?"조회 중...":"조회"}),e.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:8},children:[e.jsx("button",{onClick:()=>ue("prev"),className:"btn btn-card",style:{height:32,width:32,padding:0,display:"flex",alignItems:"center",justifyContent:"center"},title:"이전",disabled:W.length===0&&ee.length===0,children:e.jsx("img",{src:jn,alt:"이전",style:{width:16,height:16}})}),e.jsx("button",{onClick:()=>ue("next"),className:"btn btn-card",style:{height:32,width:32,padding:0,display:"flex",alignItems:"center",justifyContent:"center"},title:"다음",disabled:W.length===0&&ee.length===0,children:e.jsx("img",{src:vn,alt:"다음",style:{width:16,height:16}})})]})]}),e.jsx("div",{style:{flex:1,minHeight:0,overflow:"auto",padding:20},children:a?e.jsx("div",{style:{textAlign:"center",padding:40,color:"var(--muted)"},children:"데이터를 불러오는 중..."}):e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:20,height:"100%"},children:[e.jsxs("div",{style:{flex:"0 0 auto",display:"flex",gap:20,flexWrap:"wrap"},children:[e.jsxs("div",{style:{flex:1,minWidth:0,display:"flex",flexDirection:"column",gap:12},children:[e.jsx("h3",{style:{margin:0,fontSize:15,fontWeight:600,color:"var(--text)"},children:"잠재고객 등록현황"}),W.length===0?e.jsxs("div",{style:{textAlign:"center",padding:40,background:"var(--panel)",border:"1px solid var(--border)",borderRadius:8},children:[e.jsx("div",{style:{fontSize:48,marginBottom:16,opacity:.3},children:"📊"}),e.jsx("div",{style:{fontSize:15,color:"var(--muted)",marginBottom:8},children:"조회 조건을 설정하고 조회 버튼을 클릭하세요"})]}):e.jsx(e.Fragment,{children:e.jsx("div",{style:{display:"flex",gap:12},children:W.map((r,u)=>e.jsxs("button",{onClick:()=>X(r),className:"btn btn-card btn-3d",style:{flex:1,minHeight:120,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",gap:8,background:(g==null?void 0:g.label)===r.label?"var(--primary)":"var(--panel)",color:(g==null?void 0:g.label)===r.label?"#fff":"var(--text)",border:(g==null?void 0:g.label)===r.label?"2px solid var(--primary)":"1px solid var(--border)"},children:[e.jsx("div",{style:{fontSize:14,fontWeight:600},children:r.label}),e.jsx("div",{style:{fontSize:28,fontWeight:700},children:r.count}),e.jsx("div",{style:{fontSize:11,opacity:.7},children:r.startDate===r.endDate?r.startDate:`${r.startDate} ~ ${r.endDate}`})]},u))})})]}),e.jsxs("div",{style:{flex:1,minWidth:0,display:"flex",flexDirection:"column",gap:12},children:[e.jsx("h3",{style:{margin:0,fontSize:15,fontWeight:600,color:"var(--text)"},children:"잠재고객 활동현황"}),ee.length===0?e.jsxs("div",{style:{textAlign:"center",padding:40,background:"var(--panel)",border:"1px solid var(--border)",borderRadius:8},children:[e.jsx("div",{style:{fontSize:48,marginBottom:16,opacity:.3},children:"📊"}),e.jsx("div",{style:{fontSize:15,color:"var(--muted)",marginBottom:8},children:"조회 조건을 설정하고 조회 버튼을 클릭하세요"})]}):e.jsx("div",{style:{display:"flex",gap:12},children:ee.map((r,u)=>e.jsxs("div",{className:"btn-card btn-3d",style:{flex:1,minHeight:120,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",gap:8,background:"var(--panel)",color:"var(--text)",border:"1px solid var(--border)",cursor:"default",opacity:.8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:600},children:r.label}),e.jsx("div",{style:{fontSize:28,fontWeight:700},children:r.count}),e.jsx("div",{style:{fontSize:11,opacity:.7},children:r.startDate===r.endDate?r.startDate:`${r.startDate} ~ ${r.endDate}`})]},u))})]})]}),g&&Y.length>0&&e.jsxs("div",{style:{flex:1,minHeight:0,display:"flex",gap:12},children:[e.jsxs("div",{style:{flex:1,minWidth:0,overflow:"auto",background:"var(--panel)",border:"1px solid var(--border)",borderRadius:8,padding:12},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[e.jsxs("h4",{style:{margin:0,fontSize:14,fontWeight:600,color:"var(--text)"},children:[g.label," 등록 목록 (",Y.length,"건)"]}),e.jsx("span",{style:{fontSize:12,color:"#e11d48",fontWeight:600},children:"잠재고객 클릭시 활동 조회"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:Y.map(r=>e.jsxs("button",{onClick:()=>f(r.id),style:{padding:10,background:c===r.id?"var(--primary-light)":"var(--background)",border:c===r.id?"2px solid var(--primary)":"1px solid var(--border)",borderRadius:6,fontSize:13,textAlign:"left",cursor:"pointer",transition:"all 0.2s"},children:[e.jsxs("div",{style:{fontWeight:600,color:c===r.id?"var(--primary)":"var(--text)",marginBottom:4},children:[r.company_name||"-",r.activities&&r.activities.length>0&&e.jsxs("span",{style:{marginLeft:8,fontSize:11,color:"var(--muted)"},children:["(활동 ",r.activities.length,"건)"]})]}),e.jsxs("div",{style:{color:"var(--muted)",fontSize:12},children:["담당자: ",r.contact_name||"-"]}),e.jsxs("div",{style:{color:"var(--muted)",fontSize:12,marginTop:4},children:["상태: ",r.lead_status||"-"," | 업종: ",r.biz_type||"-"]}),e.jsxs("div",{style:{color:"var(--muted)",fontSize:12,marginTop:4},children:["지역: ",r.addr_province_name||"-"]}),e.jsxs("div",{style:{color:"var(--muted)",fontSize:12,marginTop:4},children:["최종수정: ",Ha(r.updated_at)]})]},r.id))})]}),c&&(()=>{var u;const r=Y.find($=>$.id===c);return r?e.jsxs("div",{style:{flex:1,minWidth:0,overflow:"auto",background:"var(--panel)",border:"1px solid var(--border)",borderRadius:8,padding:12},children:[e.jsxs("h4",{style:{margin:"0 0 12px",fontSize:14,fontWeight:600,color:"var(--text)"},children:[r.company_name||"-"," 활동 목록 (",((u=r.activities)==null?void 0:u.length)||0,"건)"]}),!r.activities||r.activities.length===0?e.jsx("div",{style:{textAlign:"center",padding:20,color:"var(--muted)",fontSize:13},children:"활동 데이터가 없습니다"}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:r.activities.map($=>e.jsxs("div",{style:{padding:10,background:"var(--background)",border:"1px solid var(--border)",borderRadius:6,fontSize:13},children:[e.jsx("div",{style:{fontWeight:600,color:"var(--text)",marginBottom:4},children:$.subject||"-"}),e.jsxs("div",{style:{color:"var(--muted)",fontSize:12},children:["유형: ",$.activity_type||"-"," | 상태: ",$.activity_status||"-"]}),e.jsxs("div",{style:{color:"var(--muted)",fontSize:12,marginTop:4},children:["계획: ",$.planned_start_at?new Date($.planned_start_at).toLocaleString("ko-KR"):"-"]}),$.actual_start_at&&e.jsxs("div",{style:{color:"var(--muted)",fontSize:12,marginTop:4},children:["실제: ",new Date($.actual_start_at).toLocaleString("ko-KR")]}),$.description&&e.jsx("div",{style:{color:"var(--muted)",fontSize:12,marginTop:4},children:$.description}),e.jsxs("div",{style:{color:"var(--muted)",fontSize:12,marginTop:4},children:["수정: ",$.updated_at?new Date($.updated_at).toLocaleString("ko-KR"):"-"]})]},$.id))})]}):null})()]})]})})]})}const gn="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%20fill='none'%20stroke='currentColor'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'%3e%3cline%20x1='12'%20y1='5'%20x2='12'%20y2='19'/%3e%3cline%20x1='5'%20y1='12'%20x2='19'%20y2='12'/%3e%3c/svg%3e";function Ya(){const[s,o]=t.useState(""),[d,D]=t.useState(""),[H,U]=t.useState([]),[q,Q]=t.useState(!1),[W,se]=t.useState(null),[ee,S]=t.useState(null),[g,M]=t.useState([]),[Y,v]=t.useState(!1),[c,f]=t.useState(!1),[a,C]=t.useState({open:!1,x:0,y:0}),w=t.useRef(null);async function b(h){try{v(!0);const O=ee!=null?H[ee]:null,E=new URLSearchParams;E.set("q",d.trim()||s.trim());const pe=h??(O==null?void 0:O.customerSeq);pe!=null&&E.set("customerSeq",String(pe));const re=await fetch(`/api/v1/items/search?${E.toString()}`),G=re.ok?await re.json():[],xe=Array.isArray(G)?G.map(_=>({itemSeq:_==null?void 0:_.itemSeq,itemName:String((_==null?void 0:_.itemName)??""),recentInvoiceDate:(_==null?void 0:_.recentInvoiceDate)??(_==null?void 0:_.recent_invoice_date)??null,curAmt:(_==null?void 0:_.curAmt)??null,qty:(_==null?void 0:_.qty)??null,srcPri:(_==null?void 0:_.srcPri)!=null?Number(_.srcPri):void 0,itemStdUnit:(_==null?void 0:_.itemStdUnit)??(_==null?void 0:_.item_std_unit)??null,companyType:(_==null?void 0:_.companyType)||(_==null?void 0:_.company_type)||null})):[];M(xe)}catch{M([])}finally{v(!1)}}const[p,L]=t.useState(()=>({open:!1,text:""})),[X,ue]=t.useState([]);async function de(h){if(!(h==null||h.itemName==null)){f(!0);try{let O,E=typeof h.itemStdUnit=="string"?h.itemStdUnit:void 0,pe,re;const G=await fetch(`/api/v1/items/spec?itemName=${encodeURIComponent(String(h.itemName))}`);if(G.ok){const fe=await G.json().catch(()=>({}));fe&&fe.itemSpec&&(O=String(fe.itemSpec)),!E&&fe&&fe.itemStdUnit&&(pe=String(fe.itemStdUnit),E=pe),fe&&fe.companyType&&(re=String(fe.companyType))}const xe=localStorage.getItem("tnt.sales.ordersheet.cart"),_=xe?JSON.parse(xe):[];if((Array.isArray(_)?_.findIndex(fe=>String(fe.itemName)===String(h.itemName)):-1)>=0){alert("이미 주문에 포함되어 있습니다."),f(!1);return}else{const fe=re||h.companyType||null,Se={itemSeq:h.itemSeq,itemName:h.itemName,itemSpec:O||"",qty:"",itemStdUnit:E||void 0,companyType:fe};_.push(Se)}localStorage.setItem("tnt.sales.ordersheet.cart",JSON.stringify(_)),window.dispatchEvent(new CustomEvent("tnt.sales.ordersheet.cart.changed",{detail:{cart:_}}))}catch{}finally{f(!1)}}}function r(h){try{const E=[JSON.parse(h)];let pe=null;for(;E.length;){const re=E.shift();if(Array.isArray(re)){if(re.length&&typeof re[0]=="object"){pe=re;break}}else if(re&&typeof re=="object")for(const G of Object.keys(re))E.push(re[G])}return pe?pe.map(re=>{const G=(re==null?void 0:re.WHName)??(re==null?void 0:re.whName)??(re==null?void 0:re.warehouseName)??(re==null?void 0:re.WH_NM)??(re==null?void 0:re.wh_nm)??"",xe=Number((re==null?void 0:re.AvailStock)??(re==null?void 0:re.availStock)??(re==null?void 0:re.AVAIL_STOCK)??(re==null?void 0:re.qty)??0)||0,_=(re==null?void 0:re.UnitName)??(re==null?void 0:re.unitName)??(re==null?void 0:re.UNIT_NAME)??(re==null?void 0:re.salesMgmtUnit)??"";return{whName:String(G||""),avail:xe,unitName:String(_||"")}}):[]}catch{return[]}}async function u(h,O){const pe=h.currentTarget.getBoundingClientRect(),re=pe.right,G=pe.bottom;C({open:!0,x:re,y:G,loading:!0});try{const xe={bizUnit:"",stdDate:"",whSeq:"",itemName:String(O.itemName||""),itemNo:"",itemSeq:String(O.itemSeq||""),pageNo:"",pageSize:""},_=await fetch("/api/v1/items/avail-stock",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(xe)});if(_.ok){const me=await _.json().catch(()=>({})),fe=me&&(me.receivedPayload||me),Se=JSON.stringify(fe,null,2),Ce=r(Se);C({open:!0,x:re,y:G,loading:!1,error:null,rows:Ce})}else C({open:!0,x:re,y:G,loading:!1,error:`HTTP ${_.status}`})}catch(xe){C({open:!0,x:re,y:G,loading:!1,error:(xe==null?void 0:xe.message)||"재고 조회 실패"})}}t.useEffect(()=>{if(!a.open)return;const h=E=>{const pe=w.current;pe&&E.target instanceof Node&&!pe.contains(E.target)&&C({open:!1,x:0,y:0})},O=E=>{E.key==="Escape"&&C({open:!1,x:0,y:0})};return document.addEventListener("mousedown",h,!0),window.addEventListener("keydown",O,!0),()=>{document.removeEventListener("mousedown",h,!0),window.removeEventListener("keydown",O,!0)}},[a.open]);async function $(){var h;Q(!0),se(null);try{const O=new URLSearchParams;s.trim()&&O.set("name",s.trim()),O.set("mineOnly","false");const E=await fetch(`/api/v1/customers?${O.toString()}`);if(!E.ok)throw new Error(`HTTP ${E.status}`);const pe=await E.json(),re=Array.isArray(pe)?pe.map(G=>({customerId:(G==null?void 0:G.customerId)??"",customerName:(G==null?void 0:G.customerName)??"",bizNo:(G==null?void 0:G.bizNo)??"",ownerName:(G==null?void 0:G.ownerName)??(G==null?void 0:G.empName)??"",telNo:(G==null?void 0:G.telNo)??"",customerSeq:(G==null?void 0:G.customerSeq)!=null?Number(G.customerSeq):void 0,addrProvinceName:(G==null?void 0:G.addrProvinceName)??(G==null?void 0:G.addr_province_name)??"",addrCityName:(G==null?void 0:G.addrCityName)??(G==null?void 0:G.addr_city_name)??"",companyType:String((G==null?void 0:G.company_type)??(G==null?void 0:G.companyType)??(G==null?void 0:G.company)??"").toUpperCase(),companyCode:String((G==null?void 0:G.companyCode)??(G==null?void 0:G.company_code)??(G==null?void 0:G.company_type)??(G==null?void 0:G.companyType)??(G==null?void 0:G.company)??"").toUpperCase()})):[];if(re.sort((G,xe)=>String(G.customerName||"").localeCompare(String(xe.customerName||""),"ko-KR")),U(re),re.length>0){S(0);try{localStorage.setItem("tnt.sales.ordersheet.selectedCustomer",JSON.stringify(re[0])),window.dispatchEvent(new CustomEvent("tnt.sales.ordersheet.customer.selected",{detail:{customer:re[0]}}))}catch{}await b((h=re[0])==null?void 0:h.customerSeq)}else S(null),M([])}catch(O){se((O==null?void 0:O.message)||"조회 중 오류가 발생했습니다"),U([])}finally{Q(!1)}}t.useEffect(()=>{try{localStorage.removeItem("tnt.sales.ordersheet.selectedCustomer"),localStorage.removeItem("tnt.sales.ordersheet.cart"),localStorage.removeItem("tnt.sales.ordersheet.regionGroup"),localStorage.removeItem("tnt.sales.ordersheet.requests"),localStorage.removeItem("tnt.sales.ordersheet.deliveryDueDate")}catch{}},[]);function N(h,O){S(O);try{localStorage.setItem("tnt.sales.ordersheet.selectedCustomer",JSON.stringify(h)),window.dispatchEvent(new CustomEvent("tnt.sales.ordersheet.customer.selected",{detail:{customer:h}}))}catch{}b(h.customerSeq),m(h.customerSeq)}async function m(h){try{ue([]);const O=h!=null?Number(h):NaN;if(!Number.isFinite(O))return;const E=await fetch(`/api/v1/customers/${O}/transactions`,{cache:"no-store"});if(!E.ok)return;const pe=await E.json().catch(()=>[]);if(!Array.isArray(pe)){ue([]);return}const re=Date.now()-365*24*60*60*1e3,G={};for(const _ of pe){const me=String((_==null?void 0:_.itemName)??(_==null?void 0:_.item_name)??"").trim();if(!me)continue;const fe=(_==null?void 0:_.itemSeq)??(_==null?void 0:_.item_seq)??null,Se=(_==null?void 0:_.companyType)??(_==null?void 0:_.company_type)??null,Ce=Number((_==null?void 0:_.curAmt)??(_==null?void 0:_.cur_amt)??0)||0,I=Number((_==null?void 0:_.qty)??0)||0,je=String((_==null?void 0:_.invoiceDate)??(_==null?void 0:_.invoice_date)??""),V=Date.parse(je)||Date.parse(je.replace(" ","T"))||NaN;if(!Number.isFinite(V)||V<re)continue;const _e=fe!=null?String(fe):me,qe=G[_e]||{itemSeq:fe,itemName:me,companyType:Se||null,recent:0,totalAmt:0,totalQty:0};qe.totalAmt+=Ce,qe.totalQty+=I,V>qe.recent&&(qe.recent=V),qe.itemSeq==null&&fe!=null&&(qe.itemSeq=fe),!qe.companyType&&Se&&(qe.companyType=Se),G[_e]=qe}const xe=Object.values(G).sort((_,me)=>me.recent-_.recent||_.itemName.localeCompare(me.itemName,"ko",{sensitivity:"base"})).map(_=>({itemSeq:_.itemSeq,itemName:_.itemName,companyType:_.companyType,recentDate:new Date(_.recent).toISOString().slice(0,10),totalAmt:_.totalAmt,totalQty:_.totalQty}));ue(xe)}catch{ue([])}}const P=t.useMemo(()=>e.jsx("div",{className:"table-container",style:{maxHeight:"40vh"},children:H.length===0?e.jsx("div",{className:"empty-state",children:q?"불러오는 중…":W||"데이터가 없습니다"}):e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:160},children:"회사코드"}),e.jsx("th",{children:"거래처명"}),e.jsx("th",{style:{width:160},children:"대표자"}),e.jsx("th",{style:{width:180},children:"사업자번호"}),e.jsx("th",{style:{width:160},children:"대표번호"})]})}),e.jsx("tbody",{children:H.map((h,O)=>e.jsxs("tr",{className:ee===O?"selected":void 0,onClick:()=>N(h,O),children:[e.jsx("td",{children:h.companyCode||h.companyType||""}),e.jsx("td",{children:h.customerName}),e.jsx("td",{children:h.ownerName}),e.jsx("td",{children:h.bizNo}),e.jsx("td",{children:h.telNo})]},O))})]})}),[H,q,W,ee]),te=t.useMemo(()=>X.length===0?null:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"muted",style:{fontSize:12,marginTop:8,marginBottom:4},children:"최근거래내역"}),e.jsx("div",{className:"table-container",style:{maxHeight:"24vh"},children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"품목"}),e.jsx("th",{style:{width:120},children:"최근거래일"}),e.jsx("th",{style:{width:140,textAlign:"right"},children:"총금액"}),e.jsx("th",{style:{width:100,textAlign:"right"},children:"총수량"}),e.jsx("th",{style:{width:80}})]})}),e.jsx("tbody",{children:X.map((h,O)=>e.jsxs("tr",{children:[e.jsx("td",{children:h.itemName}),e.jsx("td",{children:h.recentDate}),e.jsx("td",{style:{textAlign:"right"},children:Number(h.totalAmt||0).toLocaleString()}),e.jsx("td",{style:{textAlign:"right"},children:Number(h.totalQty||0).toLocaleString()}),e.jsxs("td",{children:[e.jsx("span",{role:"button",tabIndex:0,className:"icon-button","aria-label":"재고 조회",title:"재고 조회",onClick:E=>ne(E,h.itemName),onKeyDown:E=>{(E.key==="Enter"||E.key===" ")&&(E.preventDefault(),ne(E,h.itemName))},children:e.jsx("img",{src:rn,className:"icon",alt:"재고"})}),e.jsx("span",{role:"button",tabIndex:0,className:"icon-button","aria-label":"담기",title:"담기",onClick:()=>l(h),onKeyDown:E=>{(E.key==="Enter"||E.key===" ")&&(E.preventDefault(),l(h))},children:e.jsx("img",{src:gn,className:"icon",alt:"담기"})})]})]},O))})]})})]}),[X]);function K(){try{const h=localStorage.getItem("tnt.sales.ordersheet.selectedCustomer");if(!h)return null;const O=JSON.parse(h),E=Number(O==null?void 0:O.customerSeq);return Number.isFinite(E)?E:null}catch{return null}}async function j(h){const O=g.find(E=>String(E.itemName).trim()===String(h).trim());if(O&&O.itemSeq!=null)return{itemSeq:O.itemSeq,itemName:O.itemName};try{const E=new URLSearchParams;E.set("q",h);const pe=K();pe!=null&&E.set("customerSeq",String(pe));const re=await fetch(`/api/v1/items/search?${E.toString()}`),G=re.ok?await re.json():[],xe=Array.isArray(G)?G:[],_=xe.find(me=>String((me==null?void 0:me.itemName)||"").trim()===String(h).trim())||xe[0];if(_&&_.itemSeq!=null)return{itemSeq:_.itemSeq,itemName:String(_.itemName||h)}}catch{}return null}async function ne(h,O){const E=await j(O);E&&await u(h,E)}async function l(h){let O=h;if(!O.itemSeq){const E=await j(h.itemName);if(!E)return;O={...O,...E}}await de({itemSeq:O.itemSeq,itemName:O.itemName,companyType:O.companyType||void 0})}const i=new Intl.NumberFormat("ko-KR"),x=t.useMemo(()=>e.jsx("div",{className:"table-container",style:{maxHeight:"32vh",marginTop:12},children:g.length===0?e.jsx("div",{className:"empty-state",children:Y?"품목 불러오는 중…":"품목 데이터가 없습니다"}):e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"품목명"}),e.jsx("th",{style:{width:140},children:"최근거래일시"}),e.jsx("th",{style:{width:120,textAlign:"right"},children:"총금액"}),e.jsx("th",{style:{width:100,textAlign:"right"},children:"총수량"}),e.jsx("th",{style:{width:90}})]})}),e.jsx("tbody",{children:g.map((h,O)=>e.jsxs("tr",{className:h.srcPri===0?"inv-row":void 0,onDoubleClick:()=>de(h),title:"더블클릭하면 우측 수주장에 담습니다",children:[e.jsxs("td",{style:{display:"flex",alignItems:"center",gap:6},children:[(()=>{const pe=(h.companyType||h.company_type||h.companyCode||h.company_code||"").toString().toUpperCase(),re=pe==="TNT"?"T":pe==="DYS"?"D":pe==="ALL"?"A":"",G=pe==="TNT"?"#2563eb":pe==="DYS"?"#10b981":pe==="ALL"?"#f59e0b":"#9ca3af";return re?e.jsx("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:18,height:18,borderRadius:"50%",background:G,color:"#fff",fontSize:11,fontWeight:800,boxShadow:"0 0 0 1px rgba(0,0,0,.08)"},children:re}):null})(),e.jsx("span",{children:h.itemName}),h.itemStdUnit?e.jsxs("span",{style:{fontSize:11,color:"var(--text-muted)"},children:["(",h.itemStdUnit,")"]}):null]}),e.jsx("td",{children:h.recentInvoiceDate||""}),e.jsx("td",{style:{textAlign:"right"},children:h.curAmt!=null&&h.curAmt!==""?i.format(Number(h.curAmt)):""}),e.jsx("td",{style:{textAlign:"right"},children:h.qty!=null&&h.qty!==""?i.format(Number(h.qty)):""}),e.jsxs("td",{children:[e.jsx("span",{role:"button",tabIndex:0,className:"icon-button","aria-label":"재고 조회",title:"재고 조회",onClick:E=>u(E,h),onKeyDown:E=>{(E.key==="Enter"||E.key===" ")&&(E.preventDefault(),u({currentTarget:E.currentTarget},h))},children:e.jsx("img",{src:rn,className:"icon",alt:"재고"})}),e.jsx("span",{role:"button",tabIndex:0,className:"icon-button","aria-label":"담기",title:"담기",onClick:()=>de(h),onKeyDown:E=>{(E.key==="Enter"||E.key===" ")&&(E.preventDefault(),de(h))},children:e.jsx("img",{src:gn,className:"icon",alt:"담기"})})]})]},O))})]})}),[g,Y]);return e.jsxs("section",{children:[e.jsxs("div",{className:"page-title",children:[e.jsx("h2",{children:"수주장"}),e.jsxs("div",{className:"controls",style:{gap:8},children:[e.jsx("input",{className:"search-input",type:"text",placeholder:"거래처명",value:s,onChange:h=>o(h.target.value),onKeyDown:h=>{h.key==="Enter"&&$()},style:{width:240}}),e.jsx("button",{className:"btn",onClick:$,disabled:q,children:"조회"})]})]}),P,te,e.jsxs("div",{className:"controls",style:{gap:8,marginTop:10},children:[e.jsx("input",{className:"search-input",type:"text",placeholder:"품목명",value:d,onChange:h=>D(h.target.value),onKeyDown:h=>{h.key==="Enter"&&b()},style:{width:240}}),e.jsx("button",{className:"btn",onClick:()=>b(),disabled:Y,children:"품목 조회"})]}),x,a.open&&e.jsx("div",{ref:w,className:"context-menu",style:{left:a.x+6,top:a.y+6,position:"fixed",maxWidth:420,padding:8},onClick:h=>h.stopPropagation(),children:a.loading?e.jsx("div",{className:"muted",children:"재고 불러오는 중…"}):a.error?e.jsx("div",{className:"error",children:a.error}):!a.rows||a.rows.length===0?e.jsx("div",{className:"empty-state",children:"재고 데이터가 없습니다"}):e.jsx("div",{className:"table-container",style:{maxHeight:200,overflow:"auto",border:0},children:e.jsxs("table",{className:"table",style:{width:"100%",fontSize:12},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"창고명"}),e.jsx("th",{style:{width:100,textAlign:"right"},children:"가용재고"}),e.jsx("th",{style:{width:120},children:"단위"})]})}),e.jsx("tbody",{children:(a.rows||[]).map((h,O)=>e.jsxs("tr",{children:[e.jsx("td",{children:h.whName||"-"}),e.jsx("td",{style:{textAlign:"right"},children:Number(h.avail||0).toLocaleString()}),e.jsx("td",{children:h.unitName||""})]},O))})]})})})]})}function Ka(){const s=[];for(let o=2030;o>=2026;o--)s.push(o);return s}function Ja(){const[s,o]=t.useState(2026),[d,D]=t.useState(()=>{try{return localStorage.getItem("tnt.sales.assign.mode")==="Moderate"?"Moderate":"Best"}catch{return"Best"}}),[H,U]=t.useState([{company:"TNT",group:"TNT",name:"복층유리",amount:0,stage:""},{company:"TNT",group:"TNT",name:"건자재",amount:0,stage:""},{company:"DYS",group:"DYS",name:"실란트",amount:0,stage:""}]),[q,Q]=t.useState(!1),[W,se]=t.useState(null),[ee,S]=t.useState(null),g=new Intl.NumberFormat("ko-KR");async function M(){Q(!0),se(null);try{const w=new URL("/api/v1/targets/year",window.location.origin);w.searchParams.set("year",String(s)),w.searchParams.set("versionNo",d==="Moderate"?"2":"1");const b=await fetch(w.toString()),p=b.ok?await b.json():[],L=new Map;if(Array.isArray(p))for(const X of p){const ue=String((X==null?void 0:X.company_name)||"").toUpperCase()==="DYS"?"DYS":"TNT",de=String((X==null?void 0:X.biz_area_name)||""),r=Number((X==null?void 0:X.version_no)??0),u=Number((X==null?void 0:X.target_amount_max)??(X==null?void 0:X.target_amount_min)??0),$=String((X==null?void 0:X.target_stage)??""),N=`${ue}||${de}`,m=L.get(N);(!m||r>m.ver)&&L.set(N,{ver:r,amt:Number.isFinite(u)?u:0,stage:$,company:ue,name:de})}L.size===0?(U(X=>X.map(ue=>({...ue,amount:0,stage:""}))),S("영업목표가 수립되지 않았습니다.")):(U(X=>X.map(ue=>{const de=`${ue.company}||${ue.name}`,r=L.get(de);return r?{...ue,amount:r.amt,stage:r.stage}:ue})),S(null))}catch(w){se((w==null?void 0:w.message)||"조회 오류")}finally{Q(!1)}}t.useEffect(()=>{M()},[s,d]),t.useEffect(()=>{try{localStorage.setItem("tnt.sales.assign.mode",d)}catch{}try{window.dispatchEvent(new CustomEvent("tnt.sales.assign.mode.changed",{detail:{mode:d}}))}catch{}},[d]),t.useEffect(()=>{try{localStorage.setItem("tnt.sales.assign.year",String(s)),window.dispatchEvent(new CustomEvent("tnt.sales.assign.year.changed"))}catch{}},[s]);const Y=t.useMemo(()=>H.filter(w=>w.company==="TNT").reduce((w,b)=>w+(Number(b.amount)||0),0),[H]),v=t.useMemo(()=>H.filter(w=>w.company==="DYS").reduce((w,b)=>w+(Number(b.amount)||0),0),[H]);t.useEffect(()=>{try{const w={tnt:Number(Y)||0,dys:Number(v)||0,year:s};localStorage.setItem("tnt.sales.assign.companyTotals",JSON.stringify(w)),window.dispatchEvent(new CustomEvent("tnt.sales.assign.companyTotals.changed"))}catch{}},[Y,v,s]);function c(w,b){const p=Number((b||"").replace(/[\s,]/g,""));U(L=>L.map((X,ue)=>ue===w?{...X,amount:Number.isFinite(p)?p:0}:X))}async function f(w=!1){try{const b=H.map(ue=>({targetYear:`${s}-01-01`,versionNo:1,companyName:ue.company,bizAreaGroup:ue.group,bizAreaName:ue.name,targetAmountMin:ue.amount,targetAmountMax:ue.amount,targetStage:w?"확정":"기안중"})),p=localStorage.getItem("tnt.sales.empSeq")||"",L={"Content-Type":"application/json"};p&&(L["X-EMP-SEQ"]=String(p));const X=await fetch("/api/v1/targets/year/upsert",{method:"POST",headers:L,body:JSON.stringify(b)});if(!X.ok)throw new Error(`HTTP ${X.status}`);w&&await fetch(`/api/v1/targets/year/confirm?year=${s}`,{method:"POST",headers:L}),await M(),alert(w?"확정되었습니다.":"저장되었습니다.")}catch(b){alert((b==null?void 0:b.message)||"저장 중 오류")}}const a=t.useMemo(()=>{const w=H.filter(b=>b.company==="TNT").map(b=>(b.stage||"").trim());return w.includes("확정")?"확정":w.includes("기안중")?"기안중":""},[H]),C=t.useMemo(()=>{const w=H.filter(b=>b.company==="DYS").map(b=>(b.stage||"").trim());return w.includes("확정")?"확정":w.includes("기안중")?"기안중":""},[H]);return e.jsxs("section",{className:"card",style:{padding:12},children:[e.jsxs("div",{className:"page-title",style:{marginBottom:12},children:[e.jsx("h2",{style:{margin:0},children:"회사별 목표 입력"}),e.jsxs("div",{className:"controls",style:{gap:8},children:[e.jsxs("div",{role:"radiogroup","aria-label":"목표 산정 모드",className:"segmented",children:[e.jsxs("label",{className:`seg ${d==="Best"?"selected":""}`,children:[e.jsx("input",{type:"radio",name:"assign-mode",checked:d==="Best",onChange:()=>D("Best")}),e.jsx("span",{children:"Best"})]}),e.jsxs("label",{className:`seg ${d==="Moderate"?"selected":""}`,children:[e.jsx("input",{type:"radio",name:"assign-mode",checked:d==="Moderate",onChange:()=>D("Moderate")}),e.jsx("span",{children:"Moderate"})]})]}),e.jsx("select",{className:"search-input",value:s,onChange:w=>o(Number(w.target.value)),children:Ka().map(w=>e.jsxs("option",{value:w,children:[w,"년"]},w))}),e.jsx("button",{className:"btn btn-3d btn-card",onClick:()=>f(!1),children:"저장"}),e.jsx("button",{className:"btn btn-3d btn-card",onClick:()=>f(!0),children:"확정"})]})]}),W&&e.jsx("div",{className:"error",children:W}),ee&&!W&&e.jsx("div",{className:"empty-state",style:{marginBottom:12},children:ee}),e.jsxs("div",{style:{display:"flex",gap:12,flexWrap:"nowrap",width:"100%"},children:[e.jsxs("div",{className:"card",style:{padding:12,flex:"1 1 0",minWidth:0},children:[e.jsxs("div",{style:{fontWeight:700,marginBottom:8,display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{children:"TNT"}),a?e.jsx("span",{className:"badge",children:a}):null,q&&e.jsx("span",{className:"muted",style:{marginLeft:"auto",fontSize:12},children:"불러오는 중…"})]}),H.filter(w=>w.company==="TNT").map(w=>{const b=H.findIndex(p=>p.company===w.company&&p.name===w.name);return e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"180px 1fr 42px",alignItems:"center",gap:8,marginBottom:8},children:[e.jsx("div",{children:e.jsx("span",{className:"muted",children:w.name})}),e.jsx("input",{className:"assign-input",style:{textAlign:"right"},value:w.amount?g.format(w.amount):"",onChange:p=>c(b,p.target.value),placeholder:"0",disabled:d==="Moderate",title:d==="Moderate"?"Moderate 모드에서는 회사별 목표 수정이 비활성화됩니다":"값을 입력하세요"}),e.jsx("div",{className:"muted",style:{textAlign:"left"},children:"억원"})]},`TNT-${w.name}`)}),e.jsxs("div",{style:{textAlign:"right",fontWeight:700},children:["합계: ",g.format(Y)," 억원"]})]}),e.jsxs("div",{className:"card",style:{padding:12,flex:"1 1 0",minWidth:0},children:[e.jsxs("div",{style:{fontWeight:700,marginBottom:8,display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{children:"DYS"}),C?e.jsx("span",{className:"badge",children:C}):null,q&&e.jsx("span",{className:"muted",style:{marginLeft:"auto",fontSize:12},children:"불러오는 중…"})]}),H.filter(w=>w.company==="DYS").map(w=>{const b=H.findIndex(p=>p.company===w.company&&p.name===w.name);return e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"180px 1fr 42px",alignItems:"center",gap:8,marginBottom:8},children:[e.jsx("div",{children:e.jsx("span",{className:"muted",children:w.name})}),e.jsx("input",{className:"assign-input",style:{textAlign:"right"},value:w.amount?g.format(w.amount):"",onChange:p=>c(b,p.target.value),placeholder:"0",disabled:d==="Moderate",title:d==="Moderate"?"Moderate 모드에서는 회사별 목표 수정이 비활성화됩니다":"값을 입력하세요"}),e.jsx("div",{className:"muted",style:{textAlign:"left"},children:"억원"})]},`DYS-${w.name}`)}),e.jsxs("div",{style:{textAlign:"right",fontWeight:700},children:["합계: ",g.format(v)," 억원"]})]})]})]})}const Qa=["영업1본부","영업1팀","영업2본부","영업2팀"];function Xa(){const[s,o]=t.useState([]),[d,D]=t.useState(!1),[H,U]=t.useState(null),[q,Q]=t.useState(!1),[W,se]=t.useState(()=>{try{const N=localStorage.getItem("tnt.sales.assign.year");return N?Number(N):new Date().getFullYear()}catch{return new Date().getFullYear()}}),[ee,S]=t.useState({}),[g,M]=t.useState(null),[Y,v]=t.useState({}),[c,f]=t.useState(""),a=new Intl.NumberFormat("ko-KR"),[C,w]=t.useState(0);t.useEffect(()=>{const N=()=>w(m=>m+1);return window.addEventListener("tnt.sales.assign.mode.changed",N),()=>window.removeEventListener("tnt.sales.assign.mode.changed",N)},[]);const b=t.useMemo(()=>{try{return(localStorage.getItem("tnt.sales.assign.mode")||"").toLowerCase()==="moderate"}catch{return!1}},[C]);async function p(){D(!0),U(null);try{const N=new URL("/api/v1/targets/assigned",window.location.origin);N.searchParams.set("year",String(W));try{const i=(localStorage.getItem("tnt.sales.assign.mode")||"").toLowerCase(),x=i==="moderate"?"2":i==="best"?"1":"";x&&N.searchParams.set("versionNo",x)}catch{}const m=await fetch(N.toString()),P=m.ok?await m.json():[],te=Array.isArray(P)?P:[];if(te.length>0){const i=te.reduce((x,h)=>{const O=String(h.emp_id??h.empId??"").trim(),E=String(h.emp_name??h.empName??"").trim(),pe=String(h.dept_name??h.deptName??""),re=O||(E?`name:${E}`:"");return re&&(x.some(G=>G.key===re)||x.push({key:re,empId:O,empName:E,deptName:pe})),x},[]);i.sort((x,h)=>(x.deptName||"").localeCompare(h.deptName||"")||(x.empName||"").localeCompare(h.empName||"")),o(i),D(!1);return}const K=new URL("/api/v1/employees",window.location.origin);K.searchParams.set("depts",Qa.join(","));const j=await fetch(K.toString());if(!j.ok)throw new Error(`HTTP ${j.status}`);const ne=await j.json(),l=Array.isArray(ne)?ne.map(i=>{const x=String(i.empId??i.emp_id??"").trim(),h=String(i.empName??i.emp_name??"").trim(),O=String(i.deptName??i.dept_name??""),E=String(i.assignee_id??i.assigneeId??"").trim()||void 0;return{key:x||E||(h?`name:${h}`:""),empId:x,empName:h,deptName:O,assigneeId:E}}).filter(i=>!!i.key):[];l.sort((i,x)=>(i.deptName||"").localeCompare(x.deptName||"")||(i.empName||"").localeCompare(x.empName||"")),o(l)}catch(N){U((N==null?void 0:N.message)||"조회 중 오류"),o([])}finally{D(!1)}}t.useEffect(()=>{p()},[]),t.useEffect(()=>{try{localStorage.setItem("tnt.sales.assign.empList",JSON.stringify(s)),window.dispatchEvent(new CustomEvent("tnt.sales.assign.emps.changed"))}catch{}},[s]),t.useEffect(()=>{const N=()=>{try{const m=localStorage.getItem("tnt.sales.assign.year");m&&se(Number(m)),v({}),f&&f("")}catch{}};return window.addEventListener("tnt.sales.assign.year.changed",N),()=>window.removeEventListener("tnt.sales.assign.year.changed",N)},[]),t.useEffect(()=>{async function N(){try{if(!s.length){v({});return}const m=new URL("/api/v1/targets/assigned",window.location.origin);m.searchParams.set("year",String(W));try{const l=(localStorage.getItem("tnt.sales.assign.mode")||"").toLowerCase(),i=l==="moderate"?"2":l==="best"?"1":"";i&&m.searchParams.set("versionNo",i)}catch{}const P=await fetch(m.toString()),te=P.ok?await P.json():[],K={};let j="";Array.isArray(te)&&te.forEach(l=>{const i=String(l.emp_id??l.empId??"").trim(),x=String(l.emp_name??l.empName??"").trim(),h=i||(x?`name:${x}`:"");if(!h)return;const O=String(l.company_name??l.companyName??"").toUpperCase(),E=Number(l.assigned_amount??l.assignedAmount??0),pe=String(l.target_stage??l.targetStage??"").trim(),re=K[h]||{tnt:0,dys:0};O==="TNT"?re.tnt=Math.round(E):O==="DYS"&&(re.dys=Math.round(E)),K[h]=re,pe==="확정"?j="확정":!j&&pe==="기안중"&&(j="기안중")});const ne={};s.forEach(l=>{const i=K[l.key];i&&(ne[l.key]={tnt:i.tnt||0,dys:i.dys||0})}),v(ne),f(j)}catch{}}N()},[W,s,C]),t.useEffect(()=>{async function N(){try{const m=Array.from(new Set(s.map(l=>String(l.empName||"").trim()).filter(Boolean)));if(!m.length){S({});return}const P=new URL("/api/v1/sales/employee-yearly",window.location.origin);P.searchParams.set("year",String(W)),P.searchParams.set("empNames",m.join(",")),P.searchParams.set("joinKey","emp_name");const te=await fetch(P.toString()),K=te.ok?await te.json():[],j=Array.isArray(K)?K:Array.isArray(K==null?void 0:K.employees)?K.employees:[],ne={};j.forEach(l=>{const i=String(l.emp_name??l.empName??"").trim();if(!i)return;const x=Number(l.tnt_amount??0),h=Number(l.dys_amount??0),O=ne[i]||{tnt:0,dys:0};ne[i]={tnt:O.tnt+(Number.isFinite(x)?x:0),dys:O.dys+(Number.isFinite(h)?h:0)}}),S(ne)}catch{S({})}}N()},[W,s]);function L(N,m){const P=Number(m);return!Number.isFinite(P)||P<=0?"-":`${(Math.max(0,Number(N||0))*1e8/P*100).toFixed(1)}%`}const X=s;function ue(N){M(N);try{localStorage.setItem("tnt.sales.selectedEmployee",JSON.stringify(N))}catch{}try{window.dispatchEvent(new CustomEvent("tnt.sales.employee.selected"))}catch{}}function de(N,m,P){const te=Number((P||"").replace(/[,\s]/g,"")),K=Number.isFinite(te)?te:0;v(j=>{const l={...j[N]||{tnt:0,dys:0},[m]:K};return{...j,[N]:l}})}function r(N,m){const P=Math.max(0,Math.round(Number(N)||0)),te=m.reduce((x,h)=>x+(Number(h.value)||0),0);if(!Number.isFinite(te)||te<=0||P<=0){const x={};return m.forEach(h=>{x[h.key]=0}),x}const j=m.map(x=>({key:x.key,exact:P*((Number(x.value)||0)/te)})).map(x=>({key:x.key,floor:Math.floor(x.exact),frac:x.exact-Math.floor(x.exact)}));let ne=j.reduce((x,h)=>x+h.floor,0),l=P-ne;j.sort((x,h)=>h.frac-x.frac);for(let x=0;x<l&&j.length>0;x++){const h=x%j.length;j[h].floor+=1}const i={};return j.forEach(x=>{i[x.key]=x.floor}),i}async function u(){if(!q){Q(!0);try{let N=null;try{const xe=localStorage.getItem("tnt.sales.assign.companyTotals");N=xe?JSON.parse(xe):null}catch{}const m=Math.round(Number((N==null?void 0:N.tnt)||0)),P=Math.round(Number((N==null?void 0:N.dys)||0));if(!Number.isFinite(m)||!Number.isFinite(P)){alert("회사별 목표 합계를 찾을 수 없습니다. 상단 패널을 확인하세요.");return}const te=s.map(xe=>String(xe.empName||"").trim()).filter(xe=>!!xe);if(!te.length){alert("대상 직원이 없습니다.");return}const K=new URL("/api/v1/sales/employee-yearly",window.location.origin);K.searchParams.set("year",String(W)),K.searchParams.set("empNames",te.join(",")),K.searchParams.set("joinKey","emp_name");const j=await fetch(K.toString()),ne=j.ok?await j.json():[],l=Array.isArray(ne)?ne:Array.isArray(ne==null?void 0:ne.employees)?ne.employees:[],i={};Array.isArray(l)&&l.forEach(xe=>{const _=String(xe.emp_name??xe.empName??"").trim();if(!_)return;const me=Number(xe.tnt_amount??0),fe=Number(xe.dys_amount??0),Se=i[_]||{tnt:0,dys:0};i[_]={tnt:Se.tnt+(Number.isFinite(me)?me:0),dys:Se.dys+(Number.isFinite(fe)?fe:0)}});const x={};s.forEach(xe=>{const _=String(xe.empName||"").trim();x[_]=(x[_]||0)+1});const h=[],O=[];s.forEach(xe=>{const _=String(xe.empName||"").trim(),me=i[_]||{tnt:0,dys:0},fe=Math.max(1,x[_]||1);h.push({key:xe.key,value:me.tnt/fe}),O.push({key:xe.key,value:me.dys/fe})});const E=r(m,h),pe=r(P,O);v(xe=>{const _={...xe};return s.forEach(me=>{_[me.key]={tnt:E[me.key]??0,dys:pe[me.key]??0}}),_});const re=xe=>Object.values(xe||{}).reduce((_,me)=>_+(Number(me)||0),0),G=`TNT 합계 ${a.format(re(E))} / 목표 ${a.format(m)}
DYS 합계 ${a.format(re(pe))} / 목표 ${a.format(P)}`;re(E)!==m||re(pe)!==P?alert(`배정 완료(합계 보정 필요):
`+G):alert(`배정이 완료되었습니다.
`+G)}catch(N){alert((N==null?void 0:N.message)||"배정 중 오류가 발생했습니다.")}finally{Q(!1)}}}return e.jsxs("section",{children:[e.jsx(Ja,{}),e.jsxs("div",{className:"page-title",style:{alignItems:"center",marginTop:12},children:[e.jsxs("h2",{style:{margin:0,fontSize:18,display:"flex",alignItems:"center",gap:8},children:["목표배정",c?e.jsx("span",{className:"badge",title:"해당 연도 전체 단계",children:c}):null]}),e.jsxs("div",{style:{marginLeft:"auto",display:"inline-flex",alignItems:"center",gap:8},children:[e.jsx("button",{className:"btn btn-card btn-3d",onClick:()=>u(),disabled:q,title:"전년도 매출 비율로 자동 배정",children:"할당(매출 기반)"}),e.jsx("button",{className:"btn btn-card btn-3d",onClick:()=>$(!1),title:"현재 배정값 저장",children:"저장"}),e.jsx("button",{className:"btn btn-card btn-3d",onClick:()=>$(!0),title:"현재 배정값 확정",children:"확정"})]})]}),H&&e.jsx("div",{className:"error",children:H}),e.jsx("div",{className:"table-container",style:{height:"calc(100vh - 140px)"},children:d?e.jsx("div",{className:"empty-state",children:"불러오는 중…"}):X.length===0?e.jsx("div",{className:"empty-state",children:"데이터가 없습니다"}):e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:140},children:"부서"}),e.jsx("th",{style:{width:140},children:"사번"}),e.jsx("th",{style:{width:180,textAlign:"left"},children:"이름"}),e.jsx("th",{style:{width:140,textAlign:"right"},children:"TNT"}),e.jsx("th",{style:{width:110,textAlign:"right"},children:"TNT 전년대비"}),e.jsx("th",{style:{width:140,textAlign:"right"},children:"DYS"}),e.jsx("th",{style:{width:110,textAlign:"right"},children:"DYS 전년대비"})]})}),e.jsx("tbody",{children:X.map((N,m)=>{var ne,l;const P=Y[N.key]||{tnt:0,dys:0},te=String(N.empName||"").trim(),K=Number(((ne=ee[te])==null?void 0:ne.tnt)||0),j=Number(((l=ee[te])==null?void 0:l.dys)||0);return e.jsxs("tr",{onClick:()=>ue(N),"aria-selected":(g==null?void 0:g.key)===N.key?!0:void 0,style:(g==null?void 0:g.key)===N.key?{background:"rgba(59,130,246,.12)"}:void 0,children:[e.jsx("td",{children:N.deptName}),e.jsx("td",{children:N.empId}),e.jsx("td",{style:{textAlign:"left"},children:N.empName}),e.jsx("td",{style:{textAlign:"right"},children:e.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9,]*",value:P.tnt?a.format(P.tnt):"",onChange:i=>de(N.key,"tnt",i.target.value),placeholder:"0",style:{width:"100%",textAlign:"right"},className:"assign-input","aria-label":`TNT 목표(${N.empName})`,title:b?"Moderate 모드에서는 목표 수정이 비활성화됩니다":"TNT 매출목표",disabled:b})}),e.jsx("td",{style:{textAlign:"right"},title:"해당 직원 전년도 TNT 매출 대비 올해 목표 비율",children:e.jsx("span",{className:"muted",children:L(P.tnt,K)})}),e.jsx("td",{style:{textAlign:"right"},children:e.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9,]*",value:P.dys?a.format(P.dys):"",onChange:i=>de(N.key,"dys",i.target.value),placeholder:"0",style:{width:"100%",textAlign:"right"},className:"assign-input","aria-label":`DYS 목표(${N.empName})`,title:b?"Moderate 모드에서는 목표 수정이 비활성화됩니다":"DYS 매출목표",disabled:b})}),e.jsx("td",{style:{textAlign:"right"},title:"해당 직원 전년도 DYS 매출 대비 올해 목표 비율",children:e.jsx("span",{className:"muted",children:L(P.dys,j)})})]},m)})})]})})]});async function $(N){try{const m=N?"확정":"기안중",te=(localStorage.getItem("tnt.sales.assign.mode")||"").toLowerCase()==="moderate"?2:1,K=[],j=`${W}-01-01`;s.forEach(x=>{const h=Y[x.key]||{tnt:0,dys:0};K.push({targetYear:j,empName:x.empName,companyName:"TNT",targetAmount:Math.round(h.tnt||0),targetStage:m,versionNo:te}),K.push({targetYear:j,empName:x.empName,companyName:"DYS",targetAmount:Math.round(h.dys||0),targetStage:m,versionNo:te})});const ne=localStorage.getItem("tnt.sales.empSeq")||"",l={"Content-Type":"application/json"};ne&&(l["X-EMP-SEQ"]=String(ne));const i=await fetch("/api/v1/targets/assigned/upsert",{method:"POST",headers:l,body:JSON.stringify(K)});if(!i.ok)throw new Error(`HTTP ${i.status}`);N&&await fetch(`/api/v1/targets/assigned/confirm?year=${W}`,{method:"POST",headers:l}),alert(N?"배정이 확정되었습니다.":"배정이 저장되었습니다.")}catch(m){alert((m==null?void 0:m.message)||"배정 저장 중 오류가 발생했습니다.")}}}function Ga(){const[s,o]=t.useState([]),[d,D]=t.useState(!1),[H,U]=t.useState(null),[q,Q]=t.useState("TNT"),[W,se]=t.useState("mine");function ee(){const l=new Date,i=String(l.getFullYear()%100).padStart(2,"0"),x=String(l.getMonth()+1).padStart(2,"0"),h=String(l.getDate()).padStart(2,"0");return`${i}-${x}-${h}`}const[S,g]=t.useState(ee()),[M,Y]=t.useState(ee()),[v,c]=t.useState(null),[f,a]=t.useState(null),C=t.useRef(null),[w,b]=t.useState(null),[p,L]=t.useState(null),[X,ue]=t.useState(null),[de,r]=t.useState("");async function u(l){try{const i=typeof window<"u"&&localStorage.getItem("tnt.sales.assigneeId")||"",x=typeof window<"u"&&localStorage.getItem("tnt.sales.empId")||"",h=new URLSearchParams;i&&h.set("assigneeId",i),x&&h.set("empId",x),h.set("companyCode",l);const O=await fetch(`/api/v1/employee/by-assignee?${h.toString()}`,{cache:"no-store"});if(!O.ok)return"";const E=await O.json().catch(()=>null),pe=(E==null?void 0:E.resolvedSalesEmpSeq)??(l==="DYS"?E==null?void 0:E.dys_emp_seq:E==null?void 0:E.tnt_emp_seq);return pe!=null&&String(pe)?String(pe):""}catch{return""}}function $(l){if(!l)return"";let i=String(l).trim();const x=i.replace(/[^0-9]/g,"");if(x.length===6){const E=x.slice(0,2),pe=x.slice(2,4),re=x.slice(4,6);return N(E,pe,re)?`${E}-${pe}-${re}`:null}if(x.length===8){const E=x.slice(2,4),pe=x.slice(4,6),re=x.slice(6,8);return N(E,pe,re)?`${E}-${pe}-${re}`:null}const h=i.match(/^\s*(\d{2})[-/](\d{2})[-/](\d{2})\s*$/);if(h){const[,E,pe,re]=h;return N(E,pe,re)?`${E}-${pe}-${re}`:null}const O=i.match(/^\s*(\d{4})[-/](\d{2})[-/](\d{2})\s*$/);if(O){const[,E,pe,re]=O,G=E.slice(2);return N(G,pe,re)?`${G}-${pe}-${re}`:null}return null}function N(l,i,x){const h=Number(l),O=Number(i),E=Number(x);return!(!Number.isInteger(h)||!Number.isInteger(O)||!Number.isInteger(E)||O<1||O>12||E<1||E>31||E>[31,28,31,30,31,30,31,31,30,31,30,31][O-1])}function m(l){const i=l.match(/^(\d{2})-(\d{2})-(\d{2})$/);return i?`20${i[1]}-${i[2]}-${i[3]}`:null}function P(l){try{let i=String(l??"");return i=i.replace(/\r\n/g,`
`).replace(/\r/g,`
`).replace(/\\n/g,`
`),i}catch{return String(l??"")}}function te(l){const i=String(l??"").trim();if(!i)return"";const x=i.replace(/[^0-9]/g,"");return x.length===8?`${x.slice(0,4)}-${x.slice(4,6)}-${x.slice(6,8)}`:x.length===6?`20${x.slice(0,2)}-${x.slice(2,4)}-${x.slice(4,6)}`:i}async function K(l=!1){const i=S.trim(),x=M.trim();let h=i?$(i):"",O=x?$(x):"";if(L(null),ue(null),i&&!h){L("형식: YY-MM-DD");return}if(x&&!O){ue("형식: YY-MM-DD");return}if(typeof h=="string"&&g(h),typeof O=="string"&&Y(O),h&&O){const E=m(h),pe=m(O);if(E>pe){ue("종료일이 시작일보다 빠릅니다");return}}D(!0),U(null);try{const E=new URL("/api/v1/orders/external/tsl-order-text",window.location.origin);if(E.searchParams.set("company",q),h&&E.searchParams.set("fromDate",h),O&&E.searchParams.set("toDate",O),W==="mine"){const _=await u(q);_&&E.searchParams.set("salesEmpSeq",_)}const pe=await fetch(E.toString(),{cache:"no-store"});if(!pe.ok)throw new Error(`HTTP ${pe.status}`);const re=await pe.json().catch(()=>[]);let G=Array.isArray(re)?re:[];const xe=de.trim();if(xe){const _=xe.split(/\s+/).map(me=>me.toLowerCase());G=G.filter(me=>{const fe=(()=>{const Se=Object.entries(me);let Ce=null;for(const[I,je]of Se){const V=String(I).toLowerCase();if(V==="custseq"||V==="custname"||V==="customername"||V==="customer_name"){Ce=je;break}}return String(Ce??"")})().toLowerCase();return _.every(Se=>fe.includes(Se))})}o(G)}catch(E){U((E==null?void 0:E.message)||"조회 실패"),o([])}finally{D(!1)}}t.useEffect(()=>{if(!(f!=null&&f.open))return;const l=x=>{const h=C.current;h&&x.target instanceof Node&&!h.contains(x.target)&&a(null)},i=x=>{x.key==="Escape"&&a(null)};return document.addEventListener("mousedown",l,!0),window.addEventListener("keydown",i,!0),()=>{document.removeEventListener("mousedown",l,!0),window.removeEventListener("keydown",i,!0)}},[f==null?void 0:f.open]);const j=t.useMemo(()=>{if(!s.length)return[];const l=s[0];return Object.keys(l)},[s]);function ne(l){const i=(l||"").toString();return/^OrderTextNo$/i.test(i)?"수주장번호":/^OrderTextDate$/i.test(i)||/^OrderTextDat$/i.test(i)?"주문일자":/^CustSeq$/i.test(i)||/^CustName$/i.test(i)||/^CustomerName$/i.test(i)?"거래처명":/^RegionGroup$/i.test(i)||/^region_group$/i.test(i)?"지역그룹":/^SalesEmpSeq$/i.test(i)?"영업":/^OrderText$/i.test(i)?"수주내역":/^IsCancel$/i.test(i)?"중단여부":/^CancelText$/i.test(i)?"중단사유":/^Remark$/i.test(i)?"비고":/^LastDateTime$/i.test(i)?"최종수정일시":/^WHSeq$/i.test(i)?"창고번호":/^DelvDate$/i.test(i)?"납기예정일":/^CustEmpName$/i.test(i)?"거래처담당":/^IsClaim$/i.test(i)?"Claim":/^OrderRemark$/i.test(i)?"주문요청사항":/^Request(Date|Dt)$/i.test(i)||/^ReqDate$/i.test(i)?"요청일자":i}return e.jsxs("section",{children:[e.jsxs("div",{className:"page-title",style:{alignItems:"center"},children:[e.jsx("h2",{style:{margin:0,fontSize:18},children:"수주장 조회"}),e.jsxs("div",{style:{marginLeft:"auto",display:"flex",flexDirection:"column",alignItems:"flex-end",gap:8},children:[e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:12,fontSize:12},children:[e.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:4},children:[e.jsx("input",{type:"radio",name:"company",checked:q==="TNT",onChange:()=>Q("TNT")})," TNT"]}),e.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:4},children:[e.jsx("input",{type:"radio",name:"company",checked:q==="DYS",onChange:()=>Q("DYS")})," DYS"]}),e.jsxs("select",{className:"search-input",value:W,onChange:l=>se(l.target.value||"all"),title:"조회 범위",style:{minWidth:110},children:[e.jsx("option",{value:"mine",children:"내수주"}),e.jsx("option",{value:"all",children:"전체"})]}),e.jsx("div",{style:{width:8}}),e.jsx("label",{className:"muted",children:"수주일"}),e.jsx("input",{className:"search-input",placeholder:"YY-MM-DD",value:S,onChange:l=>{g(l.target.value),p&&L(null)},onBlur:l=>{const i=$(l.target.value);i===null&&l.target.value.trim()?L("형식: YY-MM-DD"):typeof i=="string"&&g(i)},style:{width:90}}),p?e.jsx("div",{className:"error",style:{fontSize:11},children:p}):null,e.jsx("span",{className:"muted",children:"~"}),e.jsx("input",{className:"search-input",placeholder:"YY-MM-DD",value:M,onChange:l=>{Y(l.target.value),X&&ue(null)},onBlur:l=>{const i=$(l.target.value);i===null&&l.target.value.trim()?ue("형식: YY-MM-DD"):typeof i=="string"&&Y(i)},style:{width:90}}),X?e.jsx("div",{className:"error",style:{fontSize:11},children:X}):null,e.jsx("button",{className:"btn btn-card btn-3d",onClick:()=>K(!0),disabled:!!p||!!X||d,children:"조회"})]}),e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:6,alignSelf:"stretch",fontSize:12},children:[e.jsx("label",{className:"muted",children:"거래처명"}),e.jsx("input",{className:"search-input",placeholder:"검색어(공백으로 AND)",value:de,onChange:l=>r(l.target.value),style:{width:320}})]})]})]}),H?e.jsx("div",{className:"error",children:H}):null,e.jsx("div",{className:"table-container",style:{height:"calc(100vh - 160px)"},children:d?e.jsx("div",{className:"empty-state",children:"불러오는 중…"}):s.length===0?e.jsx("div",{className:"empty-state",children:"데이터가 없습니다"}):e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{children:j.map(l=>e.jsx("th",{children:ne(l)},l))})}),e.jsx("tbody",{children:s.map((l,i)=>e.jsx("tr",{onMouseEnter:x=>{const h=(x.clientX||0)+12,O=(x.clientY||0)+12;f!=null&&f.open||c({open:!0,x:h,y:O,rec:l})},onMouseMove:x=>{if(!(v!=null&&v.open))return;const h=(x.clientX||0)+12,O=(x.clientY||0)+12;f!=null&&f.open||c({open:!0,x:h,y:O,rec:l})},onMouseLeave:()=>c(null),onContextMenu:x=>{x.preventDefault();const h=x.clientX,O=x.clientY;a({open:!0,x:h,y:O,rec:l})},children:j.map(x=>e.jsx("td",{children:String((l==null?void 0:l[x])??"")},x))},i))})]})}),v!=null&&v.open&&!(f!=null&&f.open)?e.jsx("div",{role:"dialog","aria-live":"polite",style:{position:"fixed",left:Math.min(Math.max(8,v.x),window.innerWidth-460),top:Math.min(Math.max(8,v.y),window.innerHeight-300),zIndex:80,pointerEvents:"none"},children:e.jsx("div",{className:"card",style:{background:"var(--panel)",padding:12,border:"1px solid var(--border)",borderRadius:8,minWidth:320,maxWidth:600,maxHeight:"85vh",overflow:"auto",boxShadow:"0 8px 24px rgba(0,0,0,.18)"},children:e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:6},children:j.map(l=>{const i=(v.rec||{})[l],x=P(i);return e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:10,paddingBottom:6,borderBottom:"1px solid var(--border-light)"},children:[e.jsx("div",{style:{minWidth:120,fontWeight:600,fontSize:12,color:"var(--text-secondary)"},children:ne(l)}),e.jsx("div",{style:{flex:1,whiteSpace:"pre-wrap",fontSize:12,wordBreak:"break-word"},children:x||e.jsx("span",{style:{color:"var(--text-muted)",fontStyle:"italic"},children:"-"})})]},l)})})})}):null,f!=null&&f.open?(()=>{const l=Math.min(Math.max(8,f.x),window.innerWidth-220),i=Math.min(Math.max(8,f.y),window.innerHeight-120);async function x(){try{const O=j.find(V=>/^OrderText$/i.test(V))||j.find(V=>ne(V)==="수주내역"),E=j.find(V=>/^OrderRemark$/i.test(V))||j.find(V=>ne(V)==="주문요청사항"),pe=j.find(V=>ne(V)==="거래처명")||j.find(V=>/^(CustName|CustomerName|customer_name|CustSeq)$/i.test(V)),re=j.find(V=>/^(UserName|CreatedBy|created_by)$/i.test(V)),G=j.find(V=>/^(RegionGroup|region_group)$/i.test(V)),xe=q,_=pe?String((f.rec||{})[pe]??""):"";let me=re?String((f.rec||{})[re]??""):"",fe=G?String((f.rec||{})[G]??""):"",Se=O?P((f.rec||{})[O]):"";const Ce=E?P((f.rec||{})[E]):"";if(!me){const V=j.find(_e=>ne(_e)==="영업");V&&(me=String((f.rec||{})[V]??""))}if(Se){const V=String(Se).split(/\n/),_e=[];for(const qe of V){const Te=qe.match(/^\s*지역\s*그룹\s*[:：]\s*(.*)\s*$/)||qe.match(/^\s*지역그룹\s*[:：]\s*(.*)\s*$/);if(Te){const Ue=(Te[1]||"").trim();!fe&&Ue&&(fe=Ue)}else _e.push(qe)}Se=_e.join(`
`)}let I=[];I.push(`회사코드: ${xe}`),I.push(`거래처: ${_}`),I.push(`등록자: ${me}`),I.push(`지역 그룹: ${fe}`),I.push("주문내용:"),I.push(Se),I.push("요청사항:"),I.push(Ce);let je=I.join(`
`);if(!Se&&!Ce&&(je=JSON.stringify(f.rec??{},null,2)),navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(je);else{const V=document.createElement("textarea");V.value=je,V.style.position="fixed",V.style.left="-9999px",document.body.appendChild(V),V.focus(),V.select(),document.execCommand("copy"),document.body.removeChild(V)}b({open:!0,x:l+8,y:i+8}),setTimeout(()=>b(null),1200)}catch{}a(null)}async function h(){try{const O=j.find(Te=>/^OrderText$/i.test(Te))||j.find(Te=>ne(Te)==="수주내역"),E=j.find(Te=>/^OrderRemark$/i.test(Te))||j.find(Te=>ne(Te)==="주문요청사항"),pe=j.find(Te=>ne(Te)==="거래처명")||j.find(Te=>/^(CustName|CustomerName|customer_name|CustSeq)$/i.test(Te)),re=j.find(Te=>ne(Te)==="수주장번호")||j.find(Te=>/^OrderTextNo$/i.test(Te)),G=[j.find(Te=>ne(Te)==="요청일자"),j.find(Te=>/^Request(Date|Dt)$/i.test(Te)),j.find(Te=>/^DelvDate$/i.test(Te)),j.find(Te=>/^OrderTextDate$/i.test(Te))].filter(Boolean);let xe="";const _=j.find(Te=>/^(UserName|CreatedBy|created_by)$/i.test(Te));if(_&&(xe=String((f.rec||{})[_]??"")),!xe){const Te=j.find(Ue=>ne(Ue)==="영업");Te&&(xe=String((f.rec||{})[Te]??""))}let me="";const fe=j.find(Te=>/^(RegionGroup|region_group)$/i.test(Te));fe&&(me=String((f.rec||{})[fe]??""));let Se=O?P((f.rec||{})[O]):"";const Ce=E?P((f.rec||{})[E]):"";if(Se){const Te=String(Se).split(/\n/),Ue=[];for(const at of Te){const dt=at.match(/^\s*지역\s*그룹\s*[:：]\s*(.*)\s*$/)||at.match(/^\s*지역그룹\s*[:：]\s*(.*)\s*$/);if(dt){const xt=(dt[1]||"").trim();!me&&xt&&(me=xt)}else Ue.push(at)}Se=Ue.join(`
`)}const I=re?String((f.rec||{})[re]??"").trim():"";let je="";for(const Te of G){const Ue=Te?String((f.rec||{})[Te]??"").trim():"";if(Ue){je=te(Ue);break}}const V={orderNo:I,companyCode:q,customerName:pe?String((f.rec||{})[pe]??""):"",createdBy:xe,regionGroup:me,orderText:Se,orderRemark:Ce,requestDate:je},_e=await fetch("/api/v1/slack/send-order-copy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(V)}),qe=await _e.json().catch(()=>({}));_e.ok&&qe.success?(b({open:!0,x:l+8,y:i+8,message:"Slack 전송 완료"}),setTimeout(()=>b(null),1500)):alert(qe.message||`Slack 전송 실패 (HTTP ${_e.status})`)}catch(O){console.error("Slack 전송 실패:",O),alert("Slack 전송 중 오류가 발생했습니다.")}a(null)}return e.jsx("div",{ref:C,role:"menu",style:{position:"fixed",left:l,top:i,zIndex:90,minWidth:180},children:e.jsxs("div",{className:"card",style:{background:"var(--panel)",padding:4,border:"1px solid var(--border)",borderRadius:8,boxShadow:"0 8px 24px rgba(0,0,0,.18)",display:"flex",flexDirection:"column",gap:2,fontSize:13},children:[e.jsx("button",{className:"btn-plain",style:{width:"100%",textAlign:"left",padding:"4px 6px",fontSize:13},onClick:h,children:"Slack전송"}),e.jsx("button",{className:"btn-plain",style:{width:"100%",textAlign:"left",padding:"4px 6px",fontSize:13},onClick:x,children:"복사"})]})})})():null,w!=null&&w.open?e.jsx("div",{style:{position:"fixed",left:w.x,top:w.y,zIndex:95},children:e.jsx("div",{className:"card",style:{background:"var(--panel)",padding:"2px 6px",border:"1px solid var(--border)",borderRadius:6,fontSize:11},children:w.message||"복사했습니다"})}):null]})}const Va=["매출","가격","재고","경쟁사","Complaint","품질관리","공급사"];function Za(){const[s,o]=t.useState(""),[d,D]=t.useState([]),[H,U]=t.useState(!1),[q,Q]=t.useState(null),[W,se]=t.useState("매출"),ee=new Intl.NumberFormat("ko-KR");async function S(){U(!0),Q(null);try{const g=new URL("/api/v1/items/search",window.location.origin);g.searchParams.set("q",s||""),g.searchParams.set("limit","100");const M=await fetch(g.toString());if(!M.ok)throw new Error(`HTTP ${M.status}`);const Y=await M.json(),v=Array.isArray(Y)?Y.map(c=>({itemSeq:Number(c.itemSeq??c.item_seq??0),itemName:String(c.itemName??c.item_name??""),recentInvoiceDate:String(c.recentInvoiceDate??c.recent_invoice_date??""),curAmt:Number(c.curAmt??c.cur_amt??0),qty:Number(c.qty??0)})):[];D(v)}catch(g){Q((g==null?void 0:g.message)||"조회 오류"),D([])}finally{U(!1)}}return t.useEffect(()=>{S()},[]),e.jsxs("section",{children:[e.jsxs("div",{className:"page-title",style:{alignItems:"center"},children:[e.jsx("h2",{style:{margin:0,fontSize:18},children:"Item360"}),e.jsxs("div",{className:"controls",style:{gap:8},children:[e.jsx("input",{className:"search-input",value:s,onChange:g=>o(g.target.value),placeholder:"품목명 검색",onKeyDown:g=>{g.key==="Enter"&&S()}}),e.jsx("button",{className:"btn btn-card btn-3d",onClick:S,disabled:H,children:"검색"})]})]}),q&&e.jsx("div",{className:"error",children:q}),e.jsx("div",{className:"table-container",style:{height:300},children:H?e.jsx("div",{className:"empty-state",children:"불러오는 중…"}):d.length===0?e.jsx("div",{className:"empty-state",children:"데이터가 없습니다"}):e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:120},children:"품목코드"}),e.jsx("th",{style:{textAlign:"left"},children:"품목명"}),e.jsx("th",{style:{width:140},children:"최근 매출일"}),e.jsx("th",{style:{width:140,textAlign:"right"},children:"매출금액"}),e.jsx("th",{style:{width:120,textAlign:"right"},children:"수량"})]})}),e.jsx("tbody",{children:d.map((g,M)=>e.jsxs("tr",{children:[e.jsx("td",{children:g.itemSeq||""}),e.jsx("td",{style:{textAlign:"left"},children:g.itemName||""}),e.jsx("td",{children:g.recentInvoiceDate||""}),e.jsxs("td",{style:{textAlign:"right"},children:[ee.format(Math.round(Number(g.curAmt||0)))," 원"]}),e.jsx("td",{style:{textAlign:"right"},children:ee.format(Math.round(Number(g.qty||0)))})]},M))})]})}),e.jsxs("div",{style:{marginTop:12},children:[e.jsx("div",{style:{display:"flex",gap:6,borderBottom:"1px solid var(--border)"},children:Va.map(g=>e.jsx("button",{className:"btn btn-card",style:{borderBottom:W===g?"2px solid var(--accent)":"2px solid transparent"},onClick:()=>se(g),children:g},g))}),e.jsx("div",{style:{padding:12},children:e.jsxs("div",{className:"empty-state",children:[W," 탭은 준비중입니다."]})})]})]})}const er=["영업1본부","영업1팀","영업2본부","영업2팀"];function tr(){const[s,o]=t.useState(()=>{try{const i=localStorage.getItem("tnt.sales.assign.year");return i?Number(i):new Date().getFullYear()}catch{return new Date().getFullYear()}}),[d,D]=t.useState([]),[H,U]=t.useState(!1),[q,Q]=t.useState(null),[W,se]=t.useState([]),[ee,S]=t.useState(!1),g=t.useRef(null),[M,Y]=t.useState([]),[v,c]=t.useState(!1),[f,a]=t.useState(null),[C,w]=t.useState({tnt:0,dys:0}),[b,p]=t.useState([]),[L,X]=t.useState(!1),[ue,de]=t.useState(null),r=t.useMemo(()=>{try{let i=0,x=0;for(const h of M){const O=String((h==null?void 0:h.company_name)??(h==null?void 0:h.companyName)??"").toUpperCase(),E=Number((h==null?void 0:h.target_amount_max)??0);Number.isFinite(E)&&(O==="TNT"?i+=E:O==="DYS"&&(x+=E))}return{tnt:i,dys:x}}catch{return{tnt:0,dys:0}}},[M]),u=t.useMemo(()=>({tnt:C.tnt/1e8,dys:C.dys/1e8}),[C]),$=t.useMemo(()=>({tnt:r.tnt-u.tnt,dys:r.dys-u.dys}),[r,u]),N=t.useMemo(()=>{try{const i=pe=>M.reduce((re,G)=>{const xe=String((G==null?void 0:G.biz_area_name)??(G==null?void 0:G.bizAreaName)??""),_=Number((G==null?void 0:G.target_amount_max)??0);return re+(xe===pe&&Number.isFinite(_)?_:0)},0),x=i("복층유리"),h=i("건자재"),O=i("실란트");return(Number.isFinite(x)?x:0)+(Number.isFinite(h)?h:0)+(Number.isFinite(O)?O:0)}catch{return 0}},[M]),m=t.useMemo(()=>{const i=[];for(let x=2030;x>=2026;x--)i.push(x);return i},[]);async function P(i){U(!0),Q(null);try{const x=new URL("/api/v1/targets/assigned",window.location.origin);x.searchParams.set("year",String(i));const h=await fetch(x.toString()),O=h.ok?await h.json():[],E=Array.isArray(O)?O:[];if(E.length>0){const _=E.reduce((me,fe)=>{const Se=String(fe.emp_id??fe.empId??"").trim(),Ce=String(fe.emp_name??fe.empName??"").trim(),I=String(fe.dept_name??fe.deptName??""),je=Se||(Ce?`name:${Ce}`:"");return je&&(me.some(V=>V.key===je)||me.push({key:je,empId:Se,empName:Ce,deptName:I})),me},[]);_.sort((me,fe)=>(me.deptName||"").localeCompare(fe.deptName||"")||(me.empName||"").localeCompare(fe.empName||"")),D(_),U(!1);return}const pe=new URL("/api/v1/employees",window.location.origin);pe.searchParams.set("depts",er.join(","));const re=await fetch(pe.toString());if(!re.ok)throw new Error(`HTTP ${re.status}`);const G=await re.json(),xe=Array.isArray(G)?G.map(_=>{const me=String(_.empId??_.emp_id??"").trim(),fe=String(_.empName??_.emp_name??"").trim(),Se=String(_.deptName??_.dept_name??""),Ce=String(_.assignee_id??_.assigneeId??"").trim()||void 0;return{key:me||Ce||(fe?`name:${fe}`:""),empId:me,empName:fe,deptName:Se,assigneeId:Ce}}).filter(_=>!!_.key):[];xe.sort((_,me)=>(_.deptName||"").localeCompare(me.deptName||"")||(_.empName||"").localeCompare(me.empName||"")),D(xe)}catch(x){Q((x==null?void 0:x.message)||"조회 중 오류"),D([])}finally{U(!1)}}t.useEffect(()=>{P(s)},[s]),t.useEffect(()=>{async function i(){c(!0),a(null);try{const x=new URL("/api/v1/targets/year",window.location.origin);x.searchParams.set("year",String(s));const h=await fetch(x.toString());if(!h.ok)throw new Error(`HTTP ${h.status}`);const O=await h.json();Y(Array.isArray(O)?O:[])}catch(x){Y([]),a((x==null?void 0:x.message)||"조회 오류")}finally{c(!1)}}i()},[s]),t.useEffect(()=>{async function i(){const x=W.length?d.filter(E=>W.includes(E.key)):d,h=x.map(E=>String(E.empId||"").trim()).filter(Boolean),O=x.map(E=>String(E.assigneeId||"").trim()).filter(Boolean);if(!s||h.length===0&&O.length===0){p([]),de(null);return}X(!0),de(null);try{const E=new URL("/api/v1/sales/plan/customer-counts",window.location.origin);E.searchParams.set("year",String(s)),h.length>0&&E.searchParams.set("empIds",h.join(",")),O.length>0&&E.searchParams.set("assigneeIds",O.join(","));const pe=await fetch(E.toString());if(!pe.ok)throw new Error(`HTTP ${pe.status}`);const re=await pe.json();p(Array.isArray(re)?re:[])}catch(E){p([]),de((E==null?void 0:E.message)||"고객수 요약 조회 오류")}finally{X(!1)}}i()},[s,W,d]),t.useEffect(()=>{async function i(){try{const x=new URL("/api/v1/sales/plan/totals",window.location.origin);x.searchParams.set("year",String(s));const h=await fetch(x.toString());if(!h.ok)throw new Error(`HTTP ${h.status}`);const O=await h.json().catch(()=>[]);let E=0,pe=0;Array.isArray(O)&&O.forEach(re=>{const G=String((re==null?void 0:re.company)||(re==null?void 0:re.company_type)||(re==null?void 0:re.companyName)||"").toUpperCase(),xe=Number((re==null?void 0:re.total)||(re==null?void 0:re.total_amount)||0);G==="TNT"?E+=Number.isFinite(xe)?xe:0:G==="DYS"&&(pe+=Number.isFinite(xe)?xe:0)}),w({tnt:E,dys:pe})}catch{w({tnt:0,dys:0})}}i()},[s]);function te(i){const x=Number(i.target.value);if(!(!Number.isFinite(x)||x<=0)){o(x);try{localStorage.setItem("tnt.sales.assign.year",String(x))}catch{}}}function K(i){se(i);const x=d.filter(O=>i.includes(O.key));try{localStorage.setItem("tnt.sales.selectedEmployees",JSON.stringify(x))}catch{}const h=x[0]||null;try{h?localStorage.setItem("tnt.sales.selectedEmployee",JSON.stringify(h)):localStorage.removeItem("tnt.sales.selectedEmployee")}catch{}try{window.dispatchEvent(new CustomEvent("tnt.sales.employees.selected",{detail:{items:x}}))}catch{}try{h&&window.dispatchEvent(new CustomEvent("tnt.sales.employee.selected"))}catch{}}function j(i){K(i?d.map(x=>x.key):[])}function ne(i,x){const h=new Set(W);x?h.add(i):h.delete(i),K(Array.from(h))}t.useEffect(()=>{if(!ee)return;const i=h=>{g.current&&(g.current.contains(h.target)||S(!1))},x=h=>{h.key==="Escape"&&S(!1)};return window.addEventListener("click",i,!0),window.addEventListener("keydown",x,!0),()=>{window.removeEventListener("click",i,!0),window.removeEventListener("keydown",x,!0)}},[ee]);const l=t.useMemo(()=>{if(!W.length)return"전체";const i=d.filter(x=>W.includes(x.key)).map(x=>x.empName||x.empId||x.key);return i.length<=2?i.join(", "):`${i.slice(0,2).join(", ")} 외 ${i.length-2}명`},[W,d]);return e.jsxs("section",{children:[e.jsxs("div",{className:"card",style:{padding:8,marginBottom:12,display:"flex",alignItems:"center",gap:16,flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:8},children:[e.jsx("div",{className:"muted",children:"목표년도"}),e.jsx("select",{className:"search-input",value:s,onChange:te,"aria-label":"목표년도",style:{height:28},children:m.map(i=>e.jsxs("option",{value:String(i),children:[i,"년"]},i))})]}),e.jsxs("div",{ref:g,style:{position:"relative",display:"inline-flex",alignItems:"center",gap:8},children:[e.jsx("div",{className:"muted",children:"영업사원"}),e.jsxs("button",{type:"button",className:"search-input","aria-haspopup":"listbox","aria-expanded":ee,onClick:()=>S(i=>!i),style:{height:28,minWidth:260,display:"inline-flex",alignItems:"center",justifyContent:"space-between",gap:8},children:[e.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:l}),e.jsx("span",{"aria-hidden":!0,children:"▾"})]}),ee&&e.jsxs("div",{role:"listbox",className:"card",style:{position:"absolute",zIndex:60,top:"100%",left:0,width:380,maxHeight:260,overflow:"auto",background:"var(--panel)",border:"1px solid var(--border)",borderRadius:8,padding:8,marginTop:6,fontSize:11},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,padding:"4px 6px"},children:[e.jsx("input",{type:"checkbox",checked:W.length===d.length&&d.length>0,onChange:i=>j(i.target.checked)}),e.jsx("span",{children:"전체"})]}),H?e.jsx("div",{className:"muted",style:{padding:"6px 6px"},children:"불러오는 중…"}):d.length===0?e.jsx("div",{className:"muted",style:{padding:"6px 6px"},children:"목록이 없습니다"}):d.map(i=>{const x=W.includes(i.key),h=`${i.deptName||"-"} / ${i.empName||""}${i.empId?` (${i.empId})`:""}`;return e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,padding:"4px 6px",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:x,onChange:O=>ne(i.key,O.target.checked)}),e.jsx("span",{children:h})]},i.key)}),q?e.jsx("div",{className:"error",style:{padding:"6px 6px"},children:q}):null]})]})]}),e.jsxs("div",{className:"card",style:{padding:8},children:[f?e.jsx("div",{className:"error",style:{marginBottom:8},children:f}):null,v?e.jsx("div",{className:"muted",style:{padding:"8px 6px"},children:"불러오는 중…"}):e.jsxs("div",{style:{display:"flex",alignItems:"stretch",gap:12},children:[e.jsxs("div",{style:{flex:"1 1 auto",display:"flex",flexDirection:"column",gap:6},children:[e.jsxs("div",{style:{display:"flex",alignItems:"baseline",justifyContent:"space-between",margin:"0 2px"},children:[e.jsx("div",{className:"muted",style:{fontWeight:800},children:"회사 목표"}),e.jsx("div",{style:{fontWeight:800},children:Number.isFinite(N)?`${Number(N).toLocaleString(void 0,{maximumFractionDigits:1})} 억원`:"-"})]}),(()=>{let i=0,x=0,h,O=0,E;M.forEach(G=>{const xe=String((G==null?void 0:G.company_name)??(G==null?void 0:G.companyName)??"").toUpperCase(),_=String((G==null?void 0:G.biz_area_name)??(G==null?void 0:G.bizAreaName)??""),me=Number((G==null?void 0:G.target_amount_max)??0),fe=String((G==null?void 0:G.target_stage)??(G==null?void 0:G.targetStage)??"")||void 0;xe==="TNT"?(_==="복층유리"&&Number.isFinite(me)?i+=me:_==="건자재"&&Number.isFinite(me)&&(x+=me),fe&&(h=fe)):xe==="DYS"&&_==="실란트"&&(Number.isFinite(me)&&(O+=me),fe&&(E=fe))});const pe=[{company:"TNT",biz:"복층유리+건자재",max:i+x,stage:h},{company:"DYS",biz:"실란트",max:O,stage:E}];return e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:8},children:pe.map((G,xe)=>{const _=G.company,me=G.biz,fe=G.max,Se=G.stage||"";return e.jsx("div",{className:"card",style:{padding:8,border:"1px solid var(--border)",borderRadius:10,display:"flex",alignItems:"center",minHeight:92,position:"relative"},children:e.jsxs("div",{style:{flex:1},children:[Se?e.jsx("div",{style:{position:"absolute",top:6,left:6},children:e.jsx("span",{className:"badge",style:{fontSize:8,padding:"0 4px",lineHeight:1.1,border:"1px solid var(--border)",borderRadius:6},children:Se})}):null,_==="TNT"&&me==="복층유리+건자재"?(()=>{try{let Ce=0,I=0;for(const V of M){const _e=String((V==null?void 0:V.company_name)??(V==null?void 0:V.companyName)??"").toUpperCase(),qe=String((V==null?void 0:V.biz_area_name)??(V==null?void 0:V.bizAreaName)??""),Te=Number((V==null?void 0:V.target_amount_max)??0);_e==="TNT"&&Number.isFinite(Te)&&(qe==="복층유리"?Ce+=Te:qe==="건자재"&&(I+=Te))}const je=Number.isFinite(fe)?Number(fe):Ce+I;return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4,textAlign:"center"},children:[e.jsxs("div",{style:{fontWeight:800,fontSize:18,lineHeight:1.1},children:["TNT ",je.toLocaleString(void 0,{maximumFractionDigits:1}),"억원"]}),e.jsxs("div",{className:"muted",style:{fontSize:10,lineHeight:1.1},children:["(",`복층${Ce.toLocaleString(void 0,{maximumFractionDigits:1})}억원+건자재${I.toLocaleString(void 0,{maximumFractionDigits:1})}억원`,")"]})]})}catch{return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4,textAlign:"center"},children:[e.jsx("div",{style:{fontWeight:700,fontSize:11},children:"TNT"}),e.jsx("div",{className:"muted",style:{fontSize:11,lineHeight:1.1},children:"데이터 없음"})]})}})():e.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4,textAlign:"center"},children:String(_||"").toUpperCase()==="DYS"&&me==="실란트"?e.jsx(e.Fragment,{children:e.jsxs("div",{style:{fontWeight:800,fontSize:18,lineHeight:1.1},children:["DYS ",Number(fe).toLocaleString(void 0,{maximumFractionDigits:1}),"억원"]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{fontWeight:700,fontSize:11},children:me||"-"}),e.jsx("div",{style:{fontSize:11,fontWeight:800,lineHeight:1.1},children:Number.isFinite(fe)?`${Number(fe).toLocaleString(void 0,{maximumFractionDigits:1})} 억원`:"-"})]})})]})},xe)})})})()]}),e.jsx("div",{style:{flex:"0 0 auto",width:1,background:"var(--border)"}}),e.jsxs("aside",{style:{flex:"0 0 260px",maxWidth:320,paddingLeft:8,display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.jsx("div",{style:{fontWeight:800,marginBottom:8},children:"목표수립 현황"}),e.jsx("div",{className:"card",style:{padding:10,border:"1px solid var(--border)",borderRadius:10,display:"flex",alignItems:"center",justifyContent:"center",minHeight:92},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:10,width:"100%"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%"},children:e.jsx("strong",{style:{fontSize:18,lineHeight:1.1},children:`TNT ${u.tnt.toLocaleString(void 0,{maximumFractionDigits:1})} 억원`})}),e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%"},children:e.jsx("strong",{style:{fontSize:18,lineHeight:1.1},children:`DYS ${u.dys.toLocaleString(void 0,{maximumFractionDigits:1})} 억원`})})]})})]}),e.jsx("div",{style:{flex:"0 0 auto",width:1,background:"var(--border)"}}),e.jsxs("aside",{style:{flex:"0 0 260px",maxWidth:320,paddingLeft:8,display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.jsx("div",{style:{fontWeight:800,marginBottom:8},children:"차액"}),e.jsx("div",{className:"card",style:{padding:10,border:"1px solid var(--border)",borderRadius:10,display:"flex",alignItems:"center",justifyContent:"center",minHeight:92},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:10,width:"100%"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%"},children:e.jsx("strong",{style:{fontSize:18,lineHeight:1.1},children:`TNT ${$.tnt.toLocaleString(void 0,{maximumFractionDigits:1})} 억원`})}),e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%"},children:e.jsx("strong",{style:{fontSize:18,lineHeight:1.1},children:`DYS ${$.dys.toLocaleString(void 0,{maximumFractionDigits:1})} 억원`})})]})})]})]})]}),e.jsxs("div",{className:"card",style:{padding:8,marginTop:12},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:6},children:[e.jsx("div",{style:{fontWeight:800},children:"고객수 요약"}),L?e.jsx("div",{className:"muted",style:{fontSize:12},children:"불러오는 중…"}):null]}),ue?e.jsx("div",{className:"error",style:{marginBottom:8},children:ue}):null,(()=>{const i=W.length?d.filter(h=>W.includes(h.key)):d,x=new Map;for(const h of b){const O=String((h==null?void 0:h.assignee_id)||(h==null?void 0:h.emp_id)||"").trim();if(!O)continue;const E=x.get(O)||[];E.push(h),x.set(O,E)}return e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(320px, 1fr))",gap:10},children:i.map(h=>{const O=String(h.assigneeId||h.empId||h.key||""),E=x.get(O)||[],pe=["TNT","DYS"],re=[...E].sort((G,xe)=>pe.indexOf(String(G.company||"").toUpperCase())-pe.indexOf(String(xe.company||"").toUpperCase()));return e.jsxs("div",{className:"card",style:{padding:10,border:"1px solid var(--border)",borderRadius:10},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:6},children:[e.jsxs("div",{style:{fontWeight:700},children:[h.deptName||"-"," / ",h.empName||h.empId||h.key]}),e.jsxs("div",{className:"muted",style:{fontSize:11},children:[s,"년"]})]}),re.length===0?e.jsx("div",{className:"muted",style:{fontSize:12},children:"데이터가 없습니다"}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:8},children:re.map((G,xe)=>e.jsxs("div",{className:"card",style:{padding:8,border:"1px solid var(--border)",borderRadius:8,minHeight:92,display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:6},children:String(G.company||"").toUpperCase()}),e.jsxs("div",{style:{display:"flex",gap:16,fontSize:12,justifyContent:"space-between"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",flex:1},children:[e.jsx("span",{className:"muted",children:"수립대상"}),e.jsx("strong",{children:Number(G.total_customers||0).toLocaleString()})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",flex:1},children:[e.jsx("span",{className:"muted",children:"확정"}),e.jsx("strong",{children:Number(G.confirmed_customers||0).toLocaleString()})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",flex:1},children:[e.jsx("span",{className:"muted",children:"진행 중"}),e.jsx("strong",{children:Number(G.planning_customers||0).toLocaleString()})]})]})]},xe))})]},O)})})})()]})]})}function sr(){return e.jsxs("section",{children:[e.jsx("h1",{children:"매출관리"}),e.jsx("div",{className:"empty-state",children:"초기 스켈레톤: 매출관리 화면"})]})}const yn="http://220.73.213.73/Angkor.Ylw.Common.HttpExecute/RestOutsideService.svc/OpenApi/IsStoredProcedure/tnt_SWAPISLCustCreditListInfo",nr={certId:"TNT_CRM",certKey:"9836164F-3601-4DBB-9D6D-54685CD89B95",dsn:"tnt_bis",dsnOper:"tnt_oper",securityType:0,CompanySeq:1},Js=[20,50,100],Jt=s=>new Intl.NumberFormat("ko-KR",{maximumFractionDigits:0}).format(Math.round(s||0)),ar=s=>{const o=d=>{const D=Number(d);return Number.isFinite(D)?D:0};return{CustName:String(s.CustName??""),CustNo:String(s.CustNo??""),CustSeq:String(s.CustSeq??""),IsCreditCheck:s.IsCreditCheck==="Y"?"Y":s.IsCreditCheck==="N"?"N":"",CurrName:String(s.CurrName??""),PrevCreditAmt:o(s.PrevCreditAmt),SalesAmt:o(s.SalesAmt),SalesVat:o(s.SalesVat),TotSalesAmt:o(s.TotSalesAmt),ReceiptAmt:o(s.ReceiptAmt),NoReceiptAmt:o(s.NoReceiptAmt)}},rr=({stdDate:s,custSeq:o,empSeq:d,pageNo:D,pageSize:H})=>({ROOT:{...nr,data:{ROOT:{DataBlock1:{StdDate:s.replace(/-/g,""),CustSeq:o.trim()?Number(o):"",EmpSeq:d.trim()?Number(d):"",SMQryType:1078004,IncludeMiNote:1,PAGE_NO:D,PAGE_SIZE:H}}}}});function ir(){const s=new Date().toISOString().slice(0,10),[o,d]=t.useState({stdDate:s,custSeq:"",empSeq:""}),[D,H]=t.useState(o),[U,q]=t.useState(1),[Q,W]=t.useState(Js[0]),[se,ee]=t.useState([]),[S,g]=t.useState({PAGE_NO:1,PAGE_SIZE:Js[0],TotalData:0,TotalPage:0}),[M,Y]=t.useState(!1),[v,c]=t.useState(null),[f,a]=t.useState(null),[C,w]=t.useState(null),[b,p]=t.useState(!1),[L,X]=t.useState(null),ue=(m,P)=>{d(te=>({...te,[m]:P}))},de=()=>{H(o),q(1)},r=m=>{W(m),q(1)},u=m=>{q(P=>m==="next"?S.TotalPage&&P>=S.TotalPage?P:P+1:Math.max(1,P-1))},$=t.useMemo(()=>se.reduce((m,P)=>(m.sales+=P.SalesAmt,m.receipt+=P.ReceiptAmt,m.noReceipt+=P.NoReceiptAmt,m),{sales:0,receipt:0,noReceipt:0}),[se]),N=t.useCallback(async()=>{Y(!0),c(null);try{const m=rr({stdDate:D.stdDate,custSeq:D.custSeq,empSeq:D.empSeq,pageNo:U,pageSize:Q}),P=JSON.stringify(m,null,2);w(P),p(!0);const te=await fetch(yn,{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(m)});if(!te.ok)throw new Error(`서버 응답이 존재하지 않거나 상태값 ${te.status}`);const K=await te.json(),j=K==null?void 0:K.ROOT,ne=j==null?void 0:j.ReturnCode;if(ne!=="0000"){const x=`ReturnCode: ${ne??"N/A"}${j!=null&&j.ReturnMessage?` • ${j.ReturnMessage}`:""}`;throw X(x),new Error((j==null?void 0:j.ReturnMessage)??"데이터를 불러오는 데 실패했습니다.")}X(`ReturnCode: ${ne??"N/A"}${j!=null&&j.ReturnMessage?` • ${j.ReturnMessage}`:""}`);const l=Array.isArray(j==null?void 0:j.DataBlock1)?j.DataBlock1:[];ee(l.map(ar));const i=Array.isArray(j==null?void 0:j.DataBlock2)?j.DataBlock2[0]:null;g(i?{PAGE_NO:Number(i.PAGE_NO??U),PAGE_SIZE:Number(i.PAGE_SIZE??Q),TotalData:Number(i.TotalData??l.length),TotalPage:Number(i.TotalPage??0)}:x=>({...x,PAGE_NO:U,PAGE_SIZE:Q,TotalData:l.length,TotalPage:Math.max(1,Math.ceil(l.length/Q))})),a(new Date().toLocaleString())}catch(m){c(m.message??"데이터를 불러오는 중 알 수 없는 오류가 발생했습니다."),ee([])}finally{Y(!1)}},[D,U,Q]);return t.useEffect(()=>{N()},[N]),e.jsxs("section",{className:"receivables-page",children:[e.jsxs("div",{className:"page-title",children:[e.jsx("h1",{children:"미수현황"}),e.jsx("p",{children:"기준일/필터를 설정하고 서버에서 고객 미수/판매/수금 데이터를 조회하세요."})]}),e.jsxs("div",{className:"filters-grid",children:[e.jsxs("label",{className:"field",children:[e.jsx("span",{children:"기준일"}),e.jsx("input",{type:"date",value:o.stdDate,onChange:m=>ue("stdDate",m.target.value),className:"search-input"})]}),e.jsxs("label",{className:"field",children:[e.jsx("span",{children:"거래처 코드(CustSeq)"}),e.jsx("input",{type:"number",placeholder:"전체",value:o.custSeq,min:0,onChange:m=>ue("custSeq",m.target.value),className:"search-input"})]}),e.jsxs("label",{className:"field",children:[e.jsx("span",{children:"사원 코드(EmpSeq)"}),e.jsx("input",{type:"number",placeholder:"전체",value:o.empSeq,min:0,onChange:m=>ue("empSeq",m.target.value),className:"search-input"})]}),e.jsxs("label",{className:"field",children:[e.jsx("span",{children:"페이지 크기"}),e.jsx("select",{value:Q,onChange:m=>r(Number(m.target.value)),className:"search-input",children:Js.map(m=>e.jsxs("option",{value:m,children:[m,"개"]},m))})]}),e.jsxs("div",{className:"field actions",children:[e.jsx("button",{type:"button",className:"btn",onClick:de,disabled:M,children:"조회하기"}),e.jsx("button",{type:"button",className:"btn secondary",onClick:()=>q(1),disabled:U===1,children:"첫 페이지"}),e.jsx("button",{type:"button",className:"btn secondary",onClick:()=>C&&p(!0),disabled:!C,children:"최근 전문 보기"})]})]}),e.jsxs("div",{className:"summary-cards",children:[e.jsxs("article",{className:"summary-card",children:[e.jsxs("div",{children:[e.jsx("p",{className:"muted",children:"총 데이터"}),e.jsxs("strong",{children:[S.TotalData.toLocaleString(),"건"]})]}),e.jsxs("span",{className:"muted",children:[S.PAGE_NO," / ",Math.max(1,S.TotalPage)," 페이지"]})]}),e.jsxs("article",{className:"summary-card",children:[e.jsxs("div",{children:[e.jsx("p",{className:"muted",children:"금월 판매"}),e.jsxs("strong",{children:[Jt($.sales)," 원"]})]}),e.jsx("span",{className:"muted",children:"합계"})]}),e.jsxs("article",{className:"summary-card",children:[e.jsxs("div",{children:[e.jsx("p",{className:"muted",children:"금월 수금"}),e.jsxs("strong",{children:[Jt($.receipt)," 원"]})]}),e.jsx("span",{className:"muted",children:"합계"})]}),e.jsxs("article",{className:"summary-card highlight",children:[e.jsxs("div",{children:[e.jsx("p",{className:"muted",children:"현미수액"}),e.jsxs("strong",{children:[Jt($.noReceipt)," 원"]})]}),e.jsx("span",{className:"muted",children:"수금과 대비"})]})]}),e.jsxs("div",{className:"table-panel",children:[e.jsxs("div",{className:"table-panel-header",children:[e.jsx("div",{children:e.jsxs("p",{className:"muted",children:["마지막 업데이트: ",f??"—"]})}),e.jsxs("div",{className:"pagination-controls",children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:()=>u("prev"),disabled:U===1,children:"이전"}),e.jsxs("span",{children:[U," page / ",Math.max(1,S.TotalPage)," page"]}),e.jsx("button",{type:"button",className:"btn secondary",onClick:()=>u("next"),disabled:S.TotalPage>0?U>=S.TotalPage:se.length<Q,children:"다음"})]})]}),v&&e.jsx("div",{className:"empty-state",children:v}),e.jsx("div",{className:"table-container receivables-table",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"거래처 코드"}),e.jsx("th",{children:"거래처명"}),e.jsx("th",{children:"통화"}),e.jsx("th",{children:"전월이월"}),e.jsx("th",{children:"금월판매"}),e.jsx("th",{children:"부가세"}),e.jsx("th",{children:"금월판매계"}),e.jsx("th",{children:"금월수금"}),e.jsx("th",{children:"현미수액"}),e.jsx("th",{children:"미수 여부"})]})}),e.jsx("tbody",{children:M?e.jsx("tr",{children:e.jsx("td",{colSpan:10,children:e.jsx("div",{className:"empty-state",children:"데이터를 불러오는 중입니다…"})})}):se.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:10,children:e.jsx("div",{className:"empty-state",children:"조회 결과가 없습니다."})})}):se.map(m=>e.jsxs("tr",{children:[e.jsx("td",{children:m.CustSeq}),e.jsx("td",{children:m.CustName}),e.jsx("td",{children:m.CurrName}),e.jsxs("td",{children:[Jt(m.PrevCreditAmt)," 원"]}),e.jsxs("td",{children:[Jt(m.SalesAmt)," 원"]}),e.jsxs("td",{children:[Jt(m.SalesVat)," 원"]}),e.jsxs("td",{children:[Jt(m.TotSalesAmt)," 원"]}),e.jsxs("td",{children:[Jt(m.ReceiptAmt)," 원"]}),e.jsxs("td",{className:"highlight-cell",children:[Jt(m.NoReceiptAmt)," 원"]}),e.jsx("td",{children:m.IsCreditCheck||"N"})]},`${m.CustSeq}-${m.CustNo}`))})]})})]}),b&&C?e.jsx("div",{className:"json-modal-backdrop",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"json-modal",children:[e.jsx("div",{className:"json-modal-header",children:e.jsx("strong",{children:"직전 요청 전문"})}),e.jsxs("p",{className:"muted",style:{fontSize:12},children:["요청 URL: ",yn]}),e.jsx("pre",{children:C}),L?e.jsx("p",{className:"muted",style:{wordBreak:"break-all"},children:L}):null,e.jsx("div",{className:"json-modal-actions",children:e.jsx("button",{type:"button",className:"btn secondary",onClick:()=>p(!1),children:"닫기"})})]})}):null]})}function Ls({value:s,max:o,color:d,label:D}){const H=Math.max(0,Math.min(100,o>0?s/o*100:0));return e.jsxs("div",{"aria-label":D,style:{position:"relative",width:"100%",height:11,background:"rgba(0,0,0,.04)",borderRadius:999,overflow:"hidden"},children:[e.jsx("div",{style:{width:`${H}%`,height:"100%",background:d,borderRadius:999,transition:"width .2s ease"}}),e.jsx("div",{style:{position:"absolute",right:6,top:0,bottom:0,display:"flex",alignItems:"center",fontSize:10,color:"var(--text)"},children:s})]})}function lr(){const[s,o]=t.useState(!0),[d,D]=t.useState(null),[H,U]=t.useState([]),[q,Q]=t.useState(0),[W,se]=t.useState("default"),[ee,S]=t.useState([]),[g,M]=t.useState(!0),[Y,v]=t.useState(null);t.useEffect(()=>{let r=!1;async function u(){o(!0),D(null);try{const $=await fetch("/api/v1/employees");if(!$.ok)throw new Error(`EMP HTTP ${$.status}`);const N=await $.json();if(r)return;const m=(Array.isArray(N)?N:[]).map((P,te)=>({id:String(P.assignee_id??P.emp_id??te),name:String(P.emp_name??""),prevWeek:{plan:0,actual:0},thisWeek:{plan:0,actual:0},nextWeek:{plan:0,actual:0}}));U(m);try{const[P,te]=await Promise.all([Ps(q),Ps(q-1)]);if(r)return;const K=xn(P),j=Qs(te);U(m.map(ne=>{const l=K.get(ne.id),i=j.get(ne.id);return{...ne,prevWeek:{plan:(i==null?void 0:i.plan)??0,actual:(i==null?void 0:i.actual)??0},thisWeek:{plan:(l==null?void 0:l.thisPlan)??0,actual:(l==null?void 0:l.thisActual)??0},nextWeek:{plan:(l==null?void 0:l.nextPlan)??0,actual:(l==null?void 0:l.nextActual)??0}}}))}catch{D("주간 활동 요약을 불러오지 못했습니다")}}catch{if(r)return;D("직원 목록을 불러오지 못했습니다");try{const N=await Ps(q),m=await Ps(q-1).catch(()=>[]);if(r)return;const P=Qs(m),te=(Array.isArray(N)?N:[]).map((K,j)=>{var i,x,h,O;const ne=String(K.assignee_id??K.emp_id??j),l=P.get(ne);return{id:ne,name:String(K.emp_name??""),prevWeek:{plan:(l==null?void 0:l.plan)??0,actual:(l==null?void 0:l.actual)??0},thisWeek:{plan:Number(((i=K.thisWeek)==null?void 0:i.plan)??0),actual:Number(((x=K.thisWeek)==null?void 0:x.actual)??0)},nextWeek:{plan:Number(((h=K.nextWeek)==null?void 0:h.plan)??0),actual:Number(((O=K.nextWeek)==null?void 0:O.actual)??0)}}});U(te)}catch{U([{id:"e01",name:"김영업",prevWeek:{plan:0,actual:0},thisWeek:{plan:0,actual:0},nextWeek:{plan:0,actual:0}},{id:"e02",name:"박세일",prevWeek:{plan:0,actual:0},thisWeek:{plan:0,actual:0},nextWeek:{plan:0,actual:0}}])}}finally{r||o(!1)}}return u(),()=>{r=!0}},[q]),t.useEffect(()=>{let r=!1;async function u(){M(!0),v(null);try{const[$,N]=await Promise.all([fn(q),fn(q-1)]);if(r)return;const m=xn($),P=Qs(N),te=new Set;for(const j of[...$,...N]){const ne=String(j.assignee_id??j.emp_id??"");ne&&te.add(ne)}const K=Array.from(te).map(j=>{const ne=m.get(j),l=P.get(j),i=$.find(h=>String(h.assignee_id??h.emp_id)===j)||N.find(h=>String(h.assignee_id??h.emp_id)===j),x=i?String(i.emp_name??j):j;return{id:j,name:x,prevWeek:{plan:(l==null?void 0:l.plan)??0,actual:(l==null?void 0:l.actual)??0},thisWeek:{plan:(ne==null?void 0:ne.thisPlan)??0,actual:(ne==null?void 0:ne.thisActual)??0},nextWeek:{plan:(ne==null?void 0:ne.nextPlan)??0,actual:(ne==null?void 0:ne.nextActual)??0}}});K.sort((j,ne)=>j.name.localeCompare(ne.name)),S(K)}catch{if(r)return;v("지역 활동 계획을 불러오지 못했습니다"),S([])}finally{r||M(!1)}}return u(),()=>{r=!0}},[q]);const c=t.useMemo(()=>{let r=1;for(const u of H)r=Math.max(r,u.prevWeek.plan,u.prevWeek.actual,u.thisWeek.plan,u.thisWeek.actual,u.nextWeek.plan,u.nextWeek.actual);return r},[H]),f=t.useMemo(()=>{let r=1;for(const u of ee)r=Math.max(r,u.prevWeek.plan,u.prevWeek.actual,u.thisWeek.plan,u.thisWeek.actual,u.nextWeek.plan,u.nextWeek.actual);return r},[ee]),a=t.useMemo(()=>H.map(r=>{const u=r.prevWeek.plan,$=r.prevWeek.actual,N=u+$,m=N>0?$/N*100:0;return{...r,achievementRate:m,prevTotal:N}}),[H]),C=t.useMemo(()=>ee.map(r=>{const u=r.prevWeek.plan,$=r.prevWeek.actual,N=u+$,m=N>0?$/N*100:0;return{...r,achievementRate:m,prevTotal:N}}),[ee]),w=t.useMemo(()=>{const r=[...a];return W==="rate-high"?r.sort((u,$)=>$.achievementRate-u.achievementRate):W==="rate-low"?r.sort((u,$)=>u.achievementRate-$.achievementRate):r},[a,W]),b=t.useMemo(()=>{const r=[...C];return W==="rate-high"?r.sort((u,$)=>$.achievementRate-u.achievementRate):W==="rate-low"?r.sort((u,$)=>u.achievementRate-$.achievementRate):r},[C,W]),p="#3b82f6",L="#10b981",X=Ne.useCallback((r,u,$,N)=>{const m=ln(q+u);try{window.dispatchEvent(new CustomEvent(N?"tnt.sales.region-plans.select":"tnt.sales.activities.select",{detail:{assigneeId:r.id,empName:r.name,startIso:m.start.toISOString(),endIso:m.end.toISOString(),label:`${r.name} · ${$} 계획/실적`,isRegion:N||!1}}))}catch{}},[q]),ue=t.useMemo(()=>Xn(ln(q)),[q]);function de(r,u){const $=r>=90?"#10b981":r>=70?"#f59e0b":"#ef4444";return{display:u?`${Math.round(r)}%`:"-",color:$}}return e.jsxs("section",{className:"sales-activities-panel",style:{display:"flex",flexDirection:"column",gap:20},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:16,paddingBottom:12,borderBottom:"2px solid var(--border)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"baseline",gap:12},children:[e.jsx("h1",{style:{margin:0,fontSize:24,fontWeight:700},children:"활동관리"}),e.jsx("div",{className:"muted",style:{fontSize:13,fontWeight:500},children:"주간 계획·실적"})]}),e.jsxs("div",{style:{display:"flex",gap:10,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs("div",{className:"card",style:{display:"inline-flex",alignItems:"center",gap:8,padding:"0 12px",border:"1px solid var(--border)",borderRadius:10,background:"var(--panel)",boxShadow:"0 1px 3px rgba(0,0,0,.05)",height:44},children:[e.jsx("button",{className:"icon-button",title:"전주","aria-label":"전주",onClick:()=>Q(r=>r-1),onKeyDown:r=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),Q(u=>u-1))},style:{width:30,height:30,borderRadius:6},children:e.jsx("img",{src:jn,className:"icon",alt:"전주"})}),e.jsx("button",{className:"icon-button",title:"이번주로","aria-label":"이번주로",onClick:()=>Q(0),onKeyDown:r=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),Q(0))},style:{width:30,height:30,borderRadius:6},children:e.jsx("img",{src:Jn,className:"icon",alt:"이번주로"})}),e.jsx("button",{className:"icon-button",title:"다음주","aria-label":"다음주",onClick:()=>Q(r=>r+1),onKeyDown:r=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),Q(u=>u+1))},style:{width:30,height:30,borderRadius:6},children:e.jsx("img",{src:vn,className:"icon",alt:"다음주"})}),e.jsx("span",{className:"muted",style:{fontSize:12,marginLeft:4,whiteSpace:"nowrap",fontWeight:600,minWidth:140,textAlign:"center"},children:ue})]}),e.jsxs("div",{className:"card",style:{padding:"0 12px",border:"1px solid var(--border)",borderRadius:10,display:"inline-flex",alignItems:"center",gap:8,background:"var(--panel)",boxShadow:"0 1px 3px rgba(0,0,0,.05)",height:44},children:[e.jsx("label",{htmlFor:"sort-select",style:{fontSize:12,color:"var(--text-muted)",fontWeight:500,display:"flex",alignItems:"center"},children:"정렬"}),e.jsxs("select",{id:"sort-select",value:W,onChange:r=>se(r.target.value),style:{fontSize:12,padding:"4px 8px",border:"1px solid var(--border)",borderRadius:6,background:"var(--panel)",color:"var(--text)",cursor:"pointer",fontWeight:500},children:[e.jsx("option",{value:"default",children:"기본"}),e.jsx("option",{value:"rate-high",children:"달성률 높은순"}),e.jsx("option",{value:"rate-low",children:"달성률 낮은순"})]})]}),e.jsxs("div",{className:"card",style:{padding:"0 14px",border:"1px solid var(--border)",borderRadius:10,display:"inline-flex",alignItems:"center",gap:12,fontSize:11,background:"var(--panel)",boxShadow:"0 1px 3px rgba(0,0,0,.05)",height:44},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("span",{style:{width:10,height:10,background:p,borderRadius:2}}),e.jsx("span",{style:{fontWeight:500},children:"계획"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("span",{style:{width:10,height:10,background:L,borderRadius:2}}),e.jsx("span",{style:{fontWeight:500},children:"실적"})]})]})]})]}),s?e.jsx("div",{className:"muted",style:{padding:12,textAlign:"center",fontSize:13},children:"직원 목록을 불러오는 중…"}):null,d?e.jsx("div",{className:"error",style:{padding:12,borderRadius:8,background:"rgba(239,68,68,.1)",fontSize:13},children:d}):null,e.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--border)",borderRadius:12,padding:20,boxShadow:"0 2px 8px rgba(0,0,0,.04)"},children:[e.jsxs("div",{style:{fontSize:15,fontWeight:700,color:"var(--text)",marginBottom:16,paddingBottom:12,borderBottom:"1px solid var(--border)",display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{style:{width:4,height:18,background:"#3b82f6",borderRadius:2}}),"영업 활동"]}),w.length===0?e.jsx("div",{className:"empty-state",style:{padding:16},children:"조회된 활동 데이터가 없습니다."}):e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"140px 90px repeat(3, minmax(0, 1fr))",gap:"6px 12px",alignItems:"center"},children:[e.jsx("div",{className:"muted",style:{fontSize:12,fontWeight:700},children:"영업사원"}),e.jsx("div",{className:"muted",style:{fontSize:12,textAlign:"center",fontWeight:700},children:"전주 달성률"}),e.jsx("div",{className:"muted",style:{fontSize:12,fontWeight:700},children:"전주"}),e.jsx("div",{className:"muted",style:{fontSize:12,fontWeight:700},children:"이번주"}),e.jsx("div",{className:"muted",style:{fontSize:12,fontWeight:700},children:"차주"}),w.map(r=>{const u=de(r.achievementRate,r.prevTotal>0),$=[{key:"prev",label:"전주",data:r.prevWeek,offset:-1},{key:"this",label:"이번주",data:r.thisWeek,offset:0},{key:"next",label:"차주",data:r.nextWeek,offset:1}];return e.jsxs(Ne.Fragment,{children:[e.jsx("div",{style:{padding:"3px 0",fontWeight:600,fontSize:12},children:r.name}),e.jsx("div",{style:{padding:"3px 0",textAlign:"center",fontWeight:700,color:u.color},children:u.display}),$.map(N=>e.jsx("div",{role:"button",tabIndex:0,title:`${N.label} 계획/실적 (클릭하여 상세보기)`,style:{cursor:"pointer",padding:"3px 0"},onClick:()=>X(r,N.offset,N.label),onKeyDown:m=>{(m.key==="Enter"||m.key===" ")&&(m.preventDefault(),X(r,N.offset,N.label))},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:3,pointerEvents:"none"},children:[e.jsx(Ls,{value:N.data.plan,max:c,color:p,label:`${r.name} ${N.label} 계획`}),e.jsx(Ls,{value:N.data.actual,max:c,color:L,label:`${r.name} ${N.label} 실적`})]})},`${r.id}-${N.key}`))]},r.id)})]})]}),e.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--border)",borderRadius:12,padding:20,boxShadow:"0 2px 8px rgba(0,0,0,.04)"},children:[e.jsxs("div",{style:{fontSize:15,fontWeight:700,color:"var(--text)",marginBottom:16,paddingBottom:12,borderBottom:"1px solid var(--border)",display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{style:{width:4,height:18,background:"#10b981",borderRadius:2}}),"지역 활동 계획"]}),g?e.jsx("div",{className:"muted",style:{padding:12,textAlign:"center",fontSize:13},children:"지역 활동 계획을 불러오는 중…"}):Y?e.jsx("div",{className:"error",style:{padding:12,borderRadius:8,background:"rgba(239,68,68,.1)",fontSize:13},children:Y}):b.length===0?e.jsx("div",{className:"muted",style:{padding:12,textAlign:"center",fontSize:13},children:"지역 활동 계획 데이터가 없습니다."}):e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"140px 90px repeat(3, minmax(0, 1fr))",gap:"6px 12px",alignItems:"center"},children:[e.jsx("div",{className:"muted",style:{fontSize:12,fontWeight:700},children:"영업사원"}),e.jsx("div",{className:"muted",style:{fontSize:12,textAlign:"center",fontWeight:700},children:"전주 달성률"}),e.jsx("div",{className:"muted",style:{fontSize:12,fontWeight:700},children:"전주"}),e.jsx("div",{className:"muted",style:{fontSize:12,fontWeight:700},children:"이번주"}),e.jsx("div",{className:"muted",style:{fontSize:12,fontWeight:700},children:"차주"}),b.map(r=>{const u=de(r.achievementRate,r.prevTotal>0),$=[{key:"prev",label:"전주",data:r.prevWeek,offset:-1},{key:"this",label:"이번주",data:r.thisWeek,offset:0},{key:"next",label:"차주",data:r.nextWeek,offset:1}];return e.jsxs(Ne.Fragment,{children:[e.jsx("div",{style:{padding:"3px 0",fontWeight:600,fontSize:12},children:r.name}),e.jsx("div",{style:{padding:"3px 0",textAlign:"center",fontWeight:700,color:u.color},children:u.display}),$.map(N=>e.jsx("div",{role:"button",tabIndex:0,title:`${N.label} 계획/실적 (클릭하여 상세보기)`,style:{cursor:"pointer",padding:"3px 0"},onClick:()=>X(r,N.offset,N.label,!0),onKeyDown:m=>{(m.key==="Enter"||m.key===" ")&&(m.preventDefault(),X(r,N.offset,N.label,!0))},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:3,pointerEvents:"none"},children:[e.jsx(Ls,{value:N.data.plan,max:f,color:p,label:`${r.name} ${N.label} 계획`}),e.jsx(Ls,{value:N.data.actual,max:f,color:L,label:`${r.name} ${N.label} 실적`})]})},`${r.id}-${N.key}`))]},r.id)})]})]})]})}async function Ps(s){const o=await fetch(`/api/v1/sales-activities/summary/weekly?offsetWeeks=${encodeURIComponent(s)}&depts=all`);if(!o.ok)throw new Error(`SUM HTTP ${o.status}`);const d=await o.json();return Array.isArray(d)?d:[]}async function fn(s){const o=await fetch(`/api/v1/region-activity-plans/summary/weekly?offsetWeeks=${encodeURIComponent(s)}&depts=all`);if(!o.ok)throw new Error(`REGION HTTP ${o.status}`);const d=await o.json();return Array.isArray(d)?d:[]}function xn(s){const o=new Map;for(const d of s){const D=String(d.assignee_id??d.emp_id??"");if(!D)continue;const H=d.thisWeek||{},U=d.nextWeek||{};o.set(D,{thisPlan:Number(H.plan??0),thisActual:Number(H.actual??0),nextPlan:Number(U.plan??0),nextActual:Number(U.actual??0)})}return o}function Qs(s){const o=new Map;for(const d of s){const D=String(d.assignee_id??d.emp_id??"");if(!D)continue;const H=d.thisWeek||{};o.set(D,{plan:Number(H.plan??0),actual:Number(H.actual??0)})}return o}function or(){const[s,o]=t.useState([]),[d,D]=t.useState([]),[H,U]=t.useState(!1),[q,Q]=t.useState(null),[W,se]=t.useState(""),[ee,S]=t.useState(""),[g,M]=t.useState(()=>new Date().toISOString().split("T")[0]);t.useEffect(()=>{Y()},[]),t.useEffect(()=>{v()},[W,ee,g]);async function Y(){try{const a=await fetch("/api/v1/inventory/warehouses");if(!a.ok)throw new Error(`HTTP ${a.status}`);const C=await a.json();D(Array.isArray(C)?C:[])}catch(a){console.error("창고 목록 조회 실패:",a)}}async function v(){U(!0),Q(null);try{const a=new URLSearchParams;W&&a.set("whSeq",W),ee.trim()&&a.set("itemName",ee.trim()),g&&a.set("asOfDate",g);const C=await fetch(`/api/v1/inventory/stock-aging?${a.toString()}`);if(!C.ok)throw new Error(`HTTP ${C.status}`);const w=await C.json();o(Array.isArray(w)?w:[])}catch(a){Q((a==null?void 0:a.message)||"재고 조회 중 오류가 발생했습니다"),o([])}finally{U(!1)}}function c(a){return a==null?"0":a.toLocaleString("ko-KR",{maximumFractionDigits:2})}function f(a){return a==null?"0":a.toLocaleString("ko-KR",{maximumFractionDigits:0})}return e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[e.jsx("div",{style:{padding:"16px 20px",borderBottom:"1px solid var(--border)",background:"var(--panel)"},children:e.jsx("h2",{style:{margin:0,fontSize:18,fontWeight:700,color:"var(--text)"},children:"재고현황 (품목별 Aging)"})}),e.jsxs("div",{style:{padding:"12px 20px",borderBottom:"1px solid var(--border)",background:"var(--panel)",display:"flex",gap:12,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("label",{style:{fontSize:13,color:"var(--muted)",whiteSpace:"nowrap"},children:"기준일자:"}),e.jsx("input",{type:"date",value:g,onChange:a=>M(a.target.value),style:{height:32,padding:"0 8px",borderRadius:6,border:"1px solid var(--border)",background:"var(--panel)",color:"var(--text)",fontSize:13}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("label",{style:{fontSize:13,color:"var(--muted)",whiteSpace:"nowrap"},children:"창고:"}),e.jsxs("select",{value:W,onChange:a=>se(a.target.value),style:{height:32,padding:"0 8px",borderRadius:6,border:"1px solid var(--border)",background:"var(--panel)",color:"var(--text)",fontSize:13,minWidth:120},children:[e.jsx("option",{value:"",children:"전체"}),d.map(a=>e.jsx("option",{value:a.WHSeq,children:a.WHName},a.WHSeq))]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("label",{style:{fontSize:13,color:"var(--muted)",whiteSpace:"nowrap"},children:"품목명:"}),e.jsx("input",{type:"text",value:ee,onChange:a=>S(a.target.value),placeholder:"검색...",style:{height:32,padding:"0 8px",borderRadius:6,border:"1px solid var(--border)",background:"var(--panel)",color:"var(--text)",fontSize:13,minWidth:200}})]}),e.jsx("button",{onClick:v,disabled:H,className:"btn btn-card btn-3d",style:{height:32,fontSize:13,padding:"0 16px"},children:H?"조회 중...":"조회"})]}),e.jsx("div",{style:{flex:1,minHeight:0,overflow:"auto",padding:20},children:q?e.jsx("div",{style:{padding:20,textAlign:"center",color:"var(--error)"},children:q}):H?e.jsx("div",{style:{padding:20,textAlign:"center",color:"var(--muted)"},children:"재고 데이터를 불러오는 중..."}):s.length===0?e.jsx("div",{style:{padding:20,textAlign:"center",color:"var(--muted)"},children:"조회된 재고가 없습니다"}):e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{className:"data-table",style:{width:"100%",borderCollapse:"collapse",fontSize:13},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"var(--panel)",borderBottom:"2px solid var(--border)"},children:[e.jsx("th",{style:{padding:"10px 12px",textAlign:"left",whiteSpace:"nowrap",color:"var(--muted)",fontWeight:600},children:"품목코드"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"left",whiteSpace:"nowrap",color:"var(--muted)",fontWeight:600},children:"품목명"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"left",whiteSpace:"nowrap",color:"var(--muted)",fontWeight:600},children:"LOT No."}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"left",whiteSpace:"nowrap",color:"var(--muted)",fontWeight:600},children:"규격"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"right",whiteSpace:"nowrap",color:"var(--muted)",fontWeight:600},children:"총재고수량"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"right",whiteSpace:"nowrap",color:"var(--muted)",fontWeight:600},children:"총재고금액"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"right",whiteSpace:"nowrap",color:"var(--muted)",fontWeight:600,background:"#e8f5e9"},children:"0-30일"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"right",whiteSpace:"nowrap",color:"var(--muted)",fontWeight:600,background:"#fff9c4"},children:"31-60일"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"right",whiteSpace:"nowrap",color:"var(--muted)",fontWeight:600,background:"#ffe0b2"},children:"61-90일"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"right",whiteSpace:"nowrap",color:"var(--muted)",fontWeight:600,background:"#ffccbc"},children:"91-180일"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"right",whiteSpace:"nowrap",color:"var(--muted)",fontWeight:600,background:"#ffcdd2"},children:"180일+"})]})}),e.jsx("tbody",{children:s.map((a,C)=>e.jsxs("tr",{style:{borderBottom:"1px solid var(--border)"},children:[e.jsx("td",{style:{padding:"10px 12px",color:"var(--text)"},children:a.itemNo||"-"}),e.jsx("td",{style:{padding:"10px 12px",color:"var(--text)",fontWeight:500},children:a.itemName||"-"}),e.jsx("td",{style:{padding:"10px 12px",color:"var(--primary)",fontWeight:500,fontSize:12},children:a.lotNo||"-"}),e.jsx("td",{style:{padding:"10px 12px",color:"var(--muted)",fontSize:12},children:a.spec||"-"}),e.jsx("td",{style:{padding:"10px 12px",textAlign:"right",color:"var(--text)",fontWeight:600},children:c(a.totalQty)}),e.jsx("td",{style:{padding:"10px 12px",textAlign:"right",color:"var(--text)"},children:f(a.totalAmt)}),e.jsx("td",{style:{padding:"10px 12px",textAlign:"right",color:"#2e7d32",background:"#f1f8e9"},children:c(a.days0to30Qty)}),e.jsx("td",{style:{padding:"10px 12px",textAlign:"right",color:"#f57f17",background:"#fffde7"},children:c(a.days31to60Qty)}),e.jsx("td",{style:{padding:"10px 12px",textAlign:"right",color:"#e65100",background:"#fff3e0"},children:c(a.days61to90Qty)}),e.jsx("td",{style:{padding:"10px 12px",textAlign:"right",color:"#d84315",background:"#fbe9e7"},children:c(a.days91to180Qty)}),e.jsx("td",{style:{padding:"10px 12px",textAlign:"right",color:"#c62828",background:"#ffebee",fontWeight:600},children:c(a.days180PlusQty)})]},C))})]})})}),s.length>0&&!H&&e.jsxs("div",{style:{padding:"12px 20px",borderTop:"2px solid var(--border)",background:"var(--panel)",display:"flex",gap:20,fontSize:13,color:"var(--muted)"},children:[e.jsxs("div",{children:["총 ",e.jsx("strong",{style:{color:"var(--text)"},children:s.length}),"개 품목"]}),e.jsxs("div",{children:["총 재고수량: ",e.jsx("strong",{style:{color:"var(--text)"},children:c(s.reduce((a,C)=>a+(C.totalQty||0),0))})]}),e.jsxs("div",{children:["총 재고금액: ",e.jsx("strong",{style:{color:"var(--text)"},children:f(s.reduce((a,C)=>a+(C.totalAmt||0),0))})]})]})]})}function gr({selectedKey:s}){return e.jsx("div",{className:"main-view",children:s==="dashboard"?e.jsx(Na,{}):s==="calendar"?e.jsx(wa,{}):s==="demand"&&wt.demandManagement?e.jsxs("section",{children:[e.jsx("h1",{children:"수요관리"}),e.jsx("p",{children:"여기에서 수요 데이터를 조회/분석/관리하는 기능이 표시됩니다."}),e.jsx("div",{className:"empty-state",children:"초기 버전: 메인 화면 스켈레톤"})]}):s==="customer"&&wt.customerManagement?e.jsxs("section",{children:[e.jsx("h1",{children:"고객관리"}),e.jsx("p",{children:"고객관리 요구사항은 별도로 정의/입력됩니다. 현재는 플레이스홀더입니다."}),e.jsx("div",{className:"empty-state",children:"초기 버전: 고객관리 화면 스켈레톤"})]}):s==="customer"&&wt.customerManagement?e.jsxs("section",{children:[e.jsx("h1",{children:"고객관리"}),e.jsx("p",{children:"고객관리 요구사항은 별도로 정의/입력됩니다. 현재는 플레이스홀더입니다."}),e.jsx("div",{className:"empty-state",children:"초기 버전: 고객관리 화면 스켈레톤"})]}):s==="customer:list"&&wt.customerManagement?e.jsx(wn,{}):s==="customer:sales-activity-new"&&wt.customerManagement?e.jsx(ia,{}):s==="customer:c360"&&wt.customerManagement?e.jsx(ha,{}):s==="sales-mgmt:activity-plan"?e.jsx(va,{}):s==="customer:c360-old"&&wt.customerManagement?e.jsx(ba,{}):s==="customer:my-activities"&&wt.customerManagement?e.jsx(Aa,{}):s==="lead:register"||s==="lead"?e.jsx(Ba,{}):s==="lead:tm-status"?e.jsx(Ua,{}):s==="order-sheet"?e.jsx(Ya,{}):s==="order-list"?e.jsx(Ga,{}):s==="inquiry"?e.jsx($a,{}):s==="estimate"?e.jsx(Wa,{}):s==="item360"?e.jsx(Za,{}):s==="inventory"?e.jsx(or,{}):s==="complaint"?e.jsx(Ia,{}):s==="settings"?e.jsx(Oa,{}):s==="sales-mgmt:sales"?e.jsx(sr,{}):s==="sales-mgmt:receivables"?e.jsx(ir,{}):s==="sales-mgmt:activities"?e.jsx(lr,{}):s==="demand:list"&&wt.demandManagement?e.jsx(Qn,{}):s==="sales-targets"&&wt.demandManagement?e.jsx(cn,{}):s==="sales-dashboard"&&wt.demandManagement?e.jsx(tr,{}):s==="sales-assign"&&wt.demandManagement?e.jsx(Xa,{}):s==="sales-plan"&&wt.demandManagement?e.jsx(ra,{}):s==="sales-plan-new"&&wt.demandManagement?e.jsx(cn,{}):s==="sales-plan-s"&&wt.demandManagement?e.jsx(na,{}):s==="demand:excel-upload"&&wt.demandManagement?e.jsx(Gn,{}):e.jsxs("section",{children:[e.jsx("h1",{children:s}),e.jsx("div",{className:"empty-state",children:"콘텐츠가 준비중입니다."})]})})}export{gr as MainView};
