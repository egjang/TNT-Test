import{r as o,j as t}from"./index-BmcpNj69.js";function b({style:s}){const[c,x]=o.useState(""),[d,u]=o.useState(!1),[m,p]=o.useState(null),[f,y]=o.useState(null),l=o.useMemo(()=>{try{return{id:localStorage.getItem("tnt.sales.empId")||"",seq:localStorage.getItem("tnt.sales.empSeq")||""}}catch{return{id:"",seq:""}}},[]);async function h(){u(!0),p(null),y(null);try{const e={question:c.trim(),mineOnly:!0};l.id&&(e.empId=l.id),l.seq&&(e.empSeq=Number(l.seq));const i=await fetch("/api/v1/analysis/ask",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!i.ok){let a=`HTTP ${i.status}`;try{const r=await i.json();r!=null&&r.error&&(a=r.error)}catch{const r=await i.text();r&&(a=r)}throw new Error(a)}const n=await i.json();y(n)}catch(e){p((e==null?void 0:e.message)||"요청 처리 중 오류가 발생했습니다")}finally{u(!1)}}function g(e){if(e==null)return null;if(Array.isArray(e)&&e.length>0&&typeof e[0]=="object"&&e[0]!=null){const i=Array.from(e.reduce((n,a)=>(Object.keys(a||{}).forEach(r=>n.add(r)),n),new Set));return t.jsx("div",{className:"table-container",style:{maxHeight:360,overflow:"auto"},children:t.jsxs("table",{className:"table",style:{width:"100%"},children:[t.jsx("thead",{children:t.jsx("tr",{children:i.map(n=>t.jsx("th",{style:{textAlign:"left"},children:n},n))})}),t.jsx("tbody",{children:e.slice(0,200).map((n,a)=>t.jsx("tr",{children:i.map(r=>t.jsx("td",{children:j(n==null?void 0:n[r])},r))},a))})]})})}return typeof e=="object"&&e&&"text"in e?t.jsx("pre",{className:"muted",style:{whiteSpace:"pre-wrap"},children:String(e.text||"")}):t.jsx("pre",{style:{whiteSpace:"pre-wrap"},children:JSON.stringify(e,null,2)})}return t.jsxs("div",{style:{padding:8,...s},children:[t.jsx("div",{style:{fontWeight:600,marginBottom:8},children:"내 거래처 분석 (AI)"}),t.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:8},children:[t.jsx("input",{value:c,onChange:e=>x(e.target.value),onKeyDown:e=>{e.key==="Enter"&&h()},placeholder:"예) 지난달 내 거래처 중 매출 상위 10개 알려줘",style:{flex:1,padding:"8px 10px",borderRadius:8,border:"1px solid var(--border)",background:"transparent",color:"var(--text)"}}),t.jsx("button",{className:"btn",disabled:d||!c.trim(),onClick:h,children:d?"분석 중…":"분석"})]}),m&&t.jsx("div",{className:"error",style:{marginBottom:8},children:m}),f&&t.jsx("div",{children:g(f)})]})}function j(s){return s==null?"":typeof s=="number"?Number.isFinite(s)?String(s):"":s instanceof Date?s.toISOString():String(s)}export{b as MyCustomerAnalysisPanel};
