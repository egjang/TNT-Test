# AI Agent 활동 분석 테이블 설정
# 이 파일에서 분석 대상 테이블과 SQL 쿼리를 관리합니다.
# 새 테이블 추가 시 tables 배열에 항목을 추가하세요.

tables:
  # 영업 활동 테이블
  - name: sales_activity
    displayName: 영업 활동 (Sales Activities)
    enabled: true
    dateColumn: planned_start_at
    limit: 100
    sql: |
      SELECT
          sa.sf_owner_id as emp_id,
          e.emp_name as emp_name,
          sa.subject,
          sa.description,
          sa.activity_type,
          sa.activity_status,
          sa.planned_start_at,
          sa.planned_end_at,
          sa.actual_start_at,
          sa.actual_end_at,
          sa.sf_account_id,
          c.customer_name as customer_name
      FROM public.sales_activity sa
      LEFT JOIN public.employee e ON CAST(e.assignee_id AS TEXT) = CAST(sa.sf_owner_id AS TEXT)
      LEFT JOIN public.customer c ON (CAST(c.customer_id AS TEXT) = CAST(sa.sf_account_id AS TEXT)
                                      OR CAST(c.customer_seq AS TEXT) = CAST(sa.sf_account_id AS TEXT))
      WHERE sa.planned_start_at >= :startDate
          AND sa.planned_start_at <= :endDate
      ORDER BY sa.planned_start_at
      LIMIT :limit
    # 결과를 텍스트로 포맷팅할 때 사용할 필드 매핑
    fields:
      - column: emp_name
        label: 담당자
        fallback: emp_id
      - column: subject
        label: 제목
      - column: activity_type
        label: 유형
      - column: activity_status
        label: 상태
      - column: planned_start_at
        label: 계획 시작
      - column: customer_name
        label: 고객
        fallback: sf_account_id
      - column: description
        label: 상세 내용
        optional: true

  # 지역 활동 계획 테이블
  - name: region_activity_plan
    displayName: 지역 활동 계획 (Region Activity Plans)
    enabled: true
    dateColumn: planned_start_at
    limit: 100
    sql: |
      SELECT
          rap.assignee_id,
          e.emp_name as emp_name,
          rap.subject,
          rap.description,
          rap.addr_province_name,
          rap.addr_district_name,
          rap.planned_start_at,
          rap.planned_end_at,
          rap.actual_start_at,
          rap.actual_end_at
      FROM public.region_activity_plan rap
      LEFT JOIN public.employee e ON e.assignee_id = rap.assignee_id
      WHERE rap.planned_start_at >= :startDate
          AND rap.planned_start_at <= :endDate
      ORDER BY rap.planned_start_at
      LIMIT :limit
    fields:
      - column: emp_name
        label: 담당자
        fallback: assignee_id
      - column: subject
        label: 제목
      - column: addr_province_name
        label: 지역(시도)
      - column: addr_district_name
        label: 지역(시군구)
      - column: planned_start_at
        label: 계획 시작
      - column: description
        label: 상세 내용
        optional: true

  # 지역 활동 목표 테이블
  - name: region_activity_plan_target
    displayName: 지역 활동 목표 (Region Activity Targets)
    enabled: true
    dateColumn: created_at
    limit: 100
    sql: |
      SELECT
          rapt.assignee_id,
          e.emp_name as emp_name,
          rapt.activity_plan_content,
          rapt.activity_result_content,
          rapt.opinion_remark,
          rapt.is_completed,
          rapt.created_at
      FROM public.region_activity_plan_target rapt
      LEFT JOIN public.employee e ON e.assignee_id = rapt.assignee_id
      WHERE rapt.created_at >= :startDate
          AND rapt.created_at <= :endDate
      ORDER BY rapt.created_at
      LIMIT :limit
    fields:
      - column: emp_name
        label: 담당자
        fallback: assignee_id
      - column: is_completed
        label: 완료 여부
      - column: activity_plan_content
        label: 활동 계획
        optional: true
      - column: activity_result_content
        label: 활동 결과
        optional: true
      - column: opinion_remark
        label: 의견
        optional: true
