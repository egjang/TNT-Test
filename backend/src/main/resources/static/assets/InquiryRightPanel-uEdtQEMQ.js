import{r,j as e}from"./index-BNMu8Wi9.js";function E(){const[b,h]=r.useState(!1),[m,y]=r.useState([]),[u,d]=r.useState(!1),[g,o]=r.useState(null),[D,f]=r.useState(!1),[j,S]=r.useState([]);async function q(){d(!0),o(null);try{const s=await fetch("/api/v1/inquiries/delayed",{cache:"no-store"});if(!s.ok)throw new Error(`HTTP ${s.status}`);const i=await s.json().catch(()=>[]),c=Array.isArray(i)?i.map((t,p)=>({id:Number((t==null?void 0:t.id)??p+1),title:String((t==null?void 0:t.title)??""),inquiryStatus:String((t==null?void 0:t.inquiryStatus)??(t==null?void 0:t.inquiry_status)??""),assigneeName:String((t==null?void 0:t.assigneeName)??(t==null?void 0:t.assignee_name)??""),openedAt:String((t==null?void 0:t.openedAt)??(t==null?void 0:t.opened_at)??"")})):[];y(c)}catch(s){o((s==null?void 0:s.message)||"조회 실패"),y([])}finally{d(!1)}}async function A(){d(!0),o(null);try{const s=await fetch("/api/v1/inquiries",{cache:"no-store"});if(!s.ok)throw new Error(`HTTP ${s.status}`);const i=await s.json().catch(()=>[]),c=Date.now(),t=24*60*60*1e3,p=c-t,l={};if(Array.isArray(i))for(const a of i){const n=String((a==null?void 0:a.assigneeName)??(a==null?void 0:a.assignee_name)??"")||"(미지정)",T=String((a==null?void 0:a.inquiryStatus)??(a==null?void 0:a.inquiry_status)??""),N=String((a==null?void 0:a.openedAt)??(a==null?void 0:a.opened_at)??""),v=N?Date.parse(N):NaN,w=T==="완료",_=!w&&Number.isFinite(v)&&v<=p;l[n]||(l[n]={assigneeName:n,total:0,completed:0,pending:0,delayed:0}),l[n].total+=1,w?l[n].completed+=1:l[n].pending+=1,_&&(l[n].delayed+=1)}const C=Object.values(l).sort((a,n)=>a.assigneeName.localeCompare(n.assigneeName,"ko",{sensitivity:"base"}));S(C)}catch(s){o((s==null?void 0:s.message)||"조회 실패"),S([])}finally{d(!1)}}return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8,height:"100%"},children:[e.jsx("div",{className:"card",style:{padding:10},children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{className:"btn btn-card btn-3d",style:{fontSize:12,padding:"6px 10px"},onClick:()=>{f(!1),h(!0),q()},children:"지연 건"}),e.jsx("button",{className:"btn btn-card btn-3d",style:{fontSize:12,padding:"6px 10px"},onClick:()=>{h(!1),f(!0),A()},children:"담당자별 처리현황"})]})}),e.jsxs("div",{style:{flex:1,minHeight:0,overflow:"auto"},children:[b&&e.jsx("div",{className:"table-container",style:{height:360},children:m.length===0?e.jsx("div",{className:"empty-state",children:u?"불러오는 중…":g||"지연된 미완료 건이 없습니다"}):e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:320},children:"제목"}),e.jsx("th",{style:{width:120},children:"상태"}),e.jsx("th",{style:{width:160},children:"담당자명"})]})}),e.jsx("tbody",{children:m.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.title}),e.jsx("td",{children:s.inquiryStatus}),e.jsx("td",{children:s.assigneeName})]},s.id))})]})}),D&&e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(220px,1fr))",gap:8,marginTop:8},children:j.length===0?e.jsx("div",{className:"empty-state",style:{gridColumn:"1 / -1"},children:u?"불러오는 중…":g||"데이터가 없습니다"}):j.map((s,i)=>e.jsxs("div",{className:"card",style:{padding:10},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:6},children:s.assigneeName||"담당자 없음"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"80px 1fr",rowGap:4,columnGap:6,fontSize:12},children:[e.jsx("span",{className:"muted",children:"합계"}),e.jsxs("span",{children:[s.total.toLocaleString(),"건"]}),e.jsx("span",{className:"muted",children:"완료"}),e.jsxs("span",{children:[s.completed.toLocaleString(),"건"]}),e.jsx("span",{className:"muted",children:"진행"}),e.jsxs("span",{children:[s.pending.toLocaleString(),"건"]}),e.jsx("span",{className:"muted",children:"지연"}),e.jsxs("span",{style:{color:s.delayed>0?"#ef4444":void 0},children:[s.delayed.toLocaleString(),"건"]})]})]},i))})]})]})}export{E as InquiryRightPanel};
