import{r as l,j as t,d as M,e as R}from"./index-BNMu8Wi9.js";function j(n){const s=n.getFullYear(),e=String(n.getMonth()+1).padStart(2,"0"),x=String(n.getDate()).padStart(2,"0");return`${s}-${e}-${x}`}function m(n){const s=n?new Date(`${n}T00:00:00`):new Date;return s.setDate(1),j(s)}function $(){const[n,s]=l.useState(()=>m(new Date().toISOString().split("T")[0])),[e,x]=l.useState(null),[c,p]=l.useState(!1),[b,u]=l.useState(null),i=(e==null?void 0:e.assignees)??[],y=(e==null?void 0:e.rows)??[],w=(e==null?void 0:e.totals)??{},h=(e==null?void 0:e.month)||(n?n.slice(0,7):""),S=h?`${h.slice(0,4)}년 ${h.slice(5,7)}월`:"월 선택";l.useEffect(()=>{v(n)},[]);async function v(r){const o=r||n;if(!o)return;const a=m(o);p(!0),u(null);try{const d=new URLSearchParams({baseDate:a}),g=await fetch(`/api/v1/lead-stats/monthly/owner-matrix?${d.toString()}`);if(!g.ok)throw new Error(`Failed to fetch monthly matrix: ${g.status}`);const D=await g.json();x(D),s(a)}catch(d){console.error("월별 담당자 매트릭스 조회 실패",d),u("월별 데이터를 불러오지 못했습니다.")}finally{p(!1)}}function f(r){if(c)return;const o=(e==null?void 0:e.startDate)||n;if(!o)return;const a=new Date(`${o}T00:00:00`);a.setDate(1),a.setMonth(a.getMonth()+(r==="prev"?-1:1));const d=j(a);v(d)}return t.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",gap:12},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs("div",{children:[t.jsx("h3",{style:{margin:0,fontSize:16,fontWeight:700,color:"var(--text)"},children:"월별 잠재고객 등록 현황 (담당자)"}),(e==null?void 0:e.startDate)&&(e==null?void 0:e.endDate)&&t.jsxs("div",{style:{fontSize:12,color:"var(--muted)"},children:[e.startDate," ~ ",e.endDate]})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[t.jsx("button",{onClick:()=>f("prev"),className:"btn btn-card",style:{height:32,width:32,padding:0,display:"flex",alignItems:"center",justifyContent:"center"},title:"이전달","aria-label":"이전달",disabled:c,children:t.jsx("img",{src:M,alt:"이전달",style:{width:14,height:14}})}),t.jsx("div",{style:{fontSize:14,fontWeight:600,minWidth:100,textAlign:"center",color:"var(--text)"},children:S}),t.jsx("button",{onClick:()=>f("next"),className:"btn btn-card",style:{height:32,width:32,padding:0,display:"flex",alignItems:"center",justifyContent:"center"},title:"다음달","aria-label":"다음달",disabled:c,children:t.jsx("img",{src:R,alt:"다음달",style:{width:14,height:14}})})]})]}),t.jsx("div",{style:{flex:1,minHeight:0,background:"var(--panel)",border:"1px solid var(--border)",borderRadius:8,padding:12,overflow:"auto"},children:c?t.jsx("div",{style:{textAlign:"center",padding:24,color:"var(--muted)"},children:"월별 데이터를 불러오는 중입니다..."}):b?t.jsx("div",{style:{textAlign:"center",padding:24,color:"#f97316",fontWeight:600},children:b}):e?i.length===0?t.jsx("div",{style:{textAlign:"center",padding:24,color:"var(--muted)",fontSize:13},children:"선택한 월에는 잠재고객 등록 데이터가 없습니다."}):t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{overflow:"auto",maxHeight:"100%"},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:10,tableLayout:"fixed",minWidth:200},children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{style:{padding:"2px 3px",borderBottom:"1px solid var(--border)",borderRight:"1px solid var(--border)",background:"var(--background)",width:40},children:"일자"}),t.jsx("th",{style:{padding:"2px 3px",borderBottom:"1px solid var(--border)",borderRight:"1px solid var(--border)",background:"var(--background)",width:50},children:"합계"}),i.map(r=>t.jsx("th",{style:{padding:"2px 3px",borderBottom:"1px solid var(--border)",borderRight:"1px solid var(--border)",background:"var(--background)",whiteSpace:"nowrap",minWidth:40,width:Math.max(40,150/Math.max(i.length,1))},children:r.assigneeName},r.assigneeId))]})}),t.jsxs("tbody",{children:[t.jsxs("tr",{children:[t.jsx("td",{style:{padding:"2px 3px",borderBottom:"1px solid var(--border)",borderRight:"1px solid var(--border)",fontWeight:700,color:"#2563eb",textAlign:"center"},children:"열합계"}),t.jsx("td",{style:{padding:"2px 3px",borderBottom:"1px solid var(--border)",borderRight:"1px solid var(--border)",fontWeight:700,color:"#2563eb",textAlign:"center"},children:(e==null?void 0:e.totalCount)??0}),i.map(r=>{const o=w[r.assigneeId]??0;return t.jsx("td",{style:{padding:"2px 2px",borderBottom:"1px solid var(--border)",borderRight:"1px solid var(--border)",textAlign:"center",fontWeight:700,color:o>0?"#2563eb":"var(--text)",fontVariantNumeric:"tabular-nums"},children:o},`top-total-${r.assigneeId}`)})]}),y.map(r=>t.jsxs("tr",{children:[t.jsxs("td",{style:{padding:"2px 3px",borderBottom:"1px solid var(--border)",borderRight:"1px solid var(--border)",textAlign:"center",fontWeight:600},children:[r.date.slice(-2),"일"]}),t.jsx("td",{style:{padding:"2px 3px",borderBottom:"1px solid var(--border)",borderRight:"1px solid var(--border)",textAlign:"center",fontWeight:700,color:"#2563eb"},children:r.total}),i.map(o=>{const a=r.counts[o.assigneeId]??0;return t.jsx("td",{style:{padding:"2px 2px",borderBottom:"1px solid var(--border)",borderRight:"1px solid var(--border)",textAlign:"center",fontVariantNumeric:"tabular-nums",color:a>0?"#2563eb":"var(--text)"},children:a},`${r.date}-${o.assigneeId}`)})]},r.date))]})]})}),t.jsxs("div",{style:{marginTop:8,textAlign:"right",fontSize:12,color:"var(--muted)"},children:["총 ",(e==null?void 0:e.totalCount)!=null?e.totalCount.toLocaleString():"0","건"]})]}):t.jsx("div",{style:{textAlign:"center",padding:24,color:"var(--muted)",fontSize:13},children:"데이터를 불러오려면 상단 버튼으로 월을 선택하세요."})})]})}export{$ as TMMonthlyMatrix};
