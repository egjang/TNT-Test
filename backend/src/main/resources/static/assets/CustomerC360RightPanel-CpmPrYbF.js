import{r as o,j as t}from"./index-BB_3LKiY.js";function se(){const b=[];for(let r=2030;r>=2022;r--)b.push(r);return b}function ae(){const b=new Date().getFullYear(),[r,q]=o.useState(b),[l,P]=o.useState(()=>{try{const e=localStorage.getItem("tnt.sales.selectedCustomer");return e?JSON.parse(e):null}catch{return null}}),[p,M]=o.useState([]),[x,N]=o.useState([]),E=o.useRef(null),[D,J]=o.useState(0),[oe,K]=o.useState([]),[T,R]=o.useState(!1),[W,Y]=o.useState(null);async function V(){if(!l||!l.customerSeq){M([]),N([]);return}R(!0),Y(null);try{const[e,n]=await Promise.all([fetch(`/api/v1/customers/${l.customerSeq}/invoice-monthly?year=${r}`),fetch(`/api/v1/customers/${l.customerSeq}/invoice-monthly?year=${r-1}`)]),a=e.ok?await e.json():[],d=n.ok?await n.json():[],m={},h={};if(Array.isArray(a))for(const s of a){const i=Number((s==null?void 0:s.month)??0),c=Number((s==null?void 0:s.amount)??0);!Number.isFinite(i)||!Number.isFinite(c)||(m[i]=(m[i]||0)+c)}if(Array.isArray(d))for(const s of d){const i=Number((s==null?void 0:s.month)??0),c=Number((s==null?void 0:s.amount)??0);!Number.isFinite(i)||!Number.isFinite(c)||(h[i]=(h[i]||0)+c)}const g=[],C=[];for(let s=1;s<=12;s++)g.push({month:s,amount:m[s]||0}),C.push({month:s,amount:h[s]||0});M(g),N(C)}catch(e){Y((e==null?void 0:e.message)||"월별 매출 조회 중 오류"),M([]),N([])}finally{R(!1)}}o.useEffect(()=>{const e=()=>{try{const n=localStorage.getItem("tnt.sales.selectedCustomer");P(n?JSON.parse(n):null)}catch{P(null)}};return window.addEventListener("tnt.sales.customer.selected",e),()=>window.removeEventListener("tnt.sales.customer.selected",e)},[]),o.useEffect(()=>{V()},[l==null?void 0:l.customerSeq,r]),o.useEffect(()=>{const e=E.current;if(!e)return;const n=()=>J(e.clientWidth||0);n();let a=null;try{a=new ResizeObserver(()=>n()),a.observe(e)}catch{window.addEventListener("resize",n)}return()=>{a?a.disconnect():window.removeEventListener("resize",n)}},[]),o.useEffect(()=>{const e=E.current;if(!e)return;const n=new Array(12).fill(0),a=e.getBoundingClientRect();for(let d=1;d<=12;d++){const m=e.querySelector(`[data-month="${d}"]`);if(!m)continue;const h=m.getBoundingClientRect(),g=h.left-a.left+h.width/2;n[d-1]=g}K(n)},[p,D]);const G=o.useMemo(()=>p.reduce((e,n)=>Math.max(e,n.amount),0),[p]),Q=o.useMemo(()=>x.reduce((e,n)=>Math.max(e,n.amount),0),[x]),w=Math.max(G,Q),L=new Intl.NumberFormat("ko-KR"),k=new Intl.NumberFormat("ko-KR",{maximumFractionDigits:1}),A=typeof window<"u"?getComputedStyle(document.documentElement).getPropertyValue("--accent").trim():"#93c5fd",F="#ef4444",U=o.useMemo(()=>p.reduce((e,n)=>e+(Number(n==null?void 0:n.amount)||0),0),[p]),X=o.useMemo(()=>x.reduce((e,n)=>e+(Number(n==null?void 0:n.amount)||0),0),[x]);return t.jsxs("div",{className:"card",style:{padding:12,height:"100%",overflow:"auto"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:10},children:[t.jsx("strong",{children:"월별 매출"}),t.jsx("select",{className:"search-input",value:r,onChange:e=>q(Number(e.target.value)),style:{width:120},children:se().map(e=>t.jsxs("option",{value:e,children:[e,"년"]},e))}),t.jsx("span",{style:{marginLeft:"auto",fontSize:12,color:"var(--muted)"},children:"단위: 백만원"})]}),!l||!l.customerSeq?t.jsx("div",{className:"empty-state",children:"거래처를 선택하세요"}):T?t.jsx("div",{className:"empty-state",children:"불러오는 중…"}):W?t.jsx("div",{className:"empty-state",children:W}):t.jsxs("div",{style:{marginTop:38},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:16,marginBottom:6},children:[t.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[t.jsx("span",{"aria-hidden":!0,style:{width:20,height:12,background:A,display:"inline-block"}}),t.jsxs("span",{className:"muted",style:{fontSize:12},children:[r,"년"]})]}),t.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[t.jsx("svg",{width:"14",height:"14",viewBox:"0 0 20 20","aria-hidden":!0,style:{display:"inline-block"},children:t.jsx("polygon",{points:"10,2 18,10 10,18 2,10",fill:F,fillOpacity:"0.9"})}),t.jsxs("span",{className:"muted",style:{fontSize:12},children:[r-1,"년"]})]})]}),(()=>{var I,z;const s=Math.floor(55.00000000000001),i="#ef4444",c=typeof window<"u"?getComputedStyle(document.documentElement).getPropertyValue("--accent"):"",Z=(c==null?void 0:c.trim())||"#93c5fd",y=[];y.push(t.jsx("line",{x1:0,y1:170,x2:1200,y2:170,stroke:"var(--border)"},"baseline"));for(let j=0;j<12;j++){const f=j+1,B=((I=p.find($=>$.month===f))==null?void 0:I.amount)??0,H=((z=x.find($=>$.month===f))==null?void 0:z.amount)??0,u=(j+.5)*100,O=w>0?Math.max(2,Math.round(B/w*160)):2,_=Math.round(u-s/2),ee=Math.round(170-O);y.push(t.jsx("rect",{x:_,y:ee,width:s,height:O,fill:Z},`b-${f}`)),y.push(t.jsx("text",{x:u,y:164,textAnchor:"middle",fontSize:20,fill:"#64748b",children:k.format(B/1e6)},`bl-${f}`));const te=170-(w>0?Math.round(H/w*160):0),v=Math.min(168,Math.max(6,te)),S=10,ne=`${Math.round(u)},${Math.round(v-S)} ${Math.round(u+S)},${Math.round(v)} ${Math.round(u)},${Math.round(v+S)} ${Math.round(u-S)},${Math.round(v)}`;y.push(t.jsxs("g",{children:[t.jsx("polygon",{points:ne,fill:i,fillOpacity:"0.9"}),t.jsx("text",{x:u,y:Math.max(16,v-16),textAnchor:"middle",fontSize:20,fill:i,children:k.format(H/1e6)})]},`p-${f}`)),y.push(t.jsx("text",{x:u,y:176,textAnchor:"middle",dominantBaseline:"hanging",fontSize:27,fontWeight:700,fill:"var(--muted)",children:String(f).padStart(2,"0")},`m-${f}`))}return t.jsx("svg",{viewBox:"0 0 1200 203",preserveAspectRatio:"xMidYMid meet",style:{width:"100%",height:203},children:y})})(),t.jsxs("div",{style:{marginTop:0,fontSize:12,color:"var(--muted)",display:"flex",alignItems:"center",gap:16,flexWrap:"wrap"},children:[t.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[t.jsx("span",{"aria-hidden":!0,style:{width:20,height:12,background:A,display:"inline-block"}}),t.jsxs("span",{children:[r,"년 총액: ",L.format(U)," 원"]})]}),t.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[t.jsx("svg",{width:"14",height:"14",viewBox:"0 0 20 20","aria-hidden":!0,style:{display:"inline-block"},children:t.jsx("polygon",{points:"10,2 18,10 10,18 2,10",fill:F,fillOpacity:"0.9"})}),t.jsxs("span",{children:[r-1,"년 총액: ",L.format(X)," 원"]})]})]})]})]})}export{ae as CustomerC360RightPanel};
