import{r,R as O,j as e}from"./index-BB_3LKiY.js";import{c as P,l as _,b as L,M as k,G as z,a as R,u as H,L as B}from"./Marker--CfJXtT2.js";/* empty css                */const D=P(function(o,n){const a=new _.Popup(o,n.overlayContainer);return L(a,n)},function(o,n,{position:a},m){r.useEffect(function(){const{instance:c}=o;function d(h){h.popup===c&&(c.update(),m(!0))}function j(h){h.popup===c&&m(!1)}return n.map.on({popupopen:d,popupclose:j}),n.overlayContainer==null?(a!=null&&c.setLatLng(a),c.openOn(n.map)):n.overlayContainer.bindPopup(c),function(){var u;n.map.off({popupopen:d,popupclose:j}),(u=n.overlayContainer)==null||u.unbindPopup(),n.map.removeLayer(c)}},[o,n,m,a])}),I=[[33,124.5],[38.7,132]],N={서울특별시:[37.5665,126.978],서울:[37.5665,126.978],부산광역시:[35.1796,129.0756],부산:[35.1796,129.0756],대구광역시:[35.8714,128.6014],대구:[35.8714,128.6014],인천광역시:[37.4563,126.7052],인천:[37.4563,126.7052],광주광역시:[35.1595,126.8526],광주:[35.1595,126.8526],대전광역시:[36.3504,127.3845],대전:[36.3504,127.3845],울산광역시:[35.5384,129.3114],울산:[35.5384,129.3114],세종특별자치시:[36.48,127.289],세종:[36.48,127.289],경기도:[37.4138,127.5183],경기:[37.4138,127.5183],강원특별자치도:[37.8228,128.1555],강원도:[37.8228,128.1555],강원:[37.8228,128.1555],충청북도:[36.6357,127.4914],충북:[36.6357,127.4914],충청남도:[36.5184,126.8],충남:[36.5184,126.8],전북특별자치도:[35.7175,127.153],전라북도:[35.7175,127.153],전북:[35.7175,127.153],전라남도:[34.8679,126.991],전남:[34.8679,126.991],경상북도:[36.4919,128.8889],경북:[36.4919,128.8889],경상남도:[35.4606,128.2132],경남:[35.4606,128.2132],제주특별자치도:[33.489,126.4983],제주도:[33.489,126.4983],제주:[33.489,126.4983]};function M(){const l=H();return r.useEffect(()=>{l.fitBounds(I,{padding:[10,10]})},[l]),null}function $(l){const o=Math.min(40,20+l*2);return B.divIcon({className:"customer-marker",html:`<div style="
      background: #e74c3c;
      color: white;
      border-radius: 50%;
      width: ${o}px;
      height: ${o}px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: ${Math.max(10,o/3)}px;
      font-weight: bold;
      border: 2px solid white;
      box-shadow: 0 2px 5px rgba(0,0,0,0.3);
    ">${l}</div>`,iconSize:[o,o],iconAnchor:[o/2,o/2]})}function G({geoData:l,loading:o,error:n,customerGroups:a,customersLoading:m}){const[p,c]=r.useState(null),[d,j]=r.useState(null),h=r.useRef(null),u=t=>{var x;if(!t)return{};const i=((x=t.properties)==null?void 0:x.CTP_KOR_NM)||"",g=d===i,S=p===i;return{fillColor:"transparent",weight:g?3:S?2:1.5,opacity:1,color:g?"#1a1a2e":S?"#333":"#555",fillOpacity:0}},v=(t,i)=>{var S;const g=((S=t.properties)==null?void 0:S.CTP_KOR_NM)||"알 수 없음";i.on({mouseover:()=>c(g),mouseout:()=>c(null),click:()=>j(x=>x===g?null:g)}),i.bindTooltip(g,{permanent:!1,direction:"center",className:"map-tooltip"})};if(r.useEffect(()=>{h.current&&h.current.setStyle(t=>u(t))},[p,d]),o)return e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:e.jsx("div",{children:"지도 데이터를 불러오는 중..."})});if(n)return e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"red"},children:e.jsxs("div",{children:["오류: ",n]})});const f=a.reduce((t,i)=>t+i.customers.length,0);return e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[e.jsxs("div",{style:{padding:"8px 12px",borderBottom:"1px solid var(--border)",background:"var(--bg-secondary)"},children:[e.jsx("h3",{style:{margin:0,fontSize:"0.95rem",fontWeight:600},children:"시도 경계 지도 + 거래처"}),e.jsx("p",{style:{margin:"2px 0 0",fontSize:"0.75rem",color:"var(--text-secondary)"},children:m?"거래처 로딩 중...":`총 ${f}개 거래처`})]}),e.jsx("div",{style:{padding:"6px 12px",borderBottom:"1px solid var(--border)",background:"var(--bg-tertiary)",fontSize:"0.8rem"},children:d?e.jsxs("span",{children:[e.jsx("strong",{children:"선택:"})," ",d]}):p?e.jsxs("span",{children:[e.jsx("strong",{children:"위치:"})," ",p]}):e.jsx("span",{children:"지역 또는 마커를 클릭하세요"})}),e.jsx("div",{style:{flex:1,minHeight:0},children:e.jsxs(k,{center:[36.5,127.5],zoom:7,style:{height:"100%",width:"100%",background:"var(--bg-primary, #fff)"},scrollWheelZoom:!0,children:[l&&e.jsxs(e.Fragment,{children:[e.jsx(z,{ref:h,data:l,style:u,onEachFeature:v}),e.jsx(M,{})]}),a.map(t=>e.jsx(R,{position:t.center,icon:$(t.customers.length),children:e.jsx(D,{children:e.jsxs("div",{style:{maxHeight:200,overflowY:"auto",minWidth:150},children:[e.jsx("strong",{style:{fontSize:"0.9rem"},children:t.sidoName}),e.jsxs("div",{style:{fontSize:"0.75rem",color:"#666",marginBottom:4},children:[t.customers.length,"개 거래처"]}),e.jsxs("ul",{style:{margin:0,padding:"0 0 0 16px",fontSize:"0.8rem"},children:[t.customers.slice(0,20).map(i=>e.jsx("li",{children:i.customerName},i.customerSeq)),t.customers.length>20&&e.jsxs("li",{style:{color:"#999"},children:["... 외 ",t.customers.length-20,"개"]})]})]})})},t.sidoName))]})})]})}function T({geoData:l,loading:o,error:n}){const[a,m]=r.useState(null),[p,c]=r.useState(null),d=r.useRef(null),j=u=>{var i;if(!u)return{};const v=((i=u.properties)==null?void 0:i.SIGUNGU_NM)||"",f=p===v,t=a===v;return{fillColor:"transparent",weight:f?3:t?2:1.5,opacity:1,color:f?"#1a1a2e":t?"#333":"#555",fillOpacity:0}},h=(u,v)=>{var t;const f=((t=u.properties)==null?void 0:t.SIGUNGU_NM)||"알 수 없음";v.on({mouseover:()=>m(f),mouseout:()=>m(null),click:()=>c(i=>i===f?null:f)}),v.bindTooltip(f,{permanent:!1,direction:"center",className:"map-tooltip"})};return r.useEffect(()=>{d.current&&d.current.setStyle(u=>j(u))},[a,p]),o?e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:e.jsx("div",{children:"지도 데이터를 불러오는 중..."})}):n?e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"red"},children:e.jsxs("div",{children:["오류: ",n]})}):e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[e.jsxs("div",{style:{padding:"8px 12px",borderBottom:"1px solid var(--border)",background:"var(--bg-secondary)"},children:[e.jsx("h3",{style:{margin:0,fontSize:"0.95rem",fontWeight:600},children:"시군구 경계 지도"}),e.jsx("p",{style:{margin:"2px 0 0",fontSize:"0.75rem",color:"var(--text-secondary)"},children:"2024년 2분기 기준 시군구 행정구역 경계"})]}),e.jsx("div",{style:{padding:"6px 12px",borderBottom:"1px solid var(--border)",background:"var(--bg-tertiary)",fontSize:"0.8rem"},children:p?e.jsxs("span",{children:[e.jsx("strong",{children:"선택:"})," ",p]}):a?e.jsxs("span",{children:[e.jsx("strong",{children:"위치:"})," ",a]}):e.jsx("span",{children:"지역 위에 마우스를 올리세요"})}),e.jsx("div",{style:{flex:1,minHeight:0},children:e.jsx(k,{center:[36.5,127.5],zoom:7,style:{height:"100%",width:"100%",background:"var(--bg-primary, #fff)"},scrollWheelZoom:!0,children:l&&e.jsxs(e.Fragment,{children:[e.jsx(z,{ref:d,data:l,style:j,onEachFeature:h}),e.jsx(M,{})]})})})]})}function J(){const[l,o]=r.useState(null),[n,a]=r.useState(null),[m,p]=r.useState(!0),[c,d]=r.useState(!0),[j,h]=r.useState(null),[u,v]=r.useState(null),[f,t]=r.useState([]),[i,g]=r.useState(!0);r.useEffect(()=>{fetch("/sales/data/sido_boundary_simplified.geojson").then(s=>{if(!s.ok)throw new Error("시도 GeoJSON 파일을 불러올 수 없습니다.");return s.json()}).then(s=>{o(s),p(!1)}).catch(s=>{h(s.message),p(!1)}),fetch("/sales/data/sigungu_boundary_simplified.geojson").then(s=>{if(!s.ok)throw new Error("시군구 GeoJSON 파일을 불러올 수 없습니다.");return s.json()}).then(s=>{a(s),d(!1)}).catch(s=>{v(s.message),d(!1)}),(async()=>{try{const s=[];let y=0;const b=1e3;let C=!0;for(;C;){const E=await fetch(`/api/v1/customers?mineOnly=false&limit=${b}&offset=${y}`);if(!E.ok)throw new Error("거래처 데이터를 불러올 수 없습니다.");const w=await E.json();s.push(...w),w.length<b?C=!1:y+=b}t(s),g(!1)}catch(s){console.error("거래처 로드 실패:",s),g(!1)}})()},[]);const S=O.useMemo(()=>{const x={};return f.forEach(s=>{const y=s.addrProvinceName;y&&N[y]&&(x[y]||(x[y]=[]),x[y].push(s))}),Object.entries(x).map(([s,y])=>({sidoName:s,customers:y,center:N[s]}))},[f]);return e.jsxs("div",{className:"standard-map",style:{display:"flex",flexDirection:"column",height:"100%"},children:[e.jsx("div",{style:{flex:1,minHeight:0,borderBottom:"2px solid var(--border)"},children:e.jsx(G,{geoData:l,loading:m,error:j,customerGroups:S,customersLoading:i})}),e.jsx("div",{style:{flex:1,minHeight:0},children:e.jsx(T,{geoData:n,loading:c,error:u})}),e.jsx("style",{children:`
        .map-tooltip {
          background: rgba(0, 0, 0, 0.8);
          border: none;
          border-radius: 4px;
          color: white;
          font-size: 12px;
          padding: 4px 8px;
        }
        .leaflet-container {
          font-family: inherit;
        }
        .customer-marker {
          background: transparent;
          border: none;
        }
      `})]})}export{J as StandardMap};
