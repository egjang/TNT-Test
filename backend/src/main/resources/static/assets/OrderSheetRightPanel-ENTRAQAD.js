import{r as x,j as e,F as T,C as q,d as w,h as $}from"./index-BB_3LKiY.js";import{R as k}from"./refresh-cw-BZiQWki6.js";function L(){const[m,S]=x.useState([]),[y,b]=x.useState(!1),[c,D]=x.useState(()=>new Date),[g,C]=x.useState(null);async function E(){try{const t=localStorage.getItem("tnt.sales.assigneeId")||"",s=localStorage.getItem("tnt.sales.empId")||"",a=new URLSearchParams;t&&a.set("assigneeId",t),s&&a.set("empId",s);const d=await fetch(`/api/v1/employee/by-assignee?${a.toString()}`,{cache:"no-store"});if(!d.ok)return{tntEmpSeq:"",dysEmpSeq:""};const n=await d.json().catch(()=>null),l=n==null?void 0:n.tnt_emp_seq,o=n==null?void 0:n.dys_emp_seq;return{tntEmpSeq:l!=null&&String(l)?String(l):"",dysEmpSeq:o!=null&&String(o)?String(o):""}}catch{return{tntEmpSeq:"",dysEmpSeq:""}}}const N=t=>{const s=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),d=String(t.getDate()).padStart(2,"0"),l=["일","월","화","수","목","금","토"][t.getDay()];return`${s}.${a}.${d} (${l})`},R=t=>{const s=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),d=String(t.getDate()).padStart(2,"0");return`${s}${a}${d}`},i=()=>{const t=new Date;return c.toDateString()===t.toDateString()},j=t=>{const s=new Date(c);t==="prev"?s.setDate(s.getDate()-1):s.setDate(s.getDate()+1),D(s)},z=()=>{D(new Date)};async function v(){var t,s;b(!0);try{const a=R(c),d=`${a.slice(2,4)}-${a.slice(4,6)}-${a.slice(6,8)}`,{tntEmpSeq:n,dysEmpSeq:l}=await E(),o=new URLSearchParams;o.set("company","ALL"),o.set("fromDate",d),o.set("toDate",d),n&&o.set("tntSalesEmpSeq",n),l&&o.set("dysSalesEmpSeq",l);const u=await fetch(`/api/v1/orders/external/tsl-order-text?${o.toString()}`);if(!u.ok)throw new Error(`HTTP ${u.status}`);const p=await u.json();let h=[];(s=(t=p==null?void 0:p.data)==null?void 0:t.ROOT)!=null&&s.DataBlock1?h=p.data.ROOT.DataBlock1.map((r,f)=>({id:f,orderTextNo:r.OrderTextNo||r.orderTextNo,customerName:r.CustName||r.custName||r.customerName,orderText:r.OrderText||r.orderText,orderRemark:r.OrderRemark||r.orderRemark,createdAt:r.RegDate||r.regDate||r.createdAt,deliveryDueDate:r.DelvDate||r.delvDate||r.deliveryDueDate,companyCode:r.CompanyType||r.CompanyCode||r.companyCode||"TNT",salesEmpName:r.SalesEmpName||r.salesEmpName})):Array.isArray(p)&&(h=p.map((r,f)=>({id:f,orderTextNo:r.orderTextNo||r.OrderTextNo,customerName:r.customerName||r.CustName||r.CustSeq,orderText:r.orderText||r.OrderText,orderRemark:r.orderRemark||r.OrderRemark,createdAt:r.createdAt||r.RegDate,deliveryDueDate:r.deliveryDueDate||r.DelvDate,companyCode:r.CompanyType||r.companyCode||"TNT",salesEmpName:r.salesEmpName||r.SalesEmpName||r.SalesEmpSeq}))),S(h)}catch(a){console.error("Failed to load orders:",a),S([])}finally{b(!1)}}x.useEffect(()=>{v()},[c]),x.useEffect(()=>{const t=()=>{v()};return window.addEventListener("tnt.sales.ordersheet.order.created",t),()=>{window.removeEventListener("tnt.sales.ordersheet.order.created",t)}},[c]);const I=t=>{t!==void 0&&C(g===t?null:t)};return e.jsxs("div",{style:{height:"100%",display:"flex",flexDirection:"column",background:"var(--panel)"},children:[e.jsxs("div",{style:{padding:"16px 20px",borderBottom:"1px solid var(--border)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:12},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx(T,{size:18}),e.jsx("strong",{style:{fontSize:16},children:"내 수주장 등록 현황"})]}),e.jsx("button",{onClick:v,disabled:y,style:{background:"none",border:"none",cursor:y?"not-allowed":"pointer",padding:6,display:"flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",borderRadius:4},title:"새로고침",children:e.jsx(k,{size:18,className:y?"animate-spin":""})})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"8px 12px",background:"var(--bg-secondary)",borderRadius:8,border:"1px solid var(--border)"},children:[e.jsx("button",{onClick:()=>j("prev"),style:{background:"none",border:"none",cursor:"pointer",padding:4,display:"flex",alignItems:"center",color:"var(--text-primary)",borderRadius:4},title:"이전 날짜",children:e.jsx(q,{size:20})}),e.jsxs("div",{style:{flex:1,textAlign:"center"},children:[e.jsx("div",{style:{fontSize:14,fontWeight:600,color:i()?"var(--primary)":"var(--text-primary)"},children:N(c)}),i()&&e.jsx("div",{style:{fontSize:11,color:"var(--primary)"},children:"오늘"})]}),e.jsx("button",{onClick:()=>j("next"),disabled:i(),style:{background:"none",border:"none",cursor:i()?"not-allowed":"pointer",padding:4,display:"flex",alignItems:"center",color:i()?"var(--text-disabled)":"var(--text-primary)",borderRadius:4},title:"다음 날짜",children:e.jsx(w,{size:20})})]}),!i()&&e.jsx("div",{style:{display:"flex",gap:8,marginTop:8},children:e.jsxs("button",{className:"btn btn-secondary",onClick:z,style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:4,fontSize:12},children:[e.jsx($,{size:14}),"오늘"]})})]}),e.jsxs("div",{style:{padding:"8px 20px",borderBottom:"1px solid var(--border)",background:"var(--bg-secondary)",fontSize:13,color:"var(--text-secondary)"},children:["총 ",e.jsx("strong",{style:{color:"var(--text-primary)"},children:m.length}),"건"]}),e.jsx("div",{style:{flex:1,overflow:"auto",padding:"12px 20px"},children:y?e.jsxs("div",{style:{padding:40,textAlign:"center",color:"var(--text-secondary)"},children:[e.jsx(k,{size:24,className:"animate-spin",style:{marginBottom:8}}),e.jsx("div",{children:"불러오는 중..."})]}):m.length===0?e.jsxs("div",{style:{padding:40,textAlign:"center",color:"var(--text-secondary)",background:"var(--bg-secondary)",borderRadius:8,border:"1px dashed var(--border)"},children:[e.jsx(T,{size:32,style:{marginBottom:8,opacity:.5}}),e.jsx("div",{style:{fontSize:14,fontWeight:500},children:"등록된 수주장이 없습니다"}),e.jsx("div",{style:{fontSize:12,marginTop:4},children:i()?"오늘 등록된 수주장이 없습니다":"해당 날짜에 등록된 수주장이 없습니다"})]}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:m.map(t=>e.jsxs("div",{style:{border:"1px solid var(--border)",borderRadius:8,background:"var(--panel)",overflow:"hidden",transition:"box-shadow 0.2s"},onMouseEnter:s=>{s.currentTarget.style.boxShadow="0 2px 8px rgba(0,0,0,0.08)"},onMouseLeave:s=>{s.currentTarget.style.boxShadow="none"},children:[e.jsxs("div",{onClick:()=>I(t.id),style:{padding:"12px 16px",cursor:"pointer",background:g===t.id?"var(--bg-secondary)":"transparent"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{style:{width:22,height:22,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,fontWeight:700,background:t.companyCode==="DYS"||t.companyCode==="D"?"#6366f1":"#10b981",color:"#fff",flexShrink:0},children:t.companyCode==="DYS"||t.companyCode==="D"?"D":"T"}),e.jsx("span",{style:{fontSize:12,color:"var(--text-secondary)"},children:t.orderTextNo||"-"}),e.jsx("span",{style:{fontSize:14,fontWeight:500,color:"var(--text-primary)"},children:t.customerName||"-"}),t.deliveryDueDate&&e.jsxs("span",{style:{fontSize:11,color:"var(--text-secondary)",marginLeft:4},children:["납품요청일 : ",t.deliveryDueDate.length===8?`${t.deliveryDueDate.slice(0,4)}.${t.deliveryDueDate.slice(4,6)}.${t.deliveryDueDate.slice(6,8)}`:t.deliveryDueDate]})]}),e.jsx(w,{size:16,style:{transform:g===t.id?"rotate(90deg)":"rotate(0deg)",transition:"transform 0.2s",color:"var(--text-secondary)"}})]}),e.jsx("div",{style:{fontSize:12,color:"var(--text-secondary)",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:t.orderText||"-"})]}),g===t.id&&e.jsx("div",{style:{padding:"12px 16px",borderTop:"1px solid var(--border)",background:"var(--bg-secondary)",fontSize:13},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"80px 1fr",gap:"8px 12px"},children:[e.jsx("span",{style:{color:"var(--text-secondary)"},children:"담당자"}),e.jsx("span",{children:t.salesEmpName||"-"}),e.jsx("span",{style:{color:"var(--text-secondary)"},children:"주문내용"}),e.jsx("span",{style:{whiteSpace:"pre-wrap"},children:t.orderText||"-"}),t.orderRemark&&e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{color:"var(--text-secondary)"},children:"요청사항"}),e.jsx("span",{style:{whiteSpace:"pre-wrap"},children:t.orderRemark})]})]})})]},t.id))})}),e.jsx("div",{style:{padding:"8px 20px",borderTop:"1px solid var(--border)",background:"var(--bg-secondary)",fontSize:11,color:"var(--text-tertiary)",textAlign:"center"},children:"좌우 화살표로 날짜를 이동할 수 있습니다"})]})}export{L as OrderSheetRightPanel};
