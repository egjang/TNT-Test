import{j as t,r as i,R as A}from"./index-BB_3LKiY.js";import{C as ue}from"./check-C3N30iKO.js";function Kt({value:h,onChange:g,placeholder:l,readOnly:S,className:b,style:at}){return t.jsx("input",{type:"text",className:["subject-input",b].filter(Boolean).join(" "),style:at,value:h,onChange:_=>g==null?void 0:g(_.target.value),placeholder:l,readOnly:S})}const me=[{value:"Ï†ïÍ∏∞Î∞©Î¨∏",label:"Ï†ïÍ∏∞Î∞©Î¨∏"},{value:"ÏòÅÏóÖÍ∏∞Ìöå",label:"ÏòÅÏóÖÍ∏∞Ìöå"},{value:"Ï±ÑÍ∂åÍ¥ÄÎ¶¨",label:"Ï±ÑÍ∂åÍ¥ÄÎ¶¨"}],pe=[{value:"Í≥ÑÌöç",label:"Í≥ÑÌöç"},{value:"ÏôÑÎ£å",label:"ÏôÑÎ£å"},{value:"Ï∑®ÏÜå",label:"Ï∑®ÏÜå"},{value:"Ïó∞Í∏∞",label:"Ïó∞Í∏∞"},{value:"ÎØ∏Î∞©Î¨∏",label:"ÎØ∏Î∞©Î¨∏"}],fe=[{value:"Î∞©Î¨∏",label:"Î∞©Î¨∏"},{value:"Ï†ÑÌôî",label:"Ï†ÑÌôî"},{value:"Î¨∏Ïûê/Î©îÏùº/Ìå©Ïä§",label:"Î¨∏Ïûê/Î©îÏùº/Ìå©Ïä§"},{value:"Í∏∞ÌÉÄ",label:"Í∏∞ÌÉÄ"}],ge=["Í≥µÍ∞ú","ÌåÄÍ≥µÏú†","Í∞úÏù∏"];function Ie({bare:h=!1,initial:g,editId:l,leadId:S,onSaved:b,onNoticeClose:at,lockSubject:_,planMode:c,multiTargets:R}){const[m,St]=i.useState(null),[xt,he]=i.useState(""),[q,nt]=i.useState(""),[Y,rt]=i.useState(""),[F,Qt]=i.useState(!1),[V,Gt]=i.useState(!1),[K,bt]=i.useState("Í≥µÍ∞ú"),[J,it]=i.useState("Î∞©Î¨∏"),[B,jt]=i.useState("Ï†ïÍ∏∞Î∞©Î¨∏"),[I,wt]=i.useState("Í≥ÑÌöç"),[Nt,Xt]=i.useState(""),[ve,Zt]=i.useState(""),[Se,Mt]=i.useState(!1),[At,xe]=i.useState(""),te=!1,[k,Q]=i.useState(""),[C,G]=i.useState(""),[ct,Tt]=i.useState(""),[z,lt]=i.useState(""),[y,ot]=i.useState(null),[dt,It]=i.useState(g??null),[kt,be]=i.useState(""),[Ct,je]=i.useState(""),[E,Dt]=i.useState(""),[ee,ut]=i.useState([]),[mt,P]=i.useState(!1),[we,se]=i.useState(null),[Et,O]=i.useState(null),[Pt,D]=i.useState(()=>({open:!1,text:""})),[Ot,X]=i.useState(null),[ae,pt]=i.useState(!1),[Lt,ne]=i.useState(new Date),[H,U]=i.useState(!1),[Z,re]=i.useState(""),[ft,_t]=i.useState(!1),[Rt,$t]=i.useState(null),[qt,Bt]=i.useState([]),gt=A.useRef(null),W=dt??g,M=(W==null?void 0:W.id)??l??(c?"plan":"new"),j=i.useMemo(()=>localStorage.getItem("tnt.sales.empId"),[]),L=i.useMemo(()=>localStorage.getItem("tnt.sales.assigneeId"),[]),tt=A.useCallback(async()=>{try{const e=[],n=!!(L||j);L?e.push(["assigneeId",String(L)]):j&&e.push(["empId",String(j)]);async function s(o){const p=new URL("/api/v1/sales-activities",window.location.origin);o&&p.searchParams.set("sfAccountId",o),e.forEach(([N,$])=>p.searchParams.set(N,$)),p.searchParams.set("mineOnly",n?"true":"false"),p.searchParams.set("onlyRoot","true"),p.searchParams.set("limit","200");const f=await fetch(p.toString());if(!f.ok)return[];const v=await f.json();return Array.isArray(v)?v:[]}if(S){const o=new URL("/api/v1/sales-activities",window.location.origin);o.searchParams.set("sfLeadId",String(S)),e.forEach(([N,$])=>o.searchParams.set(N,$)),o.searchParams.set("mineOnly",n?"true":"false"),o.searchParams.set("onlyRoot","true"),o.searchParams.set("limit","200");const p=await fetch(o.toString()),f=p.ok?await p.json():[],v=Array.isArray(f)?f:[];ut(v.slice(0,200));return}const d=[];y!=null&&y.id&&d.push(String(y.id)),m!=null&&m.customerId&&d.push(String(m.customerId)),(m==null?void 0:m.customerSeq)!=null&&d.push(String(m.customerSeq)),z&&d.push(String(z));const a=Array.from(new Set(d.filter(Boolean)));let u=[];a.length>0?u=(await Promise.all(a.map(p=>s(p)))).flat():u=await s(void 0);const w=new Map;u.forEach(o=>{o&&o.id!=null&&w.set(Number(o.id),o)});let r=Array.from(w.values());const T=g||{},x=T.parentActivitySeq!=null?Number(T.parentActivitySeq):void 0;x&&!r.some(o=>Number(o.id)===x)&&(r=[{id:x,subject:T.parentSubject||"ÏÉÅÏúÑÌôúÎèô"},...r]),r.sort((o,p)=>{const f=o.createdAt?new Date(o.createdAt).getTime():0;return(p.createdAt?new Date(p.createdAt).getTime():0)-f}),ut(r.slice(0,200))}catch{ut([])}},[y==null?void 0:y.id,m==null?void 0:m.customerSeq,m==null?void 0:m.customerId,z,j,L,g==null?void 0:g.parentActivitySeq,g==null?void 0:g.parentSubject,S]);A.useEffect(()=>{tt()},[tt]),A.useEffect(()=>{if(!l){It(g??null);return}let e=!1;return(async()=>{try{const n=await fetch(`/api/v1/sales-activities/${l}`);if(!n.ok)throw new Error(`HTTP ${n.status}`);const s=await n.json();if(e)return;const d={id:s.id,subject:s.subject,description:s.description,channel:s.channel,activityType:s.activityType,activityStatus:s.activityStatus,plannedStartAt:s.plannedStartAt||s.planned_start_at,actualStartAt:s.actualStartAt||s.actual_start_at,sfAccountId:s.sfAccountId??s.sf_account_id,customerName:s.customerName??s.customer_name,parentActivitySeq:s.parentSeq??s.parent_activity_seq,parentSubject:s.parentSubject??s.parent_subject};It(d)}catch(n){console.error("Failed to load activity detail for edit:",n)}})(),()=>{e=!0}},[l,g]),A.useEffect(()=>{if(!(gt.current!==M||l&&dt)&&gt.current===M)return;gt.current=M;const n=T=>{if(!T)return"";const x=new Date(T);if(isNaN(x.getTime()))return"";const o=x.getTimezoneOffset();return new Date(x.getTime()-o*6e4).toISOString().slice(0,16)},s=W||{};nt(s.subject??""),rt(s.description??"");const d={in_person:"Î∞©Î¨∏",phone:"Ï†ÑÌôî",email:"Î¨∏Ïûê/Î©îÏùº/Ìå©Ïä§",other:"Í∏∞ÌÉÄ"},a={site_visit:"Ï†ïÍ∏∞Î∞©Î¨∏",opportunity:"ÏòÅÏóÖÍ∏∞Ìöå",AR_mgmt:"Ï±ÑÍ∂åÍ¥ÄÎ¶¨",meeting:"ÎØ∏ÌåÖ",call:"Ï†ÑÌôî",email:"Ïù¥Î©îÏùº",demo:"Îç∞Î™®",task:"ÏóÖÎ¨¥",other:"Í∏∞ÌÉÄ"},u={scheduled:"Í≥ÑÌöç",completed:"ÏôÑÎ£å",canceled:"Ï∑®ÏÜå",postponed:"Ïó∞Í∏∞",no_show:"ÎØ∏Î∞©Î¨∏"},w={public:"Í≥µÍ∞ú",team:"ÌåÄÍ≥µÏú†",private:"Í∞úÏù∏"};it(s.channel&&(d[s.channel]||s.channel)||"Î∞©Î¨∏"),jt(s.activityType&&(a[s.activityType]||s.activityType)||"Ï†ïÍ∏∞Î∞©Î¨∏"),wt(c?"Í≥ÑÌöç":s.activityStatus&&(u[s.activityStatus]||s.activityStatus)||"Í≥ÑÌöç"),bt(s.visibility?w[s.visibility]||String(s.visibility):"Í≥µÍ∞ú"),Q(n(s.plannedStartAt));const r=n(s.actualStartAt);G(r),Tt(r),lt(s.sfAccountId!=null?String(s.sfAccountId):""),Dt(s.parentActivitySeq!=null?String(s.parentActivitySeq):""),s.sfAccountId&&String(s.sfAccountId)||s.customerName?(ot({id:s.sfAccountId?String(s.sfAccountId):void 0,name:s.customerName?String(s.customerName):void 0}),St({customerId:s.sfAccountId?String(s.sfAccountId):void 0,customerName:s.customerName})):ot(null)},[W,M,c,l,dt]),A.useEffect(()=>{l||c||Q(e=>{if(e&&String(e).trim()!=="")return e;const n=new Date,s=n.getTimezoneOffset();return new Date(n.getTime()-s*6e4).toISOString().slice(0,16)})},[l,c]);const[zt,Ht]=A.useState(""),[Ut,ie]=A.useState(!0);A.useEffect(()=>{if(Ut){Ht(I),ie(!1);return}if(!(zt===I||c)){if(I==="ÏôÑÎ£å"&&(!ct||String(ct).trim()==="")){const e=new Date,n=e.getTimezoneOffset(),d=new Date(e.getTime()-n*6e4).toISOString().slice(0,16);G(d)}Ht(I)}},[I,ct,c,zt,Ut]),A.useEffect(()=>{!C||k||Q(C)},[C,k]);const[ce,et]=i.useState(!1);A.useEffect(()=>{let e=!1;async function n(){try{if(!l){e||et(!1);return}const s=new URL("/api/v1/sales-activities",window.location.origin);s.searchParams.set("parentSeq",String(l)),s.searchParams.set("mineOnly","false"),s.searchParams.set("limit","1");const d=await fetch(s.toString());if(!d.ok){e||et(!1);return}const a=await d.json(),u=Array.isArray(a)?a:[];e||et(u.length>0)}catch{e||et(!1)}}return n(),()=>{e=!0}},[l]);const yt=!!(l&&ce),st=A.useCallback(async()=>{$t(null),_t(!0);try{const e=new URL("/api/v1/customers",window.location.origin);Z.trim()&&e.searchParams.set("name",Z.trim()),e.searchParams.set("mineOnly","false"),e.searchParams.set("limit","50");const n=await fetch(e.toString());if(!n.ok){let a=`HTTP ${n.status}`;try{const u=await n.json();u!=null&&u.error&&(a=u.error)}catch{}throw new Error(a)}const s=await n.json(),d=Array.isArray(s)?s:[];Bt(d.map(a=>({customerId:(a==null?void 0:a.customerId)??(a==null?void 0:a.customer_id),customerName:(a==null?void 0:a.customerName)??(a==null?void 0:a.customer_name),companyType:(a==null?void 0:a.companyType)??(a==null?void 0:a.company_type),ownerName:(a==null?void 0:a.ownerName)??(a==null?void 0:a.owner_name)})))}catch(e){$t((e==null?void 0:e.message)||"Ï°∞Ìöå Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§"),Bt([])}finally{_t(!1)}},[Z]);A.useEffect(()=>{H&&st()},[H,st]),A.useEffect(()=>{if(!H)return;const e=n=>{n.key==="Escape"&&(n.preventDefault(),n.stopPropagation(),U(!1))};return window.addEventListener("keydown",e,!0),()=>window.removeEventListener("keydown",e,!0)},[H]);async function le(){if(O(null),X(null),se(null),!j){O("Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§");return}let e=C;if(["ÏôÑÎ£å","Ï∑®ÏÜå","ÎØ∏Î∞©Î¨∏"].includes(I)&&(!C||C.trim()==="")){D({open:!0,text:"ÏôÑÎ£å/Ï∑®ÏÜå/ÎØ∏Î∞©Î¨∏ ÏÉÅÌÉúÎ°ú Î≥ÄÍ≤ΩÌïòÎ†§Î©¥ Ï¢ÖÎ£åÏùºÏãúÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî."}),P(!1);return}if(e&&!["ÏôÑÎ£å","Ï∑®ÏÜå","ÎØ∏Î∞©Î¨∏"].includes(I)){D({open:!0,text:"Ï¢ÖÎ£åÏùºÏãúÍ∞Ä ÏûÖÎ†•Îêú Í≤ΩÏö∞ ÏÉÅÌÉúÎäî ÏôÑÎ£å, Ï∑®ÏÜå, ÎØ∏Î∞©Î¨∏ Ï§ë ÌïòÎÇòÏó¨Ïïº Ìï©ÎãàÎã§."}),P(!1);return}const n=xt&&xt.trim()||L||j||"";if(!n||!B||!I){O("ÌïÑÏàò Ìï≠Î™©: ÌôúÎèôÏú†Ìòï, ÏÉÅÌÉú (Î°úÍ∑∏Ïù∏ ÌïÑÏöî)");return}P(!0);try{const s=u=>u?new Date(u).toISOString():void 0;let d=!1,a;if(l){const u=s(k),w=e?e.trim():"",r=s(w),T=w?r:"",x={subject:q||void 0,description:Y||void 0,activityStatus:I||void 0,activityType:B||void 0,channel:J||void 0,isAllDay:F,isPrivate:V,visibility:K,parentActivitySeq:yt?void 0:E?Number(E):void 0,plannedStartAt:u,actualStartAt:T},o=k?new Date(k).getTime():u?new Date(u).getTime():NaN,p=w?new Date(w).getTime():r?new Date(r).getTime():NaN;if(!isNaN(o)&&!isNaN(p)&&p<o){const N="Ï¢ÖÎ£åÏùºÏãúÎäî Í≥ÑÌöç ÏùºÏãúÎ≥¥Îã§ Ïª§Ïïº Ìï©ÎãàÎã§.";P(!1),O(N),X(N);return}const f=await fetch(`/api/v1/sales-activities/${l}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(x)}),v=await f.json().catch(()=>({}));if(!f.ok||v.error)throw new Error(v.error||`HTTP ${f.status}`);d=!0,a=l;try{const N=new URL("/api/v1/sales-activities",window.location.origin);L&&N.searchParams.set("assigneeId",L),j&&N.searchParams.set("empId",j),N.searchParams.set("mineOnly","true"),N.searchParams.set("_t",Date.now().toString());const $=await fetch(N.toString(),{cache:"no-cache"});if($.ok){const Wt=await $.json(),ht=Array.isArray(Wt)?Wt.find(Yt=>Yt.id===l):null;if(ht){const Ft=(Vt=>{if(!Vt)return"";const vt=new Date(Vt);if(isNaN(vt.getTime()))return"";const de=vt.getTimezoneOffset();return new Date(vt.getTime()-de*6e4).toISOString().slice(0,16)})(ht.actualStartAt||ht.actual_start_at);G(Ft),Tt(Ft)}}}catch(N){console.error("Failed to reload activity data:",N)}D({open:!0,text:"ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§."});try{window.dispatchEvent(new CustomEvent("tnt.sales.activity.updated",{detail:{id:a}}))}catch{}try{b&&b(a)}catch{}}else{const u=new Date().toISOString(),w=c&&Array.isArray(R)&&R.length>0?R:null;if(w){for(const r of w){const T=((r==null?void 0:r.customerName)||"").trim(),x=T?`${T} (ÌôúÎèôÍ≥ÑÌöç)`:q||void 0,o=r!=null&&r.customerId?String(r.customerId):(r==null?void 0:r.customerSeq)!=null?String(r.customerSeq):void 0;if(!o)continue;const p={sfOwnerId:n,subject:x,description:Y||void 0,isAllDay:F,isPrivate:V,visibility:K,channel:J,activityType:B,activityStatus:I,nextStep:Nt||void 0,nextStepDueAt:s(At),plannedStartAt:s(k),actualStartAt:s(e)||u,parentActivitySeq:E?Number(E):void 0,sfLeadId:S?String(S):void 0,sfAccountId:S?void 0:o,sfContactId:kt||void 0,sfOpportunityId:Ct||void 0,createdBy:j,updatedBy:j,createdAt:u,updatedAt:u},f=await fetch("/api/v1/sales-activities",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)}),v=await f.json().catch(()=>({}));if(!f.ok||v.error)throw new Error(v.error||`HTTP ${f.status}`);a=v.id;try{window.dispatchEvent(new CustomEvent("tnt.sales.activity.updated",{detail:{id:a}}))}catch{}}d=!0,D({open:!0,text:"Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§."});try{b&&b(a)}catch{}}else{const r=((y==null?void 0:y.name)||(m==null?void 0:m.customerName)||"").trim(),T=c&&r?`${r} (ÌôúÎèôÍ≥ÑÌöç)`:q||void 0,x=new Date().toISOString(),o=(y==null?void 0:y.id)??(m!=null&&m.customerId?String(m.customerId):void 0)??(z||void 0),p={sfOwnerId:n,subject:T,description:Y||void 0,isAllDay:F,isPrivate:V,visibility:K,channel:J,activityType:B,activityStatus:I,nextStep:Nt||void 0,nextStepDueAt:s(At),plannedStartAt:s(k),actualStartAt:s(e)||x,parentActivitySeq:E?Number(E):void 0,sfLeadId:S?String(S):void 0,sfAccountId:S?void 0:o||void 0,sfContactId:kt||void 0,sfOpportunityId:Ct||void 0,createdBy:j,updatedBy:j,createdAt:x,updatedAt:x},f=await fetch("/api/v1/sales-activities",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)}),v=await f.json().catch(()=>({}));if(!f.ok||v.error)throw new Error(v.error||`HTTP ${f.status}`);d=!0,a=v.id,D({open:!0,text:"Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§."});try{window.dispatchEvent(new CustomEvent("tnt.sales.activity.updated",{detail:{id:a}}))}catch{}try{b&&b(a)}catch{}}}ne(new Date),l||(nt(""),rt(""),Xt(""),Zt(""),Mt(!1))}catch(s){D({open:!0,text:s.message||"Ï†ÄÏû• Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§"})}finally{P(!1)}}const oe=async()=>{if(l){pt(!1),P(!0),O(null);try{const e=await fetch(`/api/v1/sales-activities/${l}`,{method:"DELETE"});if(!e.ok){const n=await e.json().catch(()=>({}));throw new Error(n.error||`HTTP ${e.status}`)}D({open:!0,text:"ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§."});try{window.dispatchEvent(new CustomEvent("tnt.sales.activity.updated",{detail:{id:l}}))}catch{}try{b&&b(void 0)}catch{}}catch(e){const n=e.message||"ÏÇ≠Ï†ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§";O(n),X(n)}finally{P(!1)}}};return t.jsxs("section",{children:[!h&&t.jsxs("div",{className:"page-title",children:[t.jsx("h2",{children:"ÏòÅÏóÖÌôúÎèô Îì±Î°ù"}),t.jsxs("div",{className:"meta",children:[t.jsx("span",{className:"badge",children:"Draft"}),t.jsxs("span",{className:"badge",children:["Last Saved: ",t.jsx("time",{children:Lt?Lt.toLocaleString():"‚Äî"})]})]})]}),!j&&t.jsx("div",{className:"error",style:{marginBottom:8},children:"Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§"}),t.jsxs("section",{className:h?void 0:c?"card plan-compact-card":"card",children:[t.jsxs("div",{className:c?"plan-compact":"form-grid",style:c?{display:"flex",flexDirection:"column",gap:6}:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px 16px"},children:[t.jsxs("div",{className:"field",style:{display:"grid",gridTemplateColumns:c?"90px 260px":"120px 1fr",gap:c?6:8,alignItems:"center",gridColumn:"1 / -1"},children:[t.jsx("label",{children:"Ï†úÎ™©"}),t.jsx(Kt,{value:q,onChange:_?void 0:nt,placeholder:"Ïòà: Í≥†Í∞ùÏÇ¨ Ï£ºÍ∞Ñ ÎØ∏ÌåÖ",readOnly:!!_})]}),!c&&t.jsxs("div",{className:"field",style:{display:"grid",gridTemplateColumns:"120px 1fr",gap:8,alignItems:"start",gridColumn:"1 / -1"},children:[t.jsx("label",{style:{paddingTop:8},children:"ÌôúÎèô ÏÑ§Î™Ö"}),t.jsx("textarea",{value:Y,onChange:e=>rt(e.target.value),placeholder:"ÌôúÎèô ÏÑ§Î™Ö ÏûÖÎ†•",rows:3})]}),t.jsxs("div",{className:"field",style:{display:"grid",gridTemplateColumns:c?"90px 260px":"120px 1fr",gap:c?6:8,alignItems:"center"},children:[t.jsx("label",{children:"ÌôúÎèôÏú†Ìòï *"}),t.jsx("select",{value:B,onChange:e=>{const n=e.target.value;jt(n);const s={Ï†ïÍ∏∞Î∞©Î¨∏:"Î∞©Î¨∏",ÏòÅÏóÖÍ∏∞Ìöå:"Î∞©Î¨∏",Ï±ÑÍ∂åÍ¥ÄÎ¶¨:"Ï†ÑÌôî"};s[n]&&it(s[n])},children:me.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))})]}),t.jsxs("div",{className:"field",style:{display:"grid",gridTemplateColumns:c?"90px 260px":"120px 1fr",gap:c?6:8,alignItems:"center"},children:[t.jsx("label",{children:"ÌôúÎèôÎ∞©Î≤ï"}),t.jsx("select",{value:J,onChange:e=>it(e.target.value),children:fe.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))})]}),t.jsxs("div",{className:"field",style:{display:"grid",gridTemplateColumns:c?"90px 260px":"120px 1fr",gap:c?6:8,alignItems:"center"},children:[t.jsx("label",{children:"ÏÉÅÌÉú *"}),t.jsx("select",{value:I,onChange:e=>wt(e.target.value),disabled:!!c,children:pe.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))})]}),!c&&t.jsxs("div",{className:"field",style:{display:"grid",gridTemplateColumns:"120px 1fr",gap:8,alignItems:"center"},children:[t.jsx("label",{children:"ÏÉÅÏúÑ ÌôúÎèô"}),t.jsxs("select",{value:E,onChange:e=>Dt(e.target.value),onFocus:()=>{try{tt()}catch{}},onClick:()=>{try{tt()}catch{}},disabled:yt,title:yt?"ÌïòÏúÑÌôúÎèôÏù¥ Ï°¥Ïû¨ÌïòÏó¨ ÏÉÅÏúÑÌôúÎèôÏùÑ Î≥ÄÍ≤ΩÌï† Ïàò ÏóÜÏäµÎãàÎã§":void 0,children:[t.jsx("option",{value:"",children:"ÏÑ†ÌÉù"}),ee.map(e=>{const n={site_visit:"Ï†ïÍ∏∞Î∞©Î¨∏",opportunity:"ÏòÅÏóÖÍ∏∞Ìöå",AR_mgmt:"Ï±ÑÍ∂åÍ¥ÄÎ¶¨",meeting:"ÎØ∏ÌåÖ",call:"Ï†ÑÌôî",email:"Ïù¥Î©îÏùº",demo:"Îç∞Î™®",task:"ÏóÖÎ¨¥",other:"Í∏∞ÌÉÄ"},s={scheduled:"Í≥ÑÌöç",completed:"ÏôÑÎ£å",canceled:"Ï∑®ÏÜå",postponed:"Ïó∞Í∏∞",no_show:"ÎØ∏Î∞©Î¨∏"},d=e.activityType?n[e.activityType]||e.activityType:"",a=e.activityStatus?s[e.activityStatus]||e.activityStatus:"",u=`${e.subject||""}${d||a?` ¬∑ ${d}${d&&a?" / ":""}${a}`:""}`;return t.jsx("option",{value:e.id,children:u},e.id)})]})]}),t.jsxs("div",{className:"field",style:{display:"grid",gridTemplateColumns:c?"90px 260px":"120px 1fr",gap:c?6:8,alignItems:"center"},children:[t.jsx("label",{children:"Í≥ÑÌöç ÏùºÏãú"}),t.jsxs("div",{className:"datetime-wrapper",children:[t.jsx("input",{type:"datetime-local",className:k?"":"empty",value:k,onChange:e=>Q(e.target.value),autoComplete:"off",disabled:!!c,title:c?"Îã¨Î†•ÏóêÏÑú ÏÑ†ÌÉùÎêú ÏùºÏãúÎ°ú ÏÑ§Ï†ïÎê©ÎãàÎã§":void 0}),!k&&t.jsx("span",{className:"datetime-placeholder",children:"YYYY-MM-DD HH:MM"})]})]}),!c&&t.jsxs("div",{className:"field",style:{display:"grid",gridTemplateColumns:"120px 1fr",gap:8,alignItems:"center"},children:[t.jsx("label",{children:"Ï¢ÖÎ£å ÏùºÏãú"}),t.jsxs("div",{className:"datetime-wrapper",children:[t.jsx("input",{type:"datetime-local",className:C?"":"empty",value:C,onChange:e=>G(e.target.value),autoComplete:"off"}),!C&&t.jsx("span",{className:"datetime-placeholder",children:"YYYY-MM-DD HH:MM"})]})]}),te,!c&&!S&&t.jsx(t.Fragment,{children:t.jsxs("div",{className:"field",style:{display:"grid",gridTemplateColumns:"120px 1fr",gap:8,alignItems:"center",gridColumn:"1 / -1"},children:[t.jsx("label",{children:"Í±∞ÎûòÏ≤ò"}),t.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[t.jsx(Kt,{value:y?y.name||y.id||"":m?m.customerName||String(m.customerId||""):z||"",onChange:y||m?void 0:lt,placeholder:"Í±∞ÎûòÏ≤òÎ™Ö ÎòêÎäî ID",readOnly:!!y||!!m||!!l,style:{flex:"1 1 auto"}}),!l&&t.jsx("button",{className:"btn secondary",style:{height:30,padding:"0 10px"},onClick:()=>{U(!0)},title:"Í±∞ÎûòÏ≤ò Í≤ÄÏÉâ",children:"üîç"})]})]})}),!c&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"field",style:{display:"grid",gridTemplateColumns:"120px 1fr",gap:8,alignItems:"center"},children:[t.jsx("label",{children:"Ï¢ÖÏùº / ÎπÑÍ≥µÍ∞ú"}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:16},children:[t.jsxs("label",{className:"muted",style:{display:"inline-flex",alignItems:"center",gap:8},children:[t.jsx("input",{className:"checkbox-accent",type:"checkbox",checked:F,onChange:e=>Qt(e.target.checked)}),t.jsx("span",{children:"Ï¢ÖÏùº"})]}),t.jsxs("label",{className:"muted",style:{display:"inline-flex",alignItems:"center",gap:8},children:[t.jsx("input",{className:"checkbox-accent",type:"checkbox",checked:V,onChange:e=>Gt(e.target.checked)}),t.jsx("span",{children:"ÎπÑÍ≥µÍ∞ú"})]})]})]}),t.jsxs("div",{className:"field",style:{display:"grid",gridTemplateColumns:"120px 1fr",gap:8,alignItems:"center"},children:[t.jsx("label",{children:"Í∞ÄÏãúÏÑ±"}),t.jsx("select",{value:K,onChange:e=>bt(e.target.value),children:ge.map(e=>t.jsx("option",{value:e,children:e},e))})]})]})]}),Et&&t.jsx("div",{className:"error",style:{marginBottom:8},children:Et}),t.jsxs("div",{className:"controls",style:{display:"flex",gap:8},children:[t.jsx("button",{className:"btn",onClick:le,disabled:mt||!j,children:mt?l?"ÏàòÏ†ï Ï§ë‚Ä¶":"Ï†ÄÏû• Ï§ë‚Ä¶":l?"ÏàòÏ†ï":"Ï†ÄÏû•"}),l&&t.jsx("button",{className:"btn",onClick:()=>pt(!0),disabled:mt,style:{background:"#dc2626",borderColor:"#dc2626"},children:"ÏÇ≠Ï†ú"})]})]}),Pt.open?t.jsx("div",{role:"dialog","aria-modal":"true",className:"card",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.45)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:70},children:t.jsxs("div",{className:"card",style:{background:"var(--panel)",padding:12,border:"1px solid var(--border)",borderRadius:10,minWidth:260,maxWidth:"86vw"},children:[t.jsx("div",{style:{marginBottom:8,fontWeight:700,textAlign:"center"},children:Pt.text}),t.jsx("div",{style:{display:"flex",justifyContent:"center"},children:t.jsx("button",{className:"btn btn-card btn-3d",onClick:()=>{D({open:!1,text:""})},children:"ÌôïÏù∏"})})]})}):null,Ot?t.jsx("div",{role:"dialog","aria-modal":"true",className:"card",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.3)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:70},children:t.jsxs("div",{className:"card",style:{background:"var(--panel)",padding:12,border:"1px solid var(--border)",borderRadius:10,minWidth:260,maxWidth:"86vw"},children:[t.jsx("div",{style:{marginBottom:8,fontWeight:700,textAlign:"center",color:"#b91c1c"},children:Ot}),t.jsx("div",{style:{display:"flex",justifyContent:"center"},children:t.jsx("button",{className:"btn btn-card btn-3d",onClick:()=>{X(null),O(null)},children:"ÌôïÏù∏"})})]})}):null,ae?t.jsx("div",{role:"dialog","aria-modal":"true",className:"card",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.45)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:70},children:t.jsxs("div",{className:"card",style:{background:"var(--panel)",padding:12,border:"1px solid var(--border)",borderRadius:10,minWidth:260,maxWidth:"86vw"},children:[t.jsx("div",{style:{marginBottom:8,fontWeight:700,textAlign:"center"},children:"Ïù¥ ÌôúÎèôÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?"}),t.jsx("div",{style:{marginBottom:12,fontSize:13,textAlign:"center",color:"#6b7280"},children:"ÏÇ≠Ï†úÎêú Îç∞Ïù¥ÌÑ∞Îäî Î≥µÍµ¨Ìï† Ïàò ÏóÜÏäµÎãàÎã§."}),t.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:8},children:[t.jsx("button",{className:"btn btn-card btn-3d",onClick:()=>pt(!1),style:{background:"#6b7280",borderColor:"#6b7280"},children:"Ï∑®ÏÜå"}),t.jsx("button",{className:"btn btn-card btn-3d",onClick:oe,style:{background:"#dc2626",borderColor:"#dc2626"},children:"ÏÇ≠Ï†ú"})]})]})}):null,H&&!l?t.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.45)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:80},onClick:()=>U(!1),children:t.jsxs("div",{className:"card",style:{background:"var(--panel)",padding:16,border:"1px solid var(--border)",borderRadius:12,boxShadow:"0 8px 32px rgba(0,0,0,.2)",width:"min(720px, 92vw)",maxHeight:"80vh",overflow:"auto"},onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:12},children:[t.jsx("h3",{style:{margin:0,fontSize:16,fontWeight:700},children:"Í±∞ÎûòÏ≤ò ÏÑ†ÌÉù"}),t.jsx("button",{onClick:()=>U(!1),style:{width:32,height:32,display:"flex",alignItems:"center",justifyContent:"center",background:"transparent",border:"none",borderRadius:4,cursor:"pointer",color:"var(--muted)",fontSize:20,transition:"all 0.2s"},onMouseEnter:e=>{e.currentTarget.style.background="var(--panel-2)",e.currentTarget.style.color="var(--text)"},onMouseLeave:e=>{e.currentTarget.style.background="transparent",e.currentTarget.style.color="var(--muted)"},title:"Îã´Í∏∞ (ESC)","aria-label":"Îã´Í∏∞",children:"√ó"})]}),t.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:8},children:[t.jsx("input",{className:"search-input",value:Z,onChange:e=>re(e.target.value),onKeyDown:e=>{e.key==="Enter"&&st()},placeholder:"Í±∞ÎûòÏ≤òÎ™Ö",style:{flex:"1 1 auto",background:"#fff",border:"1px solid var(--border)"}}),t.jsx("button",{className:"btn",style:{height:30,padding:"0 12px"},onClick:st,disabled:ft,children:ft?"Ï°∞ÌöåÏ§ë...":"Ï°∞Ìöå"})]}),Rt&&t.jsx("div",{className:"error",style:{marginBottom:8},children:Rt}),t.jsx("div",{className:"table-container",style:{maxHeight:"50vh"},children:qt.length===0&&!ft?t.jsx("div",{className:"empty-state",children:"Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§."}):t.jsxs("table",{className:"table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{style:{width:60,textAlign:"center"},children:"Íµ¨Î∂Ñ"}),t.jsx("th",{children:"Í±∞ÎûòÏ≤òÎ™Ö"}),t.jsx("th",{style:{width:140},children:"ÎåÄÌëúÏûêÎ™Ö"}),t.jsx("th",{style:{width:60,textAlign:"center"}})]})}),t.jsx("tbody",{children:qt.map((e,n)=>{const s=(e.companyType||"").toString().trim().toUpperCase(),d=s.includes("TNT"),a=s.includes("DYS"),u=d?"T":a?"D":(e.companyType||"Í±∞")[0],w=d?"#1d4ed8":a?"#059669":"#6b7280";return t.jsxs("tr",{children:[t.jsx("td",{style:{textAlign:"center"},children:t.jsx("span",{title:e.companyType||"",style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:24,height:24,borderRadius:"50%",background:w,color:"#fff",fontSize:12,fontWeight:700},children:u})}),t.jsx("td",{children:e.customerName||""}),t.jsx("td",{children:e.ownerName||""}),t.jsx("td",{style:{textAlign:"center"},children:t.jsx("button",{style:{width:32,height:32,display:"inline-flex",alignItems:"center",justifyContent:"center",background:"transparent",border:"1px solid var(--border)",borderRadius:6,cursor:"pointer",color:"var(--text)",transition:"all 0.2s"},onMouseEnter:r=>{r.currentTarget.style.background="var(--accent)",r.currentTarget.style.borderColor="var(--accent)",r.currentTarget.style.color="#fff"},onMouseLeave:r=>{r.currentTarget.style.background="transparent",r.currentTarget.style.borderColor="var(--border)",r.currentTarget.style.color="var(--text)"},onClick:()=>{const r=e.customerId?String(e.customerId):"";ot({id:r,name:e.customerName||""}),St({customerId:r,customerName:e.customerName}),lt(r),U(!1)},title:"ÏÑ†ÌÉù","aria-label":"ÏÑ†ÌÉù",children:t.jsx(ue,{size:18})})})]},n)})})]})})]})}):null]})}function ye(h){return new Date(h.getFullYear(),h.getMonth(),h.getDate())}function ke(h=0,g){const b=ye(new Date),_=(b.getDay()-1+7)%7,c=new Date(b);c.setDate(b.getDate()-_+h*7);const R=new Date(c);return R.setDate(c.getDate()+6),{start:c,end:R}}function Jt(h){const g=h.getFullYear(),l=String(h.getMonth()+1).padStart(2,"0"),S=String(h.getDate()).padStart(2,"0");return`${g}-${l}-${S}`}function Ce(h){return`${Jt(h.start)} ~ ${Jt(h.end)}`}export{Kt as S,Ie as a,Ce as f,ke as g};
