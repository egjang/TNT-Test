import{r as u,j as e,F as V,R as se,d as ie}from"./index-BB_3LKiY.js";import{S as J}from"./search-DWsQZhhE.js";import{P as ne}from"./plus-NPOo4Ump.js";import{L as _}from"./loader-circle-Cdx_3rgK.js";import{A as G}from"./arrow-left-DNYSmVoh.js";import{T as $}from"./trash-2-YQlpFIkM.js";import{T as oe}from"./triangle-alert-D2LzuWlc.js";import{S as de}from"./save-CHvqRpOx.js";import{C as le}from"./copy-DO6QvMZG.js";import{M as ae}from"./message-square-DaNp9p04.js";import{P as F,L as ce}from"./pen-line-CEzorJh1.js";import{S as xe,E as pe}from"./send-RHemNrO9.js";import{U as he}from"./user-C1JnWx0K.js";import{C as ye}from"./clock-DmAeCGI0.js";const K={DRAFT:{bg:"var(--bg-secondary)",color:"var(--text-secondary)",label:"작성중"},REQ_APPROVAL:{bg:"var(--warning-bg)",color:"var(--warning)",label:"승인요청"},APPROVED:{bg:"var(--info-bg)",color:"var(--info)",label:"승인완료"},NEGOTIATION:{bg:"var(--primary-bg)",color:"var(--primary)",label:"협의중"},CONFIRMED:{bg:"var(--success-bg)",color:"var(--success)",label:"확정"},REJECTED:{bg:"var(--error-bg)",color:"var(--error)",label:"반려"}},U={TNT_DOUBLE:"TNT 복층",TNT_MAT:"TNT 자재",DYS_SEALANT:"DYS 실란트"},M={TNT:"TNT",DYS:"동양"},H={AUTO:"자동승인",TIER_AB:"A/B티어 승인",LOSS:"손실 승인"},N=t=>t==null?"-":new Intl.NumberFormat("ko-KR").format(t)+"원",O=t=>t==null?"-":t.toFixed(1)+"%",D="/api/v1/quotes";async function ge(t){const c=new URLSearchParams;t.startDate&&c.append("startDate",t.startDate),t.endDate&&c.append("endDate",t.endDate),t.quoteStatus&&c.append("status",t.quoteStatus),(t.quoteName||t.quoteId)&&c.append("keyword",t.quoteName||t.quoteId||""),t.accountId&&c.append("customer",t.accountId);const l=await fetch(`${D}?${c}`);if(!l.ok)throw new Error("Failed to fetch quotes");return l.json()}async function me(t){const c=await fetch(`${D}/${t}`);if(!c.ok)throw new Error("Failed to fetch quote");return c.json()}async function ue(t){const c=await fetch(D,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!c.ok)throw new Error("Failed to create quote");return c.json()}async function ve(t,c){const l=await fetch(`${D}/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(!l.ok)throw new Error("Failed to update quote");return l.json()}async function fe(t="TNT",c){const l=new URLSearchParams({companyType:t}),x=await fetch(`${D}/master/customers?${l}`);if(!x.ok)throw new Error("Failed to fetch customers");return x.json()}async function je(t="TNT",c){const l=new URLSearchParams({companyType:t}),x=await fetch(`${D}/master/items?${l}`);if(!x.ok)throw new Error("Failed to fetch items");return x.json()}async function be(t="TNT",c){const l=new URLSearchParams({companyType:t}),x=await fetch(`${D}/master/projects?${l}`);if(!x.ok)throw new Error("Failed to fetch projects");return x.json()}function Se({onCreate:t,onView:c}){const[l,x]=u.useState({}),[j,s]=u.useState(1),[b,h]=u.useState([]),[z,k]=u.useState(!1),[y,T]=u.useState(null),v=10,C=u.useCallback(async()=>{k(!0),T(null);try{const n=await ge(l);h(n)}catch(n){T("견적 목록을 불러오는데 실패했습니다."),console.error("Failed to fetch quotes:",n)}finally{k(!1)}},[l]);u.useEffect(()=>{C()},[]);const R=b.length,A=Math.ceil(R/v)||1,E=b.slice((j-1)*v,j*v),I=()=>{x({}),s(1)},d=()=>{s(1),C()};return e.jsxs("div",{style:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{padding:16,borderBottom:"1px solid var(--border)",background:"var(--bg-secondary)"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:12,marginBottom:12},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:12,marginBottom:4,color:"var(--text-secondary)"},children:"회사구분"}),e.jsxs("select",{className:"input",style:{width:"100%"},value:l.companyType||"",onChange:n=>x({...l,companyType:n.target.value||void 0}),children:[e.jsx("option",{value:"",children:"전체"}),e.jsx("option",{value:"TNT",children:"TNT"}),e.jsx("option",{value:"DYS",children:"동양"})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:12,marginBottom:4,color:"var(--text-secondary)"},children:"견적상태"}),e.jsxs("select",{className:"input",style:{width:"100%"},value:l.quoteStatus||"",onChange:n=>x({...l,quoteStatus:n.target.value||void 0}),children:[e.jsx("option",{value:"",children:"전체"}),e.jsx("option",{value:"DRAFT",children:"작성중"}),e.jsx("option",{value:"REQ_APPROVAL",children:"승인요청"}),e.jsx("option",{value:"APPROVED",children:"승인완료"}),e.jsx("option",{value:"NEGOTIATION",children:"협의중"}),e.jsx("option",{value:"CONFIRMED",children:"확정"}),e.jsx("option",{value:"REJECTED",children:"반려"})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:12,marginBottom:4,color:"var(--text-secondary)"},children:"레코드유형"}),e.jsxs("select",{className:"input",style:{width:"100%"},value:l.recordType||"",onChange:n=>x({...l,recordType:n.target.value||void 0}),children:[e.jsx("option",{value:"",children:"전체"}),e.jsx("option",{value:"TNT_DOUBLE",children:"TNT 복층"}),e.jsx("option",{value:"TNT_MAT",children:"TNT 자재"}),e.jsx("option",{value:"DYS_SEALANT",children:"DYS 실란트"})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:12,marginBottom:4,color:"var(--text-secondary)"},children:"견적명"}),e.jsx("input",{type:"text",className:"input",placeholder:"견적명 검색",style:{width:"100%"},value:l.quoteName||"",onChange:n=>x({...l,quoteName:n.target.value||void 0})})]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8},children:[e.jsx("button",{className:"btn btn-secondary",onClick:I,children:"초기화"}),e.jsxs("button",{className:"btn btn-primary",onClick:d,children:[e.jsx(J,{size:14,style:{marginRight:4}}),"검색"]})]})]}),e.jsxs("div",{style:{padding:"12px 16px",borderBottom:"1px solid var(--border)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{fontSize:13,color:"var(--text-secondary)"},children:["총 ",e.jsx("strong",{style:{color:"var(--text-primary)"},children:R}),"건"]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{className:"btn btn-secondary",children:"Excel"}),e.jsxs("button",{className:"btn btn-primary",onClick:t,children:[e.jsx(ne,{size:14,style:{marginRight:4}}),"견적 작성"]})]})]}),e.jsxs("div",{className:"card",style:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column",borderRadius:0,border:"none"},children:[e.jsx("div",{style:{overflow:"auto",flex:1},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:13},children:[e.jsx("thead",{style:{position:"sticky",top:0,background:"var(--panel)",zIndex:1},children:e.jsxs("tr",{style:{background:"var(--bg-secondary)"},children:[e.jsx("th",{style:{padding:"10px 12px",textAlign:"center",borderBottom:"1px solid var(--border)",width:40},children:e.jsx("input",{type:"checkbox"})}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"left",borderBottom:"1px solid var(--border)"},children:"견적번호"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"center",borderBottom:"1px solid var(--border)",width:60},children:"회사"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"center",borderBottom:"1px solid var(--border)"},children:"상태"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"left",borderBottom:"1px solid var(--border)"},children:"견적명"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"left",borderBottom:"1px solid var(--border)"},children:"거래처"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"left",borderBottom:"1px solid var(--border)"},children:"프로젝트"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"left",borderBottom:"1px solid var(--border)",width:100},children:"구분"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"right",borderBottom:"1px solid var(--border)"},children:"총 견적금액"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"right",borderBottom:"1px solid var(--border)",width:80},children:"이익률"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"center",borderBottom:"1px solid var(--border)",width:100},children:"등록일"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"center",borderBottom:"1px solid var(--border)",width:80},children:"담당자"})]})}),e.jsxs("tbody",{children:[E.map(n=>{const B=K[n.quoteStatus];return e.jsxs("tr",{style:{cursor:"pointer"},onClick:()=>c(n.quoteId),onMouseEnter:w=>w.currentTarget.style.background="var(--bg-secondary)",onMouseLeave:w=>w.currentTarget.style.background="transparent",children:[e.jsx("td",{style:{padding:"10px 12px",textAlign:"center",borderBottom:"1px solid var(--border)"},onClick:w=>w.stopPropagation(),children:e.jsx("input",{type:"checkbox"})}),e.jsx("td",{style:{padding:"10px 12px",borderBottom:"1px solid var(--border)",fontVariantNumeric:"tabular-nums",color:"var(--primary)",fontWeight:500},children:n.quoteId}),e.jsx("td",{style:{padding:"10px 12px",textAlign:"center",borderBottom:"1px solid var(--border)"},children:e.jsx("span",{style:{padding:"2px 6px",borderRadius:4,fontSize:11,background:n.companyType==="TNT"?"var(--primary-bg)":"var(--warning-bg)",color:n.companyType==="TNT"?"var(--primary)":"var(--warning)"},children:M[n.companyType]})}),e.jsx("td",{style:{padding:"10px 12px",textAlign:"center",borderBottom:"1px solid var(--border)"},children:e.jsx("span",{className:"badge",style:{background:B.bg,color:B.color},children:B.label})}),e.jsx("td",{style:{padding:"10px 12px",borderBottom:"1px solid var(--border)",fontWeight:500},children:n.quoteName}),e.jsx("td",{style:{padding:"10px 12px",borderBottom:"1px solid var(--border)"},children:n.accountNames||"-"}),e.jsx("td",{style:{padding:"10px 12px",borderBottom:"1px solid var(--border)",color:"var(--text-secondary)"},children:n.projectName||"-"}),e.jsx("td",{style:{padding:"10px 12px",borderBottom:"1px solid var(--border)",color:"var(--text-secondary)"},children:U[n.recordType]}),e.jsx("td",{style:{padding:"10px 12px",borderBottom:"1px solid var(--border)",textAlign:"right",fontWeight:600,fontVariantNumeric:"tabular-nums"},children:N(n.totalAmount)}),e.jsx("td",{style:{padding:"10px 12px",borderBottom:"1px solid var(--border)",textAlign:"right",fontVariantNumeric:"tabular-nums"},children:e.jsx("span",{style:{color:(n.expectedProfitRate||0)>=15?"var(--success)":(n.expectedProfitRate||0)<5?"var(--error)":"inherit"},children:O(n.expectedProfitRate)})}),e.jsx("td",{style:{padding:"10px 12px",borderBottom:"1px solid var(--border)",textAlign:"center",color:"var(--text-secondary)"},children:n.createdAt}),e.jsx("td",{style:{padding:"10px 12px",borderBottom:"1px solid var(--border)",textAlign:"center"},children:n.assigneeName||"-"})]},n.id)}),z&&e.jsx("tr",{children:e.jsxs("td",{colSpan:12,style:{padding:40,textAlign:"center",color:"var(--text-secondary)"},children:[e.jsx(_,{size:24,style:{animation:"spin 1s linear infinite",display:"inline-block"}}),e.jsx("div",{style:{marginTop:8},children:"로딩 중..."})]})}),!z&&y&&e.jsx("tr",{children:e.jsx("td",{colSpan:12,style:{padding:40,textAlign:"center",color:"var(--error)"},children:y})}),!z&&!y&&E.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:12,style:{padding:40,textAlign:"center",color:"var(--text-secondary)"},children:"검색 결과가 없습니다."})})]})]})}),e.jsxs("div",{style:{padding:"12px 16px",borderTop:"1px solid var(--border)",display:"flex",justifyContent:"center",alignItems:"center",gap:4},children:[e.jsx("button",{className:"btn btn-ghost",style:{padding:"4px 8px",minWidth:32},disabled:j===1,onClick:()=>s(1),children:"«"}),e.jsx("button",{className:"btn btn-ghost",style:{padding:"4px 8px",minWidth:32},disabled:j===1,onClick:()=>s(n=>Math.max(1,n-1)),children:"‹"}),Array.from({length:Math.min(5,A)},(n,B)=>{const w=Math.max(1,Math.min(j-2,A-4))+B;return w>A?null:e.jsx("button",{className:`btn ${j===w?"btn-primary":"btn-ghost"}`,style:{padding:"4px 8px",minWidth:32},onClick:()=>s(w),children:w},w)}),e.jsx("button",{className:"btn btn-ghost",style:{padding:"4px 8px",minWidth:32},disabled:j===A,onClick:()=>s(n=>Math.min(A,n+1)),children:"›"}),e.jsx("button",{className:"btn btn-ghost",style:{padding:"4px 8px",minWidth:32},disabled:j===A,onClick:()=>s(A),children:"»"})]})]})]})}function Y({quoteId:t,onCancel:c,onSuccess:l}){const[x,j]=u.useState(1),[s,b]=u.useState({companyType:"TNT",recordType:"TNT_DOUBLE",quoteName:"",customers:[],assigneeId:"user001"}),[h,z]=u.useState(""),[k,y]=u.useState(null),[T,v]=u.useState([]),[C,R]=u.useState([]),[A,E]=u.useState([]),[I,d]=u.useState(!1),[n,B]=u.useState(!1);u.useEffect(()=>{(async()=>{d(!0);try{const p=s.companyType||"TNT",[r,a,m]=await Promise.all([fe(p),je(p),be(p)]);v(r),R(a),E(m)}catch(p){console.error("Failed to load master data:",p)}finally{d(!1)}})()},[s.companyType]),u.useEffect(()=>{t&&(async()=>{try{const p=await me(t);b(p)}catch(p){console.error("Failed to load quote:",p)}})()},[t]);const w=async()=>{B(!0);try{t?await ve(t,s):await ue(s),l()}catch(i){console.error("Failed to save quote:",i),alert("견적 저장에 실패했습니다.")}finally{B(!1)}},X=()=>{var i,p;return e.jsxs("div",{className:"card",style:{padding:24,maxWidth:800,margin:"0 auto"},children:[e.jsx("h3",{style:{fontSize:18,fontWeight:600,marginBottom:24},children:"1. 기본 정보 입력"}),e.jsxs("div",{style:{display:"grid",gap:20},children:[e.jsxs("div",{children:[e.jsxs("label",{style:{display:"block",marginBottom:8,fontWeight:500,fontSize:13},children:["회사구분 ",e.jsx("span",{style:{color:"var(--error)"},children:"*"})]}),e.jsx("div",{style:{display:"flex",gap:16},children:["TNT","DYS"].map(r=>e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer"},children:[e.jsx("input",{type:"radio",name:"companyType",checked:s.companyType===r,onChange:()=>b({...s,companyType:r}),style:{accentColor:"var(--primary)"}}),M[r]]},r))})]}),e.jsxs("div",{children:[e.jsxs("label",{style:{display:"block",marginBottom:8,fontWeight:500,fontSize:13},children:["레코드 유형 ",e.jsx("span",{style:{color:"var(--error)"},children:"*"})]}),e.jsx("div",{style:{display:"flex",gap:16},children:["TNT_DOUBLE","TNT_MAT","DYS_SEALANT"].map(r=>e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer"},children:[e.jsx("input",{type:"radio",name:"recordType",checked:s.recordType===r,onChange:()=>b({...s,recordType:r}),style:{accentColor:"var(--primary)"}}),U[r]]},r))})]}),e.jsxs("div",{children:[e.jsxs("label",{style:{display:"block",marginBottom:8,fontWeight:500,fontSize:13},children:["견적명 ",e.jsx("span",{style:{color:"var(--error)"},children:"*"})]}),e.jsx("input",{type:"text",className:"input",value:s.quoteName||"",onChange:r=>b({...s,quoteName:r.target.value}),placeholder:"견적명 입력",style:{width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:8,fontWeight:500,fontSize:13},children:"프로젝트"}),e.jsxs("select",{className:"input",style:{width:"100%"},value:s.projectId||"",onChange:r=>b({...s,projectId:r.target.value||void 0}),disabled:I,children:[e.jsx("option",{value:"",children:I?"로딩 중...":"프로젝트 선택 (선택사항)"}),A.map(r=>e.jsx("option",{value:r.projectId,children:r.projectName},r.projectId))]})]}),e.jsxs("div",{children:[e.jsxs("label",{style:{display:"block",marginBottom:8,fontWeight:500,fontSize:13},children:["거래처 ",e.jsx("span",{style:{color:"var(--error)"},children:"*"})]}),e.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginBottom:8},children:(i=s.customers)==null?void 0:i.map(r=>e.jsxs("span",{style:{padding:"4px 8px",background:"var(--primary-bg)",color:"var(--primary)",borderRadius:4,fontSize:12,display:"flex",alignItems:"center",gap:4},children:[r.accountName,e.jsx("button",{onClick:()=>{var a;return b({...s,customers:(a=s.customers)==null?void 0:a.filter(m=>m.accountId!==r.accountId)})},style:{background:"none",border:"none",cursor:"pointer",padding:0},children:e.jsx($,{size:12})})]},r.accountId))}),e.jsxs("select",{className:"input",style:{width:"100%"},disabled:I,onChange:r=>{var m;const a=T.find(f=>f.customerId===r.target.value);if(a&&!((m=s.customers)!=null&&m.find(f=>f.accountId===a.customerId))){const f={id:Date.now(),quoteId:"",accountId:a.customerId,accountName:a.customerName,items:[],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};b({...s,customers:[...s.customers||[],f]})}r.target.value=""},children:[e.jsx("option",{value:"",children:I?"로딩 중...":"거래처 추가..."}),T.filter(r=>{var a;return!((a=s.customers)!=null&&a.find(m=>m.accountId===r.customerId))}).map(r=>e.jsxs("option",{value:r.customerId,children:[r.customerName," ",r.region?`(${r.region})`:""]},r.customerId))]})]})]}),e.jsxs("div",{style:{marginTop:32,display:"flex",justifyContent:"flex-end",gap:8},children:[e.jsx("button",{className:"btn btn-secondary",onClick:c,children:"취소"}),e.jsx("button",{className:"btn btn-primary",onClick:()=>j(2),disabled:!s.quoteName||!((p=s.customers)!=null&&p.length),children:"다음: 품목 선택"})]})]})},Z=(i,p)=>{var o;const r=i.listPrice||0,a=r*.8,m={id:Date.now(),itemId:`ITEM-${Date.now()}`,quoteCustomerId:p.id,itemNo:i.itemNo,itemName:i.itemName,quantity:1,unitPrice:r,refTier:"B",refCost:a,amount:r,rowProfitRate:r>0?(r-a)/r*100:0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},f=(o=s.customers)==null?void 0:o.map(S=>S.id===p.id?{...S,items:[...S.items||[],m]}:S);b({...s,customers:f})},Q=(i,p,r,a)=>{var f;const m=(f=s.customers)==null?void 0:f.map(o=>{if(o.id===i){const S=[...o.items||[]],g={...S[p],[r]:a};return(r==="quantity"||r==="unitPrice")&&(g.amount=g.quantity*g.unitPrice,g.rowProfitRate=g.refCost?(g.unitPrice-g.refCost)/g.unitPrice*100:0),S[p]=g,{...o,items:S}}return o});b({...s,customers:m})},ee=(i,p)=>{var a;const r=(a=s.customers)==null?void 0:a.map(m=>{if(m.id===i){const f=[...m.items||[]];return f.splice(p,1),{...m,items:f}}return m});b({...s,customers:r})},te=()=>{var p,r,a,m,f;const i=k||((p=s.customers)==null?void 0:p[0]);return e.jsxs("div",{style:{display:"flex",gap:24,height:"100%"},children:[e.jsxs("div",{className:"card",style:{width:280,display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{padding:16,borderBottom:"1px solid var(--border)"},children:[e.jsx("h4",{style:{margin:0,marginBottom:12,fontSize:14},children:"품목 검색"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx(J,{size:16,style:{position:"absolute",left:12,top:"50%",transform:"translateY(-50%)",color:"var(--muted)"}}),e.jsx("input",{type:"text",className:"input",placeholder:"품목명/코드",value:h,onChange:o=>z(o.target.value),style:{width:"100%",paddingLeft:36}})]})]}),e.jsx("div",{style:{flex:1,overflow:"auto",padding:8},children:I?e.jsxs("div",{style:{padding:24,textAlign:"center",color:"var(--text-secondary)"},children:[e.jsx(_,{size:20,style:{animation:"spin 1s linear infinite"}}),e.jsx("div",{style:{marginTop:8},children:"품목 로딩 중..."})]}):C.filter(o=>(o.itemName||"").includes(h)||o.itemNo.includes(h)).map(o=>e.jsxs("div",{style:{padding:12,borderBottom:"1px solid var(--border)",cursor:"pointer"},onClick:()=>i&&Z(o,i),children:[e.jsx("div",{style:{fontWeight:600,fontSize:13},children:o.itemName}),e.jsxs("div",{style:{fontSize:12,color:"var(--text-secondary)",display:"flex",justifyContent:"space-between",marginTop:4},children:[e.jsx("span",{children:o.itemNo}),e.jsxs("span",{children:[(o.listPrice||0).toLocaleString(),"원"]})]}),e.jsxs("div",{style:{fontSize:11,color:"var(--text-secondary)",marginTop:2},children:[o.category||"-"," / ",o.unit||"-"]})]},o.itemNo))})]}),e.jsxs("div",{className:"card",style:{flex:1,display:"flex",flexDirection:"column"},children:[e.jsx("div",{style:{borderBottom:"1px solid var(--border)",padding:"0 16px"},children:e.jsx("div",{style:{display:"flex",gap:0},children:(r=s.customers)==null?void 0:r.map(o=>{var S;return e.jsxs("button",{onClick:()=>y(o),style:{padding:"12px 20px",background:"none",border:"none",borderBottom:(i==null?void 0:i.id)===o.id?"2px solid var(--primary)":"2px solid transparent",color:(i==null?void 0:i.id)===o.id?"var(--primary)":"var(--text-secondary)",fontWeight:(i==null?void 0:i.id)===o.id?600:400,cursor:"pointer",fontSize:13},children:[o.accountName," (",((S=o.items)==null?void 0:S.length)||0,")"]},o.id)})})}),e.jsxs("div",{style:{padding:"12px 16px",borderBottom:"1px solid var(--border)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{fontSize:13,color:"var(--text-secondary)"},children:["선택된 품목: ",e.jsx("strong",{style:{color:"var(--text-primary)"},children:((a=i==null?void 0:i.items)==null?void 0:a.length)||0}),"건"]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>j(1),children:"이전"}),e.jsx("button",{className:"btn btn-primary",onClick:()=>j(3),children:"다음: 검토 및 저장"})]})]}),e.jsx("div",{style:{flex:1,overflow:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:13},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"var(--bg-secondary)"},children:[e.jsx("th",{style:{padding:10,textAlign:"left"},children:"품목명"}),e.jsx("th",{style:{padding:10,textAlign:"center",width:60},children:"티어"}),e.jsx("th",{style:{padding:10,textAlign:"right",width:80},children:"수량"}),e.jsx("th",{style:{padding:10,textAlign:"right",width:120},children:"단가"}),e.jsx("th",{style:{padding:10,textAlign:"right",width:100},children:"참조원가"}),e.jsx("th",{style:{padding:10,textAlign:"right",width:120},children:"금액"}),e.jsx("th",{style:{padding:10,textAlign:"right",width:70},children:"이익률"}),e.jsx("th",{style:{padding:10,width:50}})]})}),e.jsxs("tbody",{children:[(m=i==null?void 0:i.items)==null?void 0:m.map((o,S)=>e.jsxs("tr",{children:[e.jsxs("td",{style:{padding:10,borderBottom:"1px solid var(--border)"},children:[e.jsx("div",{children:o.itemName}),e.jsx("div",{style:{fontSize:11,color:"var(--text-secondary)"},children:o.itemNo})]}),e.jsx("td",{style:{padding:10,borderBottom:"1px solid var(--border)",textAlign:"center"},children:e.jsx("span",{style:{padding:"2px 8px",borderRadius:4,fontSize:11,background:o.refTier==="A"?"var(--success-bg)":o.refTier==="B"?"var(--info-bg)":"var(--bg-secondary)",color:o.refTier==="A"?"var(--success)":o.refTier==="B"?"var(--info)":"var(--text-secondary)"},children:o.refTier})}),e.jsx("td",{style:{padding:10,borderBottom:"1px solid var(--border)"},children:e.jsx("input",{type:"number",className:"input",value:o.quantity,onChange:g=>Q(i.id,S,"quantity",Number(g.target.value)),style:{width:"100%",textAlign:"right"}})}),e.jsx("td",{style:{padding:10,borderBottom:"1px solid var(--border)"},children:e.jsx("input",{type:"number",className:"input",value:o.unitPrice,onChange:g=>Q(i.id,S,"unitPrice",Number(g.target.value)),style:{width:"100%",textAlign:"right"}})}),e.jsx("td",{style:{padding:10,borderBottom:"1px solid var(--border)",textAlign:"right",color:"var(--text-secondary)"},children:N(o.refCost)}),e.jsx("td",{style:{padding:10,borderBottom:"1px solid var(--border)",textAlign:"right",fontWeight:600},children:N(o.amount)}),e.jsx("td",{style:{padding:10,borderBottom:"1px solid var(--border)",textAlign:"right"},children:e.jsx("span",{style:{color:(o.rowProfitRate||0)>=15?"var(--success)":(o.rowProfitRate||0)<5?"var(--error)":"inherit"},children:O(o.rowProfitRate)})}),e.jsx("td",{style:{padding:10,borderBottom:"1px solid var(--border)",textAlign:"center"},children:e.jsx("button",{className:"btn btn-ghost",onClick:()=>ee(i.id,S),style:{color:"var(--error)",padding:4},children:e.jsx($,{size:14})})})]},o.id)),!((f=i==null?void 0:i.items)!=null&&f.length)&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,style:{padding:40,textAlign:"center",color:"var(--text-secondary)"},children:"왼쪽에서 품목을 클릭하여 추가하세요."})})]})]})})]})]})},re=()=>{var m,f,o,S;const i=((m=s.customers)==null?void 0:m.reduce((g,W)=>{var P;return g+(((P=W.items)==null?void 0:P.reduce((q,L)=>q+(L.amount||0),0))||0)},0))||0,p=((f=s.customers)==null?void 0:f.reduce((g,W)=>{var P;return g+(((P=W.items)==null?void 0:P.reduce((q,L)=>q+(L.refCost||0)*L.quantity,0))||0)},0))||0,r=i>0?(i-p)/i*100:0;let a="AUTO";return r<0?a="LOSS":r<10&&(a="TIER_AB"),e.jsxs("div",{className:"card",style:{padding:24,maxWidth:800,margin:"0 auto"},children:[e.jsx("h3",{style:{fontSize:18,fontWeight:600,marginBottom:24},children:"3. 검토 및 저장"}),e.jsxs("div",{style:{marginBottom:24,padding:16,background:"var(--bg-secondary)",borderRadius:8},children:[e.jsx("h4",{style:{fontSize:14,fontWeight:600,marginBottom:12},children:"기본 정보"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,fontSize:13},children:[e.jsxs("div",{children:[e.jsx("span",{style:{color:"var(--text-secondary)"},children:"회사구분: "}),e.jsx("strong",{children:s.companyType&&M[s.companyType]})]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:"var(--text-secondary)"},children:"레코드유형: "}),e.jsx("strong",{children:s.recordType&&U[s.recordType]})]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:"var(--text-secondary)"},children:"견적명: "}),e.jsx("strong",{children:s.quoteName})]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:"var(--text-secondary)"},children:"거래처: "}),e.jsx("strong",{children:(o=s.customers)==null?void 0:o.map(g=>g.accountName).join(", ")})]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:16,marginBottom:24},children:[e.jsxs("div",{style:{padding:16,background:"var(--bg-secondary)",borderRadius:8},children:[e.jsx("div",{style:{fontSize:12,color:"var(--text-secondary)"},children:"총 견적 금액"}),e.jsx("div",{style:{fontSize:24,fontWeight:700,color:"var(--primary)"},children:N(i)})]}),e.jsxs("div",{style:{padding:16,background:"var(--bg-secondary)",borderRadius:8},children:[e.jsx("div",{style:{fontSize:12,color:"var(--text-secondary)"},children:"총 원가"}),e.jsx("div",{style:{fontSize:24,fontWeight:700},children:N(p)})]}),e.jsxs("div",{style:{padding:16,background:"var(--bg-secondary)",borderRadius:8},children:[e.jsx("div",{style:{fontSize:12,color:"var(--text-secondary)"},children:"예상 이익률"}),e.jsx("div",{style:{fontSize:24,fontWeight:700,color:r>=15?"var(--success)":r<5?"var(--error)":"var(--warning)"},children:O(r)})]})]}),e.jsxs("div",{style:{padding:16,border:`1px solid ${a==="AUTO"?"var(--success)":a==="TIER_AB"?"var(--warning)":"var(--error)"}`,background:a==="AUTO"?"var(--success-bg)":a==="TIER_AB"?"var(--warning-bg)":"var(--error-bg)",borderRadius:8,marginBottom:32},children:[e.jsxs("h4",{style:{margin:0,marginBottom:8,color:a==="AUTO"?"var(--success)":a==="TIER_AB"?"var(--warning)":"var(--error)",display:"flex",alignItems:"center",gap:8},children:[e.jsx(oe,{size:16})," 승인 규칙: ",H[a]]}),e.jsxs("p",{style:{margin:0,fontSize:13},children:[a==="AUTO"&&"현재 이익률이 기준(15%)을 충족합니다. 저장 시 자동 승인됩니다.",a==="TIER_AB"&&"이익률이 기준 미달입니다. A/B 티어 승인이 필요합니다.",a==="LOSS"&&"손실 견적입니다. 특별 승인이 필요합니다."]})]}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsx("h4",{style:{fontSize:14,fontWeight:600,marginBottom:12},children:"거래처별 품목 요약"}),(S=s.customers)==null?void 0:S.map(g=>{var W,P;return e.jsx("div",{style:{padding:12,border:"1px solid var(--border)",borderRadius:8,marginBottom:8},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("strong",{children:g.accountName}),e.jsxs("span",{style:{fontSize:13,color:"var(--text-secondary)"},children:[((W=g.items)==null?void 0:W.length)||0,"건 / ",N((P=g.items)==null?void 0:P.reduce((q,L)=>q+(L.amount||0),0))]})]})},g.id)})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:12},children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>j(2),disabled:n,children:"이전"}),e.jsxs("button",{className:"btn btn-primary",onClick:w,disabled:n,style:{display:"flex",alignItems:"center",gap:8},children:[n?e.jsx(_,{size:16,style:{animation:"spin 1s linear infinite"}}):e.jsx(de,{size:16}),n?"저장 중...":"견적 저장"]})]})]})};return e.jsxs("div",{style:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsx("div",{style:{padding:"16px 20px",borderBottom:"1px solid var(--border)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[e.jsx("button",{className:"btn btn-ghost",onClick:c,children:e.jsx(G,{size:16})}),e.jsx("h2",{style:{fontSize:18,fontWeight:600,margin:0},children:t?"견적 수정":"새 견적 작성"})]})}),e.jsx("div",{style:{display:"flex",justifyContent:"center",padding:"16px 0",borderBottom:"1px solid var(--border)"},children:[{num:1,label:"기본 정보"},{num:2,label:"품목 선택"},{num:3,label:"검토 및 저장"}].map((i,p)=>e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("div",{style:{width:28,height:28,borderRadius:"50%",background:x>=i.num?"var(--primary)":"var(--bg-secondary)",color:x>=i.num?"white":"var(--text-secondary)",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:600,fontSize:12},children:i.num}),e.jsx("span",{style:{fontSize:13,color:x>=i.num?"var(--text-primary)":"var(--text-secondary)"},children:i.label})]}),p<2&&e.jsx("div",{style:{width:40,height:2,background:x>i.num?"var(--primary)":"var(--bg-secondary)",margin:"0 12px"}})]},i.num))}),e.jsxs("div",{style:{flex:1,overflow:"auto",padding:24},children:[x===1&&X(),x===2&&te(),x===3&&re()]})]})}function Te({quoteId:t,onBack:c,onEdit:l}){var T,v,C,R,A,E,I;const[x,j]=u.useState("items"),[s,b]=u.useState(0),h={quoteId:t,companyType:"TNT",quoteName:"2025년 상반기 정기 납품",recordType:"TNT_DOUBLE",quoteStatus:"DRAFT",approvalRule:"AUTO",totalAmount:15e7,totalCost:12e7,expectedProfitRate:20,createdAt:"2024-11-29T10:30:00",updatedAt:"2024-11-29T14:20:00",assigneeName:"홍길동",project:{projectName:"삼성 평택 공장 증설"},customers:[{id:1,quoteId:t,accountId:"ACC-001",accountName:"삼성전자",subtotalAmount:1e8,subtotalCost:8e7,subtotalProfitRate:20,createdAt:"2024-11-29",updatedAt:"2024-11-29",items:[{id:1,itemId:"ITEM-UUID-1",quoteCustomerId:1,itemNo:"ITEM-001",itemName:"복층유리 24mm",quantity:1e3,unitPrice:42e3,refTier:"A",refCost:36e3,refIndividualAvg:4e4,rowProfitRate:14.3,amount:42e6,createdAt:"2024-11-29",updatedAt:"2024-11-29"},{id:2,itemId:"ITEM-UUID-2",quoteCustomerId:1,itemNo:"ITEM-002",itemName:"강화유리 12mm",quantity:500,unitPrice:33e3,refTier:"B",refCost:28e3,refIndividualAvg:31e3,rowProfitRate:15.2,amount:165e5,createdAt:"2024-11-29",updatedAt:"2024-11-29"},{id:3,itemId:"ITEM-UUID-3",quoteCustomerId:1,itemNo:"ITEM-003",itemName:"실란트 300ml",quantity:2e3,unitPrice:4500,refTier:"C",refCost:4e3,refIndividualAvg:4300,rowProfitRate:11.1,amount:9e6,createdAt:"2024-11-29",updatedAt:"2024-11-29"}]},{id:2,quoteId:t,accountId:"ACC-002",accountName:"LG전자",subtotalAmount:5e7,subtotalCost:4e7,subtotalProfitRate:20,createdAt:"2024-11-29",updatedAt:"2024-11-29",items:[{id:4,itemId:"ITEM-UUID-4",quoteCustomerId:2,itemNo:"ITEM-001",itemName:"복층유리 24mm",quantity:800,unitPrice:41e3,refTier:"A",refCost:36e3,refIndividualAvg:4e4,rowProfitRate:12.2,amount:328e5,createdAt:"2024-11-29",updatedAt:"2024-11-29"},{id:5,itemId:"ITEM-UUID-5",quoteCustomerId:2,itemNo:"ITEM-004",itemName:"알루미늄 바",quantity:1500,unitPrice:11500,refTier:"B",refCost:9600,refIndividualAvg:11e3,rowProfitRate:16.5,amount:1725e4,createdAt:"2024-11-29",updatedAt:"2024-11-29"}]}]},z=[{date:"2024-11-29 14:20",user:"홍길동",action:"견적 수정",detail:"단가 조정"},{date:"2024-11-29 10:30",user:"홍길동",action:"견적 생성",detail:"초기 작성"}],k=K[h.quoteStatus],y=(T=h.customers)==null?void 0:T[s];return e.jsxs("div",{style:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{padding:"16px 20px",borderBottom:"1px solid var(--border)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[e.jsx("button",{className:"btn btn-ghost",onClick:c,children:e.jsx(G,{size:16})}),e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("h2",{style:{fontSize:18,fontWeight:600,margin:0},children:h.quoteId}),e.jsx("span",{style:{padding:"2px 8px",borderRadius:4,fontSize:11,background:"var(--primary-bg)",color:"var(--primary)"},children:M[h.companyType]}),e.jsx("span",{className:"badge",style:{background:k.bg,color:k.color},children:k.label})]}),e.jsx("p",{style:{margin:0,fontSize:13,color:"var(--text-secondary)"},children:h.quoteName})]})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsxs("button",{className:"btn btn-secondary",style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx(le,{size:14})," 복제"]}),e.jsxs("button",{className:"btn btn-secondary",style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx(ae,{size:14})," Slack"]}),e.jsxs("button",{className:"btn btn-primary",onClick:l,style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx(F,{size:14})," 수정"]}),e.jsxs("button",{className:"btn btn-success",style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx(xe,{size:14})," 승인요청"]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"320px 1fr",gap:20,flex:1,overflow:"hidden",padding:20},children:[e.jsxs("div",{className:"card",style:{padding:0,overflow:"auto"},children:[e.jsxs("div",{style:{padding:20,borderBottom:"1px solid var(--border)"},children:[e.jsxs("h4",{style:{fontSize:14,fontWeight:600,marginBottom:16,display:"flex",alignItems:"center",gap:8},children:[e.jsx(V,{size:16})," 기본 정보"]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:12,color:"var(--text-secondary)",display:"block"},children:"레코드 유형"}),e.jsx("div",{style:{fontWeight:500,fontSize:13},children:U[h.recordType]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:12,color:"var(--text-secondary)",display:"block"},children:"프로젝트"}),e.jsx("div",{style:{fontWeight:500,fontSize:13},children:(v=h.project)==null?void 0:v.projectName})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:12,color:"var(--text-secondary)",display:"block"},children:"승인 규칙"}),e.jsx("div",{style:{fontWeight:500,fontSize:13},children:H[h.approvalRule]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:12,color:"var(--text-secondary)",display:"block"},children:"ERP 동기화"}),e.jsx("div",{style:{fontWeight:500,fontSize:13},children:e.jsx("span",{style:{padding:"2px 6px",borderRadius:4,fontSize:11,background:"var(--bg-secondary)",color:"var(--text-secondary)"},children:"미동기화"})})]})]})]}),e.jsxs("div",{style:{padding:20,borderBottom:"1px solid var(--border)"},children:[e.jsx("h4",{style:{fontSize:14,fontWeight:600,marginBottom:16},children:"금액 정보"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:12,color:"var(--text-secondary)",display:"block"},children:"총 견적 금액"}),e.jsx("div",{style:{fontSize:20,fontWeight:700,color:"var(--primary)"},children:N(h.totalAmount)})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:12,color:"var(--text-secondary)",display:"block"},children:"총 원가"}),e.jsx("div",{style:{fontSize:16,fontWeight:600},children:N(h.totalCost)})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:12,color:"var(--text-secondary)",display:"block"},children:"예상 이익률"}),e.jsx("div",{style:{fontSize:20,fontWeight:700,color:"var(--success)"},children:O(h.expectedProfitRate)})]})]})]}),e.jsxs("div",{style:{padding:20,borderBottom:"1px solid var(--border)"},children:[e.jsxs("h4",{style:{fontSize:14,fontWeight:600,marginBottom:16},children:["거래처 (",((C=h.customers)==null?void 0:C.length)||0,")"]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:(R=h.customers)==null?void 0:R.map((d,n)=>{var B;return e.jsxs("div",{style:{padding:12,background:s===n?"var(--primary-bg)":"var(--bg-secondary)",borderRadius:8,cursor:"pointer",border:s===n?"1px solid var(--primary)":"1px solid transparent"},onClick:()=>b(n),children:[e.jsx("div",{style:{fontWeight:500,fontSize:13},children:d.accountName}),e.jsxs("div",{style:{fontSize:12,color:"var(--text-secondary)",marginTop:4},children:[((B=d.items)==null?void 0:B.length)||0,"건 / ",N(d.subtotalAmount)]})]},d.id)})})]}),e.jsxs("div",{style:{padding:20},children:[e.jsxs("h4",{style:{fontSize:14,fontWeight:600,marginBottom:16,display:"flex",alignItems:"center",gap:8},children:[e.jsx(he,{size:16})," 담당자 정보"]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:12,color:"var(--text-secondary)",display:"block"},children:"담당자"}),e.jsx("div",{style:{fontWeight:500,fontSize:13},children:h.assigneeName})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:12,color:"var(--text-secondary)",display:"block"},children:"등록일"}),e.jsx("div",{style:{fontWeight:500,fontSize:13},children:h.createdAt.split("T")[0]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:12,color:"var(--text-secondary)",display:"block"},children:"최종 수정"}),e.jsx("div",{style:{fontWeight:500,fontSize:13},children:h.updatedAt.replace("T"," ")})]})]})]})]}),e.jsxs("div",{className:"card",style:{display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx("div",{style:{borderBottom:"1px solid var(--border)",padding:"0 16px"},children:e.jsx("div",{style:{display:"flex",gap:0},children:[{key:"items",label:"품목 목록"},{key:"history",label:"승인 이력"}].map(d=>e.jsx("button",{onClick:()=>j(d.key),style:{padding:"12px 20px",background:"none",border:"none",borderBottom:x===d.key?"2px solid var(--primary)":"2px solid transparent",color:x===d.key?"var(--primary)":"var(--text-secondary)",fontWeight:x===d.key?600:400,cursor:"pointer",fontSize:14},children:d.label},d.key))})}),x==="items"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{padding:"12px 16px",borderBottom:"1px solid var(--border)",background:"var(--bg-secondary)"},children:e.jsx("div",{style:{display:"flex",gap:8},children:(A=h.customers)==null?void 0:A.map((d,n)=>e.jsx("button",{onClick:()=>b(n),className:`btn ${s===n?"btn-primary":"btn-secondary"}`,style:{fontSize:12,padding:"4px 12px"},children:d.accountName},d.id))})}),e.jsxs("div",{style:{padding:"12px 16px",borderBottom:"1px solid var(--border)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{fontSize:13,color:"var(--text-secondary)"},children:[e.jsx("strong",{children:y==null?void 0:y.accountName})," - ",((E=y==null?void 0:y.items)==null?void 0:E.length)||0,"건 / 소계: ",e.jsx("strong",{style:{color:"var(--primary)"},children:N(y==null?void 0:y.subtotalAmount)})]}),e.jsx("button",{className:"btn btn-secondary",style:{fontSize:12},children:"Excel"})]}),e.jsx("div",{style:{flex:1,overflow:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:13},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"var(--bg-secondary)"},children:[e.jsx("th",{style:{padding:"10px 12px",textAlign:"left",borderBottom:"1px solid var(--border)"},children:"품목명"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"center",borderBottom:"1px solid var(--border)",width:60},children:"티어"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"right",borderBottom:"1px solid var(--border)",width:80},children:"수량"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"right",borderBottom:"1px solid var(--border)",width:100},children:"단가"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"right",borderBottom:"1px solid var(--border)",width:100},children:"참조원가"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"right",borderBottom:"1px solid var(--border)",width:100},children:"개별평균가"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"right",borderBottom:"1px solid var(--border)",width:120},children:"금액"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"right",borderBottom:"1px solid var(--border)",width:70},children:"이익률"})]})}),e.jsx("tbody",{children:(I=y==null?void 0:y.items)==null?void 0:I.map(d=>e.jsxs("tr",{style:{borderBottom:"1px solid var(--border)"},children:[e.jsxs("td",{style:{padding:"10px 12px"},children:[e.jsx("div",{style:{fontWeight:500},children:d.itemName}),e.jsx("div",{style:{fontSize:11,color:"var(--text-secondary)"},children:d.itemNo})]}),e.jsx("td",{style:{padding:"10px 12px",textAlign:"center"},children:e.jsx("span",{style:{padding:"2px 8px",borderRadius:4,fontSize:11,background:d.refTier==="A"?"var(--success-bg)":d.refTier==="B"?"var(--info-bg)":"var(--bg-secondary)",color:d.refTier==="A"?"var(--success)":d.refTier==="B"?"var(--info)":"var(--text-secondary)"},children:d.refTier})}),e.jsx("td",{style:{padding:"10px 12px",textAlign:"right"},children:d.quantity.toLocaleString()}),e.jsx("td",{style:{padding:"10px 12px",textAlign:"right"},children:d.unitPrice.toLocaleString()}),e.jsx("td",{style:{padding:"10px 12px",textAlign:"right",color:"var(--text-secondary)"},children:N(d.refCost)}),e.jsx("td",{style:{padding:"10px 12px",textAlign:"right",color:"var(--text-secondary)"},children:N(d.refIndividualAvg)}),e.jsx("td",{style:{padding:"10px 12px",textAlign:"right",fontWeight:600},children:N(d.amount)}),e.jsx("td",{style:{padding:"10px 12px",textAlign:"right"},children:e.jsx("span",{style:{color:(d.rowProfitRate||0)>=15?"var(--success)":(d.rowProfitRate||0)<5?"var(--error)":"inherit"},children:O(d.rowProfitRate)})})]},d.id))}),e.jsx("tfoot",{children:e.jsxs("tr",{style:{background:"var(--bg-secondary)",fontWeight:600},children:[e.jsx("td",{colSpan:6,style:{padding:"10px 12px",textAlign:"right"},children:"소계"}),e.jsx("td",{style:{padding:"10px 12px",textAlign:"right",color:"var(--primary)"},children:N(y==null?void 0:y.subtotalAmount)}),e.jsx("td",{style:{padding:"10px 12px",textAlign:"right"},children:O(y==null?void 0:y.subtotalProfitRate)})]})})]})})]}),x==="history"&&e.jsx("div",{style:{flex:1,overflow:"auto",padding:16},children:e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:z.map((d,n)=>e.jsxs("div",{style:{display:"flex",gap:16,padding:16,background:"var(--bg-secondary)",borderRadius:8,alignItems:"flex-start"},children:[e.jsx("div",{style:{width:32,height:32,borderRadius:"50%",background:"var(--primary-bg)",color:"var(--primary)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:e.jsx(ye,{size:14})}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4},children:[e.jsx("span",{style:{fontWeight:600,fontSize:13},children:d.action}),e.jsx("span",{style:{fontSize:12,color:"var(--text-secondary)"},children:d.date})]}),e.jsxs("div",{style:{fontSize:13,color:"var(--text-secondary)"},children:[d.user," - ",d.detail]})]})]},n))})})]})]})]})}function Oe(){const[t,c]=u.useState("list"),[l,x]=u.useState(null);u.useEffect(()=>{const T=v=>{v.key==="Escape"&&(t==="create"||t==="edit"?c(l?"view":"list"):t==="view"&&(c("list"),x(null))),v.ctrlKey&&v.key==="n"&&(v.preventDefault(),j())};return window.addEventListener("keydown",T),()=>window.removeEventListener("keydown",T)},[t,l]);const j=()=>{x(null),c("create")},s=T=>{x(T),c("view")},b=T=>{x(T),c("edit")},h=()=>{c("list"),x(null)},z=()=>{c("view")},k=()=>{c(l?"view":"list")},y=()=>{const T=[{key:"list",label:"목록",icon:ce},...l?[{key:"view",label:"상세",icon:pe}]:[],...t==="create"?[{key:"create",label:"신규",icon:F}]:[],...t==="edit"?[{key:"edit",label:"수정",icon:F}]:[]];return e.jsxs("div",{className:"card",style:{padding:"8px 16px",marginBottom:16,display:"flex",alignItems:"center",gap:4,background:"var(--bg-secondary)"},children:[T.map((v,C)=>{const R=v.icon,A=t===v.key,E=v.key==="list"||v.key==="view"&&l;return e.jsxs(se.Fragment,{children:[C>0&&e.jsx(ie,{size:14,style:{color:"var(--text-secondary)"}}),e.jsxs("button",{className:A?"btn btn-primary":"btn btn-ghost",style:{padding:"6px 12px",display:"flex",alignItems:"center",gap:6,fontSize:13},onClick:()=>{v.key==="list"?h():v.key==="view"&&l&&c("view")},disabled:!E&&!A,children:[e.jsx(R,{size:14}),v.label]})]},v.key)}),e.jsxs("div",{style:{marginLeft:"auto",fontSize:11,color:"var(--text-secondary)",display:"flex",gap:16},children:[e.jsxs("span",{children:[e.jsx("kbd",{style:{padding:"2px 6px",background:"var(--bg-primary)",borderRadius:4,fontSize:10},children:"Esc"})," 뒤로"]}),e.jsxs("span",{children:[e.jsx("kbd",{style:{padding:"2px 6px",background:"var(--bg-primary)",borderRadius:4,fontSize:10},children:"Ctrl+N"})," 신규"]})]})]})};return e.jsxs("div",{style:{padding:24,height:"100%",display:"flex",flexDirection:"column",background:"var(--panel)"},children:[e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs("h1",{style:{fontSize:24,fontWeight:700,marginBottom:4,display:"flex",alignItems:"center",gap:8},children:[e.jsx(V,{size:24,style:{color:"var(--primary)"}}),"견적 관리"]}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:13,margin:0},children:"TNT/DYS 견적서 작성 및 승인 관리"})]}),e.jsx(y,{}),e.jsxs("div",{style:{flex:1,minHeight:0,overflow:"hidden"},children:[t==="list"&&e.jsx(Se,{onCreate:j,onView:s}),t==="view"&&l&&e.jsx(Te,{quoteId:l,onBack:h,onEdit:()=>b(l)}),t==="create"&&e.jsx(Y,{onCancel:h,onSuccess:k}),t==="edit"&&l&&e.jsx(Y,{quoteId:l,onCancel:z,onSuccess:k})]})]})}export{Oe as QuotePage};
